<!DOCTYPE html>
<!-- saved from url=(0068)http://www.ovirt.org/documentation/admin-guide/administration-guide/ -->
<html class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" lang="ru"><!-- <![endif] --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>
OVirt Administration Guide —
oVirt
</title>
<meta charset="utf-8">
<meta content="" name="description">
<meta content="" name="author">
<meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport">

<link href="http://www.ovirt.org/images/favicon.ico" rel="shortcut icon">
<link href="http://www.ovirt.org/images/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed">
<link href="http://www.ovirt.org/images/apple-touch-icon-57x57-precomposed.png" rel="apple-touch-icon-precomposed" sizes="57x57">
<link href="http://www.ovirt.org/images/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72">
<link href="http://www.ovirt.org/images/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114">
<link href="./OVirt Administration Guide — oVirt_files/application.css" rel="stylesheet" type="text/css">
<link href="./OVirt Administration Guide — oVirt_files/print.css" rel="stylesheet" type="text/css" media="print">
<style type="text/css"></style><style type="text/css"></style><link rel="stylesheet" type="text/css" href="chrome-extension://pkehgijcmpdhfbdbbnkijodmdjhbjlgp/skin/socialwidgets.css"></head>
<body class=" source-md">
<header class="masthead hidden-print" id="branding" role="banner">
<section class="hgroup">
<h1>
<a href="http://www.ovirt.org/"><img id="logo" class="logo is-svg" alt="oVirt" src="./OVirt Administration Guide — oVirt_files/logo.svg">
</a></h1>
</section>
<div id="access">
<nav role="navigation">
<ul class="nav nav-pills">
<li class="nav-link-home" role="menuitem">
<a href="http://www.ovirt.org/">Домашняя страница</a>
</li>

<li class="nav-link-blog" role="menuitem">
<a href="http://www.ovirt.org/blog/">Блог</a>
</li>

<li class="nav-link-download" role="menuitem">
<a href="http://www.ovirt.org/download/">Загрузки</a>
</li>

<li class="nav-link-documentation" role="menuitem">
<a href="http://www.ovirt.org/documentation/">Документация</a>
</li>

<li class="nav-link-develop" role="menuitem">
<a href="http://www.ovirt.org/develop/">Разработка</a>
</li>

<li class="nav-link-community" role="menuitem">
<a href="http://www.ovirt.org/community/">Сообщество</a>
</li>

<li class="nav-link-search" role="menuitem">
<a href="http://www.ovirt.org/search/">Поиск</a>
</li>

</ul>
</nav>

</div>
</header>

<section class="page-wrap" id="page-wrap">
<section class="page" id="page">
<ul class="breadcrumb">
<li><a href="http://www.ovirt.org/documentation/">Документация</a></li>
<li><a href="http://www.ovirt.org/documentation/admin-guide/">Руководство администратора</a></li>
<li class="active">Руководство администратора OVirt</li>
</ul>

<section class="container content" id="content">
<div class="alert alert-warning">
<div class="pull-right">
<a>Больше информации</a>
</div>
<div class="frontmatter-metadata">
<table class="metadata">
<caption>Метаданные Frontmatter</caption>
<tbody><tr>
<th>название</th>
<td>Руководство администратора OVirt</td>
</tr>
<tr>
<th>категория</th>
<td>документация</td>
</tr>
<tr>
<th>авторы</th>
<td>bproffitt, omachace, vered, wdennis</td>
</tr>
<tr>
<th>заголовок_wiki</th>
<td>OVirt Administration Guide</td>
</tr>
<tr>
<th>количество_ревизий_wiki</th>
<td>7</td>
</tr>
<tr>
<th>последнее_обновление_wiki</th>
<td>2015-11-16</td>
</tr>
</tbody></table>
</div>
Оригинал страницы на Wiki:
<a href="http://old.ovirt.org/OVirt_Administration_Guide" target="_blank">
OVirt Administration Guide
</a>
</div>

<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->

<h1 id="ovirt-administration-guide">Руководство администратора oVirt</h1>

<h2 id="introduction">Введение</h2>

<h3 id="ovirt-architecture">Архитектура oVirt</h3>

<p>В состав среды oVirt входят:</p>

<ul>
  <li><strong>Хосты</strong> виртуальных машин (ВМ), использующие Kernel-based Virtual Machine (KVM).</li>
  <li><strong>Агенты и инструменты</strong>, работающие на хостах, в т. ч. VDSM, QEMU и libvirt. Эти инструменты обеспечивают локальное управление ВМ, сетями и хранилищами.</li>
  <li><strong>oVirt</strong>, централизованная платформа управления средой oVirt. Она предоставляет графический интерфейс, с помощью которого можно отслеживать, предоставлять и настраивать ресурсы.</li>
  <li><strong>Домены хранилищ</strong> для хранения виртуальных ресурсов, таких как ВМ, шаблоны или ISO-образы.</li>
  <li><strong>База данных</strong> для отслеживания состояния среды и изменений в ней.</li>
  <li>Доступ к внешнему <strong>Серверу директорий</strong> для обеспечения аутентификации пользователей.</li>
  <li><strong>Сеть</strong> для объединения среды. Сюда входят физические сетевые каналы и логические сети.</li>
</ul>

<p><img alt="" title="Ovirt-1024x698.png" src="./OVirt Administration Guide — oVirt_files/Ovirt-1024x698.png"></p>

<p><strong>Рисунок&nbsp;1.1.&nbsp;Обзор платформы oVirt</strong></p>

<h3 id="ovirt-system-components">Компоненты системы oVirt</h3>

<p>Среда oVirt версии 3.4 состоит из одного или более узлов (хостов Red Hat Enterprise Linux 6.5 или более поздних (либо аналогов); хостов Fedora 19; oVirt Node 6.5 или более поздних), а также как минимум одного экземпляра oVirt.</p>

<p>Хосты выполняют ВМ с использованием технологии виртуализации KVM (Kernel-based Virtual Machine).</p>

<p>oVirt выполняется на сервере под управлением Red Hat Enterprise Linux (или аналогичном) либо на сервере Fedora 19 и предоставляет интерфейсы для управления средой oVirt. Он управляет подготовкой ВМ и хранилищ, протоколами соединения, пользовательскими сессиями, образами ВМ и ВМ высокой доступности.</p>

<p>Доступ к oVirt осуществляется через портал администрирования с использованием веб-браузера.</p>

<h3 id="ovirt-resources">Ресурсы oVirt</h3>

<p>Компоненты среды oVirt разделяются на две категории: физические ресурсы и логические ресурсы. Физические ресурсы — это реальные объекты, такие как сервера хостов и хранилищ. Логические ресурсы — это нематериальные структуры и процессы, такие как логические сети и шаблоны ВМ.</p>

<ul>
  <li><strong>Дата-центр</strong> — контейнер самого высокого уровня для всех физических и логических ресурсов в подконтрольной виртуальной среде. Он представляет собой объединение кластеров, ВМ, хранилищ и сетей.</li>
  <li><strong>Кластеры</strong> — группы физических хостов, которые выступают в качестве ресурсного пула для ВМ. Хосты кластера используют общие сетевую инфраструктуру и хранилища. Они образуют «домен миграции», в пределах которого ВМ могут перемещаться с хоста на хост.</li>
  <li><strong>Логические сети</strong> — логические представления физических сетей. Логические сети объединяют сетевой трафик и соединения между oVirt, хостами, хранилищами и ВМ.</li>
  <li><strong>Хосты</strong> — физические сервера, на которых работают одна или несколько ВМ. Хосты объединяются в кластеры. ВМ могут быть перенесены с одного хоста на другой в пределах того же кластера.</li>
  <li><strong>Пул хранилищ</strong> — логический объект, содержащий независимый банк образов (image repository) определенного типа (iSCSI, Fibre Channel, NFS или POSIX). Каждый пул хранилищ может содержать несколько доменов для хранения образов дисков ВМ и ISO-образов, а также для импорта/экспорта образов ВМ.</li>
  <li><strong>Виртуальные машины (ВМ)</strong> — виртуальные десктопы или серверы, содержащие операционную систему и набор приложений. В <strong>пуле</strong> может быть создано множество одинаковых ВМ. ВМ создаются, настраиваются и удаляются суперпользователями (power users), а доступ к ним предоставляется обычным пользователям.</li>
  <li><strong>Шаблон</strong> — эталонная ВМ с заранее определенными параметрами. ВМ, основанная на том или ином шаблоне, приобретает параметры этого шаблона. Использование шаблонов — самый быстрый способ создания большого количества ВМ в один шаг.</li>
  <li><strong>Пул ВМ</strong> — группа идентичных ВМ, доступных по запросу любого члена группы. Пулы ВМ могут быть организованы для различных целей. Например, один пул — для отдела маркетинга, другой — для отдела разработки, и т. п.</li>
  <li><strong>Снимки</strong> — состояния операционной системы ВМ и всех ее приложений в определенный момент времени. Снимки используются для сохранения параметров ВМ перед апгрейдом или установкой новых приложений. В случае проблем снимок можно использовать для возврата ВМ к ее исходному состоянию.</li>
  <li><strong>Типы пользователей</strong> — поддерживаемые oVirt администраторы и пользователи, имеющие разный уровень привилегий. Системные администраторы могут управлять объектами физической инфраструктуры, такими как дата-центры, хосты и хранилища. Пользователи обращаются к виртуальным машинам, доступным в пуле ВМ, или отдельным ВМ, которые администратор сделал доступными.</li>
  <li><strong>События и мониторы</strong> — сигналы тревоги, предупреждения и прочие уведомления о событиях, позволяющие администратору отслеживать производительность и состояние ресурсов.</li>
  <li><strong>Отчеты</strong> либо формируются модулем отчетов, основанным на JasperReports, либо берутся из базы данных (data warehouse). Модуль отчетов может формировать как заранее предопределенные, так и специальные отчеты. Пользователи также могут создавать отчеты на основе информации из базы, куда поступают данные о хостах, ВМ и хранилищах, используя любой инструмент запросов, поддерживающий SQL.</li>
</ul>

<h3 id="ovirt-api-support-statement">Заявление о поддержке API oVirt</h3>

<p>oVirt предоставляет различные интерфейсы для взаимодействия с компонентами среды виртуализации. Эти интерфейсы являются дополнением к тем, что предоставляются Порталом администрирования oVirt, Пользовательским порталом и Порталом отчетов. Многие из этих интерфейсов поддерживаются полностью, некоторые — в режиме только для чтения.</p>

<p><strong>Интерфейсы, поддерживающие доступ на чтение и запись</strong></p>

<p>Для следующих интерфейсов поддерживается и рекомендуется доступ как на чтение, так и на запись:</p>

<p>API REST (Representational State Transfer, «передача состояния представления»)<br>
API REST, предоставляемый oVirt, является полностью поддерживаемым интерфейсом взаимодействия с oVirt.</p>

<p>Software Development Kit (SDK)<br>
SDK, предоставляемый пакетами python-sdk и java-sdk, является полностью поддерживаемым интерфейсом взаимодействия с oVirt.</p>

<p>Командная оболочка<br>
Командная оболочка, предоставляемая пакетом ovirt-shell package, является полностью поддерживаемым интерфейсом взаимодействия с oVirt.</p>

<p>Ловушки VDSM<br>
Создание и использование ловушек VDSM, вызывающих модификацию ВМ на основе определенных на портале администрирования свойств, поддерживается хостами oVirt. Использование ловушек VDSM на хостах виртуализации, выполняющих oVirt Node, в настоящий момент не поддерживается.</p>

<p><strong>Интерфейсы, поддерживающие доступ на чтение</strong></p>

<p>Непосредственное взаимодействие со следующими интерфейсами поддерживается и рекомендуется только в режиме чтения. Использование этих интерфейсов для доступа на запись не поддерживается:</p>

<p>База данных истории oVirt<br>
Поддерживается доступ на чтение к базе данных истории oVirt с использованием выборок (database views), указанных в Руководстве администратора. Доступ на запись <em>не</em> поддерживается.</p>

<p>Libvirt на хостах виртуализации<br>
Доступ на чтение к <code>libvirt</code> с использованием команды <code>virsh -r</code> является поддерживаемым методом взаимодействия с хостами виртуализации. Доступ на запись <em>не</em> поддерживается.</p>

<p><strong>Неподдерживаемые интерфейсы</strong></p>

<p>Непосредственное взаимодействие со следующими интерфейсами <em>не</em> поддерживается:</p>

<p>Команда vdsClient<br>
Использование команды <code>vdsClient</code> для взаимодействия с хостами виртуализации <em>не</em> поддерживается.</p>

<p>Консоль oVirt Node<br>
Консольный доступ к oVirt Node извне предоставляемого текстового пользовательского интерфейса для настройки <em>не</em> поддерживается.</p>

<p>База данных oVirt<br>
Прямой доступ к базе данных oVirt и ее модификация <em>не</em> поддерживаются.</p>

<h3 id="administering-and-maintaining-the-ovirt-environment">Администрирование и поддержка среды oVirt</h3>

<p>Среда oVirt нуждается в администраторе, который будет поддерживать ее работу. В задачи администратора входит:</p>

<ul>
  <li>Управление физическими и логическими ресурсами, такими как хосты и ВМ. Сюда входят апгрейд и добавление хостов, импортирование доменов, конвертирование ВМ, созданных на внешних гипервизорах, и управление пулами ВМ.</li>
  <li>Мониторинг всех системных ресурсов на предмет потенциальных проблем, таких как чрезмерная нагрузка на один из хостов либо недостаток памяти/дискового пространства, и принятие всех необходимых мер (таких как миграция ВМ на другие хосты с целью снижения нагрузки или высвобождение ресурсов путем выключения машин).</li>
  <li>Удовлетворение новых требований ВМ (например, апгрейд ОС или выделение дополнительной памяти).</li>
  <li>Управление специальными свойствами объектов с использованием тегов.</li>
  <li>Управление поисковыми запросами, сохраненными как общедоступные закладки (public bookmarks).</li>
  <li>Управление пользователями и задание уровней привилегий.</li>
  <li>Решение проблем конкретных пользователей или виртуальных машин для поддержания системы в рабочем состоянии.</li>
  <li>Формирование общих и специальных отчетов.</li>
</ul>

<h2 id="using-the-administration-portal">Использование портала администрирования</h2>

<h3 id="graphical-user-interface-elements">Элементы графического интерфейса пользователя</h3>

<p>Административный портал oVirt состоит из контекстных панелей и меню, которые могут использоваться в двух режимах — режиме дерева и режиме списка. Режим дерева позволяет перемещаться по иерархии объекта дата-центра, тогда как режим списка позволяет отслеживать все ресурсы дата-центров в едином перечне. Элементы графического интерфейса пользователя показаны на следующем рисунке:</p>

<p>⁠</p>

<p><img alt="Ключевые элементы графического интерфейса пользователя" title="Ключевые элементы графического интерфейса пользователя" src="./OVirt Administration Guide — oVirt_files/Admin-portal-label.png"></p>

<p><strong>Рисунок&nbsp;2.1.&nbsp;Ключевые элементы графического интерфейса пользователя</strong></p>

<p><strong>Ключевые элементы графического интерфейса пользователя</strong></p>

<ul>
  <li><img alt="" title="fig:Bullet1.png" src="./OVirt Administration Guide — oVirt_files/Bullet1.png">
<strong>Заголовок.</strong>
Панель заголовка содержит имя текущего пользователя и кнопки <strong>Выйти из системы</strong>, <strong>О программе</strong>, <strong>Настроить</strong> и <strong>Руководство</strong>. Кнопка <strong>О программе</strong> показывает информацию о версии oVirt, кнопка <strong>Настроить</strong> позволяет настраивать пользовательские роли, а кнопка <strong>Руководство</strong> является ссылкой на руководство, которое вы сейчас читаете.
<strong>Строка поиска</strong> позволяет формировать запросы для нахождения ресурсов среды oVirt, таких как хосты и кластеры. Запросы могут быть как простыми (например, вывести список всех хостов в системе), так и более сложными (вывести список ресурсов, удовлетворяющих определенным условиям). По мере ввода поискового запроса будут предлагаться варианты, которые помогут сформировать запрос. Значок со звездочкой можно использовать, чтобы сохранить запрос как закладку.</li>
  <li><img alt="" title="fig:Bullet2.png" src="./OVirt Administration Guide — oVirt_files/Bullet2.png">
<strong>Панель «Система/Закладки/Теги».</strong>
Панель «Система» отображает иерархию ресурсов в виртуализированной среде (с возможностью навигации). Закладки используются для сохранения часто используемых или сложных поисковых запросов для многократного использования. Закладки можно добавлять, редактировать и удалять. Теги применяются к группам ресурсов и используются для поиска всех ресурсов, связанных с тем или иным тегом. Панель «Система/Закладки/Теги» можно минимизировать, воспользовавшись стрелкой в правом верхнем углу панели.</li>
  <li><img alt="" title="fig:Bullet3.png" src="./OVirt Administration Guide — oVirt_files/Bullet3.png">
<strong>Вкладки ресурсов.</strong>
Всеми ресурсами можно управлять, используя связанную с ними вкладку. А вкладка <strong>События</strong>, в свою очередь, позволяет отслеживать события для каждого ресурса. Портал администрирования предоставляет следующие вкладки: <strong>Дата-центры</strong>, <strong>Кластеры</strong>, <strong>Хосты</strong>, <strong>Сети</strong>, <strong>Хранилища</strong>, <strong>Диски</strong>, <strong>Виртуальные машины</strong>, <strong>Пулы</strong>, <strong>Шаблоны</strong>, <strong>Тома</strong>, <strong>Пользователи</strong> и <strong>События</strong>, а также вкладку <strong>Статистика (Dashboard)</strong>, если были установлены хранилище данных и отчеты.</li>
  <li><img alt="" title="fig:Bullet4.png" src="./OVirt Administration Guide — oVirt_files/Bullet4.png">
<strong>Список результатов.</strong>
Можно осуществить действие с одним элементом, несколькими элементами или всеми элементами в списке результатов, выбрав их и нажав подходящую кнопку действия. Информация о выбранном элементе отображается на панели сведений.
 <strong>Интервал обновления.</strong>
Выпадающее меню «Частота обновления сведений» в верхней части списка результатов позволяет установить время (в секундах), через которое портал администрирования будет обновляться. Чтобы исключить задержки между совершением действия и появлением результата, портал автоматически обновляется после действия или события вне зависимости от выбранного интервала обновления. Можно задать этот интервал, нажав на символ обновления в правом верхнем углу портала.</li>
  <li><img alt="" title="fig:Bullet5.png" src="./OVirt Administration Guide — oVirt_files/Bullet5.png">
<strong>Панель сведений.</strong>
Панель сведений отображает детальную информацию о выбранном элементе списка результатов. Если не выбрано ни одного элемента, панель скрывается. Если выбрано множество элементов, панель сведений отображает информацию только о первом из них.
 <strong>Панель «Оповещения/События».</strong>
Под панелью сведений на вкладке <strong>Оповещения</strong> выводятся все важные события, такие как ошибки и предупреждения. Вкладка <strong>События</strong> отображает список событий для всех ресурсов. Вкладка <strong>Задачи</strong> отображает список выполняющихся в текущий момент задач. Вы можете открыть эту панель, нажав на кнопку «Свернуть/развернуть».</li>
</ul>

<div class="alert alert-info">
  <p><strong>Важно:</strong> Минимальное разрешение для просмотра портала администрирования в браузере составляет 1024 x 768. Портал администрирования не будет отображаться корректно при меньшем разрешении.</p>

</div>
<div class="alert alert-info">
  <p><strong>Примечание:</strong> В oVirt 3.4 отображение пользовательского веб-интерфейса было улучшено, чтобы позволить порталу администрирования отображаться корректно при низких разрешениях или в неразвернутых окнах. Когда разрешение слишком мало или пространства окна недостаточно для того, чтобы вместить все вкладки меню, можно прокручивать вкладки влево и вправо и обращаться к выпадающему меню, которое содержит все эти вкладки. Панель <strong>Система/Закладки/Теги</strong> также может быть свернута, чтобы высвободить дополнительное пространство.</p>

</div>
<p>### Режим дерева и режим списка</p>

<p>Портал администрирования предоставляет два режима управления ресурсами: режим дерева и режим списка. В режиме дерева ресурсы отображаются в иерархическом виде, начиная от верхнего уровня дата-центра и заканчивая конкретной виртуальной машиной. Работа в режиме дерева настоятельно рекомендуется для большинства операций.</p>

<p>⁠</p>

<table>
  <tbody>
    <tr>
      <td>![режим дерева</td>
      <td>250px](Tree_mode.png "режим дерева</td>
      <td>250px")</td>
    </tr>
  </tbody>
</table>

<p><strong>Рисунок&nbsp;2.2.&nbsp;Режим дерева</strong></p>

<p>Режим списка позволяет выполнять поиск по дата-центрам или доменам хранилищ. Он не ограничивает просмотр ресурсов рамками одной иерархии. Например, может понадобиться найти все ВМ, которые используют ЦП более чем на 80%, на всех кластерах и дата-центрах, или определить все хосты, которые имеют высшую степень использования. Режим списка делает это возможным. В дополнение к этому, определенные объекты, такие как <strong>пулы</strong> и <strong>пользователи</strong>, которые не входят в иерархию дата-центра, доступны только в режиме списка.</p>

<p>Чтобы получить доступ к режиму списка, нажмите на элемент <strong>Система</strong> на панели <strong>Дерево</strong> в левой части экрана. Если появляются вкладки ресурсов <strong>Пулы</strong> и <strong>Пользователи</strong> — это режим списка.</p>

<p>⁠</p>

<table>
  <tbody>
    <tr>
      <td>![Flat Mode</td>
      <td>250px](Flat_mode.png "Flat Mode</td>
      <td>250px")</td>
    </tr>
  </tbody>
</table>

<p><strong>Рисунок&nbsp;2.3.&nbsp;Режим списка</strong></p>

<h3 id="using-the-guide-me-facility">Использование инструмента «Пошаговый помощник»</h3>

<p>В процессе настройки ресурсов, таких как дата-центры и кластеры, необходимо последовательно решать множество задач. Контекстно-чувствительное окно <strong>Пошаговый помощник</strong> запрашивает действия, требуемые для ресурса, который настраивается в данный момент. Открыть окно <strong>Пошаговый помощник</strong> можно в любое время, нажав на кнопку <strong>Пошаговый помощник</strong> на панели ресурсов.</p>

<p>⁠</p>

<table>
  <tbody>
    <tr>
      <td>![New дата-центр Пошаговый помощник Window</td>
      <td>300px](Guide_me.png "New дата-центр Пошаговый помощник Window</td>
      <td>300px")</td>
    </tr>
  </tbody>
</table>

<p><strong>Рисунок&nbsp;2.4.&nbsp;Окно пошагового помощника «Новый дата-центр»</strong></p>

<h3 id="performing-searches-in-ovirt">Выполнение поиска в oVirt</h3>

<p>Портал администрирования позволяет управлять тысячами ресурсов, таких как виртуальные машины, хосты, пользователи и т. д. Чтобы выполнить поиск, введите поисковый запрос (прямым текстом или с использованием синтаксиса) в строку поиска. Поисковые запросы можно сохранять как закладки для дальнейшего использования, так что не придется заново вводить запрос всякий раз, когда требуются определенные результаты поиска.</p>

<div class="alert alert-info">
  <p><strong>Примечание:</strong> В версиях до oVirt 3.4 поиск на портале администрирования был чувствителен к регистру. Сейчас поисковая строка поддерживает и регистронезависимый поиск.</p>

</div>
<p>### Сохранение поискового запроса в виде закладки</p>

<p><strong>Описание задачи</strong></p>

<p>Поисковый запрос можно сохранить в виде закладки и сделать его доступным для других пользователей.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;2.1.&nbsp;Сохранение поискового запроса в виде закладки</strong></p>

<ol>
  <li>Введите поисковый запрос в строку и выполните поиск.</li>
  <li>
    <p>Нажмите на значок <strong>Закладки</strong> в форме звездочки справа от строки поиска, чтобы открыть окно <strong>Новая закладка</strong>.
⁠</p>

    <p><img alt="Значок закладки" title="Значок закладки" src="./OVirt Administration Guide — oVirt_files/Bookmark.png"></p>

    <p><strong>Рисунок&nbsp;2.5.&nbsp;Значок закладки</strong></p>
  </li>
  <li>Введите <strong>Имя</strong> закладки.</li>
  <li>Введите <strong>Строку поиска</strong> (если доступно).</li>
  <li>Нажмите <strong>OK</strong>, чтобы сохранить запрос как закладку, и закройте окно.</li>
  <li>Поисковый запрос будет сохранен и отобразится на панели <strong>Закладки</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы сохранили поисковый запрос как закладку для применения в будущем. Используйте панель <strong>Закладки</strong>, чтобы найти и выбрать закладку.</p>

<h2 id="data-centers">⁠Дата-центры</h2>

<h3 id="introduction-to-data-centers">Введение</h3>

<p>Дата-центр — это логический объект, определяющий набор ресурсов, используемых в определенной среде. Дата-центр рассматривается как ресурс-контейнер, поскольку он включает в себя логические ресурсы (в форме кластеров и хостов), сетевые ресурсы (в форме логических сетей и физических NIC) и ресурсы хранения в форме доменов хранения.</p>

<p>Дата-центр может состоять из множества кластеров, каждый из которых может содержать множество хостов; с ним могут быть связаны несколько доменов хранения; он поддерживает несколько ВМ на каждом хосте. Среда oVirt может содержать множество дата-центров; инфраструктура дата-центра позволяет работать с этими центрами по отдельности.</p>

<p>Все дата-центры управляются из единого портала администрирования.</p>

<p>oVirt создает дата-центр по умолчанию во время установки. Этот дата-центр рекомендуется не удалять; вместо этого создавайте новые дата-центры с нужными названиями.</p>

<h3 id="the-storage-pool-manager">Менеджер пула хранилищ</h3>

<p>Менеджер пула хранилищ (SPM) — это роль, назначаемая одному из хостов в дата-центре и позволяющая ему управлять доменами хранилищ дата-центра. SPM может быть запущен на любом хосте дата-центра; oVirt назначает роль одному из хостов. SPM не мешает осуществлению стандартных операций хоста; хост, работающий как SPM, по-прежнему остается хостом для виртуальных ресурсов.</p>

<p>Объект SPM управляет доступом к хранилищам, координируя метаданные в доменах хранения. Сюда входит создание, удаление и манипулирование виртуальными дисками (образами), снимками (snapshots) и шаблонами и выделение хранилищ для распределенных блочных устройств (на SAN). Это уникальный объект: только один хост может являться SPM в дата-центре в один момент времени, чтобы можно было гарантировать целостность метаданных.</p>

<p>oVirt проверяет, чтобы SPM был всегда доступен. oVirt переназначает роль SPM другому хосту, если текущий хост SPM имеет проблемы с доступом к хранилищу. Когда SPM начинает работу, он убеждается, что является единственным, кому назначена эта роль; вследствие этого он получает storage-centric lease. Этот процесс может занять некоторое время.</p>

<h3 id="spm-priority">Приоритет SPM</h3>

<p>Роль SPM использует часть доступных ресурсов хоста. Параметр хоста «приоритет SPM» влияет на вероятность того, что хосту назначат роль SPM: хост с высоким приоритетом SPM получит роль SPM скорее, чем хост с низким приоритетом SPM. Важные ВМ на хостах с низким приоритетом SPM не будут конфликтовать с операциями SPM за ресурсы хоста.</p>

<p>Можно изменить приоритет SPM, отредактировав параметры хоста.</p>

<h3 id="using-the-events-tab-to-identify-problem-objects-in-data-centers">Использование вкладки «События» для идентификации проблемных объектов в дата-центрах</h3>

<p>Вкладка <strong>События</strong> отображает все события, связанные с определенным дата-центром. Понятие «события» включает отчеты (audits), предупреждения и ошибки. Информация, отображаемая в списке результатов, позволяет идентифицировать проблемные объекты в среде oVirt.</p>

<p>Список результатов для <strong>событий</strong> может отображаться в двух режимах: обычном и расширенном. В обычном режиме показываются иконка события, время его наступления и описание. В расширенном режиме также показываются (когда это возможно) ID события, связанные с ним пользователь, хост, ВМ, шаблон, дата-центр, хранилище и кластер, а также том Gluster и correlation ID.</p>

<h3 id="data-center-tasks">Работа с дата-центром</h3>

<h4 id="creating-a-new-data-center">Создание нового дата-центра</h4>

<p><strong>Описание задачи</strong></p>

<p>Это Действие по созданию дата-центра в среде виртуализации. Для работы дата-центру требуются функционирующий кластер, хост и домен хранения.</p>

<div class="alert alert-info">
  <p><strong>Примечание:</strong> <strong>тип</strong> хранилища может быть изменен до того, как первый домен хранения будет добавлен к дата-центру. После этого изменить <strong>тип</strong> хранилища будет нельзя.</p>

  <p>Если будет выбрана <strong>версия совместимости</strong> <strong>3.1</strong>, в дальнейшем её нельзя будет изменить на <strong>3.0</strong>; понижение версий не допускается.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;3.1.&nbsp;Создание нового дата-центра</strong></p>

<ol>
  <li>Откройте вкладку <strong>Дата-центры</strong>, чтобы в списке результатов появились все дата-центры.</li>
  <li>Нажмите <strong>Новое</strong>, чтобы открыть окно <strong>Новый дата-центр</strong>.</li>
  <li>Введите <strong>Имя</strong> и <strong>Описание</strong> дата-центра.</li>
  <li>Выберите <strong>Тип хранилища</strong>, <strong>Версию совместимости</strong> и <strong>Режим квоты</strong> дата-центра из выпадающих меню.</li>
  <li>Нажмите <strong>OK</strong>, чтобы создать дата-центр и открыть окно <strong>Новый дата-центр — Пошаговый помощник</strong>.</li>
  <li>В окне <strong>Пошагового помощника</strong> будут перечислены объекты, которые необходимо сконфигурировать для дата-центра. Настройте эти объекты или отложите настройку, нажав на кнопку <strong>Настроить позже</strong>; к настройке можно будет вернуться, выбрав дата-центр и нажав на кнопку <strong>Пошаговый помощник</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>В среду виртуализации будет добавлен новый дата-центр. Он будет оставаться <strong>неинициализированным</strong>, пока для него не будут настроены кластер, хост и домен хранения; используйте <strong>Пошаговый помощник</strong>, чтобы настроить эти объекты.</p>

<h4 id="explanation-of-settings-in-the-new-data-center-and-edit-data-center-windows">Пояснение к свойствам в окнах «Новый дата-центр» и «Параметры дата-центра»</h4>

<p>Следующая таблица описывает свойства дата-центра, встречающиеся в окнах <strong>Новый дата-центр</strong> и <strong>Параметры дата-центра</strong>. При нажатии <strong>OK</strong> неверные данные обводятся оранжевой линией, что препятствует принятию изменений. Также в полях ввода показываются ожидаемые значения или диапазоны значений.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;3.1.&nbsp;Свойства дата-центра</strong></p>

<table>
<colgroup>
<col width="15%">
<col width="85%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание/Действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Название дата-центра. Это текстовое поле имеет ограничение в 40 символов и должно содержать уникальное имя, состоящее из букв в верхнем и нижнем регистрах, цифр, дефисов и подчеркиваний.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Описание дата-центра. Это поле является рекомендуемым, но не обязательным.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Тип</strong></p></td>
<td align="left"><p>Тип хранилища. Выберите один из следующих:</p>
<ul>
<li><strong>Общий</strong></li>
<li><strong>Локальный</strong></li>
</ul>
<p>Тип домена данных определяет тип дата-центра и не может быть изменен после создания без существенных нарушений. К одному дата-центру можно добавить множество типов доменов хранения (iSCSI, NFS, FC, POSIX и Gluster), но нельзя смешивать локальные и распределенные домены.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Версия совместимости</strong></p></td>
<td align="left"><p>Версия oVirt. Выберите одну из следующих:</p>
<ul>
<li><strong>3.0</strong></li>
<li><strong>3.1</strong></li>
<li><strong>3.2</strong></li>
<li><strong>3.3</strong></li>
<li><strong>3.4</strong></li>
<li><strong>3.5</strong></li>
<li><strong>3.6</strong></li>
</ul>
<p>После обновления oVirt хосты, кластеры и дата-центры могут по-прежнему относиться к старой версии. Убедитесь, что все и кластеры обновлены, перед тем как изменить уровень совместимости дата-центра. </p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Режим квоты</strong></p></td>
<td align="left"><p>Квота — это инструмент ограничения ресурсов, предоставляемый oVirt. Доступные варианты:</p>
<ul>
<li><strong>Отключено</strong>: выберите, если не хотите использовать квоту</li>
<li><strong>Аудит</strong>: выберите, если хотите изменить параметры квоты</li>
<li><strong>Принудительно</strong>: выберите, чтобы применить квоту</li>
</ul></td>
</tr>
</tbody>
</table>

<h4 id="editing-a-resource">Редактирование ресурса</h4>

<p><strong>Описание задачи</strong></p>

<p>Редактирование свойств ресурса.</p>

<p><strong>Инструкция&nbsp;3.2.&nbsp;Редактирование ресурса</strong></p>

<ol>
  <li>Используйте вкладки ресурсов, режим дерева или функцию поиска, чтобы найти и выбрать ресурс в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong>, чтобы открыть окно <strong>Параметры</strong>.</li>
  <li>Измените нужные свойства и нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новые свойства ресурса будут сохранены. Окно <strong>Параметры</strong> не закроется, если какое-либо поле свойства заполнено некорректно.</p>

<h4 id="creating-a-new-logical-network-in-a-data-center-or-cluster">Создание новой логической сети в дата-центре или кластере</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание логической сети и ее настройка для использования в дата-центре или в кластерах дата-центра.</p>

<p><strong>Инструкция&nbsp;3.3.&nbsp;Создание новой логической сети в дата-центре или кластере</strong></p>

<ol>
  <li>Используйте вкладки ресурсов <strong>Дата-центры</strong> или <strong>Кластеры</strong>, режим дерева либо функцию поиска, чтобы найти и выбрать дата-центр или кластер в списке результатов.</li>
  <li>Нажмите на вкладку <strong>Логические сети</strong> на панели сведений, чтобы вывести существующие логические сети.</li>
  <li>На панели сведений дата-центра нажмите <strong>Новая</strong>, чтобы открыть окно <strong>Новая логическая сеть</strong>. На панели сведений кластера нажмите <strong>Добавить сеть</strong>, чтобы открыть окно <strong>Новая логическая сеть</strong></li>
  <li>Введите <strong>Имя</strong>, <strong>Описание</strong> и <strong>Комментарий</strong> для логической сети.</li>
  <li>В секции <strong>Экспорт</strong> отметьте пункт <strong>Создать на внешнем поставщике</strong>, чтобы создать логическую сеть на базе внешнего поставщика. Выберите внешнего поставщика из выпадающего меню <strong>Внешний поставщик</strong>.</li>
  <li>В секции <strong>Параметры сети</strong> отметьте пункты <strong>Включить добавление тегов для VLAN</strong>, <strong>Сеть ВМ</strong> и <strong>Пользовательское MTU</strong>, чтобы включить эти опции.</li>
  <li>Введите новую или выберите существующую метку для логической сети в текстовом поле <strong>Метка сети</strong>.</li>
  <li>На вкладке <strong>Кластер</strong> выберите кластеры, к которым будет относиться сеть. Также можно указать, будет ли логическая сеть требуемой.</li>
  <li>Если отмечен пункт <strong>Создать на внешнем поставщике</strong>, отобразится вкладка <strong>Подсеть</strong>. На вкладке <strong>Подсеть</strong> введите <strong>имя</strong> и <strong>CIDR</strong> и выберите <strong>версию IP</strong> для подсети, которую будет предоставлять логическая сеть.</li>
  <li>На вкладке <strong>Профили vNIC</strong> добавьте к логической сети требуемые профили vNIC.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы определили логическую сеть как ресурс, необходимый кластеру или кластерам в дата-центре. Если для логической сети была задана метка, сеть автоматически будет присоединена ко всем сетевым интерфейсам хостов с этой меткой.</p>

<div class="alert alert-info">
  <p><strong>Примечание:</strong> При создании новой логической сети или внесении изменений в существующую, которая используется как display network, все работающие виртуальные машины, которые используют эту сеть, должны быть перезагружены, прежде чем сеть станет доступной или изменения будут применены.</p>

</div>
<p>#### Удаление логической сети</p>

<p><strong>Описание задачи</strong></p>

<p>Удаление логической сети из oVirt.</p>

<p>⁠<strong>Действие&nbsp;3.4.&nbsp;Удаление логической сети</strong></p>

<ol>
  <li>Используйте вкладку <strong>Дата-центры</strong>, режим дерева или функцию поиска, чтобы найти и выбрать дата-центр логической сети в списке результатов.</li>
  <li>Нажмите на вкладку <strong>Логические сети</strong> на панели сведений, чтобы вывести список логических сетей дата-центра.</li>
  <li>Выберите логическую сеть и нажмите <strong>Удалить</strong>, чтобы открыть окно <strong>Удалить логические сети</strong>.</li>
  <li>Также можно отметить пункт <strong>Удалить внешнюю сеть из поставщика</strong>, чтобы удалить логическую сеть как из oVirt, так и из внешнего поставщика, если сеть предоставлялась им.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Логическая сеть удалена из oVirt и более не доступна. Если логическая сеть была предоставлена внешним поставщиком, и было решено удалить ее из этого поставщика, она также удалится и из него и более не будет доступна.</p>

<h4 id="re-initializing-a-data-center-recovery-procedure">Повторная инициализация дата-центра: Действие по восстановлению</h4>

<p><strong>Описание задачи</strong></p>

<p>Данная процедура восстановления замещает главный (Master) домен данных дата-центра новым главным доменом данных. Это необходимо в случае повреждения информации в главном домене данных. Повторная инициализация дата-центра позволяет восстановить все прочие ресурсы, связанные с дата-центром, включая кластеры, хосты и не имеющие проблем домены хранения.</p>

<p>Можно импортировать любые резервные копии ВМ, экспортированные ВМ и шаблоны в новый главный домен данных.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;3.5.&nbsp;Повторная инициализация дата-центра</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите дата-центр, который нужно повторно инициализировать.</li>
  <li>Убедитесь, что все домены хранения, присоединенные к дата-центру, находятся в режиме обслуживания.</li>
  <li>Кликните правой кнопкой по дата-центру и выберите <strong>Повторно инициализировать дата-центр</strong> из выпадающего меню, чтобы открыть окно <strong>Повторная инициализация дата-центра</strong>.</li>
  <li>В окне <strong>Повторная инициализация дата-центра</strong> приведен список всех доступных (отсоединенных; находящихся в режиме обслуживания) доменов хранения. Отметьте пункты, соответствующие доменам хранения, которые нужно добавить к дата-центру.</li>
  <li>Отметьте пункт <strong>Подтвердить операцию</strong>.</li>
  <li>Нажмите <strong>OK</strong>, чтобы закрыть окно и повторно инициализировать дата-центр.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Домен хранения будет присоединен к дата-центру как главный домен данных и активирован. Теперь можно импортировать любые резервные копии ВМ, экспортированные ВМ и шаблоны в новый главный домен данных.</p>

<h4 id="removing-a-data-center">Удаление дата-центра</h4>

<p><strong>Описание задачи</strong></p>

<p>Для удаления дата-центра необходим активный хост. Удаление дата-центра не приведет к удалению ассоциированных ресурсов.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;3.6.&nbsp;Удаление дата-центра</strong></p>

<ol>
  <li>Убедитесь, что домен хранения, присоединенный к дата-центру, находится в режиме обслуживания.</li>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите дата-центр, который нужно удалить.</li>
  <li>Нажмите <strong>Удалить</strong>, чтобы открыть окно подтверждения <strong>Удалить дата-центр</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Дата-центр будет удален.</p>

<h4 id="force-removing-a-data-center">Принудительное удаление дата-центра</h4>

<p><strong>Описание задачи</strong></p>

<p>Дата-центр переходит в состояние <code>Не отвечает</code>, если присоединенный домен хранения поврежден или если хост переходит в состояние <code>Не отвечает</code>. В не сможете провести обычное <strong>Удаление</strong> дата-центра в таких условиях.</p>

<p><strong>Принудительное удаление</strong> не требует наличия активного хоста. Оно также безвозвратно удаляет присоединенный домен хранения.</p>

<p>Возможно, понадобится <strong>Уничтожить</strong> поврежденный домен хранения перед тем, как будет возможно провести <strong>Принудительное удаление</strong> дата-центра.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;3.7.&nbsp;Принудительное удаление дата-центра</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите дата-центр, который нужно удалить.</li>
  <li>Нажмите <strong>Принудительное удаление</strong>, чтобы открыть окно подтверждения <strong>Принудительное удаление дата-центра</strong>.</li>
  <li>Отметьте пункт <strong>Подтвердить операцию</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Дата-центр и присоединенный домен хранения будут безвозвратно удалены из среды oVirt.</p>

<h4 id="changing-the-data-center-compatibility-version">Изменение версии совместимости дата-центра</h4>

<p><strong>Описание задачи</strong></p>

<p>Дата-центры oVirt имеют версию совместимости. Она указывает версию oVirt, с которой дата-центр должен быть совместим. Все кластеры в дата-центре должны поддерживать желаемый уровень совместимости.</p>

<div class="alert alert-info">
  <p><strong>Примечание:</strong> Чтобы изменить версию совместимости дата-центра, сначала нужно обновить все кластеры в дата-центре до уровня, который поддерживает желаемую версию совместимости.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;3.8.&nbsp;Изменение версии совместимости дата-центра</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong>.</li>
  <li>Выберите из списка дата-центр, который необходимо изменить. Если список дата-центров слишком длинный, чтобы выбрать дата-центр визуально, выполните поиск, чтобы найти требуемый дата-центр.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong>.</li>
  <li>Измените <strong>Версию совместимости</strong> на нужную.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы обновили версию совместимости дата-центра.</p>

<div class="alert alert-info">
  <p><strong>Предупреждение:</strong> Обновление совместимости также обновит все домены хранения, принадлежащие дата-центру. Если обновляется версия совместимости 3.1 или ниже до более высокой, эти домены хранения станет невозможно использовать с версиями старше 3.1.</p>

</div>
<p>### Дата-центры и домены хранения</p>

<h4 id="attaching-an-existing-data-domain-to-a-data-center">Присоединение существующего домена данных к дата-центру</h4>

<p><strong>Описание задачи</strong></p>

<p>Домены данных, являющиеся <strong>неприсоединенными</strong>, могут быть присоединены к дата-центру. Домен данных должен иметь тот же <strong>тип хранилища</strong>, что и дата-центр.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;3.9.&nbsp;Присоединение существующего домена данных к дата-центру</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите требуемый дата-центр.</li>
  <li>Выберите вкладку <strong>Хранилища</strong> на панели сведений, чтобы вывести список доменов хранения, уже присоединенных к дата-центру.</li>
  <li>Нажмите <strong>Присоединить данные</strong>, чтобы открыть окно <strong>Присоединить хранилище</strong>.</li>
  <li>Отметьте пункт, соответствующий домену данных, который нужно присоединить к дата-центру. Можно отметить несколько пунктов, чтобы присоединить несколько доменов данных.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Домен данных будет присоединен к дата-центру и автоматически активирован.</p>

<div class="alert alert-info">
  <p><strong>Примечание:</strong> В oVirt 3.4 к одному дата-центру можно добавить несколько общих доменов хранения различных типов (iSCSI, NFS, FC, POSIX и Gluster).</p>

</div>
<h4>Присоединение существующего ISO-домена к дата-центру</h4>

<p><strong>Описание задачи</strong></p>

<p>ISO-домен, являющийся <strong>неприсоединенным</strong>, может быть присоединен к дата-центру. ISO-домен должен иметь тот же <strong>тип хранилища</strong>, что и дата-центр. К дата-центру может быть присоединен только один ISO-домен.</p>

<p><strong>Инструкция&nbsp;3.10.&nbsp;Присоединение существующего ISO-домена к дата-центру</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите требуемый дата-центр.</li>
  <li>Выберите вкладку <strong>Хранилища</strong> на панели сведений, чтобы вывести список доменов хранения, уже присоединенных к дата-центру.</li>
  <li>Нажмите <strong>Присоединить ISO</strong>, чтобы открыть окно <strong>Присоединить библиотеку ISO</strong>.</li>
  <li>Отметьте пункт, соответствующий нужному ISO-домену.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>ISO-домен будет присоединен к дата-центру и автоматически активирован.</p>

<h4 id="attaching-an-existing-export-domain-to-a-data-center">Присоединение существующего экспортированного домена к дата-центру</h4>

<p><strong>Описание задачи</strong></p>

<p>Экспортированный домен, являющийся <strong>неприсоединенным</strong>, может быть присоединен к дата-центру.</p>

<p>К дата-центру может быть присоединен только один экспортированный домен.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;3.11.&nbsp;Присоединение существующего экспортированного домена к дата-центру</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите требуемый дата-центр.</li>
  <li>Выберите вкладку <strong>Хранилища</strong> на панели сведений, чтобы вывести список доменов хранения, уже присоединенных к дата-центру.</li>
  <li>Нажмите <strong>Присоединить экспорт</strong>, чтобы открыть окно <strong>Присоединить экспортированный домен</strong>.</li>
  <li>Отметьте пункт, соответствующий нужному экспортированному домену.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Экспортированный домен будет присоединен к дата-центру и автоматически активирован.</p>

<h4 id="detaching-a-storage-domain-from-a-data-center">Отключение домена хранения от дата-центра</h4>

<p><strong>Описание задачи</strong></p>

<p>Отключение домена хранения от дата-центра сделает дата-центр более не ассоциированным с этим доменом хранения. Домен хранения не удаляется из среды oVirt; он может быть присоединен к другому дата-центру.</p>

<p>Данные, такие как ВМ и шаблоны, останутся присоединенными к домену хранения.</p>

<div class="alert alert-info">
  <p><strong>Примечание:</strong> главное хранилище, если оно является последним доступным доменом хранения, не может быть удалено.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;3.12.&nbsp;Отключение домена хранения от дата-центра</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите требуемый дата-центр.</li>
  <li>Выберите вкладку <strong>Хранилища</strong> на панели сведений, чтобы вывести список доменов хранения, присоединенных к дата-центру.</li>
  <li>Выберите домен хранения, который нужно отключить. Если домен хранения <code>активен</code>, нажмите <strong>Обслуживание</strong>, чтобы открыть окно подтверждения <strong>Обслуживание домена хранения</strong>.</li>
  <li>Нажмите <strong>OK</strong>, чтобы войти в режим обслуживания.</li>
  <li>Нажмите <strong>Отключить</strong>, чтобы открыть окно подтверждения <strong>Отключение хранилища</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы отключили домен хранения от дата-центра. Может пройти несколько минут, прежде чем домен хранения исчезнет с панели сведений.</p>

<h4 id="activating-a-storage-domain-from-maintenance-mode">Активация домена хранения из режима обслуживания</h4>

<p><strong>Описание задачи</strong></p>

<p>Домен хранения, находящийся в режиме обслуживания, должен быть активирован, прежде чем его можно будет использовать.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;3.13.&nbsp;Активация домена хранения из режима обслуживания</strong></p>

<ol>
  <li>Нажмите на вкладку <strong>Дата-центры</strong> и выберите требуемый дата-центр.</li>
  <li>Выберите вкладку <strong>Хранилища</strong> на панели сведений, чтобы вывести список доменов хранения, присоединенных к дата-центру.</li>
  <li>Выберите нужный домен хранения и нажмите <strong>Активировать</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Домен хранения будет активирован и станет доступным для использования в дата-центре.</p>

<h2 id="clusters">⁠Кластеры</h2>

<h3 id="introduction-to-clusters">Введение</h3>

<p>Кластер — это логическое объединение хостов, совместно использующих один домен хранения и имеющих один тип процессора (Intel или AMD). Если хосты оснащены процессорами разных поколений, будут использоваться только те возможности, которые есть у всех моделей.</p>

<p>Каждый кластер в системе должен принадлежать дата-центру, и каждый хост в системе должен принадлежать кластеру. Виртуальные машины динамически распределяются между хостами кластера и могут перемещаться с одного на другой в процессе работы в соответствии с политикой, определенной на вкладке <strong>Кластеры</strong> и в разделе настройки. Кластер — это наивысший уровень, на котором могут быть определены политики управления питанием и распределения нагрузки.</p>

<p>Кластеры выполняют ВМ или сервера хранения Red Hat. Эти две задачи взаимно исключают друг друга: кластер не может одновременно поддерживать виртуализацию и служить хранилищем для хостов.</p>

<p>Платформа oVirt устанавливает кластер по умолчанию в дата-центр по умолчанию в процессе инсталляции.</p>

<h3 id="cluster-tasks">Работа с кластером</h3>

<h4 id="creating-a-new-cluster">Создание нового кластера</h4>

<p><strong>Описание задачи</strong></p>

<p>Дата-центр может содержать множество кластеров, а кластер может содержать множество хостов. Все хосты в кластере должны иметь один тип процессора (Intel или AMD). Рекомендуется создавать хосты до создания кластера, чтобы гарантировать оптимизацию под нужный тип процессора. Настроить хосты можно позже, нажав на кнопку <strong>Пошаговый помощник</strong>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;4.1.&nbsp;Создание нового кластера</strong></p>

<ol>
  <li>Выберите вкладку <strong>Кластеры</strong>.</li>
  <li>Нажмите <strong>Новый</strong>, чтобы открыть окно <strong>Новый кластер</strong>.</li>
  <li>Выберите <strong>Дата-центр</strong>, к которому кластер будет принадлежать, из выпадающего списка.</li>
  <li>Введите <strong>Имя</strong> и <strong>Описание</strong> кластера.</li>
  <li>Выберите <strong>Архитектуру ЦП</strong> и <strong>Тип ЦП</strong>, а также <strong>версию совместимости</strong> из выпадающих списков. Важно, чтобы выбранное семейство процессоров соответствовало минимальному типу процессора на хостах, которые нужно подключить к кластеру, иначе эти хосты могут оказаться неработоспособными.</li>
  <li>Нажмите на вкладку <strong>Оптимизация</strong>, чтобы выбрать порог выделения страниц памяти для кластера и (опционально) включить управление многопоточностью процессора, оптимизацию памяти balloon и контроль KSM на хостах кластера.</li>
  <li>Нажмите на вкладку <strong>Политика устойчивости</strong>, чтобы выбрать политику миграции для виртуальных машин.</li>
  <li>Нажмите на вкладку <strong>Политика планирования</strong>, чтобы при необходимости настроить политику кластера и параметры оптимизации планировщика, включить доверенную службу для хостов кластера или активировать резервирование ВМ высокой доступности.</li>
  <li>Нажмите на вкладку <strong>Консоль</strong> чтобы при необходимости переопределить глобальный SPICE-прокси, если таковой имеется, и указать адрес SPICE-прокси для хостов кластера.</li>
  <li>Нажмите <strong>OK</strong>, чтобы создать кластер и открыть окно <strong>Новый кластер — Пошаговый помощник</strong>.</li>
  <li>В окне <strong>Пошаговый помощник</strong> выводится список объектов, которые необходимо настроить для работы с кластером. Настройте эти объекты или отложите настройку, нажав на кнопку <strong>Настроить позже</strong>; к настройке можно вернуться, выбрав кластер и нажав на кнопку <strong>Пошаговый помощник</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новый кластер будет добавлен к среде виртуализации.</p>

<h4 id="explanation-of-settings-and-controls-in-the-new-cluster-and-edit-cluster-windows">Объяснение параметров и регулировок в окнах Новый кластер и Параметры кластера</h4>

<h5 id="general-cluster-settings-explained">Объяснение основных параметров кластера</h5>

<table>
  <tbody>
    <tr>
      <td>![New cluster window</td>
      <td>400px](New_Cluster_Window.png "New cluster window</td>
      <td>400px")</td>
    </tr>
  </tbody>
</table>

<p><strong>Рисунок&nbsp;4.1.&nbsp;Окно «Новый кластер»</strong></p>

<p>Следующая таблица описывает параметры на вкладке <strong>Общие</strong> в окнах <strong>Новый кластер</strong> и <strong>Параметры кластера</strong>. При нажатии на <strong>OK</strong> неверные данные обводятся оранжевой линией, что препятствует принятию изменений. Также в полях ввода показываются ожидаемые значения или диапазоны значений.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;4.1.&nbsp;Основные параметры кластера</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание/Действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Дата-центр</strong></p></td>
<td align="left"><p>Дата-центр, который будет содержать кластер.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Название кластера. Это текстовое поле имеет ограничение в 40 символов и должно содержать уникальное имя, состоящее из букв в верхнем и нижнем регистрах, цифр, дефисов и подчеркиваний.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Описание кластера. Это поле является рекомендуемым, но не обязательным..</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Архитектура ЦП</strong></p></td>
<td align="left"><p>Архитектура кластера. Выберите одну из следующих:</p>
<ul>
<li>x86_64</li>
<li>ppc64</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Тип ЦП</strong></p></td>
<td align="left"><p>Тип ЦП кластера. Выберите один из следующих:</p>
<ul>
<li>Intel Conroe</li>
<li>Intel Penryn</li>
<li>Intel Nehalem</li>
<li>Intel Westmere</li>
<li>Intel SandyBridge</li>
<li>Intel Haswell</li>
<li>AMD Opteron G1</li>
<li>AMD Opteron G2</li>
<li>AMD Opteron G3</li>
<li>AMD Opteron G4</li>
<li>AMD Opteron G5</li>
</ul>
<p>Все хосты кластера должны использовать один тип ЦП (Intel или AMD); его нельзя поменять после создания без существенных нарушений. Тип ЦП должен быть определен по наименее производительному хосту. Например: хост на <strong>Intel SandyBridge</strong> можно включить в кластер на <strong>Intel Penryn</strong>, а хост на <strong>Intel Conroe</strong> — нельзя. Хосты с различными моделями ЦП будут использовать только те возможности, которые есть у всех моделей.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Версия совместимости</strong></p></td>
<td align="left"><p>Версия oVirt. Выберите одну из следующих:</p>
<ul>
<li>3.0</li>
<li>3.1</li>
<li>3.2</li>
<li>3.3</li>
<li>3.4</li>
<li>3.5</li>
<li>3.6</li>
</ul>
<p>Невозможно выбрать выбрать версию старше, чем заданная для дата-центра.</p></td>
</tr>
</tbody>
</table>

<h5 id="optimization-settings-explained">Объяснение параметров оптимизации</h5>

<p>Превышенное выделение страниц памяти позволяет виртуальным машинам использовать до 200% от выделенной им памяти путем задействования неиспользуемой памяти на других ВМ. Этот процесс основан на предположении, что ВМ в среде oVirt не будут все одновременно работать на полной мощности, что позволит временно выделять незанятую память какой-либо ВМ.</p>

<p>Управление многопоточностью ЦП позволяет хостам запускать ВМ с общим количеством процессорных ядер, превышающим количество ядер на хосте. Это полезно в случае неинтенсивной нагрузки на ЦП, когда возможность работы большего количества ВМ может снизить требования к оборудованию. Это также позволяет ВМ работать с топологиями ЦП, которые были бы невозможны в ином случае, особенно если количество «гостевых» ядер находится в промежутке между количеством ядер хоста и количеством потоков хоста.</p>

<p>Следующая таблица описывает параметры вкладки <strong>Оптимизация</strong> в окнах <strong>Новый кластер</strong> и <strong>Параметры кластера</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;4.2.&nbsp;Параметры оптимизации</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание/Действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Оптимизация памяти</strong></p></td>
<td align="left"><ul>
<li><strong>Нет: отключить превышенное выделение страниц памяти</strong>: Отключает превышенное выделение страниц памяти.</li>
<li><strong>Для серверной нагрузки — Разрешить запланировать 150% физической памяти</strong>: устанавливает порог выделения памяти на уровне 150% системной памяти каждого хоста.</li>
<li><strong>Для десктопной нагрузки — Разрешить запланировать 200% физической памяти</strong>: устанавливает порог выделения памяти на уровне 200% системной памяти каждого хоста.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Потоки ЦП</strong></p></td>
<td align="left"><p>Выбор пункта <strong>Считать потоки как ядра</strong> позволяет хостам исполнять ВМ с общим количеством процессорных ядер, превышающим количество ядер на хосте. Предоставляемые хостом потоки будут рассматриваться как ядра, которые могут использоваться виртуальными машинами. Например, система с 24 ядрами и 2 потоками на каждое (итого 48 потоков) может исполнять ВМ, имеющие до 48 ядер каждая, и алгоритмы, вычисляющие нагрузку на процессор хоста, будут выполнять расчет для удвоенного количества потенциально задействованных ядер.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Оптимизация памяти balloon</strong></p></td>
<td align="left"><p>Выбор пункта <strong>Включить оптимизацию памяти balloon</strong> активирует возможность расширения памяти для ВМ, исполняющихся на хостах данного кластера. Когда эта опция включена, менеджер расширения памяти (MoM) начнет оптимизацию Balloon там и тогда, где это возможно, с ограничением в виде гарантированного объема памяти для каждой ВМ. Чтобы оптимизация памяти balloon работала, у ВМ должно иметься устройство balloon с соответствующими драйверами. Каждая ВМ в кластере уровня 3.2 и выше включает устройство balloon, если только оно не было специально удалено. Каждый хост в данном кластере получает обновление политики оптимизации, когда его статус меняется на <code>Работает</code>. Важно понимать, что в некоторых ситуациях оптимизация памяти может вступать в конфликт с KSM (Kernel Same-page Merging). В таких случаях MoM будет пытаться подстроить размер оптимизируемой области для минимизации коллизий. Также в некоторых случаях оптимизация памяти может снизить производительность ВМ. Администраторам рекомендуется использовать оптимизацию Balloon с осторожностью.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Контроль KSM</strong></p></td>
<td align="left"><p>Выбор пункта <strong>Включить KSM</strong> разрешает MoM запускать механизм Kernel Same-page Merging (KSM), когда это необходимо и когда это может обеспечить выгоду в виде экономии памяти, превышающую затраты в виде нагрузки на ЦП.</p></td>
</tr>
</tbody>
</table>

<h5 id="resilience-policy-settings-explained">Объяснение параметров политики устойчивости</h5>

<p>Политика устойчивости определяет схему миграции ВМ в случае неисправности хоста. ВМ, работающие на хосте, который неожиданно выключается или переводится в режим обслуживания, переносятся на другие хосты кластера; эта миграция зависит от политики кластера.</p>

<div class="alert alert-info">
  <p><strong>Примечание:</strong> При миграции ВМ интенсивно используется сеть. Например, в системе, где на одном хосте работают десять или больше ВМ, миграция их всех может быть долгим и ресурсоемким процессом. Таким образом, нужно выбирать политику, наилучшим образом подходящую системе. Если предпочитается консервативный подход, отключите миграцию ВМ. Либо, если у вас много ВМ, но лишь некоторые из них выполняют критически важные задачи, выберите опцию, соответствующую миграции только ВМ высокой доступности.</p>

</div>
<p>Следующая таблица описывает параметры вкладки <strong>Политика устойчивости</strong> в окнах <strong>Новый кластер</strong> и <strong>Параметры кластера</strong>.</p>

<p>⁠ <strong>Таблица&nbsp;4.3.&nbsp;Параметры политики устойчивости</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание/Действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Переносить машины</strong></p></td>
<td align="left"><p>Запускает миграцию всех ВМ в порядке их приоритетов.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Переносить только ВМ высокой доступности</strong></p></td>
<td align="left"><p>Запускает миграцию только высокодоступных ВМ, чтобы предотвратить перегрузку остальных хостов.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Не переносить машины</strong></p></td>
<td align="left"><p>Запрещает миграцию ВМ.</p></td>
</tr>
</tbody>
</table>

<h5 id="cluster-policy-settings-explained">Объяснение параметров политики кластера</h5>

<p>Политика кластера определяет использование ВМ и их распределение между доступными хостами. Определите политику кластера, чтобы включить автоматическое балансирование нагрузки между хостами кластера.</p>

<p>⁠</p>

<p><img alt="Редактирование политики балансирования нагрузки кластера" title="Редактирование политики балансирования нагрузки кластера" src="./OVirt Administration Guide — oVirt_files/Edit_Cluster_Window_Policy.png"></p>

<p><strong>Рисунок&nbsp;4.2.&nbsp;Параметры политики кластера: Power_Saving</strong></p>

<p>⁠</p>

<p><img alt="Редактирование политики балансирования нагрузки кластера" title="Редактирование политики балансирования нагрузки кластера" src="./OVirt Administration Guide — oVirt_files/Cluster_Window_Policy_VM_evenly.png"></p>

<p><strong>Рисунок&nbsp;4.3.&nbsp;Параметры политики кластера: VM_Evenly_Distributed</strong></p>

<p>Следующая таблица описывает параметры окна <strong>Редактирование политики</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;4.4.&nbsp;Свойства вкладки «Политика кластера»</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле/Вкладка</p></th>
<th align="left"><p>Описание/Действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Нет</strong></p></td>
<td align="left"><p>Выберите для политики значение <strong>Нет</strong>, чтобы отключить распределение нагрузки между хостами и экономию энергии. Это значение по умолчанию.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Evenly_Distributed</strong></p></td>
<td align="left"><p>Распределяет нагрузку на ЦП равномерно между всеми хостами кластера. Дополнительные ВМ, прикрепленные к хосту, не будут запускаться, если этот хост достиг Максимального уровня обслуживания (Maximum Service Level).</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Power_Saving</strong></p></td>
<td align="left"><p>Распределяет нагрузку на ЦП по группе доступных хостов, чтобы сократить потребление энергии на недостаточно загруженных хостах. Хосты, которые в течение определенного интервала времени находятся в состоянии слабой загруженности, должны будут перевести все свои ВМ на другие хосты, а сами смогут быть отключены. Дополнительные ВМ, прикрепленные к хосту, не будут запускаться, если этот хост достиг состояния сильной загруженности. </p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Равномерное распределение ВМ (VM_Evenly_Distributed)</strong></p></td>
<td align="left"><p>Распределяет ВМ поровну между хостами в зависимости от количества ВМ.</p>
<ul>
<li><strong>HighVmCount</strong>: Задает максимальное количество ВМ, которые могут работать на одном хосте. Превышение этого предела переводит хост в состояние «перегружен».</li>
<li><strong>MigrationThreshold</strong>: Определяет величину буфера, по достижении которой выполняется миграция ВМ с хоста. Это максимальная разница в количестве ВМ на наиболее и наименее используемом хостах. Кластер считается сбалансированным, когда на каждом хосте в нем количество ВМ укладывается в порог миграции.</li>
<li><strong>SpmVmGrace</strong>: Определяет количество слотов для ВМ, которые резервируются на SPM-хостах. SPM-хост будет иметь более низкую нагрузку, нежели остальные, так что эта переменная определяет, насколько меньше ВМ, чем остальные хосты, он может выполнять.</li>
</ul>
<p>Кластер считается несбалансированным, если любой его хост исполняет больше ВМ, чем указано в <strong>HighVmCount</strong> и есть как минимум один хост, количество ВМ на котором выходит за пределы <strong>MigrationThreshold</strong>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>CpuOverCommitDurationMinutes</strong></p></td>
<td align="left"><p>Определяет время (в минутах), в течение которого ЦП может работать под нагрузкой, превышающей заданную степень использования, до того, как начнет действовать политика кластера. Указанный интервал времени защищает от временных всплесков загрузки ЦП, которые могли бы активировать политику кластера и спровоцировать ненужную миграцию ВМ. Максимум два символа.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>HighUtilization</strong></p></td>
<td align="left"><p>Выражается в процентах. Если хост работает с загрузкой ЦП, большей или равной заданной степени использования в течение определенного интервала времени, oVirt перенесет ВМ на другие хосты кластера до тех пор, пока загрузка ЦП хоста не опустится ниже максимального порога обслуживания.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>LowUtilization</strong></p></td>
<td align="left"><p>Выражается в процентах. Если хост работает с загрузкой ЦП ниже заданной степени использования в течение определенного интервала времени, oVirt перенесет ВМ на другие хосты кластера. oVirt выключит исходный хост и перезапустит его только тогда, когда этого потребует балансировка нагрузки или когда будет не хватать свободных хостов в кластере.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Оптимизация планировщика</strong></p></td>
<td align="left"><p>Оптимизирует планирование для host weighing/ordering.</p>
<ul>
<li><strong>Оптимизировать на использование</strong>: Включает модули присвоения весов в планировщике для оптимизации выбора.</li>
<li><strong>Оптимизировать на скорость</strong>: Пропускает присвоение весов, когда имеется более десяти ожидающих запросов.</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Включить доверенную службу</strong></p></td>
<td align="left"><p>Включает интеграцию с сервером OpenAttestation. Прежде чем активировать эту опцию, необходимо использовать инструмент <code>engine-config</code> для входа в параметры сервера OpenAttestation.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Включить резервирование ВМ высокой доступности</strong></p></td>
<td align="left"><p>Позволяет oVirt отслеживать наличие в кластере свободного места для ВМ высокой доступности. oVirt убеждается, что в кластере есть достаточно емкости для ВМ, отмеченных как высокодоступные, чтобы перенести их в случае неожиданного отказа их текущего хоста.</p></td>
</tr>
</tbody>
</table>

<p>Когда у хоста остается менее 20% свободной памяти, команды оптимизации, такие как <code>mom.Controllers.Balloon - INFO Ballooning guest:half1 from 1096400 to 1991580</code> записываются в <code>/var/log/vdsm/mom.log</code> — файл журнала менеджера расходования памяти.</p>

<h5 id="cluster-console-settings-explained">Объяснение параметров консоли кластера</h5>

<p>В следующей таблице приведена информация, необходимая для вкладки <strong>Консоль</strong> в окнах <strong>Новый кластер</strong> и <strong>Редактировать кластер</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;4.5.&nbsp;Параметры консоли</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Настроить SPICE-прокси для кластера</strong></p></td>
<td align="left"><p>Отметьте этот пункт, чтобы перезаписать данные SPICE-прокси, определенные в глобальной конфигурации. Эта опция полезна, когда пользователь (например, подключающийся через пользовательский портал) находится вне сети, в которой располагаются гипервизоры.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Переназначенный адрес прокси SPICE</strong></p></td>
<td align="left"><p>Прокси-сервер, через который клиент SPICE будет подключаться к ВМ. Адрес должен иметь следующий формат:</p>
<pre><code>протокол://[хост]:[порт]</code></pre></td>
</tr>
</tbody>
</table>

<h4 id="editing-a-resource-1">Изменение ресурса</h4>

<p><strong>Описание задачи</strong></p>

<p>Изменение свойств ресурса.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;4.2.&nbsp;Изменение ресурса</strong></p>

<ol>
  <li>Воспользуйтесь режимом дерева или функцией поиска, чтобы найти и выбрать ресурс в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong>, чтобы открыть окно <strong>Параметры</strong>.</li>
  <li>Измените необходимые свойства и нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новые свойства ресурса будут сохранены. Окно <strong>Параметры</strong> не закроется, если значение поля некорректно.</p>

<h4 id="setting-load-and-power-management-policies-for-hosts-in-a-cluster">Настройка политик управления нагрузкой и питанием для хостов кластера</h4>

<p><strong>Описание задачи</strong></p>

<p>Политики кластера позволяют задавать допустимые значения нагрузки на ЦП (как минимальные, так и максимальные), а также действия, которые будут выполняться, когда эти значения достигаются. Настройте политику кластера, чтобы включить автоматическое балансирование нагрузки между хостами кластера.</p>

<p>Хост, нагрузка на ЦП которого выше значения <strong>HighUtilization</strong>, снизит ее путем переноса ВМ на другие хосты.</p>

<p>Хост, нагрузка на ЦП которого ниже значения <strong>LowUtilization</strong>, перенесет все свои ВМ на другие хосты и сможет быть выключен до тех пор, пока не понадобится снова.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;4.3.&nbsp;Настройка политик управления нагрузкой и питанием для хостов</strong></p>

<ol>
  <li>Воспользуйтесь режимом дерева или функцией поиска, чтобы найти и выбрать кластер в списке результатов.</li>
  <li>
    <p>Нажмите кнопку <strong>Изменить</strong>, чтобы открыть окно <strong>Параметры кластера</strong>.
⁠</p>

    <p><img alt="Изменение политики кластера" title="Изменение политики кластера" src="./OVirt Administration Guide — oVirt_files/Edit_Cluster_Window_Policy.png"></p>

    <p><strong>Рисунок&nbsp;4.4.&nbsp;Изменение политики кластера</strong></p>
  </li>
  <li>Выберите одну из следующих политик:
    <ul>
      <li><strong>Нет</strong></li>
      <li><strong>VM_Evenly_Distributed</strong> — Введите максимальное количество ВМ, которые могут выполняться на каждом хосте, в поле <strong>HighVmCount</strong>.</li>
      <li><strong>Evenly_Distributed</strong> — Введите процент использования ЦП, при котором ВМ начнут миграцию на другие хосты, в поле <strong>HighUtilization</strong>.</li>
      <li><strong>Power Saving</strong> — Введите процент использования ЦП, при котором хост будет считаться недостаточно используемым, в поле <strong>LowUtilization</strong>. Введите процент использования ЦП, при котором ВМ начнут миграцию на другие хосты, в поле <strong>HighUtilization</strong></li>
    </ul>
  </li>
  <li>Введите интервал времени в минутах, по истечении которого выбранная политика будет срабатывать, в поле <strong>CpuOverCommitDurationMinutes</strong>.</li>
  <li>Если используется сервер OpenAttestation для верификации хостов, и он настроен с помощью инструмента <code>engine-config</code>, отметьте пункт <strong>Enable Trusted Service</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы изменили политику кластера.</p>





<h4 id="creating-a-new-logical-network-in-a-data-center-or-cluster-1">Создание логической сети а дата-центре или кластере</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание логической сети и определение её использования в дата-центре или на кластерах дата-центра.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;4.4.&nbsp;Создание логической сети в дата-центре или кластере</strong></p>

<ol>
  <li>Используйте ресурсные вкладки <strong>Дата-центры</strong> или <strong>Кластеры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить дата-центр или кластер в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Логические сети</strong> на панели сведений чтобы увидеть список существующих логических сетей.</li>
  <li>На панели сведений <strong>Дата-центры</strong> нажмите на кнопку <strong>Добавить</strong> чтобы открыть окно <strong>Добавить логическую сеть</strong>. На панели сведений <strong>Кластеры</strong> нажмите на кнопку <strong>Добавить сеть</strong> чтобы открыть окно <strong>Добавить логическую сеть</strong>.</li>
  <li>Введите <strong>Имя</strong>, <strong>Описание</strong> и <strong>Комментарий</strong> для логической сети.</li>
  <li>В разделе <strong>Экспорт</strong> отметьте параметр <strong>Создать на внешнем поставщике</strong> чтобы создать логическую сеть на внешнем поставщике. Выберите внешнего поставщика в выпадающем меню <strong>Внешний поставщик</strong>.</li>
  <li>В разделе <strong>Параметры сети</strong> выберите пункты <strong>Включить добавление тегов для VLAN</strong>, <strong>Сеть ВМ</strong> и <strong>Переназначить MTU</strong> чтобы включить соответствующие параметры.</li>
  <li>Введите новую метку в текстовом поле <strong>Метка сети</strong> или выберите уже существующую.</li>
  <li>Во вкладке <strong>Кластер</strong> выберите кластеры, которым будет назначена сеть. Также можно указать, будет ли логическая сеть являться обязательной сетью.</li>
  <li>При выбранном пункте <strong>Создать на внешнем поставщике</strong> будет доступна вкладка <strong>Подсеть</strong>. Во вкладке <strong>Подсеть</strong> введите <strong>Имя</strong>, <strong>CIDR</strong> и выберите <strong>Версию IP</strong> для подсети, предоставляемой логической сетью.</li>
  <li>Во вкладке <strong>Профили</strong> добавьте профили vNIC, в соответствии с требованиями.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы определили логическую сеть в качестве необходимого ресурса для кластера или кластеров дата-центра. Если для логической сети была указана метка, сеть будет автоматически добавлена ко всем сетевым интерфейсам хоста, имеющим эту метку.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> при создании новой логической сети или внесении изменений в параметры существующей сети, которая используется как сеть передачи экрана, все выполняющиеся ВМ, использующие эту сеть, должны быть перезапущены для того, чтобы сеть стала доступна или для применения внесённых изменений.</p>

</div>

<h4 id="removing-a-cluster">Удаление кластера</h4>

<p><strong>Описание задачи</strong></p>

<p>Переместите все хосты из кластера перед его удалением.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> кластер <strong>по умолчанию</strong> нельзя удалить, т.к. он содержит <strong>Пустой</strong> шаблон. Тем не менее, кластер <strong>По умолчанию</strong> можно переименовать и добавить его в новый дата-центр.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;4.5.&nbsp;Удаление кластера</strong></p>

<ol>
  <li>Используйте ресурсную вкладку, древовидный режим или поисковый функционал чтобы найти и выделить в результатах поиска кластер, который необходимо удалить.</li>
  <li>Убедитесь, что в кластере отсутствуют хосты.</li>
  <li>Нажмите <strong>Удалить</strong> чтобы открыть окно подтверждения <strong>Удалить кластер(ы)</strong>.</li>
  <li>Нажмите <strong>OK</strong></li>
</ol>

<p><strong>Результат</strong></p>

<p>Кластер удалён.</p>

<h4 id="designate-a-specific-traffic-type-for-a-logical-network-with-the-manage-networks-window">Назначение конкретного типа трафика логической сети в окне управления сетями</h4>

<p><strong>Описание задачи</strong></p>

<p>Укажите тип трафика, используемый в логической сети, для оптимизации потока трафика.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;4.6.&nbsp;Привязка или отмена привязки логической сети к кластеру</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Кластеры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить кластер в результатах поиска.</li>
  <li>Перейдите на вкладку <strong>Логические сети</strong> на панели сведений чтобы увидеть список логических сетей, привязанных к кластеру.</li>
  <li>
    <p>Нажмите на кнопку <strong>Управление сетями</strong> чтобы открыть окно <strong>Управление сетями</strong>.
⁠</p>

    <p><img alt="The Manage Networks window" title="Окно управления сетями" src="./OVirt Administration Guide — oVirt_files/Manage_networks.png"></p>

    <p><strong>Рисунок&nbsp;4.5.&nbsp;Управление сетями</strong></p>
  </li>
  <li>Отметьте галочками нужные параметры.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы оптимизировали поток сетевого трафика, присвоив конкретной логической сети передачу конкретного типа трафика.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> сети, предлагаемые внешними поставщиками, не могут использоваться в качестве сетей передачи экрана.</p>

</div>

<h4 id="explanation-of-settings-in-the-manage-networks-window">Объяснение параметров в окне управления сетями</h4>

<p>В таблице ниже описываются параметры окна <strong>Управление сетями</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;4.6.&nbsp;Параметры управления сетями</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание/действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Назначение</strong></p></td>
<td align="left"><p>Назначает логическую сеть всем хостам в кластере.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Требуется</strong></p></td>
<td align="left"><p>Сеть с пометкой «требуется» должна оставаться работоспособной для того, чтобы связанные с ней хосты функционировали корректно. Если требуемая сеть перестанет функционировать, любые связанные с ней хосты станут нерабочими.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Сеть ВМ</strong></p></td>
<td align="left"><p>Логическая сеть с пометкой «Сеть ВМ» передаёт сетевой трафик, относящийся к сети виртуальной машины.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Сеть передачи экрана</strong></p></td>
<td align="left"><p>Логическая сеть с пометкой «Сеть передачи экрана» передаёт сетевой трафик, относящийся к SPICE и контроллеру виртуальной сети.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Сеть миграции</strong></p></td>
<td align="left"><p>Логическая сеть с пометкой «Сеть миграции» передаёт трафик виртуальной машины и трафик миграции хранилища.</p></td>
</tr>
</tbody>
</table>

<h4 id="changing-the-cluster-compatibility-version">Изменение версии совместимости кластера</h4>

<p><strong>Описание задачи</strong></p>

<p>У кластеров oVirt существует версия совместимости. Версия совместимости кластера отражает возможности oVirt, поддерживаемые всеми хостами в кластере. Совместимость кластера указывается в соответствии с версией наименее мощной ОС хоста в кластере.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> для смены версии совместимости кластера необходимо сначала обновить все хосты кластера до уровня, поддерживающего желаемый уровень совместимости.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;4.7.&nbsp;Смена версии совместимости кластера</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Кластеры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить кластер в результатах поиска.</li>
  <li>Нажмите на ссылку <strong>Изменить</strong>. Откроется окно свойств кластера.</li>
  <li>Укажите желаемое значение для <strong>Версии совместимости</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы открыть подтверждающее окно <strong>Изменить версию совместимости кластера</strong>.</li>
  <li>Нажмите <strong>OK</strong> для подтверждения.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы сменили версию совместимости кластера. После обновления версии совместимости всех кластеров в дата-центре можно сменить версию совместимости самого дата-центра.</p>

<div class="alert alert-info">
  <p><strong>Предупреждение:</strong> обновление совмстимости также обновит все домены хранилищ, принадлежащие дата-центру. В случае обновления версии совместимости ниже версии 3.1 на более позднюю, эти домены хранилищ станет невозможно использовать с версиями ниже 3.1.</p>

</div>

<h2 id="logical-networks">Логические сети</h2>

<h3 id="introduction-to-logical-networks">Введение в понятие логических сетей</h3>

<p>Логическая сеть — это именованный набор глобальных параметров сетевых подключений в дата-центре. Добавленную хосту логическую сеть можно позже настроить с использованием сетевых параметров, характерных для этого хоста. Логические сети оптимизируют сетевой поток, объединяя сетевой трафик по целям использования, типу и требованиям.</p>

<p>Логические сети предоставляют как возможность объединения, так и возможность разделения. Можно создать логическую сеть для обмена информацией с хранилищем, для оптимизации обмена сетевым трафиком между хостами и доменами хранилищ, логическую сеть, специально предназначенную для передачи всего трафика виртуальных машин, или несколько логических сетей для передачи трафика отдельных групп виртуальных машин.</p>

<p>Стандартная логическая сеть во всех дата-центрах — это сеть управления с именем <code>ovirtmgmt</code>. Сеть <code>ovirtmgmt</code> переносит весь трафик, до тех пор, пока не будет создана другая логическая сеть. Эта сеть предназначена специально для обмена административной информацией между oVirt и хостами.</p>

<p>Логическая сеть — это ресурс уровня дата-центра; создание логической сети в дата-центре делает её доступной для всех кластеров в дата-центре. Логическая сеть, созданная как <strong>Требуемая</strong> должна быть настроена на всех хостах кластера перед тем, как она станет работоспособной. <strong>Дополнительные сети</strong> могут использоваться любым хостом, к которому они были добавлены.</p>

<div class="alert alert-info">
  <p><strong>Предупреждение:</strong> не изменяйте сетевые параметры дата-центра или кластера во время работы хостов, во избежания потери связи с этими хостами.</p>

</div>
<div class="alert alert-info">
  <p><strong>Важно:</strong> если для предоставления каких-либо служб планируется использовать oVirt node, не забывайте, что эти службы будут остановлены, если окружение oVirt перестанет работать.</p>

  <p>Это правило применимо ко всем службам, но особенно следует быть внимательным к выполнению в oVirt следующих компонентов:</p>

  <ul>
    <li>Службы каталогов</li>
    <li>DNS</li>
    <li>Хранилище</li>
  </ul>

</div>

<h3 id="port-mirroring">Зеркалирование портов</h3>

<p>При зеркалировании портов, сетевой трафик 3 уровня указанной локальной сети и хоста копируется в виртуальный интерфейс виртуальной машины. Эта виртуальная машина может использоваться для сетевой отладки и тонкой настройки сети, обнаружения вторжений и наблюдения за поведением других виртуальных машин на том же хосте и в той же логической сети.</p>

<p>Копируется только внутренний трафик одной локальной сети на одном хосте. Трафик внешней сети хоста не увеличивается; тем не менее, ВМ с включённым зеркалированием портов потребляет больше ресурсов ЦП и ОЗУ, чем другие машины.</p>

<p>Зеркалирование портов включается и отключается путём изменения параметров сетевых интерфейсов на виртуальных машинах.</p>

<p>Зеркалирование портов требует IPv4 IP-адресов.</p>

<p>Горячее подключение профилей при включённом зеркалировании портов не поддерживается.</p>

<p>Начиная с oVirt версии 3.4, зеркалирование портов было включено в профили vNIC. Зеркалирование портов нельзя изменить, если профиль vNIC, связанный с зеркалированием, присоединён к виртуальной машине. Для использования зеркалирования портов создайте специальный профиль vNIC с включённым зеркалированием портов.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> включение зеркалирования портов снижает уровень конфиденциальности других пользователей этой сети.</p>

</div>

<h3 id="required-networks-optional-networks-and-virtual-machine-networks">Требуемые сети, дополнительные сети и сети виртуальных машин</h3>

<p>oVirt версии 3.1 и выше различает требуемые сети и дополнительные сети.</p>

<p>Для того, чтобы кластер и сеть были в <strong>Рабочем</strong> состоянии, <strong>Требуемые</strong> сети должны применяться ко всем хостам в кластере. Логические сети по умолчанию добавляются в кластеры как <strong>Требуемые</strong> сети.</p>

<p>Если требуемая сеть становится нерабочей, для выполняемых виртуальных машин в этой сети выполняется операция блокады, и они переносятся на другой хост. Это полезно при наличии машин с критически важной рабочей нагрузкой.</p>

<p>Если становится нерабочей дополнительная сеть, виртуальные машины, работающие в этой сети, не переносятся на другой хост, что предотвращает нежелательной нагрузки на операции ввода-вывода, возникающей в связи с массовой миграцией.</p>

<p>Дополнительные сети — это логические сети, которые не были явно указаны как <strong>Требуемые</strong>. Дополнительные сети можно создать только на тех хостах, которые их используют. Присутствие или отсутствие этих сетей не влияет на <strong>Рабочее</strong> состояние хоста.</p>

<p>Используйте кнопку <strong>Управление сетями</strong> чтобы изменить обозначение сети как <strong>Требуемой</strong>.</p>

<p>Сети виртуальных машин (которые в пользовательском интерфейсе называются <strong>Сети ВМ</strong>) — это логические сети, предназначенные для переноса только трафика виртуальных машин. Сети виртуальных машин могут быть требуемыми или дополнительными.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> виртуальная машина с сетевым интерфейсом в дополнительной сети ВМ, не запустится на хосте, не имеющем сети.</p>

</div>

<h3 id="vnic-profiles-and-qos">Профили vNIC и QoS</h3>

<h4 id="vnic-profile-overview">Обзор профилей vNIC</h4>

<p>Профиль виртуального сетевого адаптера (vNIC) — это набор параметров, который можно применить к отдельному виртуальному сетевому адаптеру в oVirt. Профили vNIC позволяют применять профили качества обслуживания сети к vNIC, включать или отключать зеркалирование портов, и добавлять или удалять настраиваемые параметры. Профили vNIC предоставляют добавленный слой гибкости администрирования, т.к. права на использование (потребление) этих профилей можно присваивать конкретным пользователям. Таким образом можно контролировать качество обслуживания, получаемое различными пользователями в конкретной сети.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> начиная с oVirt версии 3.3, виртуальные машины имеют доступ к логическим сетям только через использование профилей vNIC, и не могут получить доступ к логической сети, если для неё не существует профилей vNIC. При создании логической сети в oVirt, в этой логической сети автоматически создаётся профиль vNIC с именем этой логической сети.</p>

</div>

<h4 id="creating-a-vnic-profile">Создание профиля vNIC</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание профиля vNIC для регулирования пропускной способности сети для пользователей и групп.</p>

<p><strong>Инструкция&nbsp;5.1.&nbsp;Создание профиля vNIC</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Сети</strong>, древовидный режим или поисковый функционал чтобы найти и выделить логическую сеть на панели результатов.</li>
  <li>Перейдите на вкладку <strong>Профили</strong> на панели сведений чтобы увидеть доступные профили vNIC. Если логическая сеть была выбрана в древовидном режиме, на вкладку <strong>Профили vNIC</strong> можно перейти из списка результатов.</li>
  <li>
    <p>Нажмите <strong>Добавить</strong> чтобы открыть окно <strong>Профиль сетевого адаптера ВМ</strong>.
⁠</p>

    <table>
      <tbody>
        <tr>
          <td>![The VM Interface Profile window</td>
          <td>350px](VM_Interface_Profile.png "The VM Interface Profile window</td>
          <td>350px")</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Рисунок&nbsp;5.1.&nbsp;Окно профиля сетевого адаптера ВМ</strong></p>
  </li>
  <li>Введите <strong>Имя</strong> и <strong>Описание</strong> профиля.</li>
  <li>В выпадающем меню <strong>QoS</strong> выберите соответствующую политику QoS для применения к профилю vNIC.</li>
  <li>Отметьте пункты <strong>Зеркалирование портов</strong> и <strong>Разрешить всем пользователям использовать этот профиль</strong> чтоб включить эти параметры.</li>
  <li>Используйте выпадающее меню настраиваемых параметров, где по умолчанию показывается пункт <strong>Выберите клавишу…</strong>, чтобы выбрать настраиваемый параметр, и с помощью клавиш <strong>+</strong> и <strong>-</strong> добавьте дополнительные настраиваемые параметры или удалите существующие.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить профиль и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали профиль vNIC. Примените этот профиль пользователям и группам для регулирования пропускной способности их сети.</p>

<h4 id="assigning-security-groups-to-vnic-profiles">Присвоение групп безопасности профилям vNIC</h4>

<p><strong>Описание задачи</strong></p>

<p>Группы безопасности можно присвоить профилю vNIC тех сетей, которые были импортированы из экземпляра OpenStack Networking и в которых используются модули Linux Bridge или Open vSwitch. Группа безопасности — это набор правил строгого выполнения, дающих возможность фильтрации входящего и исходящего трафика на сетевом интерфейсе. В нижеследующей инструкции описывается присоединение группы безопасности к профилю vNIC.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;5.2.&nbsp;Присвоение групп безопасности профилям vNIC</strong></p>

<ol>
  <li>Во вкладке <strong>Сети</strong> выберите логическую сеть из списка результатов.</li>
  <li>Перейдите во вкладку <strong>Профили vNIC</strong> на панели сведений.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong> или выберите существующий профиль vNIC и нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Профиль сетевого адаптера ВМ</strong>.</li>
  <li>В выпадающем меню настраиваемых параметров выберите <strong>SecurityGroups</strong>.</li>
  <li>В текстовом поле справа от выпадающего меню введите идентификатор группы безопасности, которую нужно прикрепить к профилю vNIC.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> группа безопасности идентифицируется с помощью идентификатора этой группы, зарегистрированного в экземпляре OpenStack Networking. Идентификаторы групп безопасности указанного клиента можно узнать, выполнив следующую команду в системе, где установлена OpenStack Networking:</p>

<pre class="highlight plaintext"><code># neutron security-group-list
</code></pre>

</div>
<p><strong>Результат</strong></p>

<p>Мы прикрепили группу безопасности к профилю vNIC. Теперь весь трафик, проходящий сквозь логическую сеть, к которой прикреплён этот профиль, будет фильтроваться в соответствии с правилами этой группы.</p>

<h4 id="explanation-of-settings-in-the-vm-interface-profile-window">Объяснение параметров окна «Профиль сетевого адаптера ВМ»</h4>

<p><strong>Таблица&nbsp;5.1.&nbsp;Окно профиля сетевого адаптера ВМ</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Сеть</strong></p></td>
<td align="left"><p>Выпадающее меню с доступными сетями для применения профиля vNIC.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Имя профиля vNIC. Это должно быть уникальное имя, состоящее из любого сочетания прописных и строчных букв, цифр, тире и знаков подчёркивания количеством от 1 до 50 символов.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Описание профиля vNIC. Поле рекомендуется, но не обязательно.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>QoS</strong></p></td>
<td align="left"><p>Выпадающее меню доступных политик качества обслуживания сети для применения к профилю vNIC. Политики QoS регулируют исходящий и входящий сетевой трафик vNIC.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Зеркалирование портов</strong></p></td>
<td align="left"><p>Флажок для переключения зеркалирования портов. Зеркалирование портов — это копирование сетевого трафика 3 уровня в логической сети на виртуальный интерфейс на виртуальной машине. По умолчанию не выбрано.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Настраиваемые параметры устройства</strong></p></td>
<td align="left"><p>Выпадающее меню с доступными настраиваемыми параметрами, применяемыми к профилю VNIC. Используйте клавиши <strong>+</strong> и <strong>-</strong> для добавления и удаления параметров.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Разрешить всем пользователям использовать этот профиль</strong></p></td>
<td align="left"><p>Флажок для переключения доступности профиля для всех пользователей в окружении. Выбрано по умолчанию.</p></td>
</tr>
</tbody>
</table>

<h4 id="removing-a-vnic-profile">Удаление профиля vNIC</h4>

<p><strong>Описание задачи</strong></p>

<p>Удаление профиля vNIC из виртуализованного окружения.</p>

<p><strong>Инструкция&nbsp;5.3.&nbsp;Удаление профиля vNIC</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Сети</strong>, древовидный режим или поисковый функционал чтобы найти и выделить логическую сеть на панели результатов.</li>
  <li>Перейдите на вкладку <strong>Профили</strong> на панели сведений чтобы увидеть доступные профили vNIC. Если логическая сеть была выбрана в древовидном режиме, на вкладку <strong>Профили vNIC</strong> можно перейти из списка результатов.</li>
  <li>Выберите один или более профилей и нажмите <strong>Удалить</strong> чтобы открыть окно <strong>Удалить профиль сетевого адаптера ВМ</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы удалить профиль и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили профиль vNIC.</p>

<h4 id="user-permissions-for-vnic-profiles">Права доступа пользователей для профилей vNIC</h4>

<p><strong>Описание задачи</strong></p>

<p>Настройка привилегий пользователя для привязки пользователей к определённым профилям vNIC. Присвойте пользователю роль <strong>VnicProfileUser</strong> чтобы разрешить пользователю использовать профиль. Запретите доступ пользователей к конкретным профилям, удалив их права на этот профиль.</p>

<p><strong>Инструкция&nbsp;5.4.&nbsp;Права доступа пользователей для профилей vNIC</strong></p>

<ol>
  <li>В древовидном режиме выберите логическую сеть.</li>
  <li>Перейдите на ресурсную вкладку <strong>Профили vNIC</strong> чтобы увидеть все профили VNIC.</li>
  <li>Перейдите на вкладку <strong>Права доступа</strong> на панели сведений чтобы увидеть текущие права пользователя на этот профиль.</li>
  <li>Используйте кнопку <strong>Добавить</strong> чтобы открыть окно <strong>Добавить права пользователю</strong>, и кнопку <strong>Удалить</strong> чтобы открыть окно <strong>Удалить права</strong>, чтобы изменить права доступа пользователя для профиля vNIC.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили права доступа пользователя для профиля VNIC.</p>

<h4 id="qos-overview">Обзор QoS</h4>

<p>Сетевое качество услуг — это функционал, позволяющий создавать профили для ограничения как входящего, так и исходящего трафика отдельного виртуального NIC. С его помощью можно ограничивать пропускную способность нескольких уровней, контролируя потребление сетевых ресурсов.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> сетевое качество услуг поддерживается на кластерах с версией совместимости 3.3 и выше.</p>

</div>

<h4 id="adding-qos">Добавление QoS</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание профиля QoS для регуляции сетевого трафика в применении к профилю vNIC, или другими словами, профилю сетевого адаптера ВМ.</p>

<p><strong>Инструкция&nbsp;5.5.&nbsp;Создание профиля QoS</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Дата-центры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить дата-центр в списке результатов.</li>
  <li>Перейдите на вкладку <strong>QoS сети</strong> на панели сведений чтобы увидеть доступные профили QoS.</li>
  <li>Нажмите <strong>Добавить</strong> чтобы открыть окно <strong>Добавить QoS сети</strong>.</li>
  <li>Введите <strong>Имя</strong> профиля.</li>
  <li>Укажите пределы для <strong>Входящего</strong> и <strong>Исходящего</strong> сетевого трафика.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали профиль QoS, который можно использовать в профиле vNIC, или другими словами, в профиле сетевого адаптера ВМ.</p>

<h4 id="settings-in-the-new-network-qos-and-edit-network-qos-windows-explained">Объяснение параметров в окнах «Добавить QoS сети» и «Изменить QoS сети»</h4>

<p>Параметры QoS сети дают возможность настроить ограничения для пропускной способности сети для входящего и для исходящего трафика на трёх разных уровнях.</p>

<p><strong>Таблица&nbsp;5.2.&nbsp;Параметры QoS сети</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Дата-центр</strong></p></td>
<td align="left"><p>Дата-центр, в который будет добавлена политика QoS сети. Это пол настраивается автоматически в соответствии с выбранным дата-центром.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Имя, с которым политика QoS сети будет представлена в пределах oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Входящий</strong></p></td>
<td align="left"><p>Параметры, применяемые ко входящему трафику. Отметьте или снимите флажок <strong>Входящий</strong> для включения или отключения этих параметров.</p>
<ul>
<li><strong>Средняя</strong>: средняя скорость входящего трафика.</li>
<li><strong>Пиковая</strong>: скорость входящего трафика в периоды пиковой нагрузки.</li>
<li><strong>Пиковый всплеск</strong>: скорость входящего трафика во время пиковых всплесков.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Исходящий</strong></p></td>
<td align="left"><p>Параметры, применяемые к исходящему трафику. Отметьте или снимите флажок <strong>Исходящий</strong> для включения или отключения этих параметров.</p>
<ul>
<li><strong>Средняя</strong>: средняя скорость исходящего трафика.</li>
<li><strong>Пиковая</strong>: скорость исходящего трафика в периоды пиковой нагрузки.</li>
<li><strong>Пиковый всплеск</strong>: скорость исходящего трафика во время пиковых всплесков.</li>
</ul></td>
</tr>
</tbody>
</table>

<h4 id="removing-qos">&nbsp;Удаление QoS</h4>

<p><strong>Описание задачи</strong></p>

<p>Удаление профиля QoS сети из виртуализованного окружения.</p>

<p><strong>Инструкция&nbsp;5.6.&nbsp;Удаление профиля QoS сети</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Дата-центры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить дата-центр в списке результатов.</li>
  <li>Перейдите на вкладку <strong>QoS сети</strong> на панели сведений чтобы увидеть доступные профили QoS.</li>
  <li>Выделите профиль QoS для удаления и нажмите <strong>Удалить</strong> чтобы открыть окно <strong>Удалить QoS сети</strong>. В этом окне можно найти список профилей vNIC, если они есть, использующих выбранный профиль QoS.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили профиль QoS.</p>

<h3 id="logical-network-tasks">Работа с логическими сетями</h3>

<h4 id="creating-a-new-logical-network-in-a-data-center-or-cluster-2">Создание новой логической сети в дата-центре или кластере</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание логической сети и определение её использования в дата-центре или на кластерах в дата-центре.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;5.7.&nbsp;Создание новой логической сети в дата-центре или кластере</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Дата-центры</strong> или <strong>Кластеры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить дата-центр или кластер в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Логические сети</strong> на панели сведений чтобы увидеть список существующих логических сетей.</li>
  <li>На панели сведений <strong>Дата-центры</strong> нажмите на кнопку <strong>Добавить</strong> чтобы открыть окно <strong>Добавить логическую сеть</strong>. На панели сведений <strong>Кластеры</strong> нажмите <strong>Добавить сеть</strong> чтобы открыть окно <strong>Добавить логическую сеть</strong>.</li>
  <li>Введите <strong>Имя</strong>, <strong>Описание</strong> и <strong>Комментарий</strong> для логической сети.</li>
  <li>В разделе <strong>Экспорт</strong> отметьте параметр <strong>Создать на внешнем поставщике</strong> чтобы создать логическую сеть на внешнем поставщике. Выберите <strong>Внешнего поставщика</strong> в выпадающем меню.</li>
  <li>В разделе <strong>Параметры сети</strong> выберите пункты <strong>Включить добавление тегов для VLAN</strong>, <strong>Сеть ВМ</strong> и <strong>Переназначить MTU</strong> чтобы включить соответствующие параметры.</li>
  <li>В текстовом поле <strong>Метка сети</strong> введите новую метку логической сети или выберите уже существующую.</li>
  <li>Во вкладке <strong>Кластер</strong> выберите кластеры, которым будет присвоена сеть. Также можно указать, будет ли логическая сеть требуемой сетью.</li>
  <li>При выбранном параметре <strong>Создать на внешнем поставщике</strong> станет доступна вкладка <strong>Подсеть</strong>. Во вкладке <strong>Подсеть</strong> введите <strong>Имя</strong>, <strong>CIDR</strong> и выберите <strong>Версию IP</strong> для подсети, которую предоставит эта логическая сеть.</li>
  <li>Во вкладке <strong>Профили</strong> добавьте в логическую сеть профили vNIC, если это требуется.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы определили логическую сеть в качестве ресурса, требуемого кластером или кластерами в дата-центре. Если была указана метка логической сети, сеть будет автоматически добавлена ко всем сетевым интерфейсам хоста, имеющим эту метку.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> при создании новой логической сети или внесении изменений в параметры существующей сети, которая используется как сеть передачи экрана, все выполняющиеся ВМ, использующие эту сеть, должны быть перезапущены для того, чтобы сеть стала доступна или для применения внесённых изменений.</p>

</div>

<h4 id="explanation-of-settings-and-controls-in-the-new-cluster-and-edit-cluster-windows-1">Объяснение параметров и элементов управления в окнах «Добавить кластер» и «Изменить кластер»</h4>

<h5 id="logical-network-general-settings-explained">Объяснение общих параметров логической сети</h5>

<p>В таблице ниже описываются параметры вкладки <strong>Общие</strong> окон <strong>Добавить логическую сеть</strong> и <strong>Изменить логическую сеть</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;5.3.&nbsp;Параметры окон добавления логической сети и изменения параметров логической сети</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Имя логической сети. Это текстовое поле ограничено 15 символами и должно содержать уникальное имя, состоящее из любого сочетания строчных и прописных букв, цифр, тире и символов подчёркивания.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Описание логической сети. Это текстовое поле ограничено 40 символами.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Комментарий</strong></p></td>
<td align="left"><p>Поле для добавления удобочитаемого комментария в простом текстовом формате.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Создать на внешнем поставщике</strong></p></td>
<td align="left"><p>Даёт возможность создать логическую сеть в экземпляре OpenStack Networking, добавленном в oVirt в качестве внешнего поставщика. <strong>Внешний поставщик</strong> — даёт возможность выбрать внешнего поставщика, на котором будет создана логическая сеть.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Включить добавление тегов для VLAN</strong></p></td>
<td align="left"><p>Теги VLAN — это элемент защиты, добавляющий особые характеристики всему сетевому трафику логических сетей. Трафик с тегами VLAN не может быть прочитан интерфейсами, не имеющими таких же характеристик. Использование VLAN в логических сетях также позволяет связать один сетевой интерфейс с несколькими логическими сетями, имеющими различные теги VLAN. Введите числовое значение в текстовое поле, если теги VLAN включены.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Сеть ВМ</strong></p></td>
<td align="left"><p>Выберите этот параметр, если сеть используется только виртуальными машинами. Если сеть используется для переноса трафика, не используемого ВМ, например, для обмена информацией с хранилищами, не отмечайте этот параметр.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Переназначить MTU</strong></p></td>
<td align="left"><p>Указывает максимальный передаваемый блок данных для логической сети. Этот параметр можно использовать для уравнивания значений максимального передаваемого бока данных, поддерживаемого новой логической сетью, и максимального передаваемого блока данных, поддерживаемого физическим адаптером, предоставляющим интерфейс. Введите числовое значение в текстовое поле, если <strong>Переназначение MTU</strong> было выбрано.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Метка сети</strong></p></td>
<td align="left"><p>Даёт возможность указать новую метку для сети или выбрать из уже существующих меток, уже назначенных сетевым интерфейсам хоста. При выборе уже существующей метки логическая сеть будет автоматически присвоена всем сетевым интерфейсам хоста, имеющим эту метку.</p></td>
</tr>
</tbody>
</table>

<h5 id="logical-network-cluster-settings-explained">Объяснение параметров кластера логической сети</h5>

<p>В таблице ниже описываются параметры вкладки <strong>Кластер</strong> окон <strong>Добавить логическую сеть</strong> и <strong>Изменить логическую сеть</strong>.</p>

<p><strong>Таблица&nbsp;5.4.&nbsp;Параметры добавления логической сети и изменения логической сети</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Присоединить сеть к/отсоединить сеть от кластеров</strong></p></td>
<td align="left"><p>Даёт возможность присоединить или отсоединить логическую сеть от кластеров дата-центра и указать, будет ли логическая сеть требуемой сетью для конкретных кластеров.</p>
<p><strong>Имя</strong> — имя кластера, к которому будут применяться параметры. Это значение нельзя изменить.</p>
<p><strong>Присоединить все</strong>  даёт возможность присоединить или отсоединить логическую сеть к или от всех кластеров в дата-центре. Или выберите/снимите отметки <strong>Присоединить</strong> рядом с именем конкретного кластера, чтобы присоединить или отсоединить от него логическую сеть.</p>
<p><strong>Требуемые: все</strong> — даёт возможность указать, будет ли логическая сеть требуемой сетью на всех кластерах. Или выберите/снимите отметки <strong>Требуемая</strong> рядом с именем конкретного кластера, чтобы указать, является ли эта логическая сеть требуемой для указанного кластера.</p></td>
</tr>
</tbody>
</table>

<h5 id="logical-network-vnic-profiles-settings-explained">Объяснение параметров профилей vNIC логических сетей</h5>

<p>В таблице ниже описываются параметры вкладки <strong>Профили vNIC</strong> окон <strong>Добавить логическую сеть</strong> и <strong>Изменить логическую сеть</strong>.</p>

<p><strong>Таблица&nbsp;5.5.&nbsp;Параметры добавления логической сети и изменения логической сети</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Профили vNIC</strong></p></td>
<td align="left"><p>Даёт возможность указать один или более профилей vNIC для логической сети. Добавить или удалить профиль vNIC логической сети можно, нажимая на кнопку плюс или минус рядом с профилем vNIC. Имя профиля vNIC указывается в первом поле.</p>
<p><strong>Открытый</strong> — даёт возможность указать, будет ли профиль доступен всем пользователям.</p>
<p><strong>QoS</strong> — возможность указать профиль QoS для профиля vNIC.</p></td>
</tr>
</tbody>
</table>

<h4 id="editing-a-logical-network">Изменение параметров логической сети</h4>

<p><strong>Описание задачи</strong></p>

<p>Изменение параметров логической сети.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;5.8.&nbsp;Изменение логической сети</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Дата-центры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить дата-центр логической сети в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Логические сети</strong> на панели сведений чтоб увидеть список логических сетей дата-центра.</li>
  <li>Выберите логическую сеть и нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить логическую сеть</strong>.</li>
  <li>Измените необходимые параметры.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы обновили параметры логической сети.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> многохостовая конфигурация сети доступна в дата-центрах с версией совместимости 3.1 или более поздней, и её обновлённые параметры сети автоматически применяются на всех хостах того дата-центра, к которому относится сеть. Изменения применяются только тогда, когда машины, использующие сеть, не работают. Логическую сеть, уже настроенную на хосте, нельзя переименовать. Нельзя отключить параметр <strong>Сеть ВМ</strong> во время работы ВМ или шаблона, использующих эту сеть.</p>

</div>

<h4 id="designate-a-specific-traffic-type-for-a-logical-network-with-the-manage-networks-window-1">Назначение конкретного типа трафика логической сети в окне управления сетями</h4>

<p><strong>Описание задачи</strong></p>

<p>Назначение типа трафика логической сети для оптимизации потока сетевого трафика.</p>

<p><strong>Инструкция&nbsp;5.9.&nbsp;Присоединение или отсоединение логической сети от кластера</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Кластеры</strong>, древовидный режим или поисковый функционал чтобы найти и выделить кластер в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Логические сети</strong> на панели сведений чтоб увидеть список логических сетей, присвоенных кластеру.</li>
  <li>
    <p>Нажмите <strong>Управление сетями</strong> чтобы открыть окно <strong>Управление сетями</strong>.
⁠</p>

    <table>
      <tbody>
        <tr>
          <td>![The Manage Networks window</td>
          <td>300px](Manage_Networks.png "The Manage Networks window</td>
          <td>300px")</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Рисунок&nbsp;5.2.&nbsp;Управление сетями</strong></p>
  </li>
  <li>Отметьте галочками необходимые параметры.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы оптимизировали поток сетевого трафика, присвоив конкретный тип трафика конкретной логической сети.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> сети, предлагаемые внешними поставщиками, не могут использоваться в качестве сетей передачи экрана.</p>

</div>

<h4 id="explanation-of-settings-in-the-manage-networks-window-1">Объяснение параметров окна управления сетями</h4>

<p>В таблице ниже описываются параметры окна <strong>Управление сетями</strong>.</p>

<p><strong>Таблица&nbsp;5.6.&nbsp;Параметры управления сетями</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание/действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Присвоить</strong></p></td>
<td align="left"><p>Присваивает логическую сеть всем хостам в кластере.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Требуется</strong></p></td>
<td align="left"><p>Сеть с пометкой «требуется» должна оставаться работоспособной для того, чтобы связанные с ней хосты функционировали корректно. Если требуемая сеть перестанет функционировать, любые связанные с ней хосты станут нерабочими.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Сеть ВМ</strong></p></td>
<td align="left"><p>Логическая сеть с пометкой «Сеть ВМ» передаёт сетевой трафик, относящийся к сети виртуальной машины.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Сеть передачи экрана</strong></p></td>
<td align="left"><p>Логическая сеть с пометкой «Сеть передачи экрана» передаёт сетевой трафик, относящийся к SPICE и контроллеру виртуальной сети.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Сеть миграции</strong></p></td>
<td align="left"><p>Логическая сеть с пометкой «Сеть миграции» передаёт трафик виртуальной машины и трафик миграции хранилища.</p></td>
</tr>
</tbody>
</table>

<h4 id="adding-multiple-vlans-to-a-single-network-interface-using-logical-networks">Добавление нескольких VLAN одному сетевому интерфейсу с помощью логических сетей</h4>

<p><strong>Описание задачи</strong></p>

<p>Несколько VLAN можно добавить одному сетевому интерфейсу для отделения трафика на одном хосте.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> в окне <strong>Добавить логическую сеть</strong> или <strong>Изменить логическую сеть</strong> необходимо предварительно создать более одной логической сети, и для каждой отметить параметр <strong>Включить теги VLAN</strong>.</p>

</div>
<p><strong>Инструкция&nbsp;5.10.&nbsp;Добавление нескольких VLAN сетевому интерфейсу с помощью логических сетей</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, древовидный режим или поисковый функционал чтобы найти и выделить в списке результатов хост, связанный с кластером, которому присвоены логические сети с тегами VLAN.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений, чтобы увидеть список физических сетевых интерфейсов, присоединённых к дата-центру.</li>
  <li>Нажмите <strong>Настройка сетей хоста</strong> чтобы открыть окно <strong>Настройка сетей хоста</strong>.</li>
  <li>
    <p>Перетащите логические сети с назначенными тегами VLAN в область <strong>Назначенные логические сети</strong> рядом с физическим сетевым интерфейсом. Благодаря тегам VLAN, физическому интерфейсу можно присвоить несколько логических сетей.
⁠</p>

    <table>
      <tbody>
        <tr>
          <td>![Setup Host Networks</td>
          <td>400px](Setup_Host_Networks.png "Setup Host Networks</td>
          <td>400px")</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Рисунок&nbsp;5.3.&nbsp;Настройка сетей хоста</strong></p>
  </li>
  <li>Измените параметры логических сетей, наведя курсор на присвоенную логическую сеть и нажав на значок карандаша, чтобы открыть окно <strong>Изменить сеть</strong>. Если определение логической сети не синхронизировано с конфигурацией сети на хосте, отметьте галочкой параметр <strong>Синхронизировать сеть</strong>. Выберите один из <strong>Протоколов загрузки</strong>:
    <ul>
      <li><strong>Нет</strong>,</li>
      <li><strong>DHCP</strong> или</li>
      <li><strong>Статический</strong>, укажите <strong>IP</strong> и <strong>Маску подсети</strong>.</li>
    </ul>

    <p>Нажмите <strong>OK</strong>.</p>
  </li>
  <li>Отметьте параметр <strong>Проверить доступность соединения между хостом и ЦУ</strong> для запуска сетевой проверки; проверка возможна только если хост находится в режиме обслуживания.</li>
  <li>Отметьте галочкой параметр <strong>Сохранить параметры сети</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p>Добавьте логическую сеть к каждому хосту кластера, отредактировав параметры NIC каждого хоста в кластере. После выполнения этой операции сеть станет работоспособной.</p>

<p><strong>Результат</strong></p>

<p>Мы добавили несколько логических сетей с тегами VLAN к одному интерфейсу. Этот процесс можно повторять не один раз, каждый раз выбирая и изменяя один и тот же сетевой интерфейс на каждом хосте и добавляя логические сети с разными тегами VLAN к одному сетевому интерфейсу.</p>

<h4 id="network-labels">Сетевые метки</h4>

<p>Сетевые метки использовать для значительного упрощения различных административных задач, связанных с созданием и управлением логических сетей, и привязки этих сетей к физическим сетевым интерфейсам хостов и связкам.</p>

<p>Метка сети — это удобочитаемая метка в простом текстовом формате, которую можно назначить логической сети или физическому сетевом интерфейсу хоста. Строгого ограничения длины метки не существует, но при её создании необходимо использовать только сочетание строчных и прописных букв, знаков подчёркивания и тире; пробелы и специальные символы не разрешаются.</p>

<p>Присвоение метки логической сети или физическому интерфейсу хоста создаёт связь с логическими сетями или физическими интерфейсами с такой же меткой, а именно:</p>

<p><strong>Связи сетевых меток</strong></p>

<ul>
  <li>При присвоении метки логической сети, эта сеть автоматически становится связанной с любыми физическими сетевыми интерфейсами, имеющими такую же метку.</li>
  <li>При присвоении метки физическому сетевому интерфейсу хоста любые логические сети с такой же меткой будут автоматически связаны с этим интерфейсом.</li>
  <li>Изменение метки, присвоенной логической сети или физическому сетевому интерфейсу аналогично удалению старой метки и присвоению новой. Связь между соответствующими логическими сетями или физическими сетевыми интерфейсами хоста обновляется.</li>
</ul>

<p><strong>Сетевые метки и кластеры</strong></p>

<ul>
  <li>При добавлении логической сети с присвоенной меткой в кластер, где есть физический сетевой интерфейс хоста с такой же меткой, логическая сеть автоматически добавляется к этому интерфейсу.</li>
  <li>При отсоединении логической сети с меткой от кластера, где имеется физический сетевой интерфейс хоста с такой же меткой, логическая сеть автоматически отсоединяется от этого физического сетевого интерфейса хоста.</li>
</ul>

<p><strong>Сетевые метки и логические сети, имеющие роли</strong></p>

<ul>
  <li>Когда логической сети с присвоенной сеткой назначается роль сети передачи экрана или сети миграции, эта логическая сеть настраивается на физическом сетевом интерфейсе хоста с использованием DHCP, с целью присвоения логической сети IP-адреса.</li>
</ul>

<h5 id="adding-network-labels-to-host-network-interfaces">Присвоение сетевых меток сетевым интерфейсам хоста</h5>

<p><strong>Описание задачи</strong></p>

<p>Использование сетевых меток значительно облегчает выполнение административных работ, связанных с присвоением логических сетей сетевым интерфейсам хостов.</p>

<p><strong>Инструкция&nbsp;5.11.&nbsp;Добавление сетевых меток сетевым интерфейсам хоста</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, древовидный режим или поисковый функционал чтобы найти и выделить в списке результатов хост, связанный с кластером, которому присвоены логические сети с тегами VLAN.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений, чтобы увидеть список физических сетевых интерфейсов, присоединённых к дата-центру.</li>
  <li>Нажмите <strong>Настройка сетей хоста</strong> чтобы открыть окно <strong>Настройка сетей хоста</strong>.</li>
  <li>
    <p>Измените параметры физического сетевого интерфейса хоста, наведя курсор на присвоенную логическую сеть и нажав на значок карандаша, чтобы открыть окно <strong>Изменить интерфейс</strong>.
⁠</p>

    <table>
      <tbody>
        <tr>
          <td>![The Edit Interface Window</td>
          <td>200px](Edit_Management_Network.png "The Edit Interface Window</td>
          <td>200px")</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Рисунок&nbsp;5.4.&nbsp;Окно изменения интерфейса</strong></p>
  </li>
  <li>Введите имя сетевой метки в текстовом поле <strong>Метка</strong>, и используйте клавиши <strong>+</strong> и <strong>-</strong> для добавления или удаления дополнительных меток сети.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы добавили метку сети сетевому интерфейсу хоста. Любые новые логические сети с такой же меткой будут автоматически привязаны ко всем сетевым интерфейсам хостов, имеющим эту же метку. Удаление метки из логической сети автоматически удалит эту сеть из всех сетевых интерфейсов, имеющих эту метку.</p>

<h4 id="using-the-networks-tab">Использование вкладки «Сети»</h4>

<p>Ресурсная вкладка <strong>Сети</strong> предоставляет пользователям централизованное местоположение для выполнения сетевых операций и поиска сетей на базе свойств каждой сети или привязки к другим ресурсам.</p>

<p>Все сети в окружении oVirt показываются в списке результатов во вкладке <strong>Сети</strong>. Кнопки <strong>Добавить</strong>, <strong>Изменить</strong> и <strong>Удалить</strong> позволяют создавать, изменять свойства и удалять логические сети в пределах дата-центров.</p>

<p>Нажмите на имя каждой сети, и с помощью вкладок <strong>Кластеры</strong>, <strong>Хосты</strong>, <strong>ВМ</strong>, <strong>Шаблоны</strong> и <strong>Права доступа</strong> возможно будет выполнить различные операции, включающие в себя:</p>

<ul>
  <li>Присоединение и отсоединение сетей от кластеров и хостов</li>
  <li>Удаление сетевых интерфейсов из виртуальных машин и шаблонов</li>
  <li>Добавление и удаление привилегий пользователей на доступ и выполнение операций с сетями</li>
</ul>

<p>Этот функционал также доступен в индивидуальной вкладке каждого ресурса.</p>

<h3 id="external-provider-networks">Сети внешнего поставщика</h3>

<h4 id="importing-networks-from-external-providers">Импорт сетей из внешних поставщиков</h4>

<p><strong>Описание задачи</strong></p>

<p>Если внешний поставщик, предлагающий сетевые услуги, был зарегистрирован в oVirt, сети, предлагаемые этим поставщиком, можно импортировать в oVirt и использовать на виртуальных машинах.</p>

<p><strong>Инструкция&nbsp;5.12.&nbsp;Импорт сети от внешнего поставщика</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Сети</strong>.</li>
  <li>
    <p>Нажмите на вкладку <strong>Импорт</strong> чтобы открыть окно <strong>Импорт сетей</strong>.
⁠</p>

    <table>
      <tbody>
        <tr>
          <td>![The Import Networks Window</td>
          <td>300px](Import_Networks.png "The Import Networks Window</td>
          <td>300px")</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Рисунок&nbsp;5.5.&nbsp;Окно импорта сетей</strong></p>
  </li>
  <li>В выпадающем списке <strong>Поставщик сети</strong> выберите внешнего поставщика. Сети, предоставляемые этим поставщиком, обнаруживаются автоматически и доступны в списке <strong>Сети поставщика</strong>.</li>
  <li>В списке <strong>Сети поставщика</strong> отметьте галочками сети, которые необходимо импортировать, и далее нажмите стрелку, указывающую вниз, чтобы переместить эти сети в список <strong>Сети для импорта</strong>.</li>
  <li>В выпадающем списке <strong>Дата-центр</strong> выберите дата-центр, в который будут импортированы сети.</li>
  <li>При необходимости, уберите отметку с пункта <strong>Разрешить всем</strong>, рядом с сетью в списке <strong>Сети для импорта</strong>, чтобы предотвратить доступ к этой сети всех пользователей.</li>
  <li>Нажмите на кнопку <strong>Импорт</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Выбранные сети импортируются в целевой дата-центр и могут использоваться в oVirt.</p>

<h4 id="limitations-to-using-external-provider-networks">Ограничения на использование сетей внешних поставщиков</h4>

<p>В окружении oVirt существуют следующие ограничения на использование логических сетей, импортированных из внешних поставщиков.</p>

<ul>
  <li>Логические сети, предоставляемые внешними поставщиками, должны использоваться в качестве сетей виртуальных машин, и не должны использоваться в качестве сетей передачи экрана.</li>
  <li>Одни и те же логические сети могут импортироваться более одного раза, но только в разные дата-центры.</li>
  <li>Нельзя изменить свойства сети, предоставляемой внешним поставщиком, в oVirt. Для изменения свойств логической сети, предоставляемой внешним поставщиком, это необходимо сделать напрямую в экземпляре OpenStack Networking, предоставляющем эту логическую сеть.</li>
  <li>Для виртуальных сетевых карт, подключённых к логическим сетям, предоставляемым внешним поставщиком, зеркалирование портов невозможно.</li>
  <li>Если ВМ использует логическую сеть, предоставляемую внешним поставщиком, этот поставщик не может быть удалён из oVirt, если логическая сеть всё ещё используется виртуальной машиной.</li>
  <li>Логические сети, предоставляемые внешним поставщиком, не являются требуемыми сетями. Поэтому при составлении расписания для кластеров, куда были импортированы такие логические сети, при выборе хоста такие сети не будут учитываться. Более того, за обеспечение доступности логической сети на хостах в кластерах, куда были импортированы такие логические сети, полностью отвечает пользователь.</li>
</ul>

<div class="alert alert-info">
  <p><strong>Важно:</strong> логические сети, импортированные из внешних поставщиков, совместимы только с хостами на базе Red Hat Enterprise Linux, и не могут быть присвоены виртуальным машинам, выполняющимися на хостах oVirt Node.</p>

</div>
<div class="alert alert-info">
  <p><strong>Важно:</strong> обнаружение внешних поставщиков и операции импорта являются функционалом ознакомительной технической версии. Возможности ознакомительных технических версий не полностью поддерживаются договорами о предоставлении услуг подписки Red Hat (SLA), эти версии могут функционировать лишь частично, и не предназначены для использования на производстве. Тем не менее, таким образом предоставляется ранний доступ к будущим инновациям продукта, что даёт возможность клиентам протестировать данный функционал и предоставить свои отзывы ещё во время процесса разработки.</p>

</div>

<h4 id="subnets-on-external-provider-logical-networks">Подсети в логических сетях внешних поставщиков</h4>

<h5 id="configuring-subnets-on-external-provider-logical-networks">Настройка подсетей в логических сетях внешнего поставщика</h5>

<p>Логические сети, предоставляемые внешними поставщиками, могут присваивать IP-адрес только если в этой логической сети была создана одна или более подсетей. В случае отсутствия подсетей, виртуальным машинам не будет присвоен IP-адрес. В случае наличия одной подсети, виртуальной машине будет присвоен IP-адрес этой подсети, а в случае наличия нескольких подсетей, машине будет присвоен адрес из любой доступной подсети. За выдачу этих IP-адресов отвечает служба DHCP, предоставляемая экземпляром Neutron, на котором хостируется логическая сеть.</p>

<p>Хотя oVirt автоматически обнаруживает предварительно настроенные подсети в импортированных логических сетях, можно также добавить или удалить подсети логических сетей непосредственно из окружения oVirt.</p>

<h5 id="adding-subnets-to-external-provider-logical-networks">Добавление подсетей логическим сетям внешних поставщиков</h5>

<p><strong>Описание задачи</strong></p>

<p>Создание подсети в логической сети, предоставленной внешним поставщиком</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;5.13.&nbsp;Добавление подсетей в логическую сеть внешнего поставщика</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Сети</strong>.</li>
  <li>Нажмите на логическую сеть, предоставленную внешним поставщиком, в которую будет добавлена подсеть.</li>
  <li>Перейдите на вкладку <strong>Подсети</strong> на панели сведений.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong> чтобы открыть окно <strong>Добавить внешнюю подсеть</strong>.</li>
  <li>Введите <strong>Имя</strong> и <strong>CIDR</strong> новой подсети.</li>
  <li>В выпадающем меню <strong>Версия IP</strong> выберите либо <strong>IPv4</strong> либо <strong>IPv6</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>В логической сети была создана новая подсеть.</p>

<h5 id="removing-subnets-from-external-provider-logical-networks">Удаление подсетей из логической сети внешнего поставщика</h5>

<p><strong>Описание задачи</strong></p>

<p>Удаление подсети из логической сети, предоставленной внешним поставщиком</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;5.14.&nbsp;Удаление подсетей из логической сети внешнего поставщика</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Сети</strong>.</li>
  <li>Нажмите на логическую сеть, предоставленную внешним поставщиком, из которой будет удалена подсеть.</li>
  <li>Перейдите на вкладку <strong>Подсети</strong> на панели сведений.</li>
  <li>Нажмите на подсеть, которую нужно удалить.</li>
  <li>Нажмите на кнопку <strong>Удалить</strong> и нажмите <strong>OK</strong> для подтверждения.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Подсеть была удалена из логической сети.</p>

<h2 id="hosts">⁠Хосты</h2>

<h3 id="introduction-to-ovirt-hosts">Введение в хосты oVirt</h3>

<p>Хосты, известные также как гипервизоры, это физические серверы, на которых работают виртуальные машины. Полная виртуализация обеспечивается использованием загружаемого модуля ядра Linux под названием Kernel-based Virtual Machine (KVM).</p>

<p>KVM поддерживает одновременное хостирование нескольких ВМ с установленными ОС Windows или Linux. Виртуальные машины выполняются на хост-машине как отдельные процессы и потоки Linux и удалённо управляются oVirt. К окружению oVirt подключается один или более хостов.</p>

<p>oVirt поддерживает два способа установки хостов. Можно использовать установочный ресурс oVirt Node или установить пакеты гипервизора стандартным способом, используемым в дистрибутивах Red Hat Enterprise Linux, CentOS или Fedora .</p>

<p>Хосты oVirt используют преимущества <strong>настроенных</strong> профилей, предоставляющих оптимизацию виртуализации. Подробности о <strong>настроенных</strong> профилях в Red Hat Enterprise Linux см. в <em><a href="http://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html-single/Performance_Tuning_Guide/index.html">Руководстве по тонкой настройке производительности в Red Hat Enterprise Linux 6.0</a></em>.</p>

<p>В oVirt Node по умолчанию включены и полностью настроены средства безопасности Security Enhanced Linux (SELinux) и брандмауэр iptables. oVirt может открыть требуемые порты на хостах под управлением Red Hat Enterprise Linux, CentOS и Fedora, при добавлении этих хостов в окружение. Полный список портов см. в <a href="http://www.ovirt.org/documentation/admin-guide/administration-guide/#Virtualization_Host_Firewall_Requirements1">Разделе&nbsp;A.2, “Требования к брандмауэру хостов виртуализации”</a>.</p>

<p>Хост — это физический сервер 64-битной архитектуры с расширениями Intel VT или AMD-V, на котором установлена ОС Red Hat Enterprise Linux версии 6.1 или выше, а также CentOS версии 6.1 или выше, на AMD64 или Intel 64.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> поддерживаются машины Red Hat Enterprise Linux 5.4 и Red Hat Enterprise Linux 5.5, принадлежащие к существующим кластерам. Гостевой агент oVirt теперь включен в канал ПО <code>virtio serial</code>. При обновлении хостов Red Hat Enterprise Linux с версии 5 до версии 6, все гостевые агенты, установленные в гостевых Windows, работающих на хостах Red Hat Enterprise Linux, будут отключены от oVirt.</p>

</div>
<p>Физический хост на платформе oVirt:</p>

<ul>
  <li>Должен принадлежать только одному кластеру в системе.</li>
  <li>Должен иметь ЦП, поддерживающие расширения аппаратной виртуализации AMD-V или Intel VT.</li>
  <li>Должен иметь ЦП, полностью поддерживающие функционал, заявленный типом виртуального ЦП, выбранным во время создания кластера.</li>
  <li>Должен иметь минимум 2 ГБ оперативной памяти.</li>
  <li>Может иметь назначенного системного администратора с системными правами.</li>
</ul>

<h3 id="ovirt-node-hosts">Хосты oVirt Node</h3>

<p>Хосты oVirt Node устанавливаются с использованием специальной сборки Fedora, содержащей только пакеты, нужные для хостов виртуальных машин. Хосты работают в режиме без сохранения состояния, изменения записываются на диск только в явно указанных случаях.</p>

<p>Хосты oVirt Node можно напрямую добавлять к oVirt, а также настроить их с помощью oVirt. Или же хост можно настроить локально для подключения к oVirt; в таком случае oVirt используется только для одобрения хоста на использование его в окружении.</p>

<p>В отличие от хостов на Red Hat Enterprise Linux, Fedora или CentOS, хосты oVirt Node нельзя добавлять в кластеры, используемые службой Gluster в качестве узлов Red Hat Storage.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> oVirt Node является закрытой системой. Если для рабочего окружения нужны дополнительные rpm пакеты, используйте хост на Red Hat Enterprise Linux, CentOS или Fedora.</p>

</div>

<h3 id="foreman-host-provider-hosts">Хосты поставщика хостов Foreman</h3>

<p>Хосты, предоставляемые Foreman, могут использоваться в oVirt как хосты виртуализации. После добавления поставщика хостов Foreman в oVirt в качестве внешнего поставщика, все предоставляемые таким образом хосты можно добавить и использовать в окружении oVirt точно также, как хосты oVirt Node и хосты Red Hat Enterprise Linux/CentOS.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> поддержка Foreman является ознакомительной технической версией. Такие версии имеют неполную поддержку, могут иметь отсутствующий функционал и не предназначены для использования на производстве. Тем не менее, ознакомительные технические версии предоставляют ранний доступ к будущим инновациям и дают клиентам возможность протестировать функционал и поделиться отзывами по текущей разработке.</p>

</div>

<h3 id="enterprise-linux-hosts">Хосты Enterprise Linux</h3>

<p>Стандартные установки Red Hat Enterprise Linux 6 или CentOS 6 на подходящей аппаратной конфигурации можно использовать в качестве хостов. oVirt поддерживает хосты с установленными Red Hat Enterprise Linux&nbsp;6&nbsp;или CentOS server версии AMD64/Intel 64.</p>

<p>Добавление хостов может занять некоторое время, т.к. платформа выполняет следующие шаги: проверки на возможность виртуализации, установка пакетов, создание моста и перегрузка хоста. Для наблюдения за процессом приветствия и установки связи между хостом и управляющей системой используйте Панель сведений.</p>

<h3 id="host-tasks">Задачи хоста</h3>

<h4 id="adding-an-enterprise-linux-host">Добавление хоста Enterprise Linux</h4>

<p><strong>Описание задачи</strong></p>

<p>Хост Enterprise Linux базируется на стандартной «базовой» установке дистрибутива Red Hat Enterprise Linux или CentOS. Перед добавлением в окружение oVirt, физический хост необходимо настроить.</p>

<p>oVirt авторизуется на хосте для выполнение тестов на возможность виртуализации, установки пакетов, создания сетевого моста и перезагрузки хоста. Процесс добавления нового хоста может занять до 10 минут.</p>

<p><strong>Инструкция&nbsp;6.1.&nbsp;Добавление хоста Enterprise Linux</strong></p>

<ol>
  <li>Перейдите на ресурсную вкладку <strong>Хосты</strong> чтобы получить список хостов в результатах.</li>
  <li>Нажмите <strong>Добавить</strong> чтобы открыть окно <strong>Новый хост</strong>.</li>
  <li>В выпадающих меню выберите <strong>Дата-центр</strong> и <strong>Кластер хоста</strong> для нового хоста.</li>
  <li>Введите <strong>Имя</strong>, <strong>Адрес</strong> и <strong>Порт SSH</strong> нового хоста.</li>
  <li>Выберите метод аутентификации нового хоста:
    <ul>
      <li>Ведите пароль пользователя root для аутентификации по паролю.</li>
      <li>Скопируйте ключ из поля <strong>Открытый ключ SSH</strong> в файл <code>/root/.ssh/authorized_keys</code> хоста для использования аутентификации по открытому ключу.</li>
    </ul>
  </li>
  <li>Все обязательные шаги по добавлению хоста Red Hat Enterprise Linux или CentOS выполнены. Нажмите на кнопку <strong>Дополнительные параметры</strong> чтобы развернуть дополнительные параметры хоста.
    <ol>
      <li>По выбору: отключить автоматическую настройку брандмауэра.</li>
      <li>По выбору: добавить SSH-отпечаток хоста для усиления защиты. Это можно сделать вручную или получить отпечаток автоматически.</li>
    </ol>
  </li>
  <li>Теперь во вкладках можно настроить <strong>Управление питанием</strong> и <strong>SPM</strong>; но поскольку эти параметры не являются определяющими при добавления хоста Red Hat Enterprise Linux, то они не описываются в этом действии.</li>
  <li>Нажмите <strong>OK</strong> чтобы добавить хост и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новый хост показывается в списке хостов со статусом <code>Идёт установка</code>. После окончания установки статус меняется на <code>Перезагрузить</code>. Для смены статуса на <code>Работает</code> хост необходимо активировать.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> прогресс установки можно увидеть на панели сведений.</p>

</div>

<h4 id="approving-a-hypervisor">Утверждение гипервизора</h4>

<p><strong>Описание задачи</strong></p>

<p>С виртуальными машина гипервизора нельзя работать до тех пор, пока добавление гипервизора в окружение не будет утверждено oVirt.</p>

<p><strong>Инструкция&nbsp;6.2.&nbsp;Утверждение гипервизора</strong></p>

<ol>
  <li>Авторизуйтесь на Портале администрирования oVirt.</li>
  <li>Во вкладке <strong>Хосты</strong> нажмите на хост, который необходимо утвердить. Этот хост должен быть в списке со статусом <strong>Ожидает утверждения</strong>.</li>
  <li>Нажмите кнопку <strong>Утвердить</strong>. Будет показан диалог <strong>Изменить и утвердить хосты</strong>. В этом диалоге можно указать имя хоста, получить его SSH-отпечаток перед утверждением, а также настроить управление питанием, если у хоста есть поддерживаемая карта управления питанием. Информацию о настройке управления питанием см. в разделе <a href="http://www.ovirt.org/documentation/admin-guide/administration-guide/#Host_Power_Management_Settings_Explained">«Объяснение параметров управления питанием хоста»</a>.</li>
  <li>Нажмите <strong>OK</strong>. Если управление питанием не было настроено, появится запрос на подтверждение продолжения без настройки управления питанием, нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Статус во вкладке <strong>Хосты</strong> изменяется на <strong>Идёт установка</strong>, затем, после короткой задержки, статус хоста меняется на <strong>Работает</strong>.</p>

<h4 id="explanation-of-settings-and-controls-in-the-new-host-and-edit-host-windows">Объяснение параметров и средств управления в окнах «Новый хост» и «Свойства хоста».</h4>

<h5 id="host-general-settings-explained">Объяснение общих параметров хоста</h5>

<p>Эти параметры применяются при изменении свойств хоста, или при добавлении хостов Red Hat Enterprise Linux и хостов поставщика Foreman.</p>

<p>Таблица <strong>Общих</strong> параметров содержит информацию, которая присутствует во вкладке <strong>Общее</strong> окна <strong>Новый хост</strong> или окна <strong>Свойства хоста</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;6.1.&nbsp;Общие параметры</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Дата-центр</strong></p></td>
<td align="left"><p>Дата-центр, которому принадлежит хост. Хосты oVirt Node нельзя добавить в кластеры Gluster.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Кластер хоста</strong></p></td>
<td align="left"><p>Кластер, которому принадлежит хост.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Использовать внешних поставщиков</strong></p></td>
<td align="left"><p>Отметьте/уберите отметку с этого пункта чтобы увидеть или спрятать параметры добавления хостов, предоставленных внешними поставщиками. При выборе показывается выпадающий список внешних поставщиков, добавленных в oVirt. Также доступны следующие возможности:</p>
<ul>
<li><strong>Поиск поставщиков</strong> — текстовое поле с возможностью поиска хостов, представленных выбранным внешним поставщиком. Этот параметр зависит от поставщика; подробности формулирования поискового запроса см. в документации конкретного поставщика. Чтобы увидеть все доступные хосты, оставьте это поле пустым.</li>
<li><strong>Внешние хосты</strong> — выпадающий список, содержащий имена хостов, предоставленных выбранным внешним поставщиком. Элементы этого списка упорядочены в соответствии с любыми поисковыми запросами, введёнными в <strong>Поисковый фильтр поставщика</strong>.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Имя кластера. Это текстовое поле имеет ограничение в 40 символов и должно содержать уникальное имя, состоящее из любого сочетания строчных или прописных букв, цифр, тире и знаков нижнего подчёркивания.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Комментарий</strong></p></td>
<td align="left"><p>Поле для добавления обычного текста, комментарии о хосте, в удобочитаемой форме.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Адрес</strong></p></td>
<td align="left"><p>Адрес IP или разрешаемое имя хоста.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Пароль</strong></p></td>
<td align="left"><p>Пароль пользователя root хоста. Может быть настроено только во время добавления хоста, не подлежит дальнейшим изменениям.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Открытый ключ SSH</strong></p></td>
<td align="left"><p>Скопируйте содержимое текстового поля в файл <code>/root/.known_hosts</code> хоста, чтобы при аутентификации на хосте использовать ssh-ключ oVirt вместо пароля.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Настроить брандмауэр хоста автоматически</strong></p></td>
<td align="left"><p>При добавлении хоста oVirt может открыть требуемые порты в брандмауэре хоста. Это установка по умолчанию. Это <strong>Дополнительный параметр</strong>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Отпечаток SSH</strong></p></td>
<td align="left"><p>Можно <strong>получить</strong> SSH-отпечаток хоста и сравнить его с ожидаемым отпечатком чтобы убедиться в отсутствии различий. Это <strong>Дополнительный параметр</strong>.</p></td>
</tr>
</tbody>
</table>

<h5 id="host-power-management-settings-explained">Объяснение параметров управления питанием хоста</h5>

<p>В таблице параметров <strong>Управления питанием</strong> содержится информация, присутствующая во вкладке <strong>Управление питанием</strong> окна <strong>Новый хост</strong> или <strong>Параметры хоста</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;6.2.&nbsp;Параметры управления питанием</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
</tr>
<tr class="even">
<td align="left"><p><strong>Первичный/ Вторичный</strong></p></td>
<td align="left"><p>В версиях oVirt до 3.2, хост с настроенным управлением питанием мог различать только одного агента операции блокады. Агенты, настроенные на версии 3.1 и более ранних, и единственные агенты, считаются первичными. Вторичный параметр учитывается только если определён второй агент.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Параллельно</strong></p></td>
<td align="left"><p>Имеет силу только если присутствуют два агента операции блокады, например, для хостов с двойным источником питания, где к каждому переключателю питания подключено по два агента.</p>
<ul>
<li>Если этот параметр отмечен, то во время операции блокады хоста оба агента операции блокады используются параллельно. Это означает, что для остановки хоста, оба агента должны отреагировать на команду останова; если один из агентов отреагирует на команду запуска, хост перейдёт в работоспособное состояние.</li>
<li>Если этот параметр не отмечен, агенты операции блокады используются поочерёдно. Это означает, что для останова или запуска хоста сначала используется первичный агент, и в случае неуспеха используется второй.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Адрес</strong></p></td>
<td align="left"><p>Адрес для доступа к устройству управления питанием хоста. Разрешаемое имя хоста или IP адрес.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Имя пользователя</strong></p></td>
<td align="left"><p>Учётная запись пользователя для доступа к устройству управления питанием. Можно настроить пользователя на устройстве или использовать пользователя по умолчанию.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Пароль</strong></p></td>
<td align="left"><p>Пароль пользователя, используемого для доступа к устройству управления питанием.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Тип</strong></p></td>
<td align="left"><p>Тип устройства управления питанием хоста. Выберите один из следующих:</p>
<ul>
<li><strong>apc</strong> - удалённый переключатель питания APC MasterSwitch. Нельзя использовать с устройствами переключения питания APC 5.x.</li>
<li><strong>apc_snmp</strong> - используется с устройствами переключения питания APC 5.x.</li>
<li><strong>bladecenter</strong> - адаптер удалённого управления IBM Bladecentre.</li>
<li><strong>cisco_ucs</strong> - Cisco Unified Computing System.</li>
<li><strong>drac5</strong> - контроллер удалённого доступа Dell для компьютеров Dell.</li>
<li><strong>drac7</strong> - контроллер удалённого доступа Dell для компьютеров Dell.</li>
<li><strong>eps</strong> - удалённый переключатель питания ePowerSwitch 8M+.</li>
<li><strong>hpblade</strong> - HP BladeSystem.</li>
<li><strong>ilo</strong>, <strong>ilo2</strong>, <strong>ilo3</strong>, <strong>ilo4</strong> - HP Integrated Lights-Out.</li>
<li><strong>ipmilan</strong> - устройства управления Intelligent Platform Management Interface и Sun Integrated Lights Out.</li>
<li><strong>rsa</strong> - адаптер удалённого управления IBM.</li>
<li><strong>rsb</strong> - интерфейс управления Fujitsu-Siemens RSB.</li>
<li><strong>wti</strong> - переключатель питания WTI Network PowerSwitch.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Порт</strong></p></td>
<td align="left"><p>Номер порта, используемого устройством управления питанием для обмена информацией с хостом.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Параметры</strong></p></td>
<td align="left"><p>Параметры конкретного устройства управления питанием. Вводятся в форме 'ключ=значение' или 'ключ'. Доступные параметры см. в документации устройства управления питанием хоста.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Защищённое</strong></p></td>
<td align="left"><p>Отметьте этот параметр для включения защищённого подключения устройства управления питанием к хосту. Это может быть реализовано с помощью ssh, ssl или другого протокола аутентификации, в зависимости от агента управления питанием и его возможностей поддержки.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Источник</strong></p></td>
<td align="left"><p>Указывает, будет ли хост проводить поиск прокси для операции блокады на <strong>кластере</strong> или в <strong>дата-центре</strong>. Для смены порядка, в котором используются ресурсы, используйте клавиши <strong>Вверх</strong> и <strong>Вниз</strong>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Отключить политику управления питанием</strong></p></td>
<td align="left"><p>Управление питанием контролируется <strong>Политикой кластера</strong> хоста. Если управление питанием включено, и достигнуто указанное нижнее значение потребления, oVirt отключит машину с хостом и включит её снова, когда того потребует балансировка нагрузки или если в кластере не будет достаточного количества свободных хостов. Отметьте галочкой этот пункт для отключения политики.</p></td>
</tr>
</tbody>
</table>

<h5 id="spm-priority-settings-explained">Объяснение приоритета параметров диспетчера пула хранилища (SPM)</h5>

<p>В таблице параметров <strong>SPM</strong> приводятся подробности параметров, присутствующих во вкладке <strong>SPM</strong> окна <strong>Новый хост</strong> или окна <strong>Параметры хоста</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;6.3.&nbsp;Параметры диспетчера пула хранилища (SPM)</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
</tr>
<tr class="even">
<td align="left"><p><strong>Приоритет SPM</strong></p></td>
<td align="left"><p>Определяет возможность того, что хосту будет присвоена роль диспетчера пула хранилища (SPM). Параметры: <strong>Низкий</strong>, <strong>Обычный</strong> и <strong>Высокий</strong> приоритет. Низкий приоритет означает низкую возможность того, что хосту будет присвоена роль SPM. Высокий приоритет означает высокую возможность. Значение по умолчанию: обычный.</p></td>
</tr>
</tbody>
</table>

<h5 id="host-console-settings-explained">Объяснение параметров консоли хоста</h5>

<p>В таблице параметров <strong>Консоли</strong> приводятся подробности параметров, присутствующих во вкладке <strong>Консоль</strong> окна <strong>Новый хост</strong> или окна <strong>Параметры хоста</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;6.4.&nbsp;Параметры консоли</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
</tr>
<tr class="even">
<td align="left"><p><strong>Переназначить адрес экрана</strong></p></td>
<td align="left"><p>Отметьте этот параметр чтобы переназначить адреса экрана хоста. Этот параметр удобен в случае, если хосты определены по внутреннему IP и находятся за брандмауэром NAT. Если пользователь подключается к ВМ не из внутренней сети, то вместо возвращения частного адреса хоста, на котором выполняется ВМ, машина возвращает публичный IP или FQDN (который разрешается во внутренней сети на публичный IP).</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Адрес экрана</strong></p></td>
<td align="left"><p>Указанный здесь адрес экрана будет использоваться для всех ВМ, выполняющихся на этом хосте. Адрес должен иметь формат полного доменного имени или IP.</p></td>
</tr>
</tbody>
</table>

<h4 id="configuring-host-power-management-settings">Настройка параметров управления питанием хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>Настройка параметров устройства управления питанием хоста для выполнения операций полного жизненного цикла (останов, запуск, перезапуск) из Портала администрирования.</p>

<p>Чтобы использовать возможности высокой доступности хоста и высокой доступности ВМ, необходимо настроить управление питанием.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> перед настройкой параметров управления питанием убедитесь, что хост находится в <code>режиме обслуживания</code>. В противном случае все ВМ, выполняющиеся на этом хосте, будут некорректно остановлены из-за перезапуска хоста, что может привести к проблемам в рабочем окружении. В случае неправильной установки <code>режима обслуживания</code> на хосте, будет показан диалог с предупреждением.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;6.3.&nbsp;Настройка параметров управления питанием</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Параметры хоста</strong>.</li>
  <li>Перейдите на вкладку <strong>Управление питанием</strong> чтобы увидеть параметры управления питанием.</li>
  <li>Отметьте галочкой пункт <strong>Включить управление питанием</strong> чтобы получить доступ к полям параметров.</li>
  <li>В случае, если настраивается новое устройство управления питанием, то параметр <strong>Первичный</strong> выбирается по умолчанию. Если добавляется ещё одно устройство, необходимо выбрать <strong>Вторичный</strong>.</li>
  <li>Отметьте галочкой пункт <strong>Параллельно</strong> для параллельного использования нескольких агентов операции блокады.</li>
  <li>В соответствующие поля введите <strong>Адрес</strong>, <strong>Имя пользователя</strong> и <strong>Пароль</strong> устройства управления питанием.</li>
  <li>В выпадающем меню выберите <strong>Тип</strong> устройства управления питанием.</li>
  <li>Введите номер <strong>Порта</strong>, используемого устройством управления питанием для обмена информацией с хостом.</li>
  <li>Введите <strong>Параметры</strong>, передаваемые устройству управления питанием. Используется список параметров вида <strong>ключ=значение</strong> или <strong>ключ</strong>, разделённых запятой.</li>
  <li>Отметьте галочкой пункт <strong>Защищённое</strong> для включения защищённого подключения устройства управления питанием к хосту.</li>
  <li>Нажмите <strong>Тест</strong> для проверки правильности настроенных параметров.</li>
  <li>Нажмите <strong>OK</strong> для сохранения параметров и закрытия окна.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили параметры управления питанием хоста. Выпадающее меню <strong>Управление питанием</strong> теперь включено на Портале администрирования.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> управление питанием управляется <strong>Политикой кластера</strong> хоста. Если управление питанием включено, и достигнуто указанное нижнее значение потребления, oVirt отключит машину с хостом и включит её снова, когда этого потребует балансировка нагрузки или если в кластере не будет достаточного количества свободных хостов. Отметьте галочкой пункт <strong>Отключить контроль политики над управлением питанием</strong> для отключения автоматического выполнения этих функций на хосте.</p>

</div>

<h4 id="configuring-host-storage-pool-manager-settings">Настройка параметров диспетчера пула хранилища (SPM) хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>Диспетчер пула хранилища (SPM) — это управляющая роль, присваиваемая одному из хостов в дата-центре для поддержания контроля над доступом к доменам хранилищ. SPM всегда должен быть доступен, и в случае если хост, выполняющий роль SPM, становится недоступен, эта роль присваивается другому хосту. Поскольку роль SPM использует некоторые из доступных ресурсов хоста, очень важно выставить приоритеты для хостов, которые могут обеспечить эти ресурсы.</p>

<p>Параметры приоритетов хоста SPM изменяют возможность присвоения хосту роли SPM: возможность присвоения роли SPM хосту с высоким приоритетом SPM выше, чем эта возможность для хоста с более низким приоритетом SPM.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.4.&nbsp;Настройка параметров SPM</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Параметры хоста</strong>.</li>
  <li>Перейдите на вкладку <strong>SPM</strong> чтобы увидеть параметры <strong>Приоритет SPM</strong>.</li>
  <li>С помощью галочек отметьте необходимый приоритет SPM для этого хоста.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить конфигурацию и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили приоритет SPM хоста.</p>

<h4 id="editing-a-resource-2">Изменение ресурса</h4>

<p><strong>Описание задачи</strong></p>

<p>Изменение параметров ресурса.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.5.&nbsp;Изменение ресурса</strong></p>

<ol>
  <li>Используйте ресурсные вкладки, режим дерева или поисковый функционал чтобы найти и выделить нужный ресурс в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить</strong>.</li>
  <li>Измените необходимые параметры и нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новые параметры ресурса сохранены. Окно <strong>Изменить</strong> нельзя будет закрыть, если были введены некорректные параметры.</p>

<h4 id="approving-newly-added-ovirt-node-hosts">Утверждение новых хостов oVirt Node</h4>

<p><strong>Описание задачи</strong></p>

<p>Перед утверждением в oVirt, хосты oVirt Node необходимо установить. Подробности см. в <em>Руководстве по установке oVirt</em>.</p>

<p>Сразу после установки хост oVirt Node становится видимым на Портале администрирования, но ещё не является активным. Для размещения на хосте виртуальных машин хост необходимо утвердить.</p>

<p><strong>Инструкция&nbsp;6.6.&nbsp;Утверждение новых хостов oVirt Node</strong></p>

<ol>
  <li>Во вкладке <strong>Хосты</strong> выберите новый хост, установленный с помощью oVirt Node. Такой хост имеет статус <code>Ожидает утверждение</code>.</li>
  <li>Нажмите на кнопку <strong>Утвердить</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Статус хоста сменяется на <code>Работает</code>, и на хосте теперь можно размещать виртуальные машины.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> добавить хост можно также с помощью действий, описанных в разделе <a href="http://www.ovirt.org/documentation/admin-guide/administration-guide/#Adding_an_Enterprise_Linux_Host">«Добавление хоста Enterprise Linux»</a>, с использованием IP адреса хоста oVirt Node и пароля, заданного в <strong>ЦУ oVirt</strong>.</p>

</div>

<h4 id="moving-a-host-to-maintenance-mode">Включение режима обслуживания на хосте</h4>

<p><strong>Описание задачи</strong></p>

<p>Многие повседневные задачи обслуживания хостов, включая настройку сети и применение обновлений ПО, выполняются в режиме обслуживания хостов. При переводе хоста в режим обслуживания, oVirt попытается перенести все выполняющиеся ВМ на альтернативные хосты.</p>

<p>Применяются стандартные требования к динамической миграции, в частности, в кластере должен присутствовать как минимум один активный хост, обладающий ресурсами, необходимыми для работы перенесённых ВМ.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.7.&nbsp;Перевод хоста в режим обслуживания</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите <strong>Обслуживание</strong> чтобы открыть подтверждающее окно <strong>Обслуживание хостов</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы запустить режим обслуживания.</li>
</ol>

<p>Итог:</p>

<p>Все выполняемые ВМ переносятся на альтернативные хосты. В поле <strong>Статус</strong> появляется надпись <code>Подготовка к обслуживанию</code>, а затем, после успешного завершения действия, <code>Обслуживание</code>.</p>

<h4 id="activating-a-host-from-maintenance-mode">Активация хоста после обслуживания</h4>

<p><strong>Описание задачи</strong></p>

<p>Хост, переведённый в режим обслуживания или недавно добавленный в окружение, необходимо активировать перед использованием.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.8.&nbsp;Активация хоста после обслуживания</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите кнопку <strong>Активировать</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Статус хоста меняется на <code>Не присвоен</code>, а затем, после успешного завершения действия, на <code>Работает</code>. Виртуальные машины теперь могут работать на хосте.</p>

<h4 id="removing-a-host">Удаление хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>Удаление хоста из виртуализированного окружения.</p>

<p><strong>Инструкция&nbsp;6.9.&nbsp;Удаление хоста</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Переведите хост в режим обслуживания.</li>
  <li>Нажмите <strong>Удалить</strong> чтобы открыть подтверждающее окно <strong>Удалить хост(ы)</strong>.</li>
  <li>Отметьте галочкой пункт <strong>Удалить принудительно</strong>, если хост является частью кластера хранилища Red Hat Storage с кирпичами томов, или если хост не отвечает.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Хост был удалён из окружения и больше не показывается во вкладке <strong>Хосты</strong>.</p>

<h4 id="customizing-hosts-with-tags">Назначение тегов хостам</h4>

<p><strong>Описание задачи</strong></p>

<p>Для сохранения информации о хостах можно использовать теги, и затем использовать поиск хостов на основе тегов</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.10.&nbsp;Назначение тегов хостам</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>
    <p>Нажмите кнопку <strong>Назначить теги</strong> чтобы открыть окно <strong>Назначить теги</strong>.
⁠</p>

    <p><img alt="Assign Tags Window" title="Окно назначения тегов" src="./OVirt Administration Guide — oVirt_files/Assign_Tags.png"></p>

    <p><strong>Рисунок&nbsp;6.1.&nbsp;Окно назначения тегов</strong></p>
  </li>
  <li>Все доступные теги перечислены в окне <strong>Назначить теги</strong>. Отметьте галочками теги, которые нужно назначить.</li>
  <li>Нажмите <strong>OK</strong> чтобы назначить теги и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы добавили к хостам дополнительную информацию, доступную для поиска, в виде тегов.</p>

<h3 id="hosts-and-networking">Хосты и сети</h3>

<h4 id="refreshing-host-capabilities">Обновление сведений о характеристиках хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>При добавлении карты сетевого интерфейса к хосту, характеристики хоста необходимо затем обновить для того, чтобы карта сетевого интерфейса стала доступна в oVirt.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.11.&nbsp;Обновить сведения о характеристиках хоста</strong></p>

<ol>
  <li>Используйте ресурсные вкладки, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите на кнопку <strong>Обновить сведения о характеристиках хоста</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Обновляется список карт сетевых интерфейсов выбранного хоста во вкладке <strong>Сетевые интерфейсы</strong> на панели сведений. Любые добавленные сетевые интерфейсы теперь можно использовать в oVirt.</p>

<h4 id="editing-host-network-interfaces-and-assigning-logical-networks-to-hosts">Изменение параметров сетевых интерфейсов хоста и назначение логических сетей хостам</h4>

<p><strong>Описание задачи</strong></p>

<p>Можно сменить значения параметров физических сетевых интерфейсов хоста, переместить сеть управления с одного физического сетевого интерфейса хоста на другой и назначить логические сети физическому сетевому интерфейсу хоста.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> нельзя назначить физическому сетевому интерфейсу хоста логические сети, предоставляемые внешним поставщиком; такие сети назначаются динамически по мере требований виртуальных машин.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;6.12.&nbsp;Изменение параметров сетевых интерфейсов хоста и назначение логических сетей хостам</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений.</li>
  <li>
    <p>Нажмите на кнопку <strong>Настройка сетей хоста</strong> чтобы открыть окно <strong>Настройка сетей хоста</strong>.
⁠</p>

    <p><img alt="The Setup Host Networks window" title="Окно изменения параметров сетей" src="./OVirt Administration Guide — oVirt_files/Setup_Host_Networks.png"></p>

    <p><strong>Рисунок&nbsp;6.2.&nbsp;Окно изменения параметров сетей</strong></p>
  </li>
  <li>Присоедините логическую сеть к физическому сетевому интерфейсу хоста, выбрав и перетащив логическую сеть в область <strong>Назначенные логические сети</strong> рядом с физическим сетевым интерфейсом хоста. Или сделайте щелчок ПКМ по логической сети и выберите сетевой интерфейс в выпадающем меню.</li>
  <li>Настройте логическую сеть:
    <ol>
      <li>Наведите курсор на назначенную логическую сеть и нажмите на значок карандаша чтобы открыть окно <strong>Изменить сеть управления</strong>.</li>
      <li>Выберите <strong>Протокол загрузки</strong> из следующих возможных:
        <ul>
          <li><strong>None</strong>,</li>
          <li><strong>DHCP</strong> или</li>
          <li><strong>Статический</strong>. Если был выбран <strong>Статический</strong>, введите значения <strong>IP</strong>, <strong>Маски подсети</strong> и <strong>Шлюза</strong>.</li>
        </ul>
      </li>
      <li>Нажмите <strong>OK</strong>.</li>
      <li>Если определение логической сети не синхронизировано с параметрами сети на хосте, отметьте галочкой параметр <strong>Синхронизировать сеть</strong>.</li>
    </ol>
  </li>
  <li>Отметьте галочкой параметр <strong>Проверьте доступность соединения между хостом и ЦУ</strong> для проверки доступности сетевого соединения; это действие можно выполнить, только если хост находится в режиме обслуживания.</li>
  <li>Отметьте галочкой параметр <strong>Сохранить параметры сети</strong> чтобы параметры сохранились и после перезагрузки окружения.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы назначили логическую сеть хосту и настроили физический сетевой интерфейс хоста.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> если отображаются не все карты сетевых интерфейсов хоста, нажмите на кнопку <strong>Обновить сведения о характеристиках хоста</strong> чтобы обновить сведения о сетевых картах, доступных для этого хоста.</p>

</div>

<h4 id="bonds">Связки</h4>

<h5 id="bonding-logic-in-ovirt">Логика создания связок в oVirt</h5>

<p>Портал администрирования oVirt даёт возможность создавать устройства связок, используя графический интерфейс. Существует несколько различных сценариев создания связок, у каждого из которых своя логика.</p>

<p>Факторы, влияющие на логику создания связок:</p>

<ul>
  <li>Используется ли уже любое из устройств в логической сети?</li>
  <li>Являются ли совместимыми логические сети, в которых используются эти устройства? Одно отдельное устройство может использоваться либо в логической сети с тегом VLAN, либо в сети с тегом не-VLAN.</li>
</ul>

<p>⁠</p>

<p><strong>Таблица&nbsp;6.5.&nbsp;Сценарии создания связок и их результаты</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Сценарий создания связки</p></th>
<th align="left"><p><strong>Результат</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>NIC + NIC</p></td>
<td align="left"><p>Показывается окно <strong>Добавить связку</strong>, где можно настроить новое устройство связки. Если сетевые интерфейсы заняты в несовместимых логических сетях, операция создания связки не будет успешно выполнена до тех пор, пока несовместимая логическая сеть не будет отсоединена от устройства, используемого в новой связке.</p></td>
</tr>
<tr class="even">
<td align="left"><p>NIC + связка</p></td>
<td align="left"><p>NIC добавляется к устройству, используемому в связке. Логические сети, в которых занята NIC, и связка добавляются в итоговое устройство связки, если они совместимы. Если устройства связки используются в несовместимых логических сетях, то операция связки не будет успешно выполнена до тех пор, пока несовместимые логические сети не будет отсоединены от устройств, используемых в новой связке.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Связка + связка</p></td>
<td align="left"><p>Если устройства связки не присоединены к логическим сетям, или присоединены к совместимым логическим сетям, то создаётся новое устройство связки. Оно содержит в себе все сетевые интерфейсы и используется во всех логических сетях составных устройств связки. Показывается окно <strong>Добавить связку</strong>, в котором можно настроить новую связку. Если исходные устройства связки используются в несовместимых логических сетях, операция создания связки не будет успешно выполнена до тех пор, пока несовместимая логическая сеть не будет отсоединена от устройства, используемого в новой связке.</p></td>
</tr>
</tbody>
</table>

<h5 id="bonding-modes">Режимы связок</h5>

<p>oVirt поддерживает следующие распространённые режимы связок:</p>

<ul>
  <li>В режиме 1 (политика active-backup, «активный-запасной») все интерфейсы переводятся в запасной режим, кроме одного, который остаётся активным. В случае сбоя активного интерфейса, его заменяет запасной, который в свою очередь становится единственным активным интерфейсом в связке. MAC-адрес связки в режиме 1 является видимым только на одном порту (сетевого адаптера), для не допущения неправильной работы коммутационного оборудования. Режим 1 предоставляет отказоустойчивость и поддерживается в oVirt.</li>
  <li>В режиме 2 (политика XOR) выполняется передача на основе [(исходный MAC-адрес → XOR → MAC-адрес получателя) %число интерфейсов]. Этот расчёт XOR является гарантией того, что для каждого используемого целевого MAC-адреса будет выбран один и тот же интерфейс. Режим 2 предоставляет отказоустойчивость и балансировку нагрузки и поддерживается в oVirt.</li>
  <li>В режиме 4 (политика IEEE 802.3ad) создаются группы агрегации, в которых включенные в группу интерфейсы используют общие параметры скорости и дуплекса. В режиме 4 все интерфейсы в активной группе агрегации используются в соответствии со стандартом IEEE 802.3ad, этот режим поддерживается в oVirt.</li>
  <li>Режим 5 (политика адаптивной балансировки передаваемой нагрузки) гарантирует распределение исходящего трафика в соответствии с нагрузкой каждого интерфейса, также гарантируется принятие всего входящего трафика текущим интерфейсом. В случае сбоя интерфейса, принимающего трафик, принимающая роль назначается другому интерфейсу. Режим 5 поддерживается в oVirt.</li>
</ul>

<h5 id="creating-a-bond-device-using-the-administration-portal">Создание устройства связки через Портал администрирования</h5>

<p><strong>Описание задачи</strong></p>

<p>Совместимые сетевые устройства можно связать вместе. Этот тип конфигурации может увеличить пропускную способность и надёжность соединения. Можно создавать связки из нескольких сетевых интерфейсов, из уже существующих устройств связок, а также связки из этих двух элементов.</p>

<p>Связка не может использоваться одновременно для передачи трафика с тегом vlan и для передачи трафика с тегом не-vlan.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.13.&nbsp;Создание устройства связки через Портал администрирования</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений чтобы увидеть список всех физических сетевых интерфейсов, присоединённых к хосту.</li>
  <li>Нажмите <strong>Настроить сети хоста</strong> чтобы открыть окно <strong>Настроить сети хоста</strong>.</li>
  <li>
    <p>Выберите и перетащите одно устройство на другое, чтобы открыть окно <strong>Добавить связку</strong>. Или сделайте щелчок ПКМ по устройству и выберите другое устройство в выпадающем меню. Если устройства несовместимы, например, если одно устройство имеет тег VLAN, а другое — нет, то операция создания связки не будет выполнена, а также будет выведен совет по исправлению проблемы совместимости.</p>

    <p>⁠</p>

    <p><img alt="Bond Devices Window" title="Окно с устройствами для связки" src="./OVirt Administration Guide — oVirt_files/Create_New_Bond.png"></p>

    <p><strong>Рисунок&nbsp;6.3.&nbsp;Окно с устройствами для связки</strong></p>
  </li>
  <li>Выберите <strong>Имя связки</strong> и <strong>Режим связки</strong> из выпадающего меню. Для выбора доступны режимы связки 1, 2, 4 и 5. Любой другой режим можно настроить, нажав на кнопку <strong>Пользовательский</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы создать связку и закрыть окно <strong>Добавить связку</strong>.</li>
  <li>Назначьте логическую сеть добавленной связке.</li>
  <li>По желанию отметьте пункт <strong>Проверить доступность соединения между хостом и ЦУ</strong> и <strong>Сохранить параметры сети</strong>.</li>
  <li>Нажмите <strong>OK</strong> для принятие изменений и закрытия окна <strong>Настроить сети хоста</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Сетевые устройства связаны и имеют теперь единый интерфейс, параметры которого можно изменять. Устройство связки присутствует во вкладке <strong>Сетевые интерфейсы</strong> выбранного хоста на панели сведений.</p>

<p>Возможность создания связки должна быть включена на портах коммутационного оборудования, используемого хостом. Процесс включения связок для портов несколько отличается для разных моделей коммутаторов; обратитесь к руководству по эксплуатации своего оборудования чтобы получить информацию.</p>

<h5 id="example-uses-of-custom-bonding-options-with-host-interfaces">Примеры использования пользовательских параметров для связок интерфейсов хоста</h5>

<p>Чтобы создать индивидуальные устройства связок нужно выбрать пункт <strong>Пользовательский</strong> меню <strong>Режим связки</strong> окна <strong>Добавить связку</strong>. Примеры, приведённые ниже, адаптируйте под свои требования. Полный список параметров связок с их описанием см. в руководстве <a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt"><em>Linux Ethernet Bonding Driver HOWTO</em></a> на Kernel.org.</p>

<p>⁠</p>

<p><strong>Пример&nbsp;6.1.&nbsp;xmit_hash_policy</strong></p>

<p>Этот параметр определяет политику адаптивной балансировки передаваемой нагрузки в режимах связки 2 и 4. Например, если подавляющая часть трафика распределяется между множеством IP адресов, то может понадобиться политика баланса по IP адресам. Установить эту политику можно, выбрав режим связки <strong>Пользовательский</strong>, и далее введя в текстовом поле:</p>

<pre class="highlight plaintext"><code>mode=4 xmit_hash_policy=layer2+3
</code></pre>

<p>⁠</p>

<p><strong>Пример&nbsp;6.2.&nbsp;Контроль ARP</strong></p>

<p>Контроль ARP удобен в тех системах, где отсутствуют условия для корректных сообщений о состоянии связи через ethtool. Укажите <em><code>arp_interval</code></em> на устройстве связки хоста, выбрав режим связки <strong>Пользовательский</strong> и введя в текстовом поле:</p>

<pre class="highlight plaintext"><code>mode=1 arp_interval=1 arp_ip_target=192.168.0.2
</code></pre>

<p>⁠</p>

<p><strong>Пример&nbsp;6.3.&nbsp;Первичный</strong></p>

<p>Может понадобиться назначить NIC с самой высокой пропускной способностью в качестве первичного интерфейса устройства связки. Укажите первичный NIC, выбрав <strong>Пользовательский</strong> режим связки и введя в текстовом поле:</p>

<pre class="highlight plaintext"><code>mode=1 primary=eth0
</code></pre>

<h4 id="saving-a-host-network-configuration">Сохранение сетевой конфигурации хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>Одной из возможностей при настройке сети хоста является сохранение конфигурации после её применения, делая изменения постоянными.</p>

<p>Все изменения, сделанные в сетевой конфигурации хоста, будут временными, если не отметить галочкой параметр <strong>Сохранить сетевую конфигурацию</strong> в окне <strong>Настроить сети хоста</strong>.</p>

<p>Сохранение сетевой конфигурации в качестве постоянной.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.14.&nbsp;Сохранение сетевой конфигурации хоста</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений чтобы увидеть список всех NIC хоста, их адреса и другие спецификации.</li>
  <li>Нажмите на кнопку <strong>Сохранить сетевую конфигурацию</strong>.</li>
  <li>Сетевая конфигурация хоста сохранена. На панели задач будет показано следующее сообщение: «Изменения сетевых параметров хоста <em>[Имя_хоста]</em> сохранены.»</li>
</ol>

<p><strong>Результат</strong></p>

<p>Сетевая конфигурация хоста была сохранена как постоянная и не изменится после перезагрузки.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> во время сохранения сетевой конфигурации хоста также обновляется список сетевых интерфейсов, доступных для хоста. Это поведение аналогично поведению кнопки <strong>Обновить сведения о характеристиках хоста</strong>.</p>

</div>

<h3 id="host-resilience">Устойчивость хоста</h3>

<h4 id="host-high-availability">Высокая доступность хоста</h4>

<p>Для поддержания нормального реагирования хостов в кластере oVirt использует операции блокады. Хост со статусом <strong>Не отвечает</strong> отличается от хоста со статусом <strong>Нерабочее состояние</strong>. Хосты в <strong>Нерабочем состоянии</strong> не теряли связи с oVirt, но имеют неправильные настройки, например, в конфигурации отсутствует логическая сеть. У <strong>Не отвечающих</strong> хостов связь с oVirt отсутствует.</p>

<p>Если хост, имеющий устройство управления питанием, теряет связь с oVirt, то его можно поместить в блокаду (перезапустить) через Портал администрирования. Все ВМ, выполняющиеся на этом хосте, останавливаются, а машины с высокой доступностью запускаются на другом хосте.</p>

<p>Все действия по управлению питанием выполняются с использованием хоста прокси, а не с помощью прямого управления oVirt. Для действий по управлению питанием необходимо минимум два хоста.</p>

<p>Операция блокады даёт кластеру возможность отреагировать на неожиданный сбой хоста, а также улучшить экономию энергии, балансировку нагрузки, а также политики доступности виртуальных машин. Администратор должен настроить параметры операции блокады для устройства управления питанием хоста, и время от времени тестировать их корректность.</p>

<p>Хосты можно поместить в блокаду автоматически, с помощью параметров управления питанием, или вручную, нажав ПКМ на хост и выбрав пункты в меню. Не отвечающий хост перезапускается из блокады, и если в течение установленного времени хост не возвращается в активное состояние, то он остаётся в статусе «Не отвечает», в ожидании ручного вмешательства и решения проблемы.</p>

<p>Для выполнения на хосте виртуальных машин с высокой доступностью, необходимо включить и настроить управление питанием.</p>

<h4 id="power-management-by-proxy-in-ovirt">Управление питанием через прокси в oVirt</h4>

<p>oVirt не имеет прямой связи с агентами операции блокады. Для передачи команд устройству управления питанием хоста oVirt использует прокси. Для выполнения действий по управлению питанием oVirt использует VDSM, поэтому другой хост из окружения oVirt используется как прокси для операции блокады.</p>

<p>Возможный выбор:</p>

<ul>
  <li>Любой хост в том же кластере, что и хост, для которого нужна операции блокады.</li>
  <li>Любой хост в том же дата-центре, что и хост, для которого нужна операции блокады.</li>
</ul>

<p>Работоспособный хост имеет статус <em>Работает</em> или <em>Обслуживание</em>.</p>

<h4 id="setting-fencing-parameters-on-a-host">Установка параметров проведения блокады на хосте</h4>

<p>Параметры для операции блокады на хосте устанавливаются в разделе <strong>Управление питанием</strong> окна <strong>Добавить хост</strong> или <strong>Параметры хоста</strong>. Функционал управления питанием даёт возможность системе поместить проблемный хост в блокаду с помощью дополнительного интерфейса, например, карты удалённого доступа RAC.</p>

<p>Все действия по управлению питанием выполняются с использованием хоста прокси, а не с помощью прямого управления oVirt. Для действий по управлению питанием необходимо минимум два хоста.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.15.&nbsp;Установка параметров операции блокады на хосте</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Параметры хоста</strong> window.</li>
  <li>
    <p>Перейдите на вкладку <strong>Управление питанием</strong>.
⁠</p>

    <p><img alt="Power Management Settings" title="Параметры управления питанием" src="./OVirt Administration Guide — oVirt_files/Edit_Host_Power_Management.png"></p>

    <p><strong>Рисунок&nbsp;6.4.&nbsp;Параметры управления питанием</strong></p>
  </li>
  <li>Отметьте галочкой пункт <strong>Включить управление питанием</strong> чтобы получить доступ к полям параметров.</li>
  <li>В случае, если настраивается новое устройство управления питанием, то параметр <strong>Первичный</strong> выбирается по умолчанию. Если добавляется ещё одно устройство, необходимо выбрать <strong>Вторичный</strong>.</li>
  <li>Отметьте галочкой пункт <strong>Параллельно</strong> для параллельного использования нескольких агентов операции блокады.</li>
  <li>В соответствующие поля введите <strong>Адрес</strong>, <strong>Имя пользователя</strong> и <strong>Пароль</strong> устройства управления питанием.</li>
  <li>В выпадающем меню выберите <strong>Тип</strong> устройства управления питанием.</li>
  <li>Введите номер <strong>Порта</strong>, используемого устройством управления питанием для обмена информацией с хостом.</li>
  <li>Введите <strong>Параметры</strong>, передаваемые устройству управления питанием. Используется список параметров вида 'ключ=значение' или 'ключ', разделённых запятой.</li>
  <li>Нажмите на кнопку <strong>Тест</strong> для проверки устройства управления питанием. В случае удачной проверки будет показано сообщение <em>Тест пройден, статус хоста: работает</em>.
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> параметры управления питанием (идентификатор пользователя, пароль, передаваемые параметры и т.д.) проверяются oVirt только во время настройки и затем вручную. Если предупреждения о неправильных значениях параметров будут проигнорированы администратором, или если параметры изменяются на аппаратном уровне устройства управления питанием без внесения соответствующих изменений в oVirt, то скорей всего в самый необходимый момент операция блокады не сможет быть выполнена.</p>

    </div>
  </li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы вернулись к списку хостов. Обратите внимание, что теперь восклицательный знак рядом с именем хоста исчез, что означает успешно настроенное управление питанием.</p>

<h4 id="soft-fencing-hosts">Мягкая блокада хостов</h4>

<p>Иногда хост перестаёт отвечать по причине неожиданно возникших проблем, и хотя VDSM не может ответить на запросы, виртуальные машины, зависящие от VDSM, по-прежнему работают и доступны. В таких ситуациях перезапуск VDSM возвращает VDSM в состояние нормального реагирования и решает проблему.</p>

<p>В oVirt версии 3.3 был впервые представлен функционал «мягкой блокады через SSH». До выхода oVirt версии 3.3 операция блокады не отвечающих хостов проводилась только внешними устройствами блокады. В oVirt 3.3 процесс операции блокады был расширен и теперь включает в себя «мягкую блокаду через SSH» — процесс, с помощью которого oVirt пытается выполнить перезапуск VDSM на не отвечающих хостах с помощью SSH. Если oVirt не сможет перезапустить VDSM через SSH, ответственность за проведение операции  блокады переходит на внешнего агента, если он был ранее настроен.</p>

<p>Мягкая блокада через SSH работает следующим образом. На хосте должны быть включены и настроены параметры проведения операции блокады, а также должен существовать подходящий хост прокси (второй хост, с рабочим статусом, в дата-центре). Когда время ожидания соединения между oVirt и хостом истекает, то происходит следующее:</p>

<ol>
  <li>При первом сбое сети статус хоста меняется на «Идёт подключение».</li>
  <li>Затем oVirt делает три попытки запросить статус у VDSM, или же ждёт в течении интервала времени, определяемого загрузкой хоста. Формула для расчёта длины этого интервала строится на основе заданных значений TimeoutToResetVdsInSeconds (по умолчанию 60 сек) + [DelayResetPerVmInSeconds (по умолчанию 0.5 сек)]*(число выполняемых ВМ на хосте) + [DelayResetForSpmInSeconds (по умолчанию 20 сек)] * 1 (если хост работает как SPM) или 0 (если хост не работает как SPM). Чтобы дать VDSM максимально возможное время для ответа, oVirt выбирает наиболее долгую по времени возможность из описанных выше (три попытки получить статус VDSM или интервал, рассчитываемый по вышеуказанной формуле).</li>
  <li>Если по истечении этого интервала хост не отвечает, через SSH выполняется команда <code>vdsm restart</code>.</li>
  <li>Если <code>vdsm restart</code> не даст результата в виде восстановления соединения между хостом и oVirt, статус хоста сменяется на <code>Не отвечает</code>, и в случае настроенного управления питанием, выполнение операции блокады передаётся внешнему агенту.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> мягкую блокаду через SSH можно выполнить на хостах, где не настроено управление питанием. В этом её отличие от обычной операции блокады, которую можно выполнить только на хостах с настроенным управлением питанием.</p>

</div>

<h4 id="using-host-power-management-functions">Использование функций управления питанием хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>После того, как для хоста было настроено управление питанием, через интерфейс Портала администрирования становятся доступными несколько возможных действий. Хотя у каждого устройства управления питанием есть свои настраиваемые параметры, все они поддерживают базовые возможности для запуска, останова и перезапуска хоста.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;6.16.&nbsp;Использование функций управления питанием хоста</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите на выпадающее меню <strong>Управление питанием</strong>.</li>
  <li>
    <p>Выберите одну из следующих возможностей:</p>

    <ul>
      <li><strong>Перезапуск</strong>: этот параметр останавливает хост и ждёт смены статуса хоста на <code>Отключен</code>. После того, как агент убедился в том, что хост отключен, виртуальные машины с высокой доступностью перезапускаются на другом хосте кластера. Затем агент перезапускает хост. Когда хост снова готов к работе, его статус меняется на <code>Работает</code>.</li>
      <li><strong>Запустить</strong>: этот параметр запускает хост и даёт ему присоединиться к кластеру. Когда хост готов к работе, его статус меняется на <code>Работает</code>.</li>
      <li><strong>Остановить</strong>: этот параметр отключает питание хоста. Перед использованием этого параметра убедитесь, что ВМ, выполняющиеся на этом хосте, были заранее перенесены на другой хост в кластере. В противном случае работа ВМ будет завершена аварийно, и только машины с высокой доступностью будет возможно перезапустить на другом хосте. После остановки хоста его статус меняется на <code>Нерабочее состояние</code>.</li>
    </ul>

    <div class="alert alert-info">
      <p><strong>Важно:</strong> если для хоста определены два агента блокады, их можно использовать параллельно или последовательно. Для остановки хоста, параллельные агенты должны оба отреагировать на команду остановки; и если один из агентов отреагирует на команду запуска, хост начнёт работу. В случае последовательных агентов, для запуска или остановки хоста сначала используется первичный агент; в случае его сбоя используется вторичный агент.</p>

    </div>
  </li>
  <li>При выборе одного из вышеописанных параметров открывается окно подтверждения. Нажмите <strong>OK</strong> чтобы подтвердить и продолжить.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Выполняется выбранное действие.</p>

<h4 id="manually-fencing-or-isolating-a-non-responsive-host">Ручная блокада или изоляция не отвечающего хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>Хост может перестать отвечать на запросы в случае, например, аппаратного сбоя; это может сильно повлиять на производительность окружения. Если устройство управления питанием отсутствует или настроено неправильно, хост можно перезапустить вручную.</p>

<div class="alert alert-info">
  <p><strong>Предупреждение:</strong> не используйте параметр <strong>Подтвердить, что хост был перезапущен</strong>, если хост не был перезапущен вручную. Использование этого параметра во время работы хоста может привести к повреждению образа ВМ.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;6.17.&nbsp;Ручная блокада или изоляция не отвечающего хоста</strong></p>

<ol>
  <li>Выберите хост во вкладке <strong>Хосты</strong>. Хост должен иметь статус <code>не отвечает</code>.</li>
  <li>Перезапустите хост вручную. Это может означать физический перезапуск аппаратного обеспечения.</li>
  <li>На Портале администрирования нажмите ПКМ на элементе хоста и нажмите на кнопку <strong>Подтвердить, что хост был перезапущен</strong>.</li>
  <li>Будет выведено сообщение с просьбой подтвердить, что хост был перезапущен или выключен. Отметьте галочкой пункт <strong>Подтвердить операцию</strong> и нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы перезапустили хост вручную, позволив перезапустить высокодоступные ВМ на активном хосте. Мы подтвердили действие ручной блокады на Портале администрирования, и хост снова в сети.</p>

<h2 id="storage">⁠Хранилище</h2>

<p>Для хранения образов ВМ, файлов ISO и снимков oVirt использует централизованную систему хранилища. Сетевые хранилища можно создавать, используя следующие технологии:</p>

<ul>
  <li>Сетевая файловая система (NFS)</li>
  <li>Экспортированные тома GlusterFS</li>
  <li>Другие POSIX-совместимые ФС</li>
  <li>Протокол iSCSI</li>
  <li>Локальные хранилища, напрямую присоединённые к хостам виртуализации</li>
  <li>Транспортный протокол FCP (Fibre Channel Protocol)</li>
  <li>Файловая система parallel NFS (pNFS)</li>
</ul>

<p>Настройка хранилища является необходимым условием для нового дата-центра, поскольку дата-центр невозможно инициализировать без подключённых и активированных доменов хранилищ.</p>

<p>Системный администратор oVirt должен создать, настроить, присоединить и поддерживать работу хранилища вируализированного проекта. Администратор должен быть знаком с типами хранилищ и их использованием. Прочитайте руководства вашего поставщика массива хранения данных, а также обратитесь к <em>Руководству по администрированию хранилищ Red Hat Enterprise Linux</em>, чтобы получить дополнительную информацию о протоколах, требованиях и принципах работы хранилищ.</p>

<p>Платформа oVirt предоставляет возможность назначать хранилища и управлять ими во вкладке <strong>Хранилище</strong> Портала администрирования. В списке на вкладке <strong>Хранилище</strong> показаны все домены хранилищ, а на панели сведений находится общая информация о домене.</p>

<p>Платформа oVirt предлагает три типа доменов хранилищ:</p>

<ul>
  <li><strong>Домен данных:</strong> домен данных содержит виртуальные жёсткие диски и файлы OVF всех виртуальных машин и шаблонов дата-центра. Снимки ВМ также хранятся в домене данных. Домен данных нельзя сделать общим для нескольких дата-центров. Домены хранилищ различных типов (iSCSI, NFS, FC, POSIX и Gluster) можно добавить к одному и тому же дата-центру, при условии что это общие, а не локальные домены. Домен данных необходимо присоединить к дата-центру до присоединения к нему доменов других типов.</li>
  <li><strong>Домен ISO:</strong> в доменах ISO хранятся файлы ISO (или логические CD), используемые для установки и загрузки ОС и приложений ВМ. Домен ISO делает ненужным физические носители информации для дата-центра. Домен ISO можно сделать общим для разных дата-центров.</li>
  <li>
    <p><strong>Домен экспорта:</strong> домены экспорта — это временные репозитории хранилища, используемые для копирования и перемещения образов между дата-центрами о окружением oVirt. Домены экспорта можно использовать для создания резервных копий ВМ. Домен экспорта можно перемещать между дата-центрами, но он может быть активен только для одного из дата-центров.</p>
<div class="alert alert-info">
<p><strong>Важно</strong>
    <p>Поддержка доменов экспорта, реализованных на чём-то ином, кроме NFS, устарела. Поддержка осуществляется только для уже существующих доменов экспорта, импортированных из окружений oVirt 2.2, новые же домены хранилищ должны создаваться только с использованием NFS.</p></div>
  </li>
</ul>

<p>Приступайте к настройке и присоединению хранилищ к окружению oVirt только после того, как были определены необходимые требования дата-центра к хранилищу.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> для добавления доменов хранилищ необходимо быть авторизованным на Портале администрирования, кроме того, требуется наличие минимум одного подключенного хоста со статусом <strong>Работает</strong>.</p>

</div>

<h3 id="understanding-storage-domains">Основные сведения о доменах хранилищ</h3>

<p>Домен хранилища — это собрание образов с общим интерфейсом хранилища. Домен хранилища содержит полные образы шаблонов и виртуальных машин (включая снимки), или файлы ISO. Домен хранилища может быть создан либо на основе блочных устройств (SAN - iSCSI или FCP) либо на основе файловой системы (NAS - NFS, GlusterFS или другая POSIX-совместимая ОС).</p>

<p>В NFS все виртуальные диски, шаблоны и снимки являются файлами.</p>

<p>В SAN (iSCSI/FCP) каждый виртуальный диск, шаблон или снимок является логическим томом. Блочные устройства собираются в логическую сущность под названием «группа томов», а затем распределяются менеджером LVM (Logical Volume Manager) по логическим томам для использования в качестве виртуальных жёстких дисков.</p>

<p>Виртуальные диски могут иметь один из двух форматов: Qcow2 или RAW. Тип хранилища может быть либо разреженным либо предварительно выделенным. Снимки всегда имеют разреженный тип, но они могут быть сделаны с дисков, созданных как RAW или как разреженные.</p>

<p>ВМ, разделяющие общий домен хранилища, можно переносить между хостами, принадлежащими одному и тому кластеру.</p>

<h3 id="storage-metadata-versions-in-ovirt">Версии метаданных хранилищ в oVirt</h3>

<p>oVirt хранит информацию о доменах хранилищ в виде метаданных в самих доменах хранилищ. Каждый мажорный релиз в oVirt появляются улучшенные реализации метаданных хранилища.</p>

<ul>
  <li><em>Метаданные V1 (oVirt версий 2.x)</em> Каждый домен хранилища содержит метаданные, описывающие собственную структуру и все имена физических томов, использующихся для резервирования образов дисков ВМ. Главные домены дополнительно содержат метаданные всех доменов и имён физических томов в пуле хранилища. Лимит на общий размер этих метаданных равен 2КБ, что ограничивает число доменов хранилищ в пуле. Базовые образы шаблонов и ВМ доступны только для чтения. Метаданные V1 применяются на доменах хранилищ NFS, iSCSI и FC.</li>
  <li><em>Метаданные V2 (oVirt версии 3.0)</em> Все метаданные домена хранилища и пула хранятся в виде тегов логических томов, а не записываются на логический том. Метаданные томов дисков ВМ по-прежнему хранятся на логическом томе в доменах. Имена физических томов больше не включаются в метаданные. Базовые образы шаблонов и ВМ доступны только для чтения. Метаданные V2 применяются на доменах хранилищ iSCSI и FC.</li>
  <li><em>Метаданные V3 (oVirt версий 3.1+)</em> Все метаданные домена хранилища и пула хранятся в виде тегов логических томов, а не записываются на логический том. Метаданные томов дисков ВМ по-прежнему хранятся на логическом томе в доменах. Базовые образы шаблонов и ВМ больше не имеют режим доступа только для чтения. Это изменение делает возможным динамическое создание снимков, динамическую миграцию хранилищ и клонирование на базе снимков. Добавлена поддержка метаданных в формате юникод, имена томов стало можно писать не только латиницей. Метаданные V3 применяются на доменах хранилищ NFS, GlusterFS, POSIX, iSCSI и FC.</li>
</ul>

<h3 id="preparing-and-adding-file-based-storage">Подготовка и добавление хранилищ на базе файлов</h3>

<h4 id="preparing-nfs-storage">Подготовка хранилища NFS</h4>

<p><strong>Описание задачи</strong></p>

<p>Шаги, необходимые для подготовки общего файлового ресурса NFS на сервере под управлением Red Hat Enterprise Linux 6 к работе в oVirt.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.1.&nbsp;Подготовка хранилища NFS</strong></p>

<ol>
  <li>
    <p><strong>Установка nfs-utils</strong>
Функционал NFS предоставляется пакетом nfs-utils. Перед созданием общего файлового ресурса проверьте, что этот пакет установлен, путём запроса системной базы данных RPM:</p>

<pre class="highlight plaintext"><code>$ rpm -qi nfs-utils
</code></pre>

    <p>Если пакет nfs-utils установлен, будет показана информация о пакете. В противном случае — пакет не установлен. Установите его с помощью <code>yum</code>, получив права пользователя <code>root</code>:</p>

<pre class="highlight plaintext"><code># yum install nfs-utils
</code></pre>
  </li>
  <li>
    <p><strong>Настройка загрузочных скриптов</strong>
Для того, чтобы обеспечить доступность общих файловых ресурсов NFS на работающей системе, службы <code>nfs</code> и <code>rpcbind</code> должны запускаться во время загрузки системы. Для изменения загрузочных скриптов используйте команду <code>chkconfig</code>, получив предварительно права <code>root</code>.</p>

<pre class="highlight plaintext"><code># chkconfig --add rpcbind
# chkconfig --add nfs
# chkconfig rpcbind on
# chkconfig nfs on
</code></pre>

    <p>После настройки загрузочных скриптов запустите службы в первый раз.</p>

<pre class="highlight plaintext"><code># service rpcbind start
# service nfs start
</code></pre>
  </li>
  <li>
    <p><strong>Создание каталога</strong>
Создайте каталог, который нужно сделать общим с помощью NFS.</p>

<pre class="highlight plaintext"><code># mkdir /exports/iso
</code></pre>

    <p>Замените <em>/exports/iso</em> на имя и путь каталога, который нужно использовать.</p>
  </li>
  <li>
    <p><strong>Экспорт каталога</strong>
Чтобы каталог был доступным в сети с помощью NFS, его нужно экспортировать. Экспортируемые ресурсы NFS контролируются с помощью файла конфигурации <code>/etc/exports</code>. Каждый путь экспорта размещается в отдельной строке, за ним следует символ табуляции и любые дополнительные параметры, передаваемые NFS. Для экспортируемых ресурсов, которые необходимо присоединить к oVirt, необходимо установить права чтения и записи.</p>

    <p>Чтобы установить доступ на чтение и запись для каталога <code>/exports/iso</code> с использованием NFS, нужно добавить следующую строчку в файл <code>/etc/exports</code>.</p>

<pre class="highlight plaintext"><code>/exports/iso       *(rw)
</code></pre>

    <p>Не забудьте заменить <em>/exports/iso</em> на имя и путь используемого каталога.</p>
  </li>
  <li>
    <p><strong>Перезагрузка конфигурации NFS</strong>
Чтобы изменения, внесённые в файл <code>/etc/exports</code> вступили в силу, необходимо перезапустить службу NFS. Чтобы принудительно перезапустить конфигурацию службы, выполните следующую команду с правами пользователя <code>root</code>:</p>

<pre class="highlight plaintext"><code># service nfs reload
</code></pre>
  </li>
  <li>
    <p><strong>Настройка прав доступа</strong>
Экспортный каталог NFS необходимо настроить на доступ для чтения/записи, и установить владельца vdsm:kvm. Если эти пользователи не существуют на внешнем сервере NFS, используйте следующую команду, где в качестве каталога, используемого как общий файловый ресурс NFS, служит <code>/exports/iso</code>:</p>

<pre class="highlight plaintext"><code># chown -R 36:36 /exports/iso
</code></pre>

    <p>Права доступа для этого каталога должны быть следующими: доступ на чтение/запись для владельца и чтение/выполнение для группы и других пользователей. У владельца также будут права на выполнение в этом каталоге. Права доступа устанавливаются с помощью команды <code>chmod</code>. Следующие аргументы команды устанавливают требуемые права доступа для каталога <code>/exports/iso</code>.</p>

<pre class="highlight plaintext"><code># chmod 0755 /exports/iso
</code></pre>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали общий файловый ресурс NFS, и он готов для присоединения к oVirt.</p>

<h4 id="attaching-nfs-storage">Присоединение хранилища NFS</h4>

<p><strong>Описание задачи</strong></p>

<p><strong>Домен хранилища</strong> с типом NFS — это монтируемый общий ресурс NFS, присоединённый к дата-центру. Он используется для предоставления хранилища для образов виртуализированной гостевой ОС и загрузочных источников ISO. После экспорта хранилища NFS, его необходимо присоединить к oVirt с помощью Портала администрирования.</p>

<p>Домены данных NFS можно добавить к дата-центрам NFS. К дата-центрам любого типа можно присоединить домены хранилищ с типом NFS, ISO и экспорт.</p>

<p><strong>Инструкция&nbsp;7.2.&nbsp;Присоединение хранилища NFS</strong></p>

<ol>
  <li>Перейдите на ресурсную вкладку <strong>Хранилище</strong>, чтобы увидеть список существующих доменов хранилищ.</li>
  <li>
    <p>Нажмите <strong>Добавить домен</strong> чтобы открыть окно <strong>Добавить домен</strong>.
⁠</p>

    <p><img alt="NFS Storage" title="Хранилище NFS" src="./OVirt Administration Guide — oVirt_files/New_Domain.png"></p>

    <p><strong>Рисунок&nbsp;7.1.&nbsp;Хранилище NFS</strong></p>
  </li>
  <li>Введите <strong>Имя</strong> домена хранилища.</li>
  <li>В выпадающем меню выберите <strong>Дата-центр</strong>, <strong>Функцию домена / Тип хранилища</strong> и <strong>Использовать хост</strong>. В случае необходимости также выберите <strong>Формат</strong>.</li>
  <li>Введите <strong>Путь экспорта</strong>, который будет использован для домена хранилища. Путь экспорта должен  иметь формат <code>192.168.0.10:/данные или domain.example.com:/данные</code></li>
  <li>Нажмите <strong>Дополнительные параметры</strong> чтобы включить дополнительные параметры конфигурации. Рекомендуется не изменять значения этих параметров.
    <div class="alert alert-info">
      <p><strong>Важно:</strong> связь с доменом хранилища осуществляется с выбранного хоста, а не напрямую из oVirt. Перед настройкой хранилища к выбранному дата-центру необходимо присоединить как минимум один активный хост.</p>

    </div>
  </li>
  <li>Нажмите <strong>OK</strong> чтобы создать домен хранилища и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новый домен данных NFS показывается на вкладке <strong>Хранилище</strong> и имеет статус <code>Заблокирован</code>, пока идёт подготовка диска. После этого он автоматически присоединится к дата-центру.</p>

<h4 id="preparing-local-storage">Подготовка локального хранилища</h4>

<p><strong>Описание задачи</strong></p>

<p>Домен локального хранилища можно настроить на хосте. При подготовке хоста для использования локального хранилища, хост автоматически присоединяется к новому дата-центру и кластеру, к которому нельзя присоединить никакие другие хосты. Для кластеров с несколькими хостами необходимо, чтобы все хосты имели доступ ко всем доменам хранилищ, что невозможно для локального хранилища. Виртуальные машины, созданные на кластере с одним хостом, невозможно перенести, провести для них операцию блокады или использовать с планировщиком.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> в системах «oVirt Node» единственным разрешённым путём для использования под локальное хранилище является <code>/data/images</code>. На установках гипервизоров этот каталог уже существует и имеет соответствующие права доступа. Шаги, описанные в этом действии, необходимы только для подготовки локального хранилища, устанавливаемого на стоковых ОС, таких, как Fedora или Centos.</p>
</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;7.3.&nbsp;Подготовка локального хранилища</strong></p>

<ol>
  <li>
    <p>На хосте виртуализации создайте каталог, который будет использоваться под локальное хранилище.</p>
    # mkdir -p /data/images</p>
  </li>
  <li>
    <p>Убедитесь, что права доступа для этого каталога разрешают чтение/запись пользователю <code>vdsm</code> (UID 36) и группе <code>kvm</code> (GID 36).<pre class="highlight plaintext"><code># chown 36:36 /data /data/images
# chmod 0755 /data /data/images
</code></pre>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Локальное хранилище готово для добавления в окружение oVirt.</p>

<h4 id="adding-local-storage">Добавление локального хранилища</h4>

<p><strong>Описание задачи</strong></p>

<p>Локальное хранилище для хоста было приготовлено. Теперь с помощью oVirt добавьте его к хосту.</p>

<p>Такой способ добавления локального хранилища помещает хост в новый дата-центр и кластер. В окне настройки локального хранилища создание дата-центра, кластера и хранилища объединено в один процесс.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.4.&nbsp;Добавление локального хранилища</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хосты</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный хост в списке результатов.</li>
  <li>Нажмите <strong>Обслуживание</strong> чтобы открыть окно подтверждения <strong>Обслуживание хоста</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы инициировать режим обслуживания.</li>
  <li>
    <p>Нажмите <strong>Настроить локальное хранилище</strong> чтобы открыть окно <strong>Настроить локальное хранилище</strong>.
⁠</p>

    <p><img alt="Configure Local Storage Window" title="Окно параметров локального хранилища" src="./OVirt Administration Guide — oVirt_files/Configure_Local_Storage.png"></p>

    <p><strong>Рисунок&nbsp;7.2.&nbsp;Окно параметров локального хранилища</strong></p>
  </li>
  <li>Нажмите кнопки <strong>Изменить</strong> рядом с полями <strong>Дата-центр</strong>, <strong>Кластер</strong> и <strong>Хранилище</strong> чтобы настроить и указать имя домена локального хранилища.</li>
  <li>В текстовом поле укажите путь к локальному хранилищу.</li>
  <li>В случае необходимости перейдите на вкладку <strong>Оптимизация</strong> чтобы настроить политику оптимизации памяти для нового кластера локального хранилища.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить параметры и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Хост появляется на своём дата-центре.</p>

<h3 id="adding-posix-compliant-file-system-storage">Добавление хранилища на основе файловой системы, поддерживающей стандарты POSIX</h3>

<p>oVirt версии 3.1 и выше поддерживает использование хранилищ на базе файловых систем POSIX (встроенных). Поддержка файловых систем POSIX даёт возможность монтирования ФС с помощью тех же параметров монтирования, что используются при монтировании вручную через командную строку. Этот функционал предназначен для доступа к хранилищу, доступ к которому не открыт с помощью NFS, iSCSI или FCP.</p>

<p>Все ФС, поддерживающие стандарт POSIX, используемые под домен хранилища в oVirt, <strong>ДОЛЖНЫ</strong> поддерживать резрежённые файлы и прямой ввод/вывод. Файловая система CIFS, например, не поддерживает прямой ввод/вывод, что делает её несовместимой с oVirt.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> <em>не</em> монтируйте хранилище NFS с помощью создания домена хранилища на файловой системе, поддерживающей POSIX. Всегда создавайте домен хранилища на NFS.</p>

</div>

<h4 id="attaching-posix-compliant-file-system-storage">Присоединение хранилища на POSIX-совместимой файловой системе</h4>

<p><strong>Описание задачи</strong></p>

<p>Для домена хранилища нам нужно использовать совместимую с POSIX файловую систему, не открытую для доступа с помощью NFS, iSCSI или FCP.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.5.&nbsp;Присоединение хранилища на POSIX-совместимой ФС</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Хранилище</strong> чтобы увидеть список существующих доменов хранилищ.</li>
  <li>
    <p>Нажмите <strong>Добавить домен</strong> чтобы открыть окно <strong>Добавить домен</strong>.
⁠</p>

    <p><img alt="POSIX Storage" title="Хранилище POSIX" src="./OVirt Administration Guide — oVirt_files/New_Domain_Posix.png"></p>

    <p><strong>Рисунок&nbsp;7.3.&nbsp;Хранилище POSIX</strong></p>
  </li>
  <li>Введите <strong>Имя</strong> домена хранилища.</li>
  <li>Выберите <strong>Дата-центр</strong>, который будет связан с доменом хранилища. Дата-центр должен иметь тип <strong>POSIX (ФС, совместимая с POSIX)</strong>. Или выберите <code>(нет)</code>.</li>
  <li>Выберите пункт <code>Данные / POSIX совместимая ФС</code> из выпадающего меню <strong>Функция домена / Тип хранилища</strong>. Если необходимо, выберите также пункт <strong>Формат</strong>.</li>
  <li>В выпадающем меню <strong>Использовать хост</strong> выберите хост. Будут показаны только хосты, принадлежащие одному дата-центру. Выбранный хост будет использован для подключения домена хранилища.</li>
  <li>Укажите <strong>Путь</strong> до POSIX ФС, точно также, как указывается путь команде <code>mount</code>.</li>
  <li>Укажите <strong>Тип VFS</strong>, точно также, как указывается тип ФС команде <code>mount</code> с помощью аргумента <em><code>-t</code></em>. Список доступных ФС см. в <code>man mount</code>.</li>
  <li>Введите дополнительные <strong>Параметры монтирования</strong>, точно также, как они указываются для команды <code>mount</code> с помощью аргумента <em><code>-o</code></em>. Параметры монтирования передаются списком, разделённым запятыми. Список доступных параметров монтирования см. в <code>man mount</code>.</li>
  <li>Нажмите <strong>OK</strong> чтобы присоединить новый домен хранилища и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы использовали поддерживаемый механизм для присоединения не поддерживаемой ФС в качестве домена хранилища.</p>

<h3 id="preparing-and-adding-block-storage">Подготовка и добавление блочного хранилища</h3>

<h4 id="preparing-iscsi-storage">Подготовка хранилища iSCSI</h4>

<p><strong>Описание задачи</strong></p>

<p>Шаги, необходимые для экспорта устройства хранилища iSCSI с сервера под управлением Red Hat Enterprise Linux 6 для использования его в качестве домена хранилища в oVirt.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.6.&nbsp;Подготовка хранилища iSCSI</strong></p>

<ol>
  <li>
    <p>На сервере хранилища установите пакет <strong>scsi-target-utils</strong> с помощью команды <code>yum</code> с привилегиями пользователя <code>root</code>.
    <pre class="highlight plaintext"><code># yum install -y scsi-target-utils</code></pre>
  </li>
  <li>
    <p>Добавьте файловые устройства, которые нужно экспортировать, в файл <code>/etc/tgt/targets.conf</code>.  Вот универсальный пример основных добавлений в файл <code>targets.conf</code>:
    <target iqn.year-month.com.example:server.targetx="">
              backing-store /PATH/TO/DEVICE1 # Becomes LUN 1</p>
              backing-store /PATH/TO/DEVICE2 # Becomes LUN 2</p>
              backing-store /PATH/TO/DEVICE3 # Becomes LUN 3</p>
    </target></p>

    <p>В соответствии с принятой схемой, цели определены годом и месяцем их создания, обратным полным доменным именем домена, на котором находится сервер, именем сервера и номером цели.</p>
  </li>
  <li>
    <p>Запустите службу <strong>tgtd</strong>.
    <pre class="highlight plaintext"><code># service tgtd start</code></pre>
  </li>
  <li>
    <p>Сделайте службу <strong>tgtd</strong> автоматически запускаемой при старте системы.</p>
    <pre class="highlight plaintext"><code># chkconfig tgtd on</code></pre>
  </li>
  <li>
    <p>Откройте порт в брандмауэре iptables, чтобы разрешить клиентам доступ к экспортированному устройству iSCSI. По умолчанию iSCSI использует порт 3260. В примере ниже добавляется правило на позицию номер 6 в таблице INPUT.</p>
    # iptables -I INPUT 6 -p tcp –dport 3260 -j ACCEPT</p>
  </li>
  <li>
    <p>Сохраните созданное правило iptables.</p>
    # service iptables save</p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали основное устройство экспорта iSCSI, которое можно использовать как домен данных iSCSI.</p>

<h4 id="adding-iscsi-storage">Добавление хранилища iSCSI</h4>

<p><strong>Описание задачи</strong></p>

<p>Платформа oVirt поддерживает хранилище iSCSI с помощью создания домена хранилища из группы томов, состоящей из ранее созданных LUN. Ни группы томов ни LUN не могут быть присоединены более чем к одному домену хранилища одновременно.</p>

<p>Подробности установки и настройки iSCSI на Red Hat Enterprise Linux см. в <em>Руководстве администратора хранилищ Red Hat Enterprise Linux</em>.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> добавлять домен хранилища iSCSI можно только к дата-центру, настроенному для хранилищ с типом iSCSI.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;7.7.&nbsp;Добавление хранилища iSCSI</strong></p>

<ol>
  <li>Перейдите на ресурсную вкладку <strong>Хранилище</strong> чтобы увидеть список существующих доменов хранилищ.</li>
  <li>Нажмите на кнопку <strong>Добавить домен</strong> чтобы открыть окно <strong>Добавить домен</strong>.</li>
  <li>
    <p>Введите <strong>Имя</strong> нового домена хранилища.
⁠</p>

    <p><img alt="New iSCSI Domain" title="Новый домен iSCSI" src="./OVirt Administration Guide — oVirt_files/New_Domain_iscsi.png"></p>

    <p><strong>Рисунок&nbsp;7.4.&nbsp;Новый домен iSCSI</strong></p>
  </li>
  <li>В выпадающем меню <strong>Дата-центр</strong> выберите дата-центр iSCSI. В случае отсутствия подходящего дата-центра iSCSI, выберите <code>(нет)</code>.</li>
  <li>В выпадающем меню выберите <strong>Функция домена / Тип хранилища</strong> и <strong>Формат</strong>. Типы доменов хранилищ, несовместимые с выбранным дата-центром, недоступны.</li>
  <li>В поле <strong>Использовать хост</strong> выберите активный хост. Если это не первый домен данных в этом дата-центре, необходимо выбрать хост диспетчера пула хранилища (SPM) этого дата-центра.
    <div class="alert alert-info">
      <p><strong>Важно:</strong> связь с доменом хранилища осуществляется с выбранного хоста, а не напрямую из oVirt. Перед настройкой хранилища к выбранному дата-центру необходимо присоединить как минимум один активный хост.</p>

    </div>
  </li>
  <li>
    <p>oVirt может либо сопоставить таргеты iSCSI с номерами LUN, либо номера LUN с таргетами iSCSI. В окне <strong>Добавить домен</strong>, при выборе типа хранилища iSCSI автоматически показываются известные таргеты с неиспользуемыми номерами LUN. Если таргет, из которого добавляется хранилище, отсутствует в списке, для его нахождения можно использовать обнаружение таргетов iSCSI; в противном случае переходите к следующему шагу.</p>
<strong>Обнаружение таргетов iSCSI</strong></p>

    <ol>
      <li>Нажмите <strong>Обнаружение таргетов</strong> чтобы активировать параметры обнаружения целей. После обнаружения и соединения с таргетом, окно <strong>Добавить домен</strong> автоматически отобразит таргеты с LUN, не используемыми в окружении.
        <div class="alert alert-info">
          <p><strong>Внимание:</strong> номера LUN, используемые вне окружения, тоже показываются.</p>

        </div>
        <p>С помощью параметров <strong>Обнаружения таргетов</strong> можно добавлять номера LUN нескольким целям, или добавлять несколько путей одному и тому же LUN.</p>
      </li>
      <li>Введите полное доменное имя или адрес IP хоста iSCSI в поле <strong>Адрес</strong>.</li>
      <li>В поле <strong>Порт</strong> введите номер порта, через который будет производиться подключение к хосту во время обнаружения таргетов. По умолчанию используется <code>3260</code>.</li>
      <li>Если для защиты хранилища применяется протокол CHAP, отметьте галочкой пункт <strong>Аутентификация пользователя</strong>. Введите <strong>Имя пользователя CHAP</strong> и <strong>Пароль CHAP</strong>.</li>
      <li>Нажмите кнопку <strong>Обнаружить</strong>.</li>
      <li>Выберите один из обнаруженных таргетов и нажмите кнопку <strong>Вход в систему</strong>. Или нажмите <strong>Вход в систему (все)</strong> чтобы авторизоваться на всех обнаруженных таргетах.</li>
    </ol>
  </li>
  <li>Нажмите кнопку <strong>+</strong> рядом с нужным таргетом. Элемент будет развёрнут, что покажет все неиспользуемые LUN, присоединённые к таргету.</li>
  <li>Отметьте галочкой каждый LUN, который будет использован для создания домена хранилища.</li>
  <li>Нажмите <strong>OK</strong> чтобы создать домен хранилища и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Во вкладке хранилищ появится домен хранилища iSCSI. Это действие может занять до 5 минут.</p>

<h4 id="adding-fcp-storage">Добавление хранилища FCP</h4>

<p><strong>Описание задачи</strong></p>

<p>Платформа oVirt поддерживает хранилище SAN с помощью создания домена хранилища из группы томов, созданной из уже существующих LUN. Ни группы томов ни LUN не могут быть присоединены более чем к одному домену хранилища одновременно.</p>

<p>Системные администраторы oVirt должны обладать практическими знаниями принципов сетей хранения данных SAN. Для обмена информацией между хостами и общим внешним хранилищем в SAN обычно используется протокол FCP. В связи с этим, SAN иногда называют «хранилищем FCP».</p>

<p>Подробности о настройках и параметрах FCP или о многоканальности в Red Hat Enterprise Linux см. в <em>Руководстве по администрированию хранилищ</em> и <em>Руководстве по многоканальности DM</em>.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> добавлять домен хранилища FCP можно только к дата-центру, настроенному для хранилищ с типом FCP.</p>

</div>
<p><strong>Инструкция&nbsp;7.8.&nbsp;Добавление хранилища FCP</strong></p>

<ol>
  <li>Перейдите на ресурсную вкладку <strong>Хранилище</strong> чтобы увидеть список существующих доменов хранилищ.</li>
  <li>Нажмите на кнопку <strong>Добавить домен</strong> чтобы открыть окно <strong>Добавить домен</strong>.</li>
  <li>
    <p>Введите <strong>Имя</strong> домена хранилища
⁠</p>

    <p><img alt="Adding FCP Storage" title="Adding FCP Storage" src="./OVirt Administration Guide — oVirt_files/New_Domain_FCP.png"></p>

    <p><strong>Рисунок&nbsp;7.5.&nbsp;Добавление хранилища FCP</strong></p>
  </li>
  <li>В выпадающем меню <strong>Дата-центр</strong> выберите дата-центр FCP. Если подходящий дата-центр FCP отсутствует, выберите <code>(нет)</code>.</li>
  <li>В выпадающем меню выберите пункты <strong>Функция домена / Тип хранилища</strong> и <strong>Формат</strong>. Типы доменов хранилищ, несовместимые с выбранным дата-центром, будут недоступны.</li>
  <li>
    <p>В поле <strong>Использовать хост</strong> выберите активный хост. Если это не первый домен данных в этом дата-центре, необходимо выбрать хост диспетчера пула хранилища (SPM) этого дата-центра.
<strong>Важно:</strong></p>

    <p> связь с доменом хранилища осуществляется с выбранного хоста, а не напрямую из oVirt. Перед настройкой хранилища к выбранному дата-центру необходимо присоединить как минимум один активный хост.</p>
  </li>
  <li>При выборе типа хранилища <strong>Данные / Оптоволоконный канал</strong> в окне <strong>Добавить домен</strong> будут автоматически показаны известные таргеты с неиспользуемыми LUN. Отметьте пункт <strong>LUN ID</strong> для выбора всех доступных LUN.</li>
  <li>Нажмите <strong>OK</strong> чтобы создать домен хранилища и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новый домен данных FCP появляется во вкладке <strong>Хранилище</strong>. Во время подготовки к использованию он будет иметь статус <code>Заблокирован</code>. Готовый домен автоматически присоединяется к дата-центру.</p>

<h4 id="unusable-luns-in-ovirt">Неиспользуемые LUN в oVirt</h4>

<p>В определённых условиях oVirt не позволит использовать LUN для создания домена хранилища или жёсткого диска ВМ.</p>

<ul>
  <li>LUN, уже являющиеся частью текущего окружения oVirt, автоматически предохраняются от использования.</li>
  <li>LUN, уже использующиеся хостом-диспетчером пула хранилища (SPM), также показываются как используемые. Можно выбрать возможность принудительно перезаписать содержимое этих LUN, но успех этой операции не гарантируется.</li>
</ul>

<h3 id="storage-tasks">Задачи хранилища</h3>

<h4 id="importing-existing-iso-or-export-storage-domains">Импорт существующего домена ISO или домена экспорта</h4>

<p><strong>Описание задачи</strong></p>

<p>Существует домен ISO или домен экспорта, ранее используемый с другим дата-центром. Домен необходимо присоединить к используемому дата-центру, и импортировать ВМ или использовать образы ISO.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.9.&nbsp;Импорт существующего домена ISO или домена экспорта</strong></p>

<ol>
  <li>Перейдите на ресурсную вкладку <strong>Хранилище</strong> чтобы увидеть список существующих доменов хранилищ.</li>
  <li>
    <p>Нажмите на кнопку <strong>Импортировать домен</strong> чтобы открыть окно <strong>Импортировать предварительно настроенный домен</strong>.
⁠</p>

    <p><img alt="Import Domain" title="Импорт домена" src="./OVirt Administration Guide — oVirt_files/Import_Domain.png"></p>

    <p><strong>Рисунок&nbsp;7.6.&nbsp;Импорт предварительно настроенного домена</strong></p>
  </li>
  <li>Выберите нужные <strong>Функция домена / Тип хранилища</strong> из следующих:
    <ul>
      <li>ISO</li>
      <li>Экспорт</li>
    </ul>

    <p>Пункты <strong>Функция домена / Тип хранилища</strong> определяет доступность поля <strong>Формат</strong>.</p>
  </li>
  <li>Выберите хост SPM в выпадающем меню <strong>Использовать хост</strong>.
    <div class="alert alert-info">
      <p><strong>Важно:</strong> связь с доменом хранилища осуществляется с выбранного хоста, а не напрямую из oVirt. До начала настройки хранилища должен существовать как минимум один активный хост с доступом к хранилищу.</p>

    </div>
  </li>
  <li>Введите <strong>Путь экспорта</strong> хранилища. Путь экспорта может быть либо статическим <strong>Адресом IP</strong> либо разрешаемым именем хоста. Например, <code>192.168.0.10:/Images/ISO</code> или <code>storage.demo.redhat.com:/exports/iso</code>.</li>
  <li>Нажмите <strong>OK</strong> чтобы импортировать домен и закрыть окно.</li>
  <li>Домен хранилища импортируется и появляется на вкладке <strong>Хранилище</strong>. Следующий шаг: присоединение его к дата-центру. Это действие будет описано позже в данной главе.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы импортировали домен ISO или домен экспорта в наш дата-центр. Для работы с ним присоедините его к дата-центру.</p>

<h4 id="populating-the-iso-storage-domain">Заполнение домена хранилища ISO</h4>

<p><strong>Описание задачи</strong></p>

<p>Домен хранилища ISO был присоединён к дата-центру, теперь в хранилище необходимо загрузить образы ISO. oVirt предоставляет инструмент-загрузчик ISO, гарантирующий, что образы будут загружены по правильному пути и с корректными правами доступа.</p>

<p>Создание образов ISO физических носителей не описано в данном документе. Предполагается, что доступ к образам, требуемым для окружения, уже имеется.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.10.&nbsp;Заполнение домена хранилища ISO</strong></p>

<ol>
  <li>Скопируйте нужный образ ISO во временный каталог системы, где работает oVirt.</li>
  <li>Выполните вход в систему с работающей oVirt с правами пользователя <code>root</code>.</li>
  <li>
    <p>С помощью команды <code>engine-iso-uploader</code> загрузите образ ISO. Для выполнения этого действия понадобится некоторое время, в зависимости от размера образа и пропускной способности доступного канала.
⁠</p>

    <p><strong>Пример&nbsp;7.1.&nbsp;Использование загрузчика ISO</strong></p>

    <p>В данном примере образ ISO <code>RHEL6.iso</code> загружается на домен ISO с именем <code>ISODomain</code>, использующий NFS. Команда запросит имя и пароль администратора. Имя пользователя должно быть указано в форме <em>имя_пользователя</em>@<em>домен</em>.</p>

<pre class="highlight plaintext"><code># engine-iso-uploader --iso-domain=ISODomain upload RHEL6.iso
</code></pre>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Образ ISO был загружен и появился на указанном домене хранилища ISO. Он также появляется в списке доступных загрузочных носителей при создании ВМ в дата-центре, к которому присоединён домен хранилища.</p>

<h4 id="moving-storage-domains-to-maintenance-mode">Перевод доменов хранилища в режим обслуживания</h4>

<p><strong>Описание задачи</strong></p>

<p>Для отсоединения и перемещения доменов хранилищ необходимо, чтобы домены находились в режиме обслуживания. Это необходимо для переназначения другого домена данных в качестве основного домена данных.</p>

<p>Изменение параметров доменов и расширение доменов iSCSI с помощью добавления LUN можно выполнять только если домен является активным.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> переведите любой активный домен ISO и домен экспорта в режим обслуживания, выполнив это действие.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;7.11.&nbsp;Перевод доменов хранилища в режим обслуживания</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хранилище</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный домен хранилища в списке результатов.</li>
  <li>Выключите и переместите все ВМ, выполняющиеся в домене хранилища.</li>
  <li>Перейдите на вкладку <strong>Дата-центры</strong> на панели сведений.</li>
  <li>Нажмите <strong>Обслуживание</strong> чтобы открыть подтверждающее окно <strong>Обслуживание доменов хранилищ</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы инициировать ражим обслуживания. Домен хранилища деактивируется и имеет статус <code>Неактивен</code> в списке результатов.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Теперь мы можем изменять, отсоединять, удалять или повторно активировать домены хранилищ в дата-центре.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> активировать, отсоединять и переводить домены в режим обслуживания можно также с помощью вкладки «Хранилище» на панели сведений того дата-центра, с которым связан домен.</p>

</div>

<h4 id="editing-a-resource-3">Изменение ресурса</h4>

<p><strong>Описание задачи</strong></p>

<p>Изменение свойств ресурса.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.12.&nbsp;Изменение ресурса</strong></p>

<ol>
  <li>Используйте ресурсные вкладки, режим дерева или поисковый функционал чтобы найти и выделить ресурс в списке результатов.</li>
  <li>Нажмите кнопку <strong>Изменить</strong> чтобы открыть окно <strong>Изменить</strong>.</li>
  <li>Измените необходимые параметры и нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Ресурс сохранён с новыми параметрами. Окно <strong>Изменить</strong> нельзя будет закрыть, если были введены недопустимые значения.</p>

<h4 id="activating-storage-domains">Активация доменов хранилищ</h4>

<p><strong>Описание задачи</strong></p>

<p>Если были изменены параметры хранилища дата-центра, домены хранилищ необходимо перевести в режим обслуживания. Активируйте домен хранилища чтобы возобновить его работу.</p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хранилище</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный домен хранилища в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Дата-центры</strong> на панели сведений.</li>
  <li>Выделите нужный дата-центр и нажмите <strong>Активировать</strong>.
    <div class="alert alert-info">
      <p><strong>Важно:</strong> при попытке активировать домен ISO до активации домена данных, будет показано сообщение об ошибке, и домен не будет активирован.</p>

    </div>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Наш домен хранилища активен и готов к работе.</p>

<h4 id="removing-a-storage-domain">Удаление домена хранилища</h4>

<p><strong>Описание задачи</strong></p>

<p>У нас есть домен хранилища, который нужно удалить из виртуализованного окружения.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.13.&nbsp;Удаление домена хранилища</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хранилище</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный домен хранилища в списке результатов.</li>
  <li>Переведите домен в режим обслуживания для его деактивации.</li>
  <li>Отсоедините от дата-центра.</li>
  <li>Нажмите <strong>Удалить</strong> чтобы открыть окно подтверждения <strong>Удалить хранилище</strong>.</li>
  <li>Выберите хост в списке.</li>
  <li>Нажмите <strong>OK</strong> чтобы удалить домен хранилища и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Домен хранилища окончательно удалён из окружения.</p>

<h4 id="destroying-a-storage-domain">Разрушение домена хранилища</h4>

<p><strong>Описание задачи</strong></p>

<p>Домен хранилища, на котором возникли ошибки, бывает невозможно удалить с помощью стандартной процедуры. Разрушение домена хранилища принудительно удалит его их виртуализованного окружения без ссылки на каталог экспорта.</p>

<p>После разрушения домена хранилища необходимо вручную исправить каталог экспорта домена хранилища перед тем, как работать с ним снова.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.14.&nbsp;Разрушение домена хранилища</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хранилище</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный домен хранилища в списке результатов.</li>
  <li>Нажмите ПКМ на домене хранилища и выберите пункт <strong>Разрушить</strong> чтобы открыть подтверждающее окно <strong>Разрушить домен хранилища</strong>.</li>
  <li>Отметьте галочкой пункт <strong>Подтвердить операцию</strong> и нажмите <strong>OK</strong> чтобы разрушить домен хранилища и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Домен хранилища был разрушен. Вручную очистите каталог экспорта домена хранилища для его повторного использования.</p>

<h4 id="detaching-the-export-domain">Отсоединение домена экспорта</h4>

<p><strong>Описание задачи</strong></p>

<p>Отсоедините домен экспорта от дата-центра чтобы импортировать шаблоны в другой дата-центр.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.15.&nbsp;Отсоединение домена экспорта от дата-центра</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хранилище</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный домен экспорта в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Дата-центры</strong> на панели сведений и выберите домен экспорта.</li>
  <li>Нажмите <strong>Обслуживание</strong> чтобы открыть окно подтверждения <strong>Обслуживание доменов хранилищ</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы инициировать режим обслуживания.</li>
  <li>Нажмите <strong>Отсоединить</strong> чтобы открыть окно подтверждения <strong>Отсоединить хранилище</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы отсоединить домен экспорта.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Домен экспорта был отсоединён от дата-центра и готов для присоединения к другому дата-центру.</p>

<h4 id="attaching-an-export-domain-to-a-data-center">Присоединение домена экспорта к дата-центру</h4>

<p><strong>Описание задачи</strong></p>

<p>Присоединение домена экспорта к дата-центру.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;7.16.&nbsp;Присоединение домена экспорта к дата-центру</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хранилище</strong>, режим дерева или поисковый функционал чтобы найти и выделить нужный домен экспорта в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Дата-центры</strong> на панели сведений.</li>
  <li>Нажмите <strong>Присоединить</strong> чтобы открыть окно <strong>Присоединить к дата-центру</strong>.</li>
  <li>Отметьте галочкой нужный дата-центр.</li>
  <li>Нажмите <strong>OK</strong> чтобы присоединить домен экспорта.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Домен экспорта был присоединён к дата-центру и автоматически активирован.</p>

<h2 id="virtual-machines">Виртуальные машины</h2>

<h3 id="introduction-to-virtual-machines">Введение в виртуальные машины</h3>

<p>Виртуальная машина — это программная реализация компьютера. Окружение oVirt даёт возможность создавать виртуальные рабочие столы и виртуальные серверы.</p>

<p>Виртуальные машины объединяют вычислительные задачи и рабочую нагрузку. В традиционном вычислительном окружении рабочая нагрузка обычно распределяется по серверам, каждый из которых имеет своего администратора, который в том числе занимается и обновлением. Виртуальные машины сокращают объём аппаратных и административных составляющих, необходимых для выполнения тех же вычислительных и административных задач и рабочей нагрузки.</p>

<h3 id="supported-virtual-machine-operating-systems">Операционные системы, поддерживаемые виртуальными машинами</h3>

<p>Следующие операционные системы доступны для виртуализации в качестве гостевых ОС в oVirt:</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.1.&nbsp;ОС, доступные для использования в качестве гостевых</strong></p>

<table>
<colgroup>
<col width="60%">
<col width="20%">
<col width="20%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Операционная система</p></th>
<th align="left"><p>Архитектура</p></th>
<th align="left"><p>Поддержка SPICE</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Red Hat Enterprise Linux 3</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>Red Hat Enterprise Linux 4</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Red Hat Enterprise Linux 5</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>Red Hat Enterprise Linux 6</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Red Hat Enterprise Linux 7</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>SUSE Linux Enterprise Server 10 (выберите тип гостя <strong>Другой Linux</strong> в пользовательском интерфейсе)</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Нет</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SUSE Linux Enterprise Server 11 (драйверы SPICE (QXL) не поставляются Red Hat, но поставщик дистрибутива может поставлять их в составе дистрибутива.)</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Нет</p></td>
</tr>
<tr class="even">
<td align="left"><p>Ubuntu 12.04 (Precise Pangolin LTS)</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Ubuntu 12.10 (Quantal Quetzal)</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>Ubuntu 13.04 (Raring Ringtail)</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Нет</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Ubuntu 13.10 (Saucy Salamander)</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>Windows XP Service Pack 3 и более поздние</p></td>
<td align="left"><p>32-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows 7</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>Windows 8</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Нет</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows Server 2003 Service Pack 2 и более поздние</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>Windows Server 2003 R2</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows Server 2008</p></td>
<td align="left"><p>32-бита, 64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="even">
<td align="left"><p>Windows Server 2008 R2</p></td>
<td align="left"><p>64-бита</p></td>
<td align="left"><p>Да</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows Server 2012</p></td>
<td align="left"><p>64-бита</p></td>
<td align="left"><p>Нет</p></td>
</tr>
<tr class="even">
<td align="left"><p>Windows Server 2012 R2</p></td>
<td align="left"><p>64-бита</p></td>
<td align="left"><p>Нет</p></td>
</tr>
</tbody>
</table>

<p>Протокол RDP является протоколом по умолчанию для доступа к гостевым ОС Windows 8 и Windows 2012 с Пользовательского портала, т.к. компания Microsoft внесла изменения в модель WDDM (Windows Display Driver Model), препятствующие оптимальной производительности SPICE.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> несмотря на имеющуюся поддержку Red Hat Enterprise Linux 3 и Red Hat Enterprise Linux 4, виртуальные машины, на которых установлены 32-битные версии этих ОС, невозможно выключить безопасно из Портала администрирования в связи с отсутствием поддержки ACPI в 32-битном x86 ядре. Чтобы завершить работу машин с установленными 32-битными версиями Red Hat Enterprise Linux 3 или Red Hat Enterprise Linux 4, сделайте щелчок ПКМ по машине и выберите пункт <strong>Выключение питания</strong>.</p>

</div>

<h3 id="virtual-machine-performance-parameters">Параметры производительности ВМ</h3>

<p>Виртуальные машины oVirt поддерживают следующие параметры:</p>

<p><strong>Таблица&nbsp;8.2.&nbsp;Поддерживаемые параметры ВМ</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Параметр</p></th>
<th align="left"><p>Количество</p></th>
<th align="left"><p>Примечание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Виртуализированные ЦП</p></td>
<td align="left"><p>160</p></td>
<td align="left"><p>на каждую ВМ</p></td>
</tr>
<tr class="even">
<td align="left"><p>Виртуализированная ОЗУ</p></td>
<td align="left"><p>2TБ</p></td>
<td align="left"><p>на каждую 64-битную ВМ</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Виртуализированная ОЗУ</p></td>
<td align="left"><p>4ГБ</p></td>
<td align="left"><p>На каждую 32-битную ВМ. Внимание: ВМ может не зарегистрировать все 4ГБ. Объём ОЗУ, распознаваемый машиной, ограничен установленной на машине ОС.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Виртуализированные накопительные устройства</p></td>
<td align="left"><p>8</p></td>
<td align="left"><p>на каждую ВМ</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Виртуализированные контроллеры сетевого интерфейса</p></td>
<td align="left"><p>8</p></td>
<td align="left"><p>на каждую ВМ</p></td>
</tr>
<tr class="even">
<td align="left"><p>Виртуализированные устройства PCI</p></td>
<td align="left"><p>32</p></td>
<td align="left"><p>на каждую ВМ</p></td>
</tr>
</tbody>
</table>

<h3 id="creating-virtual-machines">Создание виртуальных машин</h3>

<h4 id="creating-a-virtual-machine">Создание ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>Виртуальную машину можно создать из пустого шаблона и затем настроить все параметры машины.</p>

<p><strong>Инструкция&nbsp;8.1.&nbsp;Создание виртуальной машины</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong>.</li>
  <li>
    <p>Нажмите на кнопку <strong>Добавить ВМ</strong> чтобы открыть окно <strong>Добавить ВМ</strong>.
⁠</p>

    <p><img alt="The New Virtual Machine Window" title="Окно новой ВМ" src="./OVirt Administration Guide — oVirt_files/New_Virtual_Machine.png"></p>

    <p><strong>Рисунок&nbsp;8.1.&nbsp;Окно новой ВМ</strong></p>
  </li>
  <li>Во вкладке <strong>Общий</strong> заполните поля <strong>Имя</strong> и <strong>Операционная система</strong>. Параметры в других полях можно  принять по умолчанию или изменить их в случае необходимости.</li>
  <li>Или, определите свойства машины во вкладках <strong>Начальный запуск</strong>, <strong>Консоль</strong>, <strong>Хост</strong>, <strong>Выделение ресурсов</strong>, <strong>Параметры загрузки</strong> и <strong>Пользовательские свойства</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы создать ВМ и закрыть окно. Откроется окно <strong>Новая ВМ — Пошаговый помощник</strong>.</li>
  <li>С помощью кнопок Пошагового помощника завершите настройку параметров или нажмите <strong>Настроить позже</strong> чтобы закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали новую ВМ, которая появилась в списке машин и имеет статус <code>Не запущена</code>. Перед работой с этой ВМ необходимо добавить как минимум один сетевой интерфейс и один виртуальный диск и установить ОС.</p>

<h4 id="creating-a-virtual-machine-based-on-a-template">Создание ВМ на основе шаблона</h4>

<p><strong>Описание задачи</strong></p>

<p>Виртуальные машины можно создавать на основе шаблонов. Шаблоны позволяют создавать преднастроенные ВМ с ОС, сетевыми интерфейсами, приложениями и другими ресурсами.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> ВМ, созданные на основе шаблонов, зависят от этих шаблонов. Это означает, что шаблон нельзя удалить из oVirt, если существует ВМ, созданная на его основе. Тем не менее, виртуальную машину можно клонировать из шаблона, что удаляет зависимость машины от этого шаблона.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;8.2.&nbsp;Создание ВМ на основе шаблона</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong>.</li>
  <li>Нажмите на кнопку <strong>Добавить ВМ</strong> чтобы открыть окно <strong>Добавить ВМ</strong>.</li>
  <li>Выберите <strong>Кластер</strong>, на котором будет работать машина.</li>
  <li>Выберите шаблон из выпадающего списка <strong>Основана на шаблоне</strong>.</li>
  <li>Выберите подверсию шаблона в выпадающем меню <strong>Подверсия шаблона</strong>.</li>
  <li>Введите <strong>Имя</strong>, <strong>Описание</strong> и любые <strong>Комментарии</strong>. Значения по умолчанию в остальных полях, унаследованные из шаблона, можно оставить без изменений или изменить их при надобности.</li>
  <li>Нажмите на кнопку <strong>Показать дополнительные параметры</strong>.</li>
  <li>
    <p>Перейдите на вкладку <strong>Выделение ресурсов</strong>.
<img alt="Provisioning - Thin" title="Резервирование — тонкое" src="./OVirt Administration Guide — oVirt_files/New_Virtual_Machine_Resource_Allocation.png"></p>

    <p><strong>Рисунок&nbsp;8.2.&nbsp;Резервирование  — тонкое</strong></p>
  </li>
  <li>Отметьте галочкой пункт <strong>Тонкое</strong> в области <strong>Выделение ресурсов</strong>.</li>
  <li>В выпадающем меню <strong>Политика распределения</strong> выберите политику выделения дисковых ресурсов. Эта политика влияет на скорость операций клонирования и на объём дискового пространства, которое изначально требуется машине.
    <ul>
      <li>Результатом выбора <strong>Тонкого резервирования</strong> является ускоренная операция клонирования и оптимизированное использование возможностей хранилища. Дисковое пространство выделяется по мере необходимости. Эти параметры выбираются по умолчанию.</li>
      <li>Результатом выбора пункта <strong>Предварительно выделенное</strong> является медленная операция клонирования и оптимизированные операции чтения/записи виртуальной машины. Всё дисковое пространство, требуемое шаблоном, выделяется сразу во время операции клонирования.</li>
    </ul>
  </li>
  <li>Используя выпадающее меню <strong>Таргет</strong>, выберите домен хранилища, где будет размещён диск ВМ.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Создаётся ВМ, которая появляется в списке машин на вкладке <strong>Виртуальные машины</strong>. Теперь можно выполнить вход на машине и начать с ней работу, или же назначить ей пользователей.</p>

<h4 id="creating-a-cloned-virtual-machine-based-on-a-template">Создание клонированной ВМ на основе шаблона</h4>

<p><strong>Описание задачи</strong></p>

<p>Клонированные ВМ аналогичны машинам, созданным на основе шаблона. Тем не менее, хотя клонированная ВМ наследует параметры точно также, как и ВМ, основанная на шаблоне, клонированная ВМ после своего создания не зависит от шаблона, на базе которого она была создана.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> при клонировании ВМ из шаблона, имя этого шаблона показывается во вкладке <strong>Общие</strong> окна <strong>Изменить ВМ</strong> этой машины. Если изменить имя этого шаблона, то имя шаблона во вкладке <strong>Общие</strong> также обновится. Но если удалить шаблон из oVirt, то во вкладке будет показано изначальное имя этого шаблона.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;8.3.&nbsp;Клонирование ВМ, основанной на шаблоне</strong></p>

<ol>
  <li>Перейдите во вкладку <strong>Виртуальные машины</strong>.</li>
  <li>Нажмите на кнопку <strong>Новая ВМ</strong> чтобы открыть окно <strong>Новая ВМ</strong>.</li>
  <li>Выберите <strong>Кластер</strong>, на котором будет выполняться машина.</li>
  <li>Выберите шаблон из выпадающего меню <strong>Основана на шаблоне</strong>.</li>
  <li>Выберите подверсию шаблона в выпадающем меню <strong>Подверсия шаблона</strong>.</li>
  <li>Введите <strong>Имя</strong>, <strong>Описание</strong> и любые <strong>Комментарии</strong>, и примите стандартные параметры для других полей, унаследованные из шаблона. При необходимости их можно изменить.</li>
  <li>Нажмите на кнопку <strong>Показать дополнительные параметры</strong>.</li>
  <li>
    <p>Перейдите на вкладку <strong>Выделение ресурсов</strong>.
<img alt="Provisioning - Clone" title="Распределение — Клонирование" src="./OVirt Administration Guide — oVirt_files/New_Virtual_Machine_Clone_Allocation.png"></p>

    <p><strong>Рисунок&nbsp;8.3.&nbsp;Распределение — клонирование</strong></p>
  </li>
  <li>Отметьте галочкой пункт <strong>Клонировать</strong> в области <strong>Выделение хранилища</strong>.</li>
  <li>Выберите политику выделения диска в выпадающем меню <strong>Политика выделения</strong>. Эта политика влияет на скорость операции клонирования и на размер дискового пространства, изначально требующегося новой ВМ.
    <ul>
      <li>Результатом выбора <strong>Тонкого резервирования</strong> является ускоренная операция клонирования и оптимизированное использование возможностей хранилища. Дисковое пространство выделяется только по мере необходимости. Эти параметры выбираются по умолчанию.</li>
      <li>Результатом выбора пункта <strong>Предварительно выделенное</strong> является медленная операция клонирования и оптимизированные операции чтения/записи виртуальной машины. Всё дисковое пространство, требуемое шаблоном, выделяется сразу во время операции клонирования.</li>
    </ul>
  </li>
  <li>В выпадающем меню <strong>Таргет</strong> выберите домен хранилища, где будет расположен виртуальный диск ВМ.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> операция клонирования ВМ может занять некоторое время. Должна быть создана новая копия диска шаблона. В течение этого времени ВМ будет иметь сначала статус <strong>Образ заблокирован</strong>, а затем <strong>Выключена</strong>.</p>

</div>
<p><strong>Результат</strong></p>

<p>Виртуальная машина создаётся и появляется в списке машин на вкладке <strong>Виртуальные машины</strong>. Теперь ей можно присвоить пользователей, и начать работу по окончании операции клонирования.</p>

<h3 id="explanation-of-settings-and-controls-in-the-new-virtual-machine-and-edit-virtual-machine-windows">Объяснение параметров и элементов управления в окнах «Добавить ВМ» и «Изменить ВМ»</h3>

<h4 id="virtual-machine-general-settings-explained">Объяснение общих параметров виртуальной машины</h4>

<p>В таблице ниже приводятся подробности параметров, доступных во вкладке <strong>Общие</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.3.&nbsp;Виртуальная машина: общие параметры</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Кластер</strong></p></td>
<td align="left"><p>Имя кластера хоста, к которому присоединена ВМ. ВМ хостируются на любой физический машине в этом кластере в соответствии с правилами политики.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>На основе шаблона</strong></p></td>
<td align="left"><p>Шаблон, на основе которого может быть создана машина. Это поле по умолчанию <code>Не заполнено</code>, что даёт возможность создать ВМ без установленной ОС.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Подверсия шаблона</strong></p></td>
<td align="left"><p>Версия шаблона, на котором может быть основана ВМ. По умолчанию, в поле указана самая свежая версия указанного шаблона. Если никакие другие версии шаблона, кроме базовой, недоступны, то в поле по умолчанию указано <code>базовый шаблон</code>. Каждая версия отмечена числом в скобках, которое обозначает относительный порядок версии, где более старшие номера означают более свежую версию.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Операционная система</strong></p></td>
<td align="left"><p>Операционная система. Пригодные к использованию ОС: диапазон версий Red Hat Enterprise Linux и различные вариации Windows.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Оптимизировано для</strong></p></td>
<td align="left"><p>Тип системы, для которой машина будут оптимизирована. Имеется два варианта: <strong>Сервер</strong> и <strong>Рабочий стол</strong>; значение этого поля по умолчанию — <strong>Сервер</strong>. Виртуальные машины, оптимизированные для работы в качестве сервера, не имеют звуковой карты, используют клонированный образ диска и выполняются с сохранением состояния. В то же время, машины, оптимизированные для работы в качестве рабочего стола, имеют звуковую карту, используют образ (тонкое резервирование) и выполняются без сохранения состояния.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Имя ВМ. Имена не могут содержать пробелов и должны состоять минимум из одного символа от A до Z или от 0 до 9. Максимальная длина имени ВМ — 64 символа.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Осмысленное описание новой ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Комментарий</strong></p></td>
<td align="left"><p>Поле для добавления текстового комментария в удобочитаемой форме.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Без сохранения состояния</strong></p></td>
<td align="left"><p>Отметьте галочкой этот пункт, если ВМ должна выполняться без сохранения состояния. Этот режим используются в первую очередь для виртуальных рабочих столов. Рабочие столы и серверы, выполняемые без сохранения состояния, создают новый слой копирования при записи (Copy-On-Write, COW) на образе жёсткого диска ВМ, где хранятся новые и изменённые данные. Выключение ВМ удаляет новый слой COW, что возвращает ВМ в исходное состояние. Машины, выполняющиеся без сохранения состояния, удобны, если необходимо создать ВМ для использования в течении короткого времени или для временных сотрудников.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Запустить и приостановить</strong></p></td>
<td align="left"><p>Отметьте галочкой этот параметр чтобы машины приостанавливалась сразу после запуска. Данный параметр рекомендуется для ВМ, которым требуется длительное время для установления подключения SPICE; например, ВМ с удалённым местоположением.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Защита от удаления</strong></p></td>
<td align="left"><p>Отметьте галочкой этот параметр, чтобы сделать невозможным удаление машины. Удалить ВМ можно, только если этот параметр не отмечен.</p></td>
</tr>
</tbody>
</table>

<p>В нижней части вкладки <strong>Общие</strong> располагается выпадающее поле, в котором можно назначить новой ВМ сетевые интерфейсы. С помощью кнопок «+» и «-» добавьте или удалите дополнительные сетевые интерфейсы.</p>

<h4 id="virtual-machine-system-settings-explained">Объяснение системных параметров виртуальных машин</h4>

<p>В таблице ниже приводятся подробности параметров, доступных во вкладке <strong>Система</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.4.&nbsp;Виртуальная машина: системные параметры</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Размер памяти</strong></p></td>
<td align="left"><p>Объём памяти, назначенный машине. Выделяя память, учитывайте требования приложений, которые будут установлены на ВМ, к ресурсам для обработки и хранения данных. Максимальный объём памяти гостевой ОС зависит от выбранной архитектуры и уровня совместимости кластера.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Количество виртуальных ЦП</strong></p></td>
<td align="left"><p>Объём вычислительной мощности, выделенной виртуальной машине в виде ядер ЦП. Не назначайте машине больше ядер, чем имеется в наличии на физическом хосте.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Ядер на виртуальный сокет</strong></p></td>
<td align="left"><p>Количество ядер, назначенных каждому виртуальному сокету.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Виртуальные сокеты</strong></p></td>
<td align="left"><p>Число сокетов ЦП на виртуальную машину. Не назначайте машине больше сокетов, чем имеется в наличии на физическом хосте.</p></td>
</tr>
</tbody>
</table>

<h4 id="virtual-machine-initial-run-settings-explained">Объяснение параметров начального запуска ВМ</h4>

<p>В таблице ниже приводятся подробности параметров, доступных во вкладке <strong>Начальный запуск</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>. Параметры, приведённые в этой таблице, становятся доступными только при отмеченном пункте <strong>Использовать Cloud-Init/Sysprep</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.5.&nbsp;Виртуальная машина: параметры начального запуска</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Использовать Cloud-Init/Sysprep</strong></p></td>
<td align="left"><p>Включение/отключение использования Cloud-Init или Sysprep при инициализации ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Имя хоста ВМ</strong></p></td>
<td align="left"><p>Возможность назначить имя хоста ВМ.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Параметры часового пояса</strong></p></td>
<td align="left"><p>Даёт возможность установить конкретный часовой пояс на ВМ. Отметьте этот пункт и выберите часовой пояс в выпадающем меню <strong>Часовой пояс</strong>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Аутентификация</strong></p></td>
<td align="left"><p>Даёт возможность настроить подробности аутентификации на ВМ. Нажмите на стрелке чтобы развернуть доступные параметры аутентификации.</p>
<ul>
<li><strong>Использовать уже установленный пароль</strong>: даёт возможность указать для использования уже настроенные на ВМ пароли.</li>
<li><strong>Пароль пользователя root</strong>: возможность указать пароль root для ВМ. Введите пароль в это текстовое поле, а также в поле <strong>Подтвердить пароль root</strong> для подтверждения.</li>
<li><strong>Назначенные ключи SSH</strong>: ключи SSH, которые нужно добавить в файл назначенных ключей ВМ.</li>
<li><strong>Пересоздать ключи SSH</strong>: возможность заново создать ключи SSH для ВМ.</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Сети</strong></p></td>
<td align="left"><p>Параметры машины, имеющие отношение к сетям. Нажмите на стрелку, чтобы развернуть эти параметры.</p>
<ul>
<li><strong>Серверы DNS</strong>: серверы DNS, используемые машиной.</li>
<li><strong>Домены поиска DNS</strong>: домены поиска DNS, используемые машиной.</li>
<li><strong>Сеть</strong>: параметры сетевых интерфейсов, используемых машиной. Отметьте этот параметр, и с помощью кнопок <strong>+</strong> и <strong>-</strong> добавьте или удалите сетевые интерфейсы ВМ. При нажатии на кнопку <strong>+</strong> отображаются поля, в которых можно указать параметры DHCP, настроить адрес IP, сетевую маску и шлюз, а также указать, будут ли стартовать сетевые интерфейсы при загрузке.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Пользовательский скрипт</strong></p></td>
<td align="left"><p>Возможность указать скрипты, стартующие при загрузке ВМ. Скрипты, введённые в этом поле — это пользовательские блоки в формате YAML, добавляемые к тем, которые создал oVirt, и позволяющие автоматизировать задачи, например, создание пользователей и файлов, настройка репозиториев <strong>yum</strong> и запуск команд. Подробности о формате скриптов, вводимых в это поле, см. в документации по <a href="http://www.ovirt.org/Features/vm-init-persistent#Custom_Script">Пользовательским скриптам</a>.</p></td>
</tr>
</tbody>
</table>

<h4 id="virtual-machine-console-settings-explained">Объяснение консольных параметров ВМ</h4>

<p>В таблице ниже приводятся подробности параметров, доступных во вкладке <strong>Консоль</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.6.&nbsp;Виртуальная машина: параметры консоли</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Протокол</strong></p></td>
<td align="left"><p>Используемый протокол. Рекомендуемый протокол для Linux и Windows машин — <strong>SPICE</strong>, за исключением ОС Windows 8 и Windows Server 2012. Или, для Linux машин, выберите <strong>VNC</strong>. Для подключения к машине по протоколу VNC необходим VNC-клиент.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Раскладка клавиатуры VNC</strong></p></td>
<td align="left"><p>Определяет раскладку клавиатуры для ВМ. Этот параметр доступен только при использовании протокола VNC.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Поддержка USB</strong></p></td>
<td align="left"><p>Определяет возможность использования устройств USB в виртуальной машине. Этот параметр доступен только для ВМ, использующих протокол SPICE. Выберите одну из следующих возможностей:</p>
<ul>
<li><strong>Отключено</strong> — перенаправление USB с клиентской на виртуальную машину отключено.</li>
<li><strong>Поддержка устаревших версий</strong> — включает политику перенаправления SPICE USB, использующуюся в oVirt 3.0. Этот параметр можно использовать только для ВМ с Windows, он не будет поддерживаться в будущих версиях oVirt.</li>
<li><strong>Встроенная</strong> — включает встроенную поддержку перенаправления KVM/SPICE USB для ВМ с Linux и Windows. В случае встроенной поддержки машинам не требуется никаких гостевых агентов или драйверов. Этот параметр можно использовать только если версия совместимости кластера машины равна 3.1 или более ранней.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Мониторы</strong></p></td>
<td align="left"><p>Количество мониторов ВМ. Этот параметр доступен только для ВМ, использующих протокол дисплея SPICE. Можно выбрать <strong>1</strong>, <strong>2</strong> или <strong>4</strong>. Поскольку ВМ под управлением ОС Windows 8 и Windows Server 2012 не поддерживают протокол SPICE, поддержка нескольких мониторов для машин отсутствует.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Смарт-карта включена</strong></p></td>
<td align="left"><p>Смарт карты — это внешняя аппаратная функция безопасности, наиболее часто встречающаяся в кредитных картах, но также нередко используемая в бизнесе в виде токенов аутентификации. Смарт карты можно использовать для защиты виртуальных машин oVirt. Отметьте галочкой этот пункт или снимите галочку чтобы активировать/деактивировать аутентификацию по смарт картам для отдельных ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Отключить строгую проверку пользователей</strong></p></td>
<td align="left"><p>Нажмите на стрелку <strong>Дополнительные параметры</strong> и отметьте галочкой этот параметр для его использования. Если этот параметр выбран, то виртуальной машине не требуется перезагрузка при подключении к ней другого пользователя. Строгая проверка пользователей по умолчанию включена, что позволяет только одному пользователя быть подключенным к консоли ВМ. Никакой другой пользователь не может открыть консоль для подключения к той же самой ВМ до её перезагрузки. Исключение составляет <code>Суперпользователь</code>, который может подключиться в любое время и заменить существующее соединение. Во время подключения <code>Суперпользователя</code> никакой обычный пользователь не может подключиться снова, пока ВМ не будет перезапущена. Используйте отключение строгой проверки пользователей аккуратно, т.к. в этом случае сеанс предыдущего пользователя может стать видимым для нового пользователя.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Звуковая карта включена</strong></p></td>
<td align="left"><p>Звуковое устройство необязательно для каждой ВМ. Если звуковая карта нужна для данной машины, включите поддержку звуковой карты в этом пункте.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Консольное устройство VirtIO включено</strong></p></td>
<td align="left"><p>Консольное устройство VirtIO — это консоль, работающая с использованием транспорта VirtIO, применяющегося для связи между пользовательским пространством хоста и пользовательским пространством гостевой ОС. Это устройство состоит из двух частей: эмуляция устройства в QEMU, предоставляющая устройство virtio-pci гостю, и гостевой драйвер, предоставляющий символьный интерфейс приложениям пространства пользователя. Отметьте галочкой этот пункт чтобы присоединить устройство консоли VirtIO к машине.</p></td>
</tr>
</tbody>
</table>

<h4 id="virtual-machine-host-settings-explained">Объяснение параметров хоста виртуальной машины</h4>

<p>В таблице ниже приводятся подробности параметров вкладки <strong>Хост</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.7.&nbsp;Виртуальная машина: параметры хоста</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Начать выполнение на</strong></p></td>
<td align="left"><p>Определяет предпочитаемый хост, на котором будет выполняться ВМ. Доступные возможности:</p>
<ul>
<li><strong>Любой хост в кластере</strong> — ВМ может запуститься и работать на любом доступном хосте кластера.</li>
<li><strong>Указанный</strong> — ВМ будет запущена на конкретном хосте кластера. Тем не менее, oVirt или администратор могут перенести ВМ на другой хост кластера, в зависимости от параметров миграции и высокой доступности машины. Выберите конкретный хост в списке доступных хостов в выпадающем меню.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Параметры миграции</strong></p></td>
<td align="left"><p>Определяет параметры запуска и миграции ВМ. Если доступные здесь параметры не используются, ВМ будет работать или мигрировать в соответствии с политикой своего кластера.</p>
<ul>
<li><strong>Разрешить ручную и автоматическую миграцию</strong> — ВМ может быть перенесена с одного хоста на другой автоматически, в соответствии со статусом окружения, или вручную администратором.</li>
<li><strong>Разрешить только ручную миграцию</strong> — перенос ВМ с одного хоста на другой осуществляется только вручную администратором.</li>
<li><strong>Не разрешать миграцию</strong> — перенос машины, автоматически или вручную, запрещён.</li>
</ul>
<p>Флажок <strong>Использовать ЦП хоста</strong> позволяет машинам использовать преимущества, предоставляемые свойствами физического ЦП хоста, на котором выполняются машины. Этот параметр можно включить только если был отмечен пункт <strong>Разрешить только ручную миграцию</strong> или <strong>Не разрешать миграцию</strong>. Флажок <strong>Использовать заданное время простоя при миграции</strong> позволяет указать максимальное время простоя ВМ при динамической миграции (в миллисекундах). Настройте различные максимальные значения простоя для каждой ВМ в соответствии с рабочей нагрузкой и требованиями соглашения об уровне обслуживания (SLA). Значение VDSM по умолчанию — 0.</p></td>
</tr>
</tbody>
</table>

<h4 id="virtual-machine-high-availability-settings-explained">Объяснение параметров высокой доступности ВМ</h4>

<p>В таблице ниже приводятся подробности параметров вкладки <strong>Высокая доступность</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.8.&nbsp;Виртуальная машина: параметры высокой доступности</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>С высокой доступностью</strong></p></td>
<td align="left"><p>Отметьте галочкой этот параметр, если машина должна быть высокодоступной. Например, в случаях обслуживания хоста или сбоя, виртуальная машина автоматически будет перемещена или перезапущена на другом хосте. Если хост выключается вручную системным администратором, машина не перемещается автоматически на другой хост. Обратите внимание, что этот параметр недоступен, если значение пункта <strong>Параметры миграции</strong> во вкладке <strong>Хосты</strong> установлено либо как <strong>Разрешить только ручную миграцию</strong> либо как <strong>Миграция не разрешена</strong>. Чтобы ВМ была высокодоступной, у oVirt должна существовать возможность переноса этой машины на другие доступные хосты в случае необходимости.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Приоритет в очереди на запуск/миграцию</strong></p></td>
<td align="left"><p>Устанавливает уровень приоритета машины на перенос или перезапуск на другом хосте.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Сторожевой таймер</strong></p></td>
<td align="left"><p>Даёт возможность пользователю подключить карту сторожевого таймера к виртуальной машине. Сторожевой таймер (watchdog) — это таймер, использующийся для автоматического обнаружения сбоев и восстановления после сбоев. После установки, сторожевой таймер начинает производить периодические отсчёты до нуля во время работы системы, и периодически перезапускается системой для предотвращения достижения таймером нулевой отметки. Если таймеру удалось досчитать до нуля, это означает, что система была не в состоянии его перезапустить, что является признаком сбоя системы. В таком случае применяются действия по исправлению сбоя. Этот функционал особенно удобен для серверов, требующих высокой доступности. <strong>Модель сторожевого таймера</strong>: модель карты сторожевого таймера, которую нужно назначить машине. В настоящее время единственной поддерживаемой моделью является <strong>i6300esb</strong>. <strong>Действие сторожевого таймера</strong>: действие, которое будет выполнено при достижении таймером нуля. Доступны следующие возможности:</p>
<ul>
<li><strong>нет</strong> — никаких действий не предпринимается, но событие сторожевого таймера записывается в журнал аудита.</li>
<li><strong>сброс</strong> — сброс параметров ВМ с уведомлением oVirt об этом действии.</li>
<li><strong>отключить питание</strong> — ВМ немедленно выключается.</li>
<li><strong>дамп</strong> — выполняется дамп, и виртуальная машина приостанавливается.</li>
<li><strong>приостановить</strong> — ВМ приостанавливается и может быть снова запущена пользователями.</li>
</ul></td>
</tr>
</tbody>
</table>

<h4 id="virtual-machine-resource-allocation-settings-explained">Объяснение параметров распределения ресурсов ВМ</h4>

<p>В таблице ниже приводятся подробности параметров вкладки <strong>Выделение ресурсов</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.9.&nbsp;Виртуальная машина: параметры выделения ресурсов</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Подэлемент</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Выделение ЦП</strong></p></td>
<td align="left"><p><strong>Ресурсы ЦП</strong></p></td>
<td align="left"><p>Возможность указать уровень ресурсов ЦП, которые может затребовать ВМ, относительно других машин.</p>
<ul>
<li><strong>Низкий</strong> - 512</li>
<li><strong>Средний</strong> - 1024</li>
<li><strong>Высокий</strong> - 2048</li>
<li><strong>Назначенный</strong> — назначенный пользователем уровень ресурсов ЦП.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><p><strong>Топология привязки ЦП</strong></p></td>
<td align="left"><p>Позволяет виртуальным ЦП (вЦП) виртуальной машины работать на конкретном физическом ЦП (фЦП) конкретного хоста. Эта возможность не поддерживается, если версия совместимости кластера ВМ равна 3.0. Синтаксис привязки ЦП: <code>v#p[_v#p]</code>, например:</p>
<ul>
<li><code>0#0</code> — привязывает вЦП 0 к фЦП 0.</li>
<li><code>0#0_1#3</code> — привязывает вЦП 0 к фЦП 0, и привязывает вЦП 1 к фЦП 3.</li>
<li><code>1#1-4,^2</code> — привязывает вЦП 1 к одному из фЦП в диапазоне от 1 до 4, исключая фЦП 2.</li>
</ul>
<p>Чтобы иметь возможность привязать ВМ к хосту, необходимо выбрать параметр <strong>Не разрешать миграцию</strong> в <strong>Параметрах миграции</strong>, и отметить галочкой пункт <code>Использовать ЦП хоста</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Выделение памяти</strong></p></td>
<td align="left"></td>
<td align="left"><p>Объём гарантированной физической памяти ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Резервирование хранилища</strong></p></td>
<td align="left"></td>
<td align="left"><p>Параметр <strong>Подготовка шаблона</strong> доступен только, если ВМ была создана из шаблона.</p></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><p><strong>Тонкое</strong></p></td>
<td align="left"><p>Предоставляет оптимизированное использование объёмов хранилища. Место на диске выделяется только по мере необходимости.</p></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><p><strong>Клонирование</strong></p></td>
<td align="left"><p>Оптимизация под операции чтения/записи гостевой ОС. Всё дисковое пространство, требуемое в шаблоне, выделяется сразу в процессе операции клонирования.</p></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><p><strong>VirtIO-SCSI включен</strong></p></td>
<td align="left"><p>Возможность включить или отключить использование VirtIO-SCSI на машинах.</p></td>
</tr>
</tbody>
</table>

<h4 id="virtual-machine-boot-options-settings-explained">Объяснение параметров загрузки ВМ</h4>

<p>В таблице ниже приводятся подробности параметров вкладки <strong>Параметры загрузки</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong></p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.10.&nbsp;Виртуальная машина: настройка параметров загрузки</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Первое устройство</strong></p></td>
<td align="left"><p>После установки новой ВМ, перед включением питания машина должна перейти в режим загрузки. Выберите первое устройство, которое ВМ должна попробовать загрузить:</p>
<ul>
<li><strong>жёсткий диск</strong></li>
<li><strong>CD-ROM</strong></li>
<li><strong>Сеть (PXE)</strong></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Второе устройство</strong></p></td>
<td align="left"><p>Выберите второе устройство, которое должна использовать ВМ для загрузки, если первое устройство недоступно. Первое устройство, выбранное в предыдущем пункте, здесь отсутствует.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Присоединить CD</strong></p></td>
<td align="left"><p>Если в качестве загрузочного устройства был выбран <strong>CD-ROM</strong>, отметьте этот параметр галочкой и выберите образ CD-ROM в выпадающем меню. Образы должны быть доступны в домене ISO.</p></td>
</tr>
</tbody>
</table>

<h4 id="virtual-machine-custom-properties-settings-explained">Объяснение настройки параметров ВМ, заданных пользователем</h4>

<p>В таблице ниже приводятся подробности параметров вкладки <strong>Заданные пользователем параметры</strong> окон <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.11.&nbsp;Виртуальная машина: настройка параметров, заданных пользователем</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
<th align="left"><p>Рекомендации и ограничения</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>sap_agent</strong></p></td>
<td align="left"><p>Включает мониторинг SAP на ВМ. Укажите <strong>верно</strong> или <strong>ложно</strong>.</p></td>
</tr>
<tr class="even">
</tr>
<tr class="odd">
<td align="left"><p><strong>sndbuf</strong></p></td>
<td align="left"><p>Введите размер буфера для исходящих данных, посылаемых через сокет. Значение по умолчанию — 0.</p></td>
</tr>
<tr class="even">
</tr>
<tr class="odd">
<td align="left"><p><strong>vhost</strong></p></td>
<td align="left"><p>Отключает vhost-net, включённый в состав ядра сетевой драйвер virtio, который используется для работы виртуальной сети, присоединённой к ВМ. Применяется следующий формат отключения vhost:</p>
<pre><code>LogicalNetworkName: false</code></pre>
<p>Этот параметр явно запускает ВМ без установок vhost-net на виртуальной NIC, присоединённой к <em>LogicalNetworkName</em>.</p></td>
<td align="left"><p>драйвер vhost-net предоставляет лучшую производительность, чем virtio-net, и, в случае его присутствия, по умолчанию включается для всех NIC машины. Отключение этого параметра облегчает локализацию и диагностику проблем производительности, а также отладку ошибок vhost-net; например, при сбое миграции для тех ВМ, где отсутствует vhost.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>viodiskcache</strong></p></td>
<td align="left"><p>Режим кеширования для диска virtio. В режиме <strong>writethrough</strong> данные записываются одновременно и в кеш и на диск, в режиме <strong>writeback</strong> изменения не копируются из кеша на диск, а параметр <strong>нет</strong> отключает кеширование.</p></td>
<td align="left"><p>В oVirt версии 3.1 при включенном viodiskcache невозможна динамическая миграция ВМ.</p></td>
</tr>
</tbody>
</table>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> увеличение значения настраиваемого параметра sndbuf увеличивает количество случаев обрыва связи между хостами и неотвечающими ВМ.</p>

</div>

<h3 id="configuring-virtual-machines">Настройка виртуальных машин</h3>

<h4 id="completing-the-configuration-of-a-virtual-machine-by-defining-network-interfaces-and-hard-disks">Завершение настройки ВМ: определение сетевых интерфейсов и жёстких дисков</h4>

<p><strong>Описание задачи</strong></p>

<p>Перед началом работы с добавленной ВМ, окно <strong>Пошагового помощника</strong> предлагает настроить минимум один сетевой интерфейс и один виртуальный диск для машины.</p>

<p><strong>Инструкция&nbsp;8.4.&nbsp;Завершение настройки ВМ: определение сетевых интерфейсов и жёстких дисков</strong></p>

<ol>
  <li>В окне <strong>Добавить ВМ: Пошаговый помощник</strong> нажмите на кнопку <strong>Параметры сетевых интерфейсов</strong> чтобы открыть окно <strong>Добавить сетевой интерфейс</strong>. Можно принять значения по умолчанию или изменить их при необходимости.</li>
  <li>Введите <strong>Имя</strong> сетевого интерфейса.</li>
  <li>В выпадающем меню выберите <strong>Сеть</strong> и <strong>Тип</strong> сетевого интерфейса новой машины. Значение параметра <strong>Статус канала</strong>, при настроенной и подключённой к сети NIC, по умолчанию установлено на <strong>Работает</strong>.
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> параметры полей <strong>Сеть</strong> и <strong>Тип</strong> заполняются сетями, доступными на кластере, и NIC, доступными на машине.</p>

    </div>
  </li>
  <li>В случае необходимости отметьте галочкой параметр <strong>Указать настраиваемый MAC адрес</strong> и введите MAC адрес для сетевого интерфейса.</li>
  <li>Нажмите на стрелочку рядом с <strong>Дополнительными параметрами</strong> чтобы настроить поля <strong>Зеркалирование портов</strong> и <strong>Статус карты</strong>, в случае их необходимости.</li>
  <li>Нажмите <strong>OK</strong> чтобы закрыть окно <strong>Добавить сетевой интерфейс</strong> и открыть окно <strong>Добавить ВМ: Пошаговый помощник</strong>.</li>
  <li>Нажмите на кнопку <strong>Параметры виртуального диска</strong> чтобы открыть окно <strong>Добавить виртуальный диск</strong>.</li>
  <li>
    <p>Добавьте либо <strong>Внутренний</strong> виртуальный диск, либо <strong>Внешний</strong> номер LUN для ВМ.
⁠</p>

    <p><img alt="Add Virtual Disk Window" title="Окно добавления виртуального диска" src="./OVirt Administration Guide — oVirt_files/Add_Virtual_Disk.png"></p>

    <p><strong>Рисунок&nbsp;8.4.&nbsp;Окно добавления виртуального диска</strong></p>
  </li>
  <li>Нажмите <strong>OK</strong> чтобы закрыть окно <strong>Добавить виртуальный диск</strong>. Откроется окно <strong>Добавить ВМ: Пошаговый помощник</strong> с изменённым контекстом. Дальнейших обязательных шагов по настройке нет.</li>
  <li>Нажмите <strong>Настроить позже</strong> чтобы закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы добавили сетевой интерфейс и виртуальный диск для виртуальной машины.</p>

<h4 id="installing-windows-on-virtio-optimized-hardware">Установка Windows на аппаратном обеспечении, оптимизированном для VirtIO</h4>

<p><strong>Описание задачи</strong></p>

<p>Образ дискеты <code>virtio-win.vfd</code> содержит драйверы Windows для диска и сетевых устройств, оптимизированных под VirtIO. Эти драйверы предоставляют значительное увеличение производительности по сравнению с эмулированными драйверами устройств.</p>

<p>Образ <code>virtio-win.vfd</code> автоматически помещается на доменах хранилищ ISO, размещённых на сервере oVirt. Образ необходимо вручную загрузить на другие домены хранилищ ISO с помощью утилиты <strong>engine-iso-uploader</strong>.</p>

<p>Драйверы устройств, оптимизированных для VirtIO, можно установить во время установки Windows, подключив дискету к ВМ.</p>

<p>Выполнение нижеописанного действия предполагает, что к виртуальной машине были подключены сетевой интерфейс <code>Red Hat VirtIO</code> и диск, использующий интерфейс <code>VirtIO</code>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.5.&nbsp;Установка драйверов VirtIO во время установки Windows</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите на кнопку <strong>Однократный запуск</strong>, будет открыто окно <strong>Однократный запуск</strong>.</li>
  <li>Нажмите на <strong>Параметры загрузки</strong> чтобы развернуть настраиваемые <strong>Параметры загрузки</strong>.</li>
  <li>Отметьте галочкой пункт <strong>Присоединить дискету</strong>, и в выпадающем блоке выберите <code>virtio-win.vfd</code>.</li>
  <li>Отметьте галочкой пункт <strong>Присоединить CD</strong>, и в выпадающем блоке выберите образ ISO, содержащий версию Windows, которую нужно установить.</li>
  <li>В поле <strong>Последовательность загрузки</strong> переместите <strong>CD-ROM</strong> <strong>ВВЕРХ</strong> .</li>
  <li>Настройте остальные параметры <strong>Однократного запуска</strong> и нажмите <strong>OK</strong> чтобы запустить ВМ, затем нажмите кнопку <strong>Консоль</strong> чтобы открыть графическую консоль и подключиться к ВМ.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Во время начального этапа установки Windows можно загрузить дополнительные драйверы для их установки. Используйте эту возможность чтобы загрузить драйверы с дискеты <code>virtio-win.vfd</code>, которая была подключена к ВМ как диск <code>A:</code>.</p>

<p>Для каждой поддерживаемой виртуальной машиной архитектуры и версии Windows на диске существует папка, содержащая оптимизированные драйверы аппаратных устройств.</p>

<h4 id="virtual-machine-run-once-settings-explained">Объяснение параметров однократного запуска ВМ</h4>

<p>В окне <strong>Однократный запуск</strong> определяются однократные параметры загрузки ВМ. Для постоянных параметров используйте вкладку <strong>Параметры загрузки</strong> окна <strong>Добавить ВМ</strong>. В таблице ниже приводятся подробности параметров окна <strong>Однократный запуск</strong>.</p>

<p><strong>Таблица&nbsp;8.12.&nbsp;Виртуальная машина: параметры однократного запуска</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Параметры загрузки</strong></p></td>
<td align="left"><p>Определяет последовательность загрузки ВМ, параметры выполнения и образы для установки ОС и нужных драйверов.</p>
<ul>
<li><strong>Присоединить дискету</strong> — подключает образ дискеты к ВМ. Используйте этот параметр для установки драйверов Windows. Образ дискеты должен находиться на домене ISO.</li>
<li><strong>Присоединить CD</strong> — подключает образ ISO к ВМ. Используйте этот параметр для установки ОС и приложений на ВМ. Образ CD должен находиться на домене ISO.</li>
<li><strong>Последовательность загрузки</strong> — определяет порядок, в котором используются загрузочные устройства для загрузки ВМ. Выберите <strong>Жёсткий диск</strong>, <strong>CD-ROM</strong> или <strong>Сеть</strong>, и используйте клавиши со стрелками для передвижения устройства выше или ниже по списку.</li>
<li><strong>Запустить без сохранения состояния</strong> — удаляет все изменения в виртуальной машине после её выключения. Этот параметр доступен только если к ВМ присоединён виртуальный диск.</li>
<li><strong>Запустить и приостановить</strong> — запускает и затем сразу приостанавливает ВМ чтобы активировать консольное подключение, что подходит для ВМ в удалённых местоположениях.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Параметры загрузки Linux</strong></p></td>
<td align="left"><p>Следующие параметры загружают ядро Linux напрямую, а не через загрузчик BIOS.</p>
<ul>
<li><strong>путь к ядру</strong> — полный путь к образу ядра для загрузки ВМ. Образ ядра должен храниться либо в домене ISO (путь в формате <code>iso://путь_до_образа</code>) либо в локальном домене хранилища хоста (путь в формате <code>/data/images</code>).</li>
<li><strong>путь к initrd</strong> — полный путь к образу ramdisk, для использования с вышеуказанным ядром. Образ ramdisk должен храниться либо в домене ISO (путь в формате <code>iso://путь_до_образа</code>) либо в локальном домене хранилища хоста (путь в формате <code>/data/images</code>).</li>
<li><strong>параметры ядра</strong> — параметры командной строки для использования указанным ядром при загрузке.</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Однократный запуск</strong></p></td>
<td align="left"><p>Указывает, будет ли использоваться Cloud-Init для инициализации ВМ. Если параметр выбран, становятся доступными также следующие параметры:</p>
<ul>
<li><strong>Имя хоста ВМ</strong> — указать имя хоста машины.</li>
<li><strong>Параметры часового пояса</strong> — установите конкретный часовой пояс на ВМ. Отметьте этот пункт и выберите часовой пояс в выпадающем меню <strong>Часовой пояс</strong>.</li>
</ul>
<p><strong>Аутентификация</strong></p>
<ul>
<li><strong>Использовать уже установленный пароль</strong> — указать для использования уже настроенные на ВМ пароли.</li>
<li><strong>Пароль пользователя root</strong> — указать пароль root для ВМ. Введите пароль в это текстовое поле, а также в поле <strong>Подтвердить пароль root</strong> для его подтверждения.</li>
<li><strong>Назначенные ключи SSH</strong> — ключи SSH, которые нужно добавить в файл назначенных ключей ВМ.</li>
<li><strong>Пересоздать ключи SSH</strong> — возможность заново создать ключи SSH для ВМ.</li>
</ul>
<p><strong>Сети</strong></p>
<ul>
<li><strong>Серверы DNS</strong>: серверы DNS, используемые машиной.</li>
<li><strong>Домены поиска DNS</strong>: домены поиска DNS, используемые машиной.</li>
<li><strong>Сеть</strong>: параметры сетевых интерфейсов, используемых машиной. Отметьте этот параметр, и с помощью кнопок <strong>+</strong> и <strong>-</strong> добавьте или удалите сетевые интерфейсы ВМ. При нажатии на кнопку <strong>+</strong> отображаются поля, в которых можно указать параметры DHCP, настроить адрес IP, сетевую маску и шлюз, а также указать, будут ли стартовать сетевые интерфейсы при загрузке.</li>
</ul>
<p><strong>Пользовательский скрипт</strong></p>
<ul>
<li>Введите скрипты, стартующие при загрузке ВМ. Скрипты, введённые в этом поле — это пользовательские блоки в формате YAML, добавляемые к тем, которые создал oVirt, и позволяющие автоматизировать задачи, например, создание пользователей и файлов, настройка репозиториев <strong>yum</strong> и запуск команд. Подробности о формате скриптов, вводимых в это поле, см. в документации по <a href="http://www.ovirt.org/Features/vm-init-persistent#Custom_Script">Пользовательским скриптам</a>.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Хост</strong></p></td>
<td align="left"><p>Определяет хост ВМ.</p>
<ul>
<li><strong>Любой хост в кластере:</strong> — выделяет машине любой доступный хост.</li>
<li><strong>Указанный</strong> — определяет для машины хост, указанный пользователем.</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Протокол дисплея</strong></p></td>
<td align="left"><p>Определяет протокол, по которому осуществляется соединение с машиной.</p>
<ul>
<li><strong>VNC</strong> — можно использовать для ВМ под управлением Linux. Для подключения к машине по протоколу VNC необходим VNC-клиент. По необходимости также в выпадающем меню выберите <strong>Раскладку клавиатуры VNC</strong>.</li>
<li><strong>SPICE</strong> — рекомендуемый протокол для машин под управлением как Linux, так и Windows, исключая машины с установленными Windows 8 и Server 2012.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Назначаемые пользователем параметры</strong></p></td>
<td align="left"><p>Дополнительные параметры VDSM для запуска ВМ.</p>
<ul>
<li><strong>sap_agent</strong> — включает мониторинг SAP на ВМ. Укажите <strong>верно</strong> или <strong>ложно</strong>.</li>
<li><strong>sndbuf</strong> — Введите размер буфера для исходящих данных, посылаемых через сокет.</li>
<li><strong>vhost</strong> — укажите имя виртуального хоста, на котором должна выполняться данная ВМ. Имя может состоять из любого сочетания букв и цифр.</li>
<li><strong>viodiskcache</strong> — режим кеширования для диска virtio. В режиме <strong>writethrough</strong> данные записываются одновременно и в кеш и на диск, в режиме <strong>writeback</strong> изменения не копируются из кеша на диск, а параметр <strong>нет</strong> отключает кеширование.</li>
</ul></td>
</tr>
</tbody>
</table>

<h4 id="configuring-a-watchdog">Параметры сторожевого таймера</h4>

<h5 id="adding-a-watchdog-card-to-a-virtual-machine">Добавление карты сторожевого таймера в ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Добавление карты сторожевого таймера в ВМ.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.6.&nbsp;Добавление карты сторожевого таймера в ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong> чтобы открыть окно <strong>Изменить ВМ</strong>.</li>
  <li>Нажмите на кнопку <strong>Показать дополнительные параметры</strong> чтобы показать все вкладки, и перейдите на вкладку <strong>Высокая доступность</strong>.</li>
  <li>В выпадающем меню <strong>Модель сторожевого таймера</strong> выберите модель сторожевого таймера.</li>
  <li>В выпадающем меню <strong>Действие сторожевого таймера</strong> выберите действие. Это действие, которое должна выполнять машина при срабатывании сторожевого таймера.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы добавили карту сторожевого таймера в ВМ.</p>

<h5 id="installing-a-watchdog">Установка сторожевого таймера</h5>

<p><strong>Описание задачи</strong></p>

<p>Чтобы активировать карту сторожевого таймера, подключенную к ВМ, на этой машине необходимо установить пакет watchdog и запустить службу <code>watchdog</code>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.7.&nbsp;Установка watchdog</strong></p>

<ol>
  <li>Выполните вход на ВМ с подключенной картой сторожевого таймера.</li>
  <li>
    <p>Для установки пакета watchdog и его зависимостей выполните следующую команду:
    # yum install watchdog</p>
  </li>
  <li>
    <p>В файле <code>/etc/watchdog.conf</code> раскомментируйте следующую строку:
    watchdog-device = /dev/watchdog</p>
  </li>
  <li>Сохраните изменения.</li>
  <li>Запустите службу <code>watchdog</code> и сделайте её запускаемой при загрузке системы:
    # service watchdog start
    # chkconfig watchdog on</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы запустили и стартовали службу <code>watchdog</code> на виртуальной машине.</p>

<h5 id="confirming-watchdog-functionality">Подтверждение работоспособности сторожевого таймера</h5>

<p><strong>Описание задачи</strong></p>

<p>Подтверждение того, что карта сторожевого таймера была подключена к ВМ, и служба <code>watchdog</code> активна.</p>

<div class="alert alert-info">
  <p><strong>Предупреждение:</strong> данная процедура предназначена только для тестирования работоспособности сторожевого таймера и не должна выполняться на рабочих машинах.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;8.8.&nbsp;Подтверждение работоспособности сторожевого таймера</strong></p>

<ol>
  <li>Выполните вход на ВМ с подключенной картой сторожевого таймера.</li>
  <li>
    <p>Для проверки того, что карта  была идентифицирована виртуальной машиной, выполните следующую команду:
    # lspci | grep watchdog -i</p>
  </li>
  <li>Для проверки активности сторожевого таймера, выполните одну из следующих команд:
    <ul>
      <li>
        <p>Выполните следующую команду для срабатывания механизма kernel panic:
    # echo c &gt; /proc/sysrq-trigger</p>
      </li>
      <li>
        <p>Выполните следующую команду для прекращения работы службы <code>watchdog</code>:
    # kill -9 <code>pgrep watchdog</code></p>
      </li>
    </ul>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Отсчёт сторожевого таймера больше нельзя возобновить, поэтому за короткий период времени отсчёт достигает нуля. После этого выполняется действие, указанное в выпадающем меню <strong>Действие сторожевого таймера</strong> для этой ВМ.</p>

<h5 id="parameters-for-watchdogs-in-watchdogconf">Параметры сторожевых таймеров в watchdog.conf</h5>

<p>Ниже даётся список параметров настройки службы <code>watchdog</code>, доступных в файле <code>/etc/watchdog.conf</code>. Чтобы настроить параметр, необходимо убедиться, что он раскомментирован, и перезапустить службу <code>watchdog</code> после сохранения изменений в файле.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> более подробное объяснение параметров настройки службы <code>watchdog</code> и использования команды <code>watchdog</code>, см. <code>man watchdog</code>.</p>

</div>
<p><strong>Таблица&nbsp;8.13.&nbsp;переменные файла watchdog.conf</strong></p>

<table>
<colgroup>
<col width="40%">
<col width="20%">
<col width="40%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя переменной</p></th>
<th align="left"><p>Значение по умолчанию</p></th>
<th align="left"><p>Примечания</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>ping</code></p></td>
<td align="left"><p>Н/Д</p></td>
<td align="left"><p>Адрес IP, который будет пытаться пинговать сторожевой таймер для определения его доступности. Можно указать дополнительные адреса, добавить дополнительные строки с <code>ping</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>interface</code></p></td>
<td align="left"><p>Н/Д</p></td>
<td align="left"><p>Сетевой интерфейс, который будет контролировать сторожевой таймер для проверки присутствия сетевого трафика. Можно указать несколько интерфейсов, добавив строки с <code>interface</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>file</code></p></td>
<td align="left"><p><code>/var/log/messages</code></p></td>
<td align="left"><p>Файл в локальной системе, изменения в котором контролируются сторожевым таймером. Можно указать несколько файлов, добавив строки с <code>file</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>change</code></p></td>
<td align="left"><p><code>1407</code></p></td>
<td align="left"><p>Число интервалов сторожевого таймера, по истечении которых сторожевой таймер проверяет изменения в файлах. Строка <code>change</code> должна следовать непосредственно за каждой строкой <code>file</code>, и применяется к строке <code>file</code>, идущей непосредственно выше этой строки <code>change</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>max-load-1</code></p></td>
<td align="left"><p><code>24</code></p></td>
<td align="left"><p>Максимальная средняя загрузка, которую может выдержать ВМ в течении периода в одну минуту. При превышении этого среднего значения запускается механизм сторожевого таймера. Значение <code>0</code> отключает этот параметр.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>max-load-5</code></p></td>
<td align="left"><p><code>18</code></p></td>
<td align="left"><p>Максимальная средняя загрузка, которую может выдержать ВМ в течении периода в пять минут. При превышении этого среднего значения запускается механизм сторожевого таймера. Значение <code>0</code> отключает этот параметр. По умолчанию, значение этой переменной равно примерно трём четвертям значения <code>max-load-1</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>max-load-15</code></p></td>
<td align="left"><p><code>12</code></p></td>
<td align="left"><p>Максимальная средняя загрузка, которую может выдержать ВМ в течении периода в пятнадцать минут. При превышении этого среднего значения запускается механизм сторожевого таймера. Значение <code>0</code> отключает этот параметр. По умолчанию, значение этой переменной равно примерно половине значения <code>max-load-1</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>min-memory</code></p></td>
<td align="left"><p><code>1</code></p></td>
<td align="left"><p>Минимальный объём виртуальной памяти, который должен оставаться свободным на машине. Это значение измеряется в страницах. Значение <code>0</code> отключает этот параметр.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>repair-binary</code></p></td>
<td align="left"><p><code>/usr/sbin/repair</code></p></td>
<td align="left"><p>Путь и имя бинарного файла в локальной системе, который будет выполняться при запуске механизма сторожевого таймера. Если указанный файл исправляет проблему, не дающую перезапустить отсчёт сторожевого таймера, то действие сторожевого таймера не выполняется.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>test-binary</code></p></td>
<td align="left"><p>Н/Д</p></td>
<td align="left"><p>Путь и имя бинарного файла в локальной системе, который будет пытаться запускать сторожевой таймер во время каждого интервала. Переменная test binary даёт возможность указать файл для выполнения проверок, определённых пользователем.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>test-timeout</code></p></td>
<td align="left"><p>Н/Д</p></td>
<td align="left"><p>Временной лимит, в секундах, в течении которого могут выполняться проверки, определённые пользователем. Значение <code>0</code> даёт неограниченное время выполнения.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>temperature-device</code></p></td>
<td align="left"><p>Н/Д</p></td>
<td align="left"><p>Путь и имя устройства, проверяющего температуру машины, на которой выполняется служба <code>watchdog</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>max-temperature</code></p></td>
<td align="left"><p><code>120</code></p></td>
<td align="left"><p>Максимальная допустимая температура машины, на которой выполняется служба <code>watchdog</code>. При достижении этой температуры машина будет выключена. Преобразование единиц измерения не учитывается, поэтому здесь необходимо указывать значение, соответствующее используемой карте сторожевого таймера.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>admin</code></p></td>
<td align="left"><p><code>root</code></p></td>
<td align="left"><p>Почтовый адрес, на который посылаются уведомления.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>interval</code></p></td>
<td align="left"><p><code>10</code></p></td>
<td align="left"><p>Интервал в секундах между обновлениями информации на устройстве сторожевого таймера. Устройство сторожевого таймера ожидает обновлений информации минимум каждую минуту, и в случае отсутствия обновлений в течение периода в одну минуту, запускается сторожевой таймер. Данный интервал в одну минуту встроен в драйверы устройства сторожевого таймера, и его невозможно изменить.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>logtick</code></p></td>
<td align="left"><p><code>1</code></p></td>
<td align="left"><p>В случае включённого подробного журналирования службы <code>watchdog</code>, служба <code>watchdog</code> периодически записывает сообщения журнала в локальную систему. Значение <code>logtick</code> отображает число интервалов сторожевого таймера, после которого записывается сообщение журнала.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>realtime</code></p></td>
<td align="left"><p><code>yes</code></p></td>
<td align="left"><p>Указывает, заблокирован ли сторожевой таймер в памяти. Значение <code>yes</code> блокирует сторожевой таймер в памяти, так что он не выгружается из памяти, а значение <code>no</code> позволяет выгрузить сторожевой таймер из памяти. Если сторожевой таймер выгружен из памяти, и не будет загружен снова перед тем, как отсчёт достигнет нуля, то сторожевой таймер будет запущен.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>priority</code></p></td>
<td align="left"><p><code>1</code></p></td>
<td align="left"><p>Приоритет очереди, если значение <code>realtime</code> равно <code>yes</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>pidfile</code></p></td>
<td align="left"><p><code>/var/run/syslogd.pid</code></p></td>
<td align="left"><p>Путь и имя файла PID, который контролируется сторожевым таймером для получения информации о том, активен ли ещё соответствующий процесс. Если соответствующий процесс неактивен, то сторожевой таймер запускается.</p></td>
</tr>
</tbody>
</table>

<h3 id="editing-virtual-machines">Изменение виртуальных машин</h3>

<h4 id="editing-virtual-machine-properties">Изменение параметров виртуальных машин</h4>

<p><strong>Описание задачи</strong></p>

<p>Изменение параметров хранилища, ОС или сетевых параметров может негативно повлиять на виртуальную машину. Перед применением любых изменений проверьте корректность вносимых параметров. Перед внесением изменений виртуальные машины должны быть выключены. Далее объясняется, как изменять парметры виртуальных машин. Для изменения параметров изменяются виртуальные машины.</p>

<p>Следующие поля можно редактировать во время выполнения ВМ:</p>

<ul>
  <li><strong>Имя</strong></li>
  <li><strong>Описание</strong></li>
  <li><strong>Комментарий</strong></li>
  <li><strong>Защита от удаления</strong></li>
  <li><strong>Сетевые интерфейсы</strong></li>
  <li><strong>Использовать Cloud-Init/Sysprep</strong> (и его свойства)</li>
  <li><strong>Использовать пользовательское время простоя при миграции</strong></li>
  <li><strong>С высокой доступностью</strong></li>
  <li><strong>Приоритет очереди запуска/миграции</strong></li>
  <li><strong>Модель модуля наблюдения</strong></li>
  <li><strong>Действие модуля наблюдения</strong></li>
  <li><strong>Гарантированная физическая память</strong></li>
  <li><strong>Включено устройство памяти Balloon</strong></li>
  <li><strong>VirtIO-SCSI включено</strong></li>
  <li><strong>Первое устройство</strong></li>
  <li><strong>Второе устройство</strong></li>
  <li><strong>Присоединить CD</strong></li>
  <li><strong>путь к ядру</strong></li>
  <li><strong>путь к initrd</strong></li>
  <li><strong>параметры ядра</strong></li>
</ul>

<p>Для смены других параметров виртуальную машину необходимо выключить.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.9.&nbsp;Изменение параметров ВМ:</strong></p>

<ol>
  <li>Выберите ВМ для редактирования.</li>
  <li>Нажмите кнопку <strong>Изменить</strong> чтобы открыть окно <strong>Изменить ВМ</strong>.</li>
  <li>Внесите необходимые изменения в поля <strong>Общие</strong>, <strong>Система</strong>, <strong>Начальный запуск</strong>, <strong>Консоль</strong>, <strong>Хост</strong>, <strong>Высокая доступность</strong>, <strong>Распределение ресурсов</strong>, <strong>Параметры загрузки</strong> и <strong>Пользовательские параметры</strong>.</li>
  <li>Нажмите <strong>OK</strong> для сохранения изменений. Изменения будут применены после перезагрузки ВМ.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы сменили параметры ВМ путём её редактирования.</p>

<h4 id="network-interfaces">Сетевые интерфейсы</h4>

<h5 id="adding-and-editing-virtual-machine-network-interfaces">Добавление и изменение сетевых интерфейсов ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Виртуальным машинам можно добавлять сетевые интерфейсы. Это позволяет разместить ВМ в нескольких логических сетях. Также можно изменять параметры карты сетевого интерфейса машины. Это действие можно выполнять на выполняющихся ВМ, но некоторые действия можно выполнять только на отключенных машинах.</p>

<p><strong>Инструкция&nbsp;8.10.&nbsp;Добавление сетевых интерфейсов виртуальным машинам</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений чтобы увидеть список сетевых интерфейсов, связанных на данный момент с машиной.</li>
  <li>
    <p>Нажмите <strong>Добавить</strong> чтобы открыть окно <strong>Добавить сетевой интерфейс</strong>.
⁠</p>

    <p><img alt="New Network Interface window" title="Окно добавления сетевого интерфейса" src="./OVirt Administration Guide — oVirt_files/New_Network_Interface.png"></p>

    <p><strong>Рисунок&nbsp;8.5.&nbsp;Окно добавления сетевого интерфейса</strong></p>
  </li>
  <li>Введите <strong>Имя</strong> сетевого интерфейса.</li>
  <li>В выпадающих меню выберите <strong>Профиль</strong> и <strong>Тип</strong> для нового сетевого интерфейса. Значение параметра <strong>Статус канала</strong>, при настроенной и подключённой к сети NIC, по умолчанию установлено на <strong>Работает</strong>.
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> поля <strong>Профиль</strong> и <strong>Тип</strong> заполняются в соответствии с профилямии типами сетиЮ доступными на кластере, и сетевыми картами, доступными на ВМ.</p>

    </div>
  </li>
  <li>Отметьте галочкой параметр <strong>Настраиваемый MAC адрес</strong> и введите нужный MAC адрес для сетевого интерфейса.</li>
  <li>Нажмите <strong>OK</strong> чтобы закрыть окно <strong>Добавить сетевой интерфейс</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Сетевой интерфейс показывается в списке во вкладке <strong>Сетевые интерфейсы</strong> панели сведений ВМ.</p>

<h5 id="editing-a-network-interface">Изменение сетевого интерфейса</h5>

<p><strong>Описание задачи</strong></p>

<p>Ниже описывается изменение сетевого интерфейса. Чтобы изменить какие-либо сетевые параметры нужно изменить сетевой интерфейс.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.11.&nbsp;Изменение сетевого интерфейса</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> панели сведений и выберите сетевой интерфейс, который нужно изменить.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить сетевой интерфейс</strong>. Поля этого диалога совпадают с полями диалога <strong>Добавить сетевой интерфейс</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы изменили сетевой интерфейс, отредактировав его.</p>

<h5 id="removing-a-network-interface">Удаление сетевого интерфейса</h5>

<p><strong>Описание задачи</strong></p>

<p>Далее рассказывается, как удалить сетевой интерфейс.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.12.&nbsp;Удаление сетевого интерфейса</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> панели сведений и выберите сетевой интерфейс, который нужно удалить.</li>
  <li>Нажмите <strong>Удалить</strong> и нажмите <strong>OK</strong> для подтверждения.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили сетевой интерфейс виртуальной машины.</p>

<h5 id="explanation-of-settings-in-the-virtual-machine-network-interface-window">Объяснение параметров окна сетевого интерфейса виртуальной машины</h5>

<p>Приведённые ниже параметры применяются при добавлении или изменении сетевого интерфейса виртуальной мшаины. Если к машине присоединено более одного сетевого интерфейса, такую машину можно разместить в нескольких логических сетях.</p>

<p><strong>Таблица&nbsp;8.14.&nbsp;Пункты добавления сетевого интерфейса ВМ</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Имя сетевого интерфейса. Это текстовое поле имеет ограничение в 21 символ и должно содержать уникальное имя, составленное из любого сочетания строчных и прописных букв, цифр, тире и знаков подчёркивания.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Сеть</strong></p></td>
<td align="left"><p>Логическая сеть, в которой расположен данный сетевой интерфейс. По умолчанию, все сетевые интерфейсы размещаются в сети управления <strong>rhevm</strong>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Статус канала</strong></p></td>
<td align="left"><p>Подключён ли сетевой интерфейс к логической сети.</p>
<ul>
<li><strong>Работает</strong>: сетевой интерфейс располагается в своём слоте.
<ul>
<li>Если <strong>Статус карты</strong> показан как <strong>Подключен</strong>, это означает, что сетевой интерфейс подключен к сетевому кабелю и является активным.</li>
<li>Если <strong>Статус карты</strong> показан как <strong>Неподключен</strong>, это означает, что сетевой интерфейс будет автоматически подключен к сети и станет активным.</li>
</ul></li>
<li><strong>Отключен</strong>: сетевой интерфейс располагается в своём слоте, но не подключен ни к одной из сетей. С таким статусом виртуальные машины не будут работать.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Тип</strong></p></td>
<td align="left"><p>Виртуальный интерфейс, предоставляемый сетевым интерфейсом виртуальным машинам. VirtIO — более быстрый, но ему требуются драйверы VirtIO. В дистрибутивы Red Hat Enterprise Linux версии 5 и более поздних, драйверы VirtIO включены по умолчанию. В Windows драйверы VirtIO отсутствуют, но их можно установить с образа ISO с гостевыми утилитами или с виртуальной дискеты. Драйверы устройств rtl8139 и e1000 включены в большинство операционных систем.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Указать настраиваемый MAC адрес</strong></p></td>
<td align="left"><p>Выберите этот параметр чтобы указать пользовательский MAC адрес. Для идентификации сетевого интерфейса oVirt автоматически создаёт MAC адрес с уникальным значением в окружении. Два активных устройства с одинаковым MAC адресом в сети создают сетевые конфликты.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Зеркалирование портов</strong></p></td>
<td align="left"><p>Это функция безопасности, позволяющая копирование (зеркалирование) на сетевой интерфейс всего сетевого трафика, входящего или исходящего с ВМ в данной логической сети и для данного хоста. Если хост также использует эту сеть, то исходящий или входящий трафик хоста также копируется. Зеркалирование портов работает только в сетях с IP адресами IPv4.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Статус карты</strong></p></td>
<td align="left"><p>Определён ли сетевой интерфейс на ВМ.</p>
<ul>
<li><code>Подключен</code>: сетевой интерфейс был определён на ВМ.
<ul>
<li>Если <strong>Статус канала</strong> показан как <code>Работает</code>, это означает, что сетевой интерфейс подключен к сетевому кабелю и является активным.</li>
<li>Если <strong>Статус канала</strong> показан как <code>Отключен</code>, это означает, что сетевой интерфейс не подключен к сетевому кабелю.</li>
</ul></li>
<li><code>Неподключен</code>: сетевой интерфейс только определён в oVirt, и не связан ни с одной ВМ.
<ul>
<li>Если <strong>Статус канала</strong> показан как <code>Работает</code>, это означает, что когда сетевой интерфейс будет подключен, он автоматически присоединится к сети и станет активным.</li>
<li>Если <strong>Статус канала</strong> показан как <code>Отключен</code>, это означает, что сетевой интерфейс не подключен ни к одной из сетей пока  он не будет оределён на ВМ.</li>
</ul></li>
</ul></td>
</tr>
</tbody>
</table>

<h5 id="hot-plugging-network-interfaces">Горячее подключение сетевых интерфейсов</h5>

<p><strong>Описание задачи</strong></p>

<p>Для сетевых интерфейсов возможно горячее подключение. Горячее подключение означает, что включать и отключать сетевые интерфейсы можно во время работы ВМ.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.13.&nbsp;Горячее подключение сетевых интерфейсов</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений ВМ.</li>
  <li>Выберите сетевой интерфейс, который нужно подключить, и нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить сетевой интерфейс</strong>.</li>
  <li>Нажмите на стрелку <strong>Дополнительные параметры</strong> чтобы получить доступ к параметру <strong>Статус карты</strong>. Укажите <strong>Статус карты</strong> как <strong>Подключен</strong> чтобы включить сетевой интерфейс, или <strong>Неподключен</strong> чтобы отключить сетевой интерфейс.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы включили или отключили сетевой интерфейс.</p>

<h5 id="removing-network-interfaces-from-virtual-machines">Удаление сетевого интерфейса с виртуальной машины</h5>

<p><strong>Описание задачи</strong></p>

<p>Удаление сетевых интерфейсов виртуальных машин.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.14.&nbsp;Удаление сетевых интерфейсов виртуальных машин</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Сетевые интерфейсы</strong> на панели сведений ВМ.</li>
  <li>Выберите сетевой интерфейс, который нужно удалить.</li>
  <li>Нажмите на кнопку <strong>Удалить</strong> и затем нажмите <strong>OK</strong> для подвтерждения.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Сетевой интерфейс больше не присоединён к машине.</p>

<h4 id="virtual-disks">Виртуальные диски</h4>

<h5 id="adding-and-editing-virtual-machine-disks">Добавление и изменение дисков виртуальной машины</h5>

<p><strong>Описание задачи</strong></p>

<p>Виртуальной машине можно добавлять диски. Можно добавлять новые диски или ранее созданные плавающие диски. Это добавляет дисковое пространство и даёт возможность создавать общие диски для виртуальных машин. Также можно изменять некоторые свойства дисков.</p>

<p><strong>Внутренний</strong> диск — это тип диска по умолчанию. Также можно добавить <strong>Внешний(прямой Lun)</strong> диск. Создание внутреннего диска полностью контролируется oVirt; для внешних дисков необходимы подготовленные внешние, уже существующие, таргеты. Уже существующие диски это либо плавающие диски, либо диски, которые можно сделать общими, присоединённые к виртуальным машинам.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.15.&nbsp;Добавление дисков к виртуальным машинам</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Диски</strong> на панели сведений чтобы увидеть список виртуальных дисков, связанных на данный момент с машиной.</li>
  <li>
    <p>Нажмите <strong>Добавить</strong> чтобы открыть окно <strong>Добавить виртуальный диск</strong>.
⁠</p>

    <p><img alt="Add Virtual Disk Window" title="Окно добавления виртуального диска" src="./OVirt Administration Guide — oVirt_files/Add_Virtual_Disk.png"></p>

    <p><strong>Рисунок&nbsp;8.6.&nbsp;Окно добавления виртуального диска</strong></p>
  </li>
  <li>С помощью соответствующих кнопок переключитесь между <strong>Внутренними</strong> и <strong>Внешними (прямой Lun)</strong> дисками.</li>
  <li>Отметьте галочкой пункт <strong>Присоединить диск</strong> чтобы выбрать из списка существующий диск, и отметьте пункт <strong>Активировать</strong>. Или введите <strong>Размер</strong>, <strong>Псевдоним</strong> и <strong>Описание</strong> для нового диска, и с помощью выпадающих меню и флажков настройте параметры диска.</li>
  <li>Нажмите <strong>OK</strong> чтобы добавить диски и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Новый диск появляется во вкладке <strong>Виртуальные диски</strong> на панели сведений виртуальной машины.</p>

<h5 id="hot-plugging-virtual-machine-disks">Горячее подключение дисков ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Для дисков виртуальной машины доступно горячее подключение. Горячее подключение — это возможность включения или отключения устройств во время работы виртуальной машины.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.16.&nbsp;Горячее подключение дисков ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Диски</strong> на панели сведений ВМ.</li>
  <li>Выберите диск ВМ, для которого нужно выполнить горячее подключение.</li>
  <li>Нажмите кнопку <strong>Активировать</strong> или кнопку <strong>Отключить</strong> и нажмите <strong>OK</strong> при появлении соответствующего запроса.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы включили или отключили диск ВМ.</p>

<h5 id="removing-virtual-disks-from-virtual-machines">Удаление виртуальных дисков ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Виртуальные диски ВМ можно удалять.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.17.&nbsp;Удаление виртуальных дисков ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Диски</strong> на панели сведений ВМ.</li>
  <li>Выберите виртуальный диск, который нужно удалить.</li>
  <li>Нажмите кнопку <strong>Отключить</strong> и нажмите <strong>OK</strong> при появлении соответствующего запроса.</li>
  <li>Нажмите на кноопку <strong>Удалить</strong> и нажмите <strong>OK</strong> при появлении соответствующего запроса. Или выберите параметр <strong>Удалить окончательно</strong> чтобы безвозвратно удалить виртуальный диск из окружения. Если этот параметр не был выбран — например, если диск является общим — то виртуальный диск не будет удалён из списка в ресурсной вкладке <strong>Диски</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Диск больше не присоединён к ВМ.</p>

<h4 id="extending-the-size-of-an-online-virtual-disk">Увеличение размера сетевого виртуального диска</h4>

<p><strong>Описание задачи</strong></p>

<p>В данном разделе объясняется, как увеличить размер виртуального диска, если этот диск присоединён к виртуальной машине.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.18.&nbsp;Увеличение размера сетевого виртуального диска</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Диски</strong> на панели сведений ВМ.</li>
  <li>Выберите нужный диск из списка на панели сведений.</li>
  <li>Нажмите кнопку <strong>Изменить</strong> на панели сведений.</li>
  <li>Введите нужное значение в поле <code>Увеличить размер на (ГБ)</code>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Статус целевого диска меняется на <code>заблокирован</code>, на короткий переиод времени, пока меняется его размер. После окончания изменения размера, диск получает статус <code>OK</code>.</p>

<h4 id="floating-disks">Плавающие диски</h4>

<p>Плавающие диски — это диски, не связанные ни с какой виртуальной машиной.</p>

<p>Плавающие диски могут уменьшить объём времени, необходимого для настройки виртуальной машины. Назначение плавающего диска в качестве хранилища для ВМ отменяет необходимость ожидания выделения диска во время создания ВМ.</p>

<p>Плавающие диски можно присоединить к виртуальным машинам или сделать их общими дисками, которые можно использовать с одной или несколькими ВМ.</p>

<h4 id="associating-a-virtual-disk-with-a-virtual-machine">Привязка виртуального диска к виртуальной машине</h4>

<p><strong>Описание задачи</strong></p>

<p>В данном разделе объясняется, как связать виртуальный диск с виртуальной машиной. После того, как диск был привязан к машине, виртуальная машина получает возможность доступа к нему.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.19.&nbsp;Назначение виртуального диска виртуальной машине</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Диски</strong> на панели сведений ВМ.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong> в меню в верхней части панели сведений.</li>
  <li>Введите размер диска в ГБ в поле <strong>Размер (ГБ)</strong>.</li>
  <li>Введите псевдоним диска в поле <strong>Псевдоним</strong>.</li>
  <li>Нажмите <strong>OK</strong> в нижнем правом углу окна <strong>Добавить виртуальный диск</strong>. Диск, назначенный виртуальной машине, вскоре появится на панели сведений..</li>
</ol>

<p><strong>Результат</strong></p>

<p>Виртуальный диск был назначен виртуальной машине.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> во время присоединения или отсоединения дисков к/от виртуальной машины не происходит потребление ресурсов квоты.</p>

</div>
<div class="alert alert-info">
  <p><strong>Внимание:</strong> с помощью вышеописанных действий возможно назначить виртуальный диск более чем одной машине.</p>

</div>

<h4 id="changing-the-cd-for-a-virtual-machine">Смена CD виртуальной машины</h4>

<p><strong>Описание задачи</strong></p>

<p>Сменить доступный для машины диск CD возможно во время выполнения виртуальной машины.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> возможно использовать только те файлы ISO, которые был добавлены в ISO домен того кластера, членом которого является эта ВМ. Соответственно, загружать файлы образов ISO на этот домен необходимо до того, как эти файлы станут доступны для виртуальных машин.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;8.20.&nbsp;Смена CD виртуальной машины</strong></p>

<ol>
  <li>Во вкладке <strong>Витуальные машины</strong> выберите ВМ, выполняемую в данный момент.</li>
  <li>
    <p>Нажмите на кнопку <strong>Сменить CD</strong> чтобы открыть окно <strong>Сменить CD</strong>.
⁠</p>

    <p><img alt="The Change CD Window" title="Окно смены CD" src="./OVirt Administration Guide — oVirt_files/Navigation_Tabs_Change_CD.png"></p>

    <p><strong>Рисунок&nbsp;8.7.&nbsp;Окно смены CD</strong></p>
  </li>
  <li>В выпадающем меню:
    <ul>
      <li>Выберите пункт <code>[Извлечь]</code> для извлечения CD, в данный момент подключенного к виртуальной машине. Или </li>
      <li>Выберите из списка файл ISO, для извлечения CD, в данный момент подключенного к виртуальной машине, и смонтируйте этот файл образа ISO как CD.</li>
    </ul>
  </li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы извлекли CD, ранее доступный для виртуальной машины, или извлекли CD ранее доступный для виртуальной машины, и создали новый доступный CD.</p>

<h4 id="smart-card-authentication">Аутентификация с помощью смарт-карты</h4>

<p>Смарт карты — это внешняя аппаратная функция безопасности, наиболее часто встречающаяся в кредитных картах, но также  нередко используемая в бизнесе в виде токенов аутентификации. Смарт-карты можно использовать для защиты виртуальных машин oVirt.</p>

<h4 id="enabling-and-disabling-smart-cards">Включение и выключение смарт-карт</h4>

<p><strong>Описание задачи</strong></p>

<p>Далее описываются действия по включению и выключению функции смарт-карт в виртуальных машинах.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.21.&nbsp;Включение смарт-карт</strong></p>

<ol>
  <li>Убедитесь, что аппаратное оборудование смарт-карты подключено к клиентской машине и установлено согласно Действием производителя.</li>
  <li>Выберите нужную виртуальную машину.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong>. Появится окно <strong>Изменить ВМ</strong>.</li>
  <li>Перейдите на вкладку <strong>Консоль</strong> и отметьте галочкой пункт <strong>Смарт-карта включена</strong>, затем нажмите <strong>OK</strong>.</li>
  <li>Запустите ВМ, нажав на значок <strong>Консоль</strong> или через Пользовательский портал. Аутентификция смарт-карты передана от клиентской аппаратной части к виртуальной машине.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы включили аутентификацию с использованием смарт-карты в виртуальной машине.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> в случае неправильно установленного аппартного оборудования смарт-карты, включение функции смарт-карт в виртуальной машине может повлиять на корректность загрузки машины.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;8.22.&nbsp;Отключение смарт-карт</strong></p>

<ol>
  <li>Выберите нужную ВМ.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong>. Появится окно <strong>Изменить ВМ</strong>.</li>
  <li>Перейдите на вкладку <strong>Консоль</strong> и уберите галочку с пункта <strong>Смарт-карта включена</strong>, затем нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы отключили аутентификацию с использованием смарт-карты в виртуальной машине.</p>

<h3 id="running-virtual-machines">Запуск виртуальных машин</h3>

<h4 id="installing-console-components">Установка консольных компонентов</h4>

<h5 id="console-components">Консольные компоненты</h5>

<p>Консоль — это графическое окно, позволяющее видеть начальный экран, экран выключения и рабочий стол виртуальной машины, а также взаимодействовать с виртуальной машиной точно также, как и с физической. Приложением по умолчанию для открытия консоли виртуальной машины в oVirt является Удалённый просмотрщик, устанавливаемый на виртуальную машину до начала её использования</p>

<h5 id="installing-remote-viewer-on-linux">Установка удалённого просмотрщика в Linux</h5>

<p>Удалённый просмотрщик — это приложение, открывающее графическую консоль, подключённую к виртуальным машинам. Удалённый просмотрщик является клиентом SPICE и включён в пакет virt-viewer, предоставляемый каналом ПО <code>Red Hat Enterprise Linux Workstation (v. 6 for x86_64)</code>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.23.&nbsp;Установка удалённого просмотрщика в Linux</strong></p>

<ol>
  <li>
    <p>Установите пакет spice-xpi и его зависимости с помощью следующей команды:
    # yum install spice-xpi</p>
  </li>
  <li>
    <p>Проверьте, не установлен ли уже пакет <strong>virt-viewer</strong> в системе:
    # rpm -q virt-viewer
    virt-viewer-0.5.2-18.el6_4.2.x86_64</p>

    <p>Если пакет virt-viewer ещё не был установлен, выполните следующую команду для установки этого пакета и его зависимостей:</p>

<pre class="highlight plaintext"><code># yum install virt-viewer
</code></pre>
  </li>
  <li>
    <p>Перезапустите Firefox для применения изменений.</p>
  </li>
</ol>

<p>Модуль SPICE теперь установлен, и можно подключаться к виртуальным машинам, используя протокол SPICE.</p>

<h5 id="installing-remote-viewer-for-internet-explorer-on-windows">Установка удалённого просмотрщика для Internet Explorer в Windows</h5>

<p><strong>Описание задачи</strong></p>

<p>Компонент SPICE ActiveX требуется для запуска Удалённого просмотрщика, открывающего графическую консоль до виртуальных машин. Удалённый просмотрщик — это клиент SPICE, устанавливаемый вместе с компонентом SPICE ActiveX; оба они предоставляются файлом <code>SpiceX.cab</code>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.24.&nbsp;Установка удалённого просмотрщика для Internet Explorer в Windows</strong></p>

<ol>
  <li>Откройте Internet Explorer и авторизуйтесь на Пользовательском портале.</li>
  <li>Запустите ВМ и попробуйте подключиться к машине с помощью параметра консоли <strong>Расширение браузера</strong>.</li>
  <li>Назмите на предупреждающий баннер и далее, при появлении соответствующего запроса, нажмите <strong>Установить это расширение</strong>.</li>
  <li>Нажмите <strong>Установить</strong> при появлении соответствующего запроса.</li>
  <li>Перезапустите Internet Explorer для применения изменений.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы установили модуль SPICE и Удалённый просмотрщик, и мождет теперь подключаться к виртуальным машинам из браузера Internet Explorer с помощью протокола SPICE.</p>

<h5 id="installing-remote-viewer-on-windows">Установка удалённого просмотрщика на Windows</h5>

<p>Приложение <strong>Удалённый просмотрщик</strong> предоставляет пользователям графическую консоль для подключения к ВМ. После установки, консоль автоматически вызывается каждый раз, когда происходит попытка запустить сеанс SPICE на ВМ. Или консоль можно использовать как отдельное приложение.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.25.&nbsp;Установка удалённого просмотрщика на Windows</strong></p>

<ol>
  <li>Откройте веб-браузер и загрузите один из следующих установщиков, соответствующий архитектуре системы.
    <ul>
      <li>
        <p>Virt Viewer для 32-битной Windows:
    https://[адрес oVirt]/ovirt-engine/services/files/spice/virt-viewer-x86.msi</p>
      </li>
      <li>
        <p>Virt Viewer для 64-битной Windows:
    https://[адрес oVirt]/ovirt-engine/services/files/spice/virt-viewer-x64.msi</p>
      </li>
    </ul>
  </li>
  <li>Откройте папку с сохранённым файлом.</li>
  <li>Сделайте двойной щелчок по файлу.</li>
  <li>Нажмите <strong>Запустить</strong>, если показано предупреждение безопасности.</li>
  <li>Нажмите <strong>Да</strong>, если показано сообщение Контроля учётных записей.</li>
</ol>

<p><strong>Результат</strong></p>

<p><strong>Удалённый просмотрщик</strong> установлен и получить к нему доступ можно с помощью пункта <strong>Удалённый просмотрщик</strong> в папке <strong>VirtViewer</strong> подменю <strong>Все программы</strong> стартового меню.</p>

<h4 id="guest-drivers-and-agents">Гостевые драйверы и агенты</h4>

<h5 id="installing-guest-agents-and-drivers">Установка гостевых агентов и драйверов</h5>

<p>Гостевые агенты и драйверы, установленные на ВМ, предоставляют оптимизированную производительность и дополнительные возможности.</p>

<dl>
  <dt>
Установка агентов и драйверов на гостевых машинах с Red Hat Enterprise Linux
</dt>
  <dd>
    <p>Все драйверы включены в набор ПО, доступный в базовом канале для виртуальных машин Red Hat Enterprise Linux, зарегистрированных в Red Hat Network (RHN). Драйверы можно установить с помощью команды <code>yum install rhevm-guest-agent</code>. Чтобы установить драйверы, гостевая машина с  RHEL должна быть подписана на канал ПО <code>Red Hat Enterprise Virt Agent</code>. В Red Hat Enterprise Linux 5 этот канал имеет метку <code>rhel-x86_64-rhev-agent-5-server</code>. В Red Hat Enterprise Linux 6 канал имеет метку <code>rhel-x86_64-rhev-agent-6-server</code>.</p>
  </dd>
  <dt>
Установка агентов и драйверов на гостевых машинах с Windows
</dt>
  <dd>
    <p>Образ ISO с гостевыми утилитами называется <code>ovirt-guest-tools-iso.rpm</code>, файл RPM, установленный в oVirt. После установки oVirt, образ ISO с гостевыми утилитами можно найти по пути <code>/usr/share/rhev-guest-tools-iso/ovirt-tools-setup.iso</code>. При настройке oVirt, если было создано общее локальное хранилище для домена хранилища ISO, файл ISO автоматически копируется в домен хранилища ISO. В этом случае образ ISO автоматически присоединяется к гостевым Windows при их создании. В других случаях, для установки гостевых утилит и агентов, образ ISO необходимо вручную присоединить к гостевым Windows. Для установки обновлённых версий гостевых утилит и агентов, обновлённые версии файла ISO необходимо вручную присоединить к работающим ВМ с Windows. Если на виртуальных машинах включена служба APT, обновлённые файлы ISO будут присоединены автоматически.</p>
  </dd>
</dl>

<h5 id="automating-guest-additions-on-windows-guests-with-ovirt-application-provisioning-toolapt">Автоматизация гостевых дополнений на гостевых машинах с Windows с помощью oVirt Application Provisioning Tool(APT)</h5>

<p>oVirt Application Provisioning Tool (APT)  это служба Windows, которую можно установить на виртуальных машинах и под управлением ОС Windows и их шаблонах. Присоедините файл ISO с гостевыми утилитами к ВМ под управлением Windows, и <strong>ovirt-Application Provisioning.exe</strong> запустится автоматически для установки службы APT.</p>

<p>После установки службы APT на ВМ, производится автоматическое сканирование присоединённых файлов ISO. При распознавании службой допустимого образа с гостевыми утилитами oVirt, и никаких других гостевых утилит не установлено, служба APT устанавливает гостевые утилиты. Если гостевые утилиты уже установлены, и образ ISO содержит обновлённые версии, выполняется автоматическое обновление.</p>

<p>После успешной установки или обновления службой APT гостевых утилит на ВМ, машина автоматически перезагружается.</p>

<h5 id="ovirt-guest-drivers-and-guest-agents">Гостевые драйверы и гостевые агенты oVirt</h5>

<p>oVirt предоставляет настроенные драйверы и гостевые утилиты для использования на гостевых машинах с Windows и Red Hat Enterprise Linux. Драйверы дают возможность гостевым ОС использовать расширенные виртуальные устройства с улучшенной производительностью по сравнению с эмулированными устройствами; гостевые агенты облегчают обмен информацией между гостевой ОС и oVirt.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.15.&nbsp;Гостевые драйверы oVirt</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Драйвер</p></th>
<th align="left"><p>Описание</p></th>
<th align="left"><p>Работает на</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>virtio-net</code></p></td>
<td align="left"><p>Паравиртуализованный сетевой драйвер, предоставляющий расширенную производительность поверх эмулированных устройств, таких, как rtl.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>virtio-block</code></p></td>
<td align="left"><p>Паравиртуализованный драйвер HDD, предоставляющий улучшенную производительность ввода/вывода поверх эмулированных устройств, таких, как IDE, путём оптимизации координации и обмена информацией между гостем и гипервизором. Драйвер дополняет программную реализацию virtio-device, используемую хостом под видом аппаратного устройства.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>virtio-scsi</code></p></td>
<td align="left"><p>Паравиртуализованный драйвер iSCSI HDD, предоставляющий аналогичный функционал для устройства virtio-block, с некоторыми дополнительными улучшениями. В частности, этот драйвер поддерживает добавление сотен устройств, и именует устройства, используя стандартную SCSI-схему именования устройств.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>virtio-serial</code></p></td>
<td align="left"><p>Virtio-serial предоставляет поддержку для нескольких последовательных портов. Улучшенная производительность используется для быстрого обмена информацией между гостем и хостом, избегая сетевых ошибок. Эта скорость коммуникаций необходима гостевым агентам, а также и для других функций, таких, как копирование/вставка через буфер обмена между гостем и хостом, и журналирование.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>virtio-balloon</code></p></td>
<td align="left"><p>Virtio-balloon используется для контроля объёма памяти, к которому имеет фактический доступ гостевая система. Он предоставляет улучшения для превышенного выделения памяти. Драйверы balloon установлены для будущей совместимости, но по умолчанию не используются в oVirt версии 3.1 или более поздней.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>qxl</code></p></td>
<td align="left"><p>Паравиртуализованный драйвер монитора, уменьшающий использование ресурсов ЦП на хосте, и предоставляющий улучшенную производительность при уменьшенной пропускной способности на большинстве рабочих нагрузок.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
</tbody>
</table>

<p>⁠</p>

<p><strong>Таблица&nbsp;8.16.&nbsp;Гостевые агенты и утилиты oVirt</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Гостевой агент/утилита</p></th>
<th align="left"><p>Описание</p></th>
<th align="left"><p>Работает на</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>ovirt-guest-agent</code></p></td>
<td align="left"><p>Позволяет oVirt получать внутренние события и информацию о госте, такие, как IP адрес и установленные приложения. Также даёт возможность oVirt выполнять в гостевой ОС конкретные команды, такие, как shut down или reboot. На гостевых машинах с установленной Red Hat Enterprise Linux версии 6 и выше, ovirt-guest-agent устанавливается на ВМ <strong>настроенным</strong>, и производит настройку на использование машины с оптимизированным профилем virtualized-guest.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>spice-agent</code></p></td>
<td align="left"><p>Агент SPICE поддерживает несколько мониторов и отвечает за поддержку режима клиентской мыши для предоставления лучшего алгоритма взаимодействия с пользователем и улучшенной скорости реагирования, чем эмуляция QEMU. В режиме клиентской мыши удержание курсора не требуется. Агент SPICE уменьшает использование пропускной способности сети при работе в глобальной сети (WAN), снижая уровень отображения монитора, включая глубину цвета, отключение фонового изображения, сглаживания шрифтов и эффектов анимации. Агент SPICE включает поддержку буфера обмена, что позволяет выполнять операции копирования-вставки как для текста, так и для изображений между клиентом и гостем, а также автоматическую настройку монитора гостя в соответствии с параметрами на стороне гостя. На гостевых Windows агент SPICE состоит из vdservice и vdagent.</p></td>
<td align="left"><p>Сервер и рабочий стол.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>ovirt-sso</code></p></td>
<td align="left"><p>Агент, дающий пользователям возможность автоматического входа в систему на виртуальных машинах на основе их учётных данных в oVirt.</p></td>
<td align="left"><p>Рабочий стол.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>ovirt-usb</code></p></td>
<td align="left"><p>Компонент, содержащий драйверы и службы для поддержки устаревших версий USB (версия 3.0 и более ранние) на гостевых системах. Это необходимо для доступа к устройствам USB, подключенных к клиентской машине. На стороне клиента необходим <code>ovirt-USB Client</code>.</p></td>
<td align="left"><p>Рабочий стол.</p></td>
</tr>
</tbody>
</table>

<h4 id="accessing-virtual-machines">Доступ к виртуальным машинам</h4>

<h5 id="starting-a-virtual-machine">Запуск ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Виртуальную машину можно запустить через Портал администрирования.</p>

<p><strong>Инструкция&nbsp;8.26.&nbsp;Запуск ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ со статусом tab <code>Выключена</code>.</li>
  <li>Нажмите на кнопку <img alt="" title="Кнопка запуска" src="./OVirt Administration Guide — oVirt_files/VM_Powered_Up.png"> запуска. Или нажмите ПКМ на машине и выберите <strong>Запуск</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p><strong>Статус</strong> виртуальной машины сменяется на <code>Работает</code>, и показывается консольный протокол выбранной ВМ. Если на ВМ установлен гостевой агент, также показывается IP адрес этой ВМ.</p>

<h5 id="opening-a-console-to-a-virtual-machine">Запуск консоли для подключения к ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Запуск консоли для подключения к ВМ.</p>

<p><strong>Инструкция&nbsp;8.27.&nbsp;Вход в систему на ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>
    <p>Нажмите на кнопку консоли или сделайте щелчок ПКМ на ВМ и выберите <strong>Консоль</strong>.
⁠</p>

    <p><img alt="Connection Icon on the Virtual Machine Menu" title="Значок подключения в меню ВМ" src="./OVirt Administration Guide — oVirt_files/Console.png"></p>

    <p><strong>Рисунок&nbsp;8.8.&nbsp;Значок подключения в меню ВМ</strong></p>
  </li>
  <li>
    <ul>
      <li>При установленном Удалённом просмотрщике, окно консоли, подключённой к ВМ, будет открыто автоматически.</li>
    </ul>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы запустили консоль, подключённую к ВМ, из Портала администрирования.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> если Удалённый просмотрщик не установлен, будет выведено сообщение с предложением загрузить файл <code>console.vv</code>. Затем можно будет установить Удалённый просмотрщик и вручную открыть этот файл, или же использовать текстовый редактор и получить информацию о подключении, которая содержится в этом файле. Далее эта информация может быть использована для открытия консоли и подключения к ВМ с помощью клиента VNC.</p>

</div>

<h5 id="shutting-down-a-virtual-machine">Выключение виртуальной машины</h5>

<p><strong>Описание задачи</strong></p>

<p>Если на ВМ установлен гостевой агент, или ВМ поддерживает ACPI, эту машину можно выключать через Портал администрирования.</p>

<p><strong>Инструкция&nbsp;8.28.&nbsp;Завершение работы виртуальной машины</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите работающую ВМ.</li>
  <li>Нажмите на кнопку ( <img alt="" title="Завершить работу" src="./OVirt Administration Guide — oVirt_files/Down.png"> ) завершения работы. Или сделайте щелчок ПКМ по машине и выберите <strong>Завершить работу</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>ВМ была безопасно выключена, и <strong>Статус</strong> машины сменился на <code>Выключена</code>.</p>

<h5 id="pausing-a-virtual-machine">Приостановка работы ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Если на ВМ установлен гостевой агент, или ВМ поддерживает ACPI, приостановить работу этой машины можно через Портал администрирования. Это аналогично переводу машины в режим <em>Гибернации</em>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.29.&nbsp;Приостановка работы ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите работающую ВМ.</li>
  <li>Нажмите на кнопку «Заморозить» ( <img alt="" title="Заморозить" src="./OVirt Administration Guide — oVirt_files/Suspend.png"> ). Или нажмите ПКМ на машине и выберите <strong>Заморозить</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p><strong>Статус</strong> ВМ сменяется на <code>Приостановлено</code>.</p>

<h5 id="rebooting-a-virtual-machine">Перезагрузка виртуальной машины</h5>

<p><strong>Описание задачи</strong></p>

<p>Если на ВМ установлен гостевой агент, перезагрузить эту машину можно через Портал администрирования.</p>

<p><strong>Инструкция&nbsp;8.30.&nbsp;Перезагрузка виртуальной машины</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите работающую ВМ.</li>
  <li>Нажмите на кнопку ( <img alt="" title="Перезагрузка" src="./OVirt Administration Guide — oVirt_files/Reboot.png"> ). Или сделайте щелчок ПКМ по машине и выберите <strong>Перезагрузить</strong>.</li>
  <li>В подтверждающем окне <strong>Перезагрузить ВМ</strong> нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p><strong>Статус</strong> ВМ сменяется на <code>Идёт перезагрузка</code>, а затем на <code>Работает</code>.</p>

<h4 id="console-options">Параметры консоли</h4>

<h5 id="introduction-to-connection-protocols">Введение в протоколы связи</h5>

<p>Протоколы связи — это технологии, лежащие в основе принципа графических консолей для виртуальных машин, и позволяющие пользователям работать с виртуальными машинами точно также, как и с физическими. В настоящее время oVirt поддерживает следующие протоколы связи:</p>

<p>SPICE</p>

<p>Простой протокол для независимой вычислительной среды (Simple Protocol for Independent Computing Environments, SPICE) — это рекомендуемый протокол связи как для машин под управлением ОС Linux, так и для машин под управлением ОС Windows. SPICE устанавливается и работает на клиенте, который подключается к ВМ.</p>

<p>VNC</p>

<p>С помощью системы Virtual Network Computing (VNC) можно создавать консоли удалённого доступа как к машинам под управлением ОС Linux, так и к машинам под управлением ОС Windows. Чтобы создать консоль для подключения к ВМ с помощью VNC, нужно использовать удалённый просмотрщик или клиент VNC.</p>

<p>RDP</p>

<p>Протокол удалённого рабочего стола (Remote Desktop Protocol, RDP) можно использовать только для создания консолей для подключения к ВМ под управлением ОС Windows, и только для доступа с машины под управлением ОС Windows, на которой установлен удалённый рабочий стол. Кроме того, перед подключением к виртуальной машине Windows с помощью RDP, на ВМ необходимо настроить удалённое совместное пользование и настроить брандмауэр для разрешения удалённых подключений к рабочему столу.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> в настоящее время протокол SPICE не поддерживается для ВМ под управлением Windows 8. Если на ВМ под управлением Windows 8 настроить использование SPICE, то система обнаружит отсутствие необходимых драйверов SPICE и автоматически откатится на использование RDP.</p>

</div>

<h5 id="accessing-console-options">Параметры консольного доступа</h5>

<p>На Портале администрирования можно настроить несколько параметров для подключения графических консолей к виртуальным машинам, таких, например, как способ запуска, а также включение или отключение перенаправления USB.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.31.&nbsp;Параметры консольного доступа</strong></p>

<ol>
  <li>Выберите работающую ВМ.</li>
  <li>Нажмите ПКМ на машине и выберите пункт меню <strong>Параметры консоли</strong> чтобы открыть окно <strong>Параметры консоли</strong>.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> другие параметры, касающиеся каждого из протоколов связи, такие, например, как раскладка клавиатуры во время использования протокола связи  VNC, можно настроить во вкладке <strong>Консоль</strong> окна <strong>Параметры ВМ</strong>.</p>

</div>

<h5 id="spice-console-options">Параметры консоли SPICE</h5>

<p>При выборе протокола SPICE, в окне <strong>Параметры консоли</strong> доступны следующие параметры:</p>

<p><img alt="The Console Options window" title="Окно параметров консоли" src="./OVirt Administration Guide — oVirt_files/Console_Options.png"></p>

<p><strong>Рисунок&nbsp;8.9.&nbsp;Окно параметров консоли</strong></p>

<p><strong>Вызов консоли</strong></p>

<ul>
  <li><strong>Автоматически</strong>: oVirt автоматически выбирает метод вызова консоли.</li>
  <li><strong>Собственный клиент</strong>: во время подключения к консоли ВМ, диалог загрузки файла предоставляет файл, открывающий консоль до виртуальной машины с использованием удалённого просмотрщика.</li>
  <li><strong>Расширение браузера</strong>: подключение к консоли ВМ сразу происходит с использованием удалённого просмотрщика.</li>
  <li><strong>Браузерный клиент SPICE HTML5 (ознакомительная тех. версия)</strong>: во время подключения к консоли ВМ в браузере открывается новая вкладка, работающая как консоль.</li>
</ul>

<p><strong>Параметры SPICE</strong></p>

<ul>
  <li><strong>Привязать сочетание control-alt-del к ctrl+alt+end</strong>: отметьте галочкой этот параметр, чтобы привязать сочетание клавиш <strong>Ctrl</strong>+<strong>Alt</strong>+<strong>Del</strong> к <strong>Ctrl</strong>+<strong>Alt</strong>+<strong>End</strong> внутри виртуальной машины.</li>
  <li><strong>Включить автоматический общий доступ к USB</strong>: отметьте галочкой этот параметр, чтобы устройства USB автоматически перенаправлялись на виртуальную машину. Если этот параметр не выбран, устройства USB будут подключаться к клиентской машине вместо гостевой. Чтобы использовать устройства USB в гостевой машине, вручную отметьте этот параметр в меню клиента SPICE.</li>
  <li><strong>Открыть на полный экран</strong>: отметьте галочкой этот параметр чтобы при подключении консоль ВМ автоматически начинала работу в полноэкранном режиме. Для смены полноэкранного режима на обычный и обратно, нажимайте <strong>SHIFT</strong>+<strong>F11</strong>.</li>
  <li><strong>Включить прокси SPICE</strong>: отметьте галочкой этот параметр чтобы включить прокси-сервер SPICE.</li>
  <li><strong>Включить параметры WAN</strong>: отметьте галочкой этот параметр чтобы включить глубину цвета и эффекты WAN для консоли ВМ. Отметьте галочкой этот параметр только для ВМ с установленной Windows. Данная функция устанавливает параметры <em>WAN — отключить эффекты</em> и <em>WAN — глубина цвета</em>. Выбор пункта <strong>Включить параметры WAN</strong> устанавливает значение <em>WAN — отключить эффекты</em> на <em>анимацию</em> и устанавливает глубину цвета в 16 бит.</li>
</ul>

<div class="alert alert-info">
  <p><strong>Важно:</strong> параметр консоли <strong>Расширение браузера</strong> присутствует только если для доступа на Пользовательский и Административный порталы используется Internet Explorer. Эти консольные параметры используют версию удалённого просмотрщика, предоставляемую программой установки <code>SpiceX.cab</code>. Для всех других браузеров по умолчанию используется параметр консоли <strong>Собственный клиент</strong>. Этот параметр консоли использует версию удалённого просмотрщика, предоставляемую установочными файлами <code>virt-viewer-x86.msi</code> и <code>virt-viewer-x64.msi</code>.</p>

</div>

<h5 id="vnc-console-options">Консольные параметры VNC</h5>

<p>При выборе протокола связи VNC, в окне <strong>Параметры консоли</strong> доступны следующие возможности:</p>

<p><strong>Вызов консоли</strong></p>

<ul>
  <li><strong>Собственный клиент</strong>: во время подключения к консоли ВМ, диалог загрузки файла предоставляет файл, открывающий консоль до виртуальной машины с использованием удалённого просмотрщика.</li>
  <li><strong>NoVNC</strong>: во время подключения к консоли ВМ в браузере открывается новая вкладка, работающая как консоль.</li>
</ul>

<p><strong>Параметры VNC</strong></p>

<ul>
  <li><strong>Привязать сочетание control-alt-del к ctrl+alt+end</strong>: отметьте галочкой этот параметр, чтобы привязать сочетание клавиш <strong>Ctrl</strong>+<strong>Alt</strong>+<strong>Del</strong> к <strong>Ctrl</strong>+<strong>Alt</strong>+<strong>End</strong> внутри виртуальной машины.</li>
</ul>

<h5 id="rdp-console-options">Консольные параметры RDP</h5>

<p>При выборе протокола связи RDP, в окне <strong>Параметры консоли</strong> доступны следующие возможности:</p>

<p><strong>Вызов консоли</strong></p>

<ul>
  <li><strong>Автоматически</strong>: oVirt автоматически выбирает этот метод вызова консоли.</li>
  <li><strong>Собственный клиент</strong>: во время подключения к консоли ВМ, диалог загрузки файла предоставляет файл, открывающий консоль до виртуальной машины с использованием удалённого просмотрщика.</li>
</ul>

<p><strong>Параметры RDP</strong></p>

<ul>
  <li><strong>Использовать локальные приводы</strong>: отметьте галочкой этот параметр, чтобы приводы клиентской машины были доступны на гостевой ВМ.</li>
</ul>

<h4 id="remote-viewer-options">Параметры удалённого просмотрщика</h4>

<h5 id="remote-viewer-options-1">Параметры удалённого просмотрщика</h5>

<p>При выборе параметров вызова консоли <strong>Собственный клиент</strong> или <strong>Расширение браузера</strong>, подключение к виртуальной машине будет осуществляться с помощью удалённого просмотрщика. Окно Удалённого просмотрщика предоставляет несколько параметров для взаимодействия с ВМ, к которой он подключен.⁠</p>

<p><strong>Таблица&nbsp;8.17.&nbsp;Параметры удалённого просмотрщика</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Параметр</p></th>
<th align="left"><p>Горячая клавиша</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Файл</p></td>
<td align="left"><ul>
<li><strong>Снимок экрана</strong>: делает снимок экрана активного окна и сохраняет в указанное местоположение.</li>
<li><strong>Выбор устройства USB</strong>: если на виртуальной машине было активировано перенаправление USB, из этого меню можно получить доступ к устройству USB, подключенному к клиентской машине.</li>
<li><strong>Выход</strong>: закрывает консоль. Горячие клавиши для этого действия: <strong>Shift</strong>+<strong>Ctrl</strong>+<strong>Q</strong>.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>Просмотр</p></td>
<td align="left"><ul>
<li><strong>Полный экран</strong>: включение/отключение полноэкранного режима. При включении, экран виртуальной машины заполняет весь экран. При отключении — ВМ показывается в окне. Горячие клавиши для этого действия: <strong>SHIFT</strong>+<strong>F11</strong>.</li>
<li><strong>Масштаб</strong>: увеличивает или уменьшает масштаб консольного окна. <strong>Ctrl</strong>+<strong>+</strong> увеличивает, <strong>Ctrl</strong>+<strong>-</strong> уменьшает, а <strong>Ctrl</strong>+<strong>0</strong> возвращает исходный размер экрана.</li>
<li><strong>Изменять размер автоматически</strong>: отметьте галочкой этот пункт чтобы разрешение экрана гостевой системы изменялось автоматически в соответствии с размером окна консоли.</li>
<li><strong>Мониторы</strong>: даёт возможность пользователям включать/отключать мониторы для гостевой ВМ.</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p>Послать сочетание клавиш</p></td>
<td align="left"><ul>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>Del</strong>: на виртуальной машине с установленной ОС Red Hat Enterprise Linux будет показан диалог с возможностями заморозить, выключить или перезапустить ВМ. На ВМ с установленной Windows будет вызван менеджер задач или диалог безопасности Windows.</li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>Backspace</strong>: на виртуальной машине с установленной ОС Red Hat Enterprise Linux будет перезапущен сервер графической системы X. Для ВМ с установленной Windows действий нет.</li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F1</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F2</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F3</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F4</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F5</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F6</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F7</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F8</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F9</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F10</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F11</strong></li>
<li><strong>Ctrl</strong>+<strong>Alt</strong>+<strong>F12</strong></li>
<li><strong>Printscreen</strong>: передаёт клавиатурный параметр <strong>Printscreen</strong> виртуальной машине.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>Справка</p></td>
<td align="left"><p>Пункт <strong>О программе</strong> показывает версию используемого просмотрщика виртуальных машин.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Освободить курсор</p></td>
<td align="left"><p><strong>SHIFT</strong>+<strong>F12</strong></p></td>
</tr>
</tbody>
</table>

<h5 id="remote-viewer-hotkeys">Горячие клавиши удалённого просмотрщика</h5>

<p>Доступ к горячим клавишам ВМ присутствует как в полноэкранном, так и в оконном режиме. Чтобы вызвать меню с кнопкой горячих клавиш в полноэкранном режиме, передвиньте курсор на середину верхней части экрана. В оконном режиме используйте меню <strong>Послать сочетание клавиш</strong> на панели заголовка виртуальной машины.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> если на клиентской машине не запущен <strong>vdagent</strong>, и ВМ работает в оконном режиме, то окно ВМ может захватить курсор мыши. Чтобы освободить курсор, нажмите <strong>Shift</strong>+<strong>F12</strong>.</p>

</div>

<h3 id="removing-virtual-machines">Удаление виртуальных машин</h3>

<h4 id="removing-a-virtual-machine">Удаление виртуальных машин</h4>

<p><strong>Описание задачи</strong></p>

<p>Удаление виртуальной машины из окружения oVirt.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> во время выполнения ВМ, кнопка <strong>Удалить</strong> неактивна; чтобы получить возможность удалить ВМ, её нужно сначала выключить.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;8.32.&nbsp;Удаление виртуальной машины</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ для удаления.</li>
  <li>Нажмите <strong>Удалить</strong> чтобы открыть окно <strong>Удалить ВМ</strong>.</li>
  <li>При необходимости также отметьте галочкой пункт <strong>Удалить диск(и)</strong> чтобы вместе с машиной удалить также и подключённые к ней виртуальные диски. Если пункт <strong>Удалить диск(и)</strong> не отмечен, виртуальные диски останутся в среде в качестве плавающих дисков.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Виртуальная машина была удалена из среды и отсутствует в списке машин в ресурсной вкладке <strong>Виртуальные машины</strong>. При отмеченном пункте <strong>Удалить диск(и)</strong> также удаляются и виртуальные диски, подключенные к ВМ.</p>

<h3 id="snapshots">⁠Снимки</h3>

<h4 id="creating-a-snapshot-of-a-virtual-machine">Создание снимка виртуальной машины</h4>

<p><strong>Описание задачи</strong></p>

<p>Снимок — это представление операционной системы и приложений ВМ на любом или на всех доступных дисках в заданной точке времени. Перед тем, как вносить изменения в параметры ВМ, которые могут привести к непредвиденным последствиям, сделайте снимок этой машины. С помощью снимка машину можно будет вернуть в предыдущее состояние.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> динамические снимки можно создавать только для машин, работающих в дата-центрах, совместимых с версией oVirt 3.1 или более поздней. ВМ, работающие в дата-центрах, совместимых с версией 3.0 или более ранней, должны быть выключены перед созданием снимка.</p>

</div>
<p><strong>Инструкция&nbsp;8.33.&nbsp;Создание снимка виртуальной машины</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>
    <p>Нажмите <strong>Создать снимок</strong> чтобы открыть окно <strong>Создать снимок</strong>.
⁠</p>

    <p><img alt="Create snapshot" title="Создать снимок" src="./OVirt Administration Guide — oVirt_files/Create_Snapshot.png"></p>

    <p><strong>Рисунок&nbsp;8.10.&nbsp;Создать снимок</strong></p>
  </li>
  <li>Введите описание снимка.</li>
  <li>Отметьте галочками нужные диски в списке <strong>Включая диски:</strong>.</li>
  <li>Отметьте галочкой параметр <strong>Сохранить память</strong>, чтобы указать, нужно ли включать память машины в снимок.</li>
  <li>Нажмите <strong>OK</strong> чтобы создать снимок и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Операционная система и приложения ВМ на выбранных дисках сохранены в снимке, который можно предварительно просмотреть или сохранить. Снимок создаётся со статусом <code>Заблокирован</code>, который затем сменяется на <code>Ok</code>. При щелчке на снимке, сведения о нём показываются во вкладках <strong>Общие</strong>, <strong>Диски</strong>, <strong>Сетевые интерфейсы</strong> и <strong>Установленные приложения</strong> в правой боковой области панели сведений.</p>

<h4 id="using-a-snapshot-to-restore-a-virtual-machine">Использование снимка для восстановления ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>Снимок может быть использован для восстановления предыдущего состояния виртуальной машины.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.34.&nbsp;Использование снимка для восстановления ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Снимки</strong> на панели сведений чтобы увидеть список доступных снимков.</li>
  <li>В левой боковой панели выберите снимок для восстановления. Сведения о снимке показываются на правой боковой панели.</li>
  <li>Нажмите на выпадающий список рядом с кнопкой <strong>Предварительный просмотр</strong> чтобы открыть окно <strong>Настраиваемый предварительный просмотр снимка</strong>.</li>
  <li>Отметьте галочками <strong>Параметры ВМ</strong>, <strong>Память</strong> и диски, которые нужно восстановить, затем нажмите <strong>OK</strong>. Это даёт возможность создать настраиваемый снимок для восстановления, используя параметры и диски из нескольких снимков. Статус снимка сменяется на <code>Режим предварительного просмотра</code>. Статус ВМ на короткое время сменяется на <code>Образ заблокирован</code> перед тем, как снова смениться на <code>Выключена</code>.</li>
  <li>Запустите ВМ; она выполняется с использованием образа диска из снимка.</li>
  <li>Нажмите <strong>Зафиксировать</strong> чтобы закрепить восстановление ВМ до состояния снимка. Любые последующие снимки удаляются. Или нажмите на кнопку <strong>Отменить</strong> чтобы деактивировать снимок и вернуть ВМ в предыдущее состояние.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Статус виртуальной машины восстановлен до статуса того момента, когда был сделан снимок, или возвращён до статуса, который машина имела перед предварительным просмотром снимка.</p>

<h4 id="creating-a-virtual-machine-from-a-snapshot">Создание ВМ из снимка</h4>

<p><strong>Описание задачи</strong></p>

<p>Мы создали снимок из виртуальной машины. Теперь можно использовать этот снимок для создания другой ВМ.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.35.&nbsp;Создание ВМ из снимка</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Снимки</strong> на панели сведений чтобы увидеть список доступных снимков.</li>
  <li>Выберите в списке снимок и нажмите <strong>Клонировать</strong> чтобы открыть окно <strong>Клонировать ВМ из снимка</strong>.</li>
  <li>
    <p>Введите <strong>Имя</strong> и <strong>Описание</strong> создаваемой ВМ.
⁠</p>

    <p><img alt="Clone a Virtual Machine from a Snapshot" title="Клонирование ВМ из снимка" src="./OVirt Administration Guide — oVirt_files/Clone_VM_Snapshot.png"></p>

    <p><strong>Рисунок&nbsp;8.11.&nbsp;Клонирование ВМ из снимка</strong></p>
  </li>
  <li>Нажмите <strong>OK</strong> чтоб создать ВМ и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Через некоторое время клонированная ВМ появляется во вкладке <strong>Виртуальные машины</strong> на панели навигации. Клонированная ВМ появляется со статусом <code>Образ заблокирован</code>. Виртуальная машина будет оставаться в этом статусе до тех пор, пока oVirt не завершит создание ВМ. Виртуальная машина с выделенными 20ГБ дискового пространства создаётся в течении примерно 15 минут. Виртуальные диски с разрежённым выделением создаются быстрее, чем предварительно выделенные диски.</p>

<p>Когда виртуальная машина готова к использованию, её статус сменяется с <code>Образ заблокирован</code> на <code>Отключена</code>, во вкладке  <strong>Виртуальные машины</strong> на панели навигации.</p>

<h4 id="deleting-a-snapshot">Удаление снимка</h4>

<p><strong>Описание задачи</strong></p>

<p>Окончательное удаление снимка из виртуализированного окружения.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.36.&nbsp;Удаление снимка</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>
    <p>Перейдите на вкладку <strong>Снимки</strong> на панели сведений чтобы увидеть список доступных снимков.
⁠</p>

    <p><img alt="Snapshot List" title="Список снимков" src="./OVirt Administration Guide — oVirt_files/Snapshot_List.png"></p>

    <p><strong>Рисунок&nbsp;8.12.&nbsp;Список снимков</strong></p>
  </li>
  <li>Выберите снимок для удаления.</li>
  <li>На панели навигации выключите работающие ВМ, связанные с удаляемым снимком.</li>
  <li>Нажмите <strong>Удалить</strong> чтобы открыть подтверждающее окно <strong>Удалить снимок</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы удалить снимок и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили снимок виртуальной машины. Удаление снимка не отражается на виртуальной машине.</p>

<h3 id="affinity-groups">⁠Группы схожести (affinity)</h3>

<h4 id="introduction-to-virtual-machine-affinity">Введение в понятие схожести для ВМ</h4>

<p>Схожесть (affinity) виртуальных машин даёт возможность определить наборы правил, определяющих, будут ли конкретные ВМ выполняться вместе на одном хосте или отдельно на различных хостах. Это позволяет создавать продвинутые сценарии рабочей нагрузки, например, отвечающие строгим условиям соблюдения лицензионных соглашений или условиям рабочей нагрузки, требующей высокой доступности.</p>

<p>Схожесть виртуальных машин применяется к машинам при помощи добавления машин в одну или более групп схожести. Группа схожести — это группа из двух или более виртуальных машин, к которым применяется набор идентичных параметров и условий. Эти параметры могут иметь положительную схожесть (работа вместе), обеспечивающую виртуальным машинам, состоящим в группе схожести, выполнение на одном и том же хосте, и отрицательную схожесть (работа отдельно друг от друга) обеспечивающую виртуальным машинам, состоящим в группе схожести, выполнение на разных хостах.</p>

<p>Далее к этим параметрам может применяться дополнительный набор условий. К примеру, жёсткое принудительное применение условий схожести, обеспечивающее работу ВМ в группе схожести на одном хосте независимо от внешних условий, или мягкое принудительное применение, что является признаком, указывающим на то, что машины в группе схожести, при наличии возможности, предпочтительно работают либо на одном хосте либо на разных.</p>

<p>Комбинация группы схожести вместе с её параметрами и условиями называется «политикой схожести».</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> группы схожести применяются к виртуальным машинам на уровне кластера. При перемещении виртуальной машины из одного кластера в другой, эта машина удаляется из всех групп схожести на исходном кластере.</p>

</div>
<div class="alert alert-info">
  <p><strong>Важно:</strong> группы схожести вступают в силу только тогда, когда в политике кластера, применяющейся на кластерах, где определены группы схожести, включен модуль фильтра <code>VmAffinityGroups</code> или модуль весовых коэффициентов. Модуль фильтра <code>VmAffinityGroups</code> используется для реализации жёсткого принудительного применения условий схожести, а модуль весовых коэффициентов <code>VmAffinityGroups</code> используется для реализации мягкого принудительного применения.</p>

</div>

<h4 id="creating-an-affinity-group">Создание групп схожести</h4>

<p><strong>Описание задачи</strong></p>

<p>Создать новые группы схожести для применения политик схожести к виртуальным машинам.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.37.&nbsp;Создание групп схожести</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Группы схожести</strong> на панели сведений.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong> чтобы открыть окно <strong>Добавить группу схожести</strong>.</li>
  <li>Введите имя и описание для группы схожести в текстовых полях <strong>Имя</strong> и <strong>Описание</strong>.</li>
  <li>Отметьте галочкой пункт <strong>Положительная</strong>, чтобы применить положительную схожесть, или убедитесь, что этот параметр не отмечен, для применения отрицательной схожести.</li>
  <li>Отметьте галочкой пункт <strong>Принудительно</strong>, чтобы применить жёсткое принуждение, или убедитесь, что этот параметр не отмечен, чтобы применить мягкое принуждение.</li>
  <li>В выпадающем меню выберите ВМ, которые нужно добавить в группу схожести. Используйте кнопки <strong>+</strong> и <strong>-</strong> для добавления/удаления машин из групп.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали группу схожести виртуальных машин и указали параметры и условия, которые должны применяться к машинам-участникам этой группы.</p>

<h4 id="editing-an-affinity-group">Изменение групп схожести</h4>

<p><strong>Описание задачи</strong></p>

<p>Изменение параметров существующих групп схожести.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.38.&nbsp;Изменение групп схожести</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Группы схожести</strong> на панели сведений.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong> чтобы открыть окно <strong>Параметры группы схожести</strong>.</li>
  <li>Отметьте флажками предпочитаемые значения в пунктах <strong>Положительная</strong> и <strong>Принудительно</strong>, и с помощью кнопок <strong>+</strong> и <strong>-</strong> добавьте машины или удалите машины из группы схожести.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы изменили группу схожести.</p>

<h4 id="removing-an-affinity-group">Удаление групп схожести</h4>

<p><strong>Описание задачи</strong></p>

<p>Удаление группы схожести.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.39.&nbsp;Удаление группы схожести</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Перейдите на вкладку <strong>Группы схожести</strong> на панели сведений.</li>
  <li>Нажмите на кнопку <strong>Удалить</strong> и нажмите <strong>OK</strong> в окне подтверждения чтобы удалить группу схожести.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили группу схожести, и политика схожести, которая применялась к ВМ-участникам этой группы, больше к ним не применяется.</p>

<h3 id="importing-and-exporting-virtual-machines">⁠Импорт и экспорт виртуальных машин</h3>

<h4 id="exporting-and-importing-virtual-machines-and-templates">Импорт и экспорт виртуальных машин и шаблонов</h4>

<p>Виртуальные машины и шаблоны можно экспортировать из дата-центров и импортировать в дата-центры того же или другого окружения oVirt. oVirt предоставляет возможность импорта и экспорта ВМ (и шаблонов) в формате Open Virtual Machine (OVF).</p>

<p>Процесс импорта и экспорта ВМ и шаблонов состоит из трёх частей:</p>

<ol>
  <li>Экспорт ВМ или шаблона в домен экспорта.</li>
  <li>Отсоединение домена экспорта от одного дата-центра и присоединение его к другому дата-центру. Присоединить домен можно или к другому дата-центру в том же окружении oVirt, или к дата-центру в отдельном окружении oVirt под управлением другого установленного экземпляра oVirt.</li>
  <li>Импорт виртуальной машины или шаблона в дата-центр, к которому был присоединён домен экспорта.</li>
</ol>

<p>Перед перемещением между дата-центрами, виртуальная машина должна быть остановлена. Если ВМ была создана на основе шаблона, то, для возможности работы этой машины, шаблон должен существовать в целевом дата-центре, или же машина должна быть экспортирована с выбранным параметром <strong>Свернуть снимки</strong>.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> во время экспорта или импорта ВМ или шаблона, свойства этой машины или шаблона сохраняются, включая такие базовые параметры, как имя и описание, выделение ресурсов и параметры высокой доступности.</p>

</div>

<h4 id="overview-of-the-export-and-import-process">Обзор процессов экспорта и импорта</h4>

<p>Домен экспорта даёт возможность перемещать ВМ и шаблоны между окружениями oVirt.</p>

<p>Для возможности экспорта или импорта ВМ и шаблонов, к дата-центру, содержащему ВМ или шаблон, предназначенные для экспорта/импорта, должен быть присоединён активный домен экспорта. Домен экспорта играет роль временной области хранения, с отдельным каталогом для каждой экспортируемой ВМ или шаблона. В одном каталоге находятся файлы машины или шаблона в формате OVF (Open Virtualization Format). В другом каталоге — образ или образы диска машины или шаблона.</p>

<p>Также существует возможность импорта ВМ, созданных другими поставщиками виртуализации, например, Xen, VMware или виртуальные машины Windows, с помощью функционала V2V (Virtual to virtual). V2V конвертирует виртуальные машины и помещает их в домен экспорта.</p>

<p>Подробную информацию о V2V см. в <em>Руководстве по Red Hat Enterprise Linux V2V</em>.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> только один домен экспорта может быть активным в одном дата-центре в заданный момент времени. Это означает, что домен экспорта должен быть присоединён либо к исходному дата-центру либо к целевому.</p>

</div>
<p>Процесс экспорта ВМ и шаблонов из одного дата-центра в другой дата-центр требует некоторых приготовлений. Убедитесь, что:</p>

<ul>
  <li>Домен экспорта существует и присоединён к исходному дата-центру.</li>
  <li>Виртуальная машина выключена.</li>
  <li>Если ВМ была создана на базе шаблона, то этот шаблон должен находиться в целевом дата-центре или быть экспортирован вместе с ВМ.</li>
</ul>

<p>После экспорта ВМ или шаблона в домен экспорта, эту ВМ или шаблон можно импортировать в целевой дата-центр. Если целевой дата-центр находится в том же окружении oVirt, что и исходный дата-центр, удалите первоначальную ВМ или шаблон из исходного дата-центра после завершения операции экспорта.</p>

<h4 id="graphical-overview-for-exporting-and-importing-virtual-machines-and-templates">Графический обзор процессов экспорта и импорта виртуальных машин и шаблонов</h4>

<p><strong>Описание задачи</strong></p>

<p>В данном разделе представлен графический обзор этапов, необходимых для экспорта ВМ или шаблона из одного дата-центра, и импорта этой ВМ или шаблона в другой дата-центр.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.40.&nbsp;Экспорт и импорт виртуальных машин и шбалонов</strong></p>

<ol>
  <li>
    <p>Присоедините домен экспорта к исходному дата-центру.
⁠</p>

    <p><img alt="Attach Export Domain" title="Присоединение домена экспорта" src="./OVirt Administration Guide — oVirt_files/Export1.png"></p>

    <p><strong>Рисунок&nbsp;8.13.&nbsp;Присоединение домена экспорта</strong></p>
  </li>
  <li>
    <p>Экспорт ВМ или шаблона в домен экспорта.
⁠</p>

    <p><img alt="Export the Virtual Resource" title="Экспорт виртуального ресурса" src="./OVirt Administration Guide — oVirt_files/Export2.png"></p>

    <p><strong>Рисунок&nbsp;8.14.&nbsp;Экспорт виртуального ресурса</strong></p>
  </li>
  <li>
    <p>Отсоединение домена экспорта от исходного дата-центра.
⁠</p>

    <p><img alt="Detach Export Domain" title="Отсоединение домена экспорта" src="./OVirt Administration Guide — oVirt_files/Export3.png"></p>

    <p><strong>Рисунок&nbsp;8.15.&nbsp;Отсоединение домена экспорта</strong></p>
  </li>
  <li>
    <p>Присоединение домена экспорта к целевому дата-центру.
⁠</p>

    <p><img alt="Attach the Export Domain" title="Присоединение домена экспорта" src="./OVirt Administration Guide — oVirt_files/Export4.png"></p>

    <p><strong>Рисунок&nbsp;8.16.&nbsp;Присоединение домена экспорта</strong></p>
  </li>
  <li>
    <p>Импорт ВМ или шаблона в целевой дата-центр.
⁠</p>

    <p><img alt="Import the virtual resource" title="Импорт виртуального ресурса" src="./OVirt Administration Guide — oVirt_files/Export5.png"></p>

    <p><strong>Рисунок&nbsp;8.17.&nbsp;Импорт виртуального ресурса</strong></p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Виртуальная машина или шаблон перенесены в целевой дата-центр.</p>

<h4 id="exporting-a-virtual-machine-to-the-export-domain">Экспорт ВМ в домен экспорта</h4>

<p><strong>Описание задачи</strong></p>

<p>Эспорт ВМ в домен экспорта для дальнейшего её импорта в другой дата-центр. Перед началом операции домен экспорта должен быть прикреплён к дата-центру, содержащему виртуальную машину, предназначенную для экспорта.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.41.&nbsp;Экспорт ВМ в домен экспорта</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите <strong>Экспорт</strong> чтобы открыть окно <strong>Экспорт ВМ</strong> window.</li>
  <li>Отметьте галочкой пункт <strong>Принудительно заменить</strong> чтобы переопределить образы машины, существующие в домене экспорта. Отметьте пункт <strong>Свернуть снимки</strong> чтобы создать отдельный том экспорта для каждого отдельного диcка. При выборе этого параметра будут удалены точки восстановления снимка, а шаблон будет включен в виртуальную машину, созданную на базе шаблона, что удаляет зависимость ВМ от шаблона.</li>
  <li>Нажмите <strong>OK</strong> чтобы экспортировать ВМ и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Начинается процесс экспорта ВМ. ВМ показыается в списке машин и имеет статус <code>Образ заблокирован</code>, т.к. идёт её экспорт. Этот процесс может занять до часа времени, в зависимости от размеров образов жёстких дисков машины и аппаратных возможностей хранилища. Для просмотре хода выполнения экспорта перейдите на вкладку <strong>События</strong>.</p>

<p>После завершения процесса, виртуальная машина экспортируется в домен экспорта и появляется во вкладке <strong>Импорт ВМ</strong> на панели сведений домена экспорта.</p>

<h4 id="importing-a-virtual-machine-into-the-destination-data-center">Импорт ВМ в целевой дата-центр</h4>

<p><strong>Описание задачи</strong></p>

<p>Виртуальная машина находится в домене экспорта. Перед переносом ВМ в новый дата-центр, домен экспорта должен быть присоединён к целевому дата-центру.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.42.&nbsp;Импорт ВМ в целевой дата-центр</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Хранилище</strong> режим дерева или поисковый функционал чтобы найти и выделить домен экспорта в списке результатов. Домен экспорта должен иметь статус <code>Активен</code>.</li>
  <li>Перейдите на вкладку <strong>Импорт ВМ</strong> на панели сведений чтобы увидеть список доступных для импорта ВМ.</li>
  <li>Выберите одну или более машину, предназначенную для импорта, и нажмите <strong>Импорт</strong> чтобы открыть окно <strong>Импорт ВМ</strong>.</li>
  <li>В выпадающем меню выберите <strong>Домен хранилища по умолчанию</strong> и <strong>Кластер</strong>.</li>
  <li>Отметьте пункт <strong>Свернуть снимки</strong> чтобы удалить точки восстановления снимка и включить шаблоны в состав ВМ, созданных на основе шаблона.</li>
  <li>Нажмите на импортируемую ВМ и перейдите на вкладку <strong>Диски</strong>. В этой вкладке находятся разворачиваемые списки <strong>Политика распределения</strong> и <strong>Домен хранилища</strong>, где можно выбрать, будет ли диск, используемый машиной, предварительно выделен или же это будет тонкое резервирование, а также выбрать домен хранилища, в котором будет располагаться диск. Также показывается значок, показывающий, какой из импортируемых дисков является загрузочным для этой ВМ.</li>
  <li>Нажмите <strong>OK</strong> чтобы импортировать виртуальные машины. В случае, если ВМ уже существует в виртуализированном окружении, будет открыто окно <strong>Конфликт импорта</strong>.</li>
  <li>Выберите один из доступных пунктов:
    <ul>
      <li><strong>Не импортировать</strong></li>
      <li><strong>Клонировать</strong> и введите уникальное имя ВМ в поле <strong>Добавить имя</strong>.</li>
    </ul>

    <p>Или выберите пункт <strong>Применить ко всем</strong> для импорта всех дублированных ВМ с одинаковым суффиксом.</p>
  </li>
  <li>Нажмите <strong>OK</strong> чтобы импортировать машины и закрыть окно.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Важно:</strong> во время отдельной операции импорта можно импортировать только машины с одинаковой архитектурой. В случае отличия архитектуры одной из машин, предназначенной для импорта, от архитектуры других импортируемых машин, будет выведено предупреждение и предложена возможность изменить выбор в пользу машин только одной архитектуры.</p>

</div>
<p><strong>Результат</strong></p>

<p>Мы импортировали ВМ в целевой дата-центр. Выполнение этого процесса может занять некоторое время.</p>

<h3 id="migrating-virtual-machines-between-hosts">⁠Перенос ВМ между хостами</h3>

<h4 id="what-is-live-migration">Что такое динамическая миграция?</h4>

<p>Динамическая миграция предоставляет возможность перемещения выполняющейся виртуальной машины между физическими хостами без перерыва в обслуживании.</p>

<p>Процесс динамической миграции является прозрачным для конечного пользователя: во время перемещения виртуальной машины на другой физический хост, машина не прерывает работы, и пользовательские приложения продолжают выполняться.</p>

<h4 id="live-migration-prerequisites">Необходимые условия и предпосылки для динамической миграции</h4>

<p>Динамическая миграция используется для бесшовного переноса виртуальных машин, в целях поддержки некоторых наиболее распространённых задач обслуживания. Задолго до использования динамической миграции необходимо убедиться, что имеющееся окружение oVirt корректно настроено для её выполнения.</p>

<p>Минимальные требования для проведения динамической миграции виртуальных машин:</p>

<ul>
  <li>Исходный и целевой хосты должны оба принадлежать одному кластеру, что обеспечивает совместимость ЦП.</li>
  <li>Исходный и целевой хосты должны оба иметь статус <code>Работает</code>.</li>
  <li>Исходный и целевой хосты должны оба иметь доступ к одной и той же виртуальной сети и виртуальной локальной сети.</li>
  <li>Исходный и целевой хосты должны оба иметь доступ к домену хранилища данных, где расположена ВМ.</li>
  <li>Целевой хост должен располагать ресурсами ЦП, соответствующими требованиям виртуальной машины.</li>
  <li>Неиспользуемый объём ОЗУ целевого хоста должен соответствовать требованиям виртуальной машины.</li>
  <li>На переносимой ВМ не должен быть установлен параметр <code>cache!=none</code>.</li>
</ul>

<p>Кроме того, для улучшения производительности, сети хранения и сети управления должны быть разделены во избежание перегрузки сети. Миграция виртуальных машин предполагает перемещение больших объёмов данных между хостами.</p>

<p>Динамическая миграция выполняется с использованием сети управления. Каждое действие динамической миграции ограничено максимальной скоростью передачи в 30 Мбит/с, и поддерживаемое число параллельных миграций также по умолчанию ограничено. Несмотря на эти ограничения, параллельно выполняемые миграции могут потенциально перегрузить сеть управления. Для снижения этого риска рекомендуется создать отдельные логические сети для хранилища, передачи экрана и данных ВМ.</p>

<h4 id="automatic-virtual-machine-migration">Автоматическая миграция виртуальных машин</h4>

<p>oVirt автоматически запускает динамическую миграцию всех ВМ, выполняющихся на хосте, если хост помещается в режим обслуживания. В целях равномерного распределения нагрузки по кластеру, каждой ВМ во время миграции выделяется целевой хост.</p>

<p>oVirt автоматически запускает динамическую миграцию ВМ в целях поддержания уровней балансировки нагрузки или энергосбережения в соответствии с требованиями политики кластера. Поскольку политика кластера по умолчанию не определена, рекомендуется указывать ту политику, которая наиболее подходит к требованиям существующего окружения. Также, при необходимости, можно отключить как автоматическую, так и ручную миграцию конкретных виртуальных машин.</p>

<h4 id="preventing-automatic-migration-of-a-virtual-machine">Предотвращение автоматической миграции ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>oVirt позволяет отключить автоматическую миграцию машин. Также можно отключить ручную миграцию, привязав выполнение машины к конкретному хосту.</p>

<p>Возможность отключения автоматическуй миграции и требование выполнения машины на конкретном хосте удобно при использовании компонентов высокой доступности, таких, как Red Hat High Availability или Cluster Suite.</p>

<p><strong>Инструкция&nbsp;8.43.&nbsp;Предотвращение автоматической миграции ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить ВМ</strong>.</li>
  <li>Нажмите на кнопку <strong>Спрятать дополнительные параметры</strong>.
<img alt="Edit Virtual Machine Window" title="Окно изменения ВМ" src="./OVirt Administration Guide — oVirt_files/Edit_Virtual_Machine.png">
<strong>Рисунок&nbsp;8.18.&nbsp;Окно изменения ВМ</strong></li>
  <li>Перейдите на вкладку <strong>Хост</strong>.</li>
  <li>Отметьте параметр <strong>Запускать на</strong>, чтобы настроить выполнение машины на <strong>Любом хосте в кластере</strong> или на <strong>Конкретном</strong> хосте. Если возможно, выберите конкретный хост в выпадающем меню.
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> высокая доступность oVirt и явная привязка выполнения ВМ к конкретному хосту и отключение миграции — это взаимоисключающие функции. Виртуальные машины, чьё выполнение привязано к конкретному хосту, можно сделать высокодоступными только при использовании сторонних продуктов высокой доступности, например, Red Hat High Availability.</p>

    </div>
  </li>
  <li>Для выбора <strong>Параметров миграции</strong> используйте выпадающее меню. Выберите пункт <strong>Не разрешать миграцию</strong> чтобы включить параметр <strong>Использовать ЦП хоста</strong>.</li>
  <li>Если возможно, введите соответствующие команды <strong>Топологии привязки ЦП</strong> в текстовое поле.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы изменили параметры миграции ВМ.</p>

<h4 id="manually-migrating-virtual-machines">Ручная миграция виртуальных машин</h4>

<p><strong>Описание задачи</strong></p>

<p>Выполняемую ВМ можно перенести на любой хост в пределах кластера целевого хоста. Это особенно удобно, если нагрузка на конкретный хост очень высока. Во время выключения хоста и перевода его в режим обслуживания, процесс миграции запускается автоматически, поэтому ручная миграция не  требуется. Миграция виртуальных машин не вызывает никаких перерывов в работе.</p>

<p>На переносимой ВМ не должен быть установлен параметр <code>cache!=none</code>.</p>

<p><strong>Инструкция&nbsp;8.44.&nbsp;Ручная миграция ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите выполняющуюся ВМ.</li>
  <li>Нажмите <strong>Миграция</strong> чтобы открыть окно <strong>Миграция ВМ</strong>.</li>
  <li>Отметьте галочкой параметр <strong>Выбрать хост автоматически</strong> или параметр <strong>Выбрать целевой хост</strong>, выбрав хост в выпадающем меню.
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> миграция ВМ проводится в пределах кластера целевого хоста. При выбранном параметре <strong>Выбрать хост автоматически</strong>, система определяет хост, на который будет переноситься ВМ, на основе правил балансировки нагрузки и экономии энергии, указанных в политике кластера.</p>

    </div>
  </li>
  <li>Нажмите <strong>OK</strong> чтобы начать миграцию и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Миграция ВМ выполняется. После завершения миграции, содержимое столбца <strong>Хост</strong> будет обновлено, и там будет показан хост, на который была перенесена машина.</p>

<h4 id="setting-migration-priority">Настройка приоритетов миграции</h4>

<p><strong>Описание задачи</strong></p>

<p>oVirt ставит в очередь одновременные запросы на миграцию от виртуальных машин вне указанного хоста. Каждую минуту выполняется процесс балансировки нагрузки. Хосты, уже участвующие в событии миграции, не включаются в цикл миграции до тех пор, пока событие не завершится. При наличии в очереди запроса на миграцию и доступных хостов в кластере, запускается событие миграции, в соответствии с политикой балансировки нагрузки кластера.</p>

<p>Порядок очереди на миграцию можно изменять, например, настроив миграцию критически важных виртуальных машин раньше остальных. Для облегчения этой задачи, oVirt предоставляет возможность указать приоритет для каждой ВМ. Порядок миграции машин будет основан на приоритете, и машины с более высоким приоритетом будут переноситься первыми.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.45.&nbsp;Настройка приоритета миграции</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить ВМ</strong>.</li>
  <li>Перейдите на вкладку <strong>Высокая доступность</strong>.</li>
  <li>С помощью флажков установите <strong>Приоритет очереди запуска/миграции</strong> виртуальной машины на значение <strong>Низкий</strong>, <strong>Средний</strong> или <strong>Высокий</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Приоритет миграции ВМ был изменён.</p>

<h4 id="canceling-ongoing-virtual-machine-migrations">Отмена текущих миграций ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>Миграция ВМ занимает больше времени, чем ожидалось. Нужно убедиться, где выполняются все машины, перед тем, как вносить изменения в параметры окружения.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;8.46.&nbsp;Отмена текущих миграций ВМ</strong></p>

<ol>
  <li>Выберите ВМ в процессе миграции. Она показывается в ресурсной вкладке <strong>Виртуальные машины</strong> и имеет статус <strong>Переносится с</strong>.</li>
  <li>Нажмите кнопку <strong>Отменить миграцию</strong> наверху списка результатов. Или сделайте щелчок ПКМ на машине и выберите пункт контекстного меню <strong>Отменить миграцию</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Статус ВМ изменяется с <strong>Переносится с</strong> на предыдущий статус <strong>Работает</strong>.</p>

<h4 id="event-and-log-notification-upon-automatic-migration-of-highly-available-virtual-servers">Уведомления о событиях и записях в журнале после выполнения автоматической миграции виртуальных серверов высокой доступности</h4>

<p>Во время проведения автоматической миграции виртуального сервера в результате функционирования высокой доступности, подробности процесса автоматичсекой миграции фиксируются во вкладке <strong>События</strong> и в журнале Центра Управления, что облегчает решение возникающих проблем, что показано в следующих примерах:</p>

<p>⁠</p>

<p><strong>Пример&nbsp;8.1.&nbsp;Уведомления во вкладке «События» портала веб-администрирования</strong></p>

<p>Сбой высокодоступной виртуальной машины <em>Имя_машины</em>. Машина будет перезапущена автоматически.</p>

<p>Виртуальная машина <em>Имя_машины</em> была перезапущена на хосте <em>Имя_хоста</em></p>

<p>⁠</p>

<p><strong>Пример&nbsp;8.2.&nbsp;Уведомления oVirt в журнале engine.log</strong></p>

<p>Этот журнал oVirt располагается по пути <code>/var/log/ovirt-engine/engine.log</code>:</p>

<p>Сбой запуска высокодоступной ВМ. Попытка перезапуска. Имя ВМ: <em>Имя_машины</em>, Id ВМ:<em>Номер_ID_ВМ</em></p>

<h3 id="improving-uptime-with-virtual-machine-high-availability">⁠Увеличение времени непрерывной работы виртуальной машины с помощью высокой доступности</h3>

<h4 id="why-use-high-availability">Для чего используется высокая доступность?</h4>

<p>Высокая доступность рекомендуется для виртуальных машин с особо важной рабочей нагрузкой.</p>

<p>Высокая доступность гарантирует перезапуск виртуальных машин в следующих сценариях:</p>

<ul>
  <li>Хост становится нерабочим в результате аппаратного сбоя.</li>
  <li>Хост переводится в режим обслуживания в запланированном простое.</li>
  <li>Хост становится недоступным в результате потери связи с внешним ресурсом хранения.</li>
</ul>

<p>ВМ высокой доступности перезапускается автоматически, на своём хосте или на другом хосте в кластере.</p>

<h4 id="what-is-high-availability">Что такое высокая доступность?</h4>

<p>Высокая доступность означает, что виртуальная машина будет автоматически перезапущена в том случае, если её работа будет прервана любым способом, кроме выключения из установленной гостевой ОС или передачи команды shutdown из oVirt. В этом случае высокодоступная ВМ автоматически перезапускается, на исходном хосте или на другом хосте кластера.</p>

<p>Высокая доступность обеспечивается постоянным наблюдением oVirt за хостами и хранилищем, в результате чего аппаратные сбои обнаруживаются автоматически. В случае обнаружения сбоя хоста, любая виртуальная машина с настроенной высокой доступностью автоматически перезапускается на другом хосте кластера.</p>

<p>Высокая доступность гарантирует минимальную возможность перерывов в работе ВМ, т.к. машины перезапускаются в течении нескольких секунд без необходимости каких-либо действий со стороны пользователя. Высокая доступность поддерживает баланс ресурсов, поскольку гости перезапускаются на хосте с низким текущим потреблением ресурсов или на основании любых настроенных политик балансировки нагрузки или экономии энергии. Это обеспечивает наличие достаточных ресурсов для перезапуска ВМ в любое время.</p>

<h4 id="high-availability-considerations">Рекомендации при выборе высокой доступности</h4>

<p>Для высокодоступного хоста необходимо устройство управления электропитанием с настроенными параметрами для проведения операции блокады. Кроме того, чтобы ВМ стала высокодоступной в случае нерабочего состояния её хоста, её необходимо перезапустить на другом доступном хосте кластера. Условия, необходимые для обеспечения миграции высокодоступной виртуальной машины:</p>

<ul>
  <li>На хостах, где выполняются высокодоступные ВМ, должно быть настроено управление питанием.</li>
  <li>В кластере, частью которого является хост, на котором выполняются высокодоступные ВМ, должны присутствовать другие доступные хосты.</li>
  <li>Целевой хост должен быть в работоспособном состоянии.</li>
  <li>Исходный и целевой хосты должны иметь доступ к домену данных, в котором располагается ВМ.</li>
  <li>Исходный и целевой хосты должны иметь доступ к одним и тем же виртуальным сетям и виртуальным локальным сетям.</li>
  <li>Объём неиспользуемых ресурсов ЦП целевого хоста должен быть достаточным для удовлетворения требований ВМ.</li>
  <li>Объём неиспользуемых ресурсов ОЗУ целевого хоста должен быть достаточным для удовлетворения требований ВМ.</li>
</ul>

<h4 id="configuring-a-highly-available-virtual-machine">Настройка параметров высокодоступной ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>Высокая доступность настраивается индивидуально для каждой ВМ.</p>

<p><strong>Инструкция&nbsp;8.47.&nbsp;Настройка высокодоступной виртуальной машины</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить ВМ</strong>.</li>
  <li>Нажмите на кнопку <strong>Показать дополнительные параметры</strong>.</li>
  <li>Перейдите на вкладку <strong>Высокая доступность</strong>.</li>
  <li>Отметьте галочкой параметр <strong>С высокой доступностью</strong> чтобы включить высокую доступность для ВМ.</li>
  <li>С помощью флажков установите <strong>Приоритет очереди запуска/миграции</strong> виртуальной машины на значение <strong>Низкий</strong>, <strong>Средний</strong> или <strong>Высокий</strong>. При запуске процесса миграции создаётся очередь, и ВМ с высоким приоритетом переносятся первыми. Если кластер испытывает недостаток ресурсов, переносятся только ВМ с высоким приоритетом.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили высокую доступность для ВМ. Чтобы проверить, является ли ВМ высокодоступной, выберите машину и перейдите на вкладку <strong>Общие</strong> на панели сведений.</p>

<h3 id="other-virtual-machine-tasks">Другие задачи виртуальных машин</h3>

<h4 id="enabling-sap-monitoring-for-a-virtual-machine-from-the-administration-portal">Включение мониторинга SAP через Административный портал</h4>

<p><strong>Описание задачи</strong></p>

<p>Включение мониторинга SAP на виртуальной машине в целях распознавания её системами мониторинга SAP.</p>

<p><strong>Инструкция&nbsp;8.48.&nbsp;Включение мониторинга SAP через Административный портал</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить ВМ</strong>.</li>
  <li>Нажмите на кнопку <strong>Показать дополнительные параметры</strong>.</li>
  <li>Перейдите на вкладку <strong>Задаваемые параметры</strong>.
<img alt="Custom Properties tab" title="Вкладка задаваемых параметров" src="./OVirt Administration Guide — oVirt_files/Edit_Virtual_Machine_CustomProperties.png">
<strong>Рисунок&nbsp;8.19.&nbsp;Включение SAP</strong></li>
  <li>В выпадающем меню выберите <code>sap_agent</code>. Убедитесь, что параметр вторичного выпадающего меню установлен на <strong>Верно</strong>. Если ранее были установлены какие-либо параметры, выберите значок плюса чтобы добавить новое правило параметра, и укажите <code>sap_agent</code>.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы включили мониторинг SAP на виртуальной машине.</p>

<h4 id="configuring-red-hat-enterprise-linux-54-or-higher-virtual-machines-to-use-spice">Настройка использования SPICE на ВМ под управлением Red Hat Enterprise Linux версии 5.4 или более поздней</h4>

<h5 id="using-spice-on-virtual-machines-running-versions-of-red-hat-enterprise-linux-released-prior-to-54">Использование SPICE на ВМ под управлением Red Hat Enterprise Linux с версиями до 5.4</h5>

<p>SPICE — это протокол удалённого экрана, предназначенный для виртуальных окружений, с помощью которого можно просматривать виртуализированный рабочий стол или сервер. SPICE предоставляет высококачественный механизм взаимодействия с пользователем, не требователен к ресурсам ЦП и поддерживает высококачественное потоковое видео.</p>

<p>Использование SPICE на машинах с Linux значительно улучшает качество движения курсора мыши в консоли ВМ. Для использования SPICE, графическому серверу X-Windows необходимы дополнительные драйверы qxl. Драйверы qxl включены в состав Red Hat Enterprise Linux 5.4 и более поздних. Ранние версии не поддерживаются. Установка SPICE на ВМ под управлением Red Hat Enterprise Linux значительно улучшает производительность графического интерфейса пользователя.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> как правило, этот функционал наиболее полезен для тех ВМ, где пользователю необходима работа с графическим интерфейсом. Системные администраторы, создающие виртуальные серверы, могут отказаться от настройки SPICE в случае, если их работа с графическим интерфейсом минимальна.</p>

</div>

<h5 id="installing-qxl-drivers-on-virtual-machines">Установка драйверов qxl на ВМ</h5>

<p><strong>Описание задачи</strong></p>

<p>Далее описывается установка драйверов qxl на ВМ под управлением Red Hat Enterprise Linux версии 5.4 или более поздней.</p>

<p><strong>Инструкция&nbsp;8.49.&nbsp;Установка драйверов qxl на ВМ</strong></p>

<ol>
  <li>Авторизуйтесь на машине под управлением Red Hat Enterprise Linux.</li>
  <li>Откройте терминал.</li>
  <li>Выполните следующую команду с правами root:
    # yum install xorg-x11-drv-qxl</li>
</ol>

<p><strong>Результат</strong></p>

<p>Драйверы qxl были установлены, и их теперь необходимо настроить.</p>

<h5 id="configuring-qxl-drivers-on-virtual-machines">Настройка драйверов qxl на виртуальных машинах</h5>

<p><strong>Описание задачи</strong></p>

<p>Драйверы qxl можно настроить через графический интерфейс или в командной строке. Выполните только одно из описанных ниже действий.</p>

<p><strong>Инструкция&nbsp;8.50.&nbsp;Настройка драйверов qxl в GNOME</strong></p>

<ol>
  <li>Нажмите <strong>Система</strong>.</li>
  <li>Нажмите <strong>Администрирование</strong>.</li>
  <li>Нажмите <strong>Монитор</strong>.</li>
  <li>Перейдите на вкладку <strong>Оборудование</strong>.</li>
  <li>Нажмите <strong>Параметры видео-карт</strong>.</li>
  <li>Выберите <strong>qxl</strong> и нажмите <strong>OK</strong>.</li>
  <li>Перезапустите X Window, завершив сеанс пользователя и затем снова авторизовавшись в системе.</li>
</ol>

<p><strong>Инструкция&nbsp;8.51.&nbsp;Настройка драйверов qxl в командной сроке:</strong></p>

<ol>
  <li>
    <p>Сохраните резервную копию <code>/etc/X11/xorg.conf</code>:
    # cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup</p>
  </li>
  <li>
    <p>Внесите следующие изменения в раздел Device файла <code>/etc/X11/xorg.conf</code>:
    Section     "Device"
    Identifier  "Videocard0"
    Driver      "qxl"
    Endsection</p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили драйверы qxl и настроили виртуальную машину на использование протокола SPICE.</p>

<h5 id="configuring-a-virtual-machines-tablet-and-mouse-to-use-spice">Настройка планшетного устройства и мыши виртуальной машины для использования SPICE</h5>

<p><strong>Описание задачи</strong></p>

<p>Измените файл <code>/etc/X11/xorg.conf</code> чтобы включить SPICE для планшетных устройств ВМ.</p>

<p><strong>Инструкция&nbsp;8.52.&nbsp;Настройка планшетного устройства и мыши виртуальной машины для использования SPICE</strong></p>

<ol>
  <li>
    <p>Убедитесь, что планшет доступен для гостевой системы:
    # /sbin/lsusb -v | grep 'QEMU USB Tablet'</p>

    <p>Если вывод этой команды отсутствует, не продолжайте настройку.</p>
  </li>
  <li>
    <p>Сохраните резервную копию <code>/etc/X11/xorg.conf</code>, выполнив команду:
    # cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup</p>
  </li>
  <li>
    <p>Внесите следующие изменения в файл /etc/X11/xorg.conf:
    Section "ServerLayout"
    Identifier     "single head configuration"
    Screen      0  "Screen0" 0 0
    InputDevice    "Keyboard0" "CoreKeyboard"
    InputDevice    "Tablet" "SendCoreEvents"
    InputDevice    "Mouse" "CorePointer"
    EndSection</p>

<pre class="highlight plaintext"><code>Section "InputDevice"
Identifier  "Mouse"
Driver      "void"
#Option      "Device" "/dev/input/mice"
#Option      "Emulate3Buttons" "yes"
EndSection

Section "InputDevice"
Identifier  "Tablet"
Driver      "evdev"
Option      "Device" "/dev/input/event2"
Option "CorePointer" "true"
EndSection
</code></pre>
  </li>
  <li>
    <p>Перезапустите X Window, завершив сеанс пользователя и затем снова авторизовавшись в системе.</p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили мышь и планшетное устройство машины на использование SPICE.</p>

<h4 id="kvm-virtual-machine-timing-management">Управление временем на виртуальной машине KVM</h4>

<p>Виртуализация предлагает определённые испытания для системы измерения времени виртуальной машины. Машины, использующие в качестве источника времени счетчик меток времени TSC, могут испытывать проблемы со временем, поскольку некоторые ЦП не имеют постоянного счётчика меток времени. ВМ, работающие без точной службы времени и хронометража, могут негативно повлиять на некоторые сетевые приложения, т.к. часы машины будет отставать или спешить относительно точного времени.</p>

<p>KVM предлагает решение проблемы, предоставляя виртуальные машины с паравиртуализованными часами. Приложение <code>pvclock</code> виртуальных машин KVM предоставляет стабильный источник отсчёта времени для гостевых машин KVM с его поддержкой.</p>

<p>На данный момент только машины под управлением Red Hat Enterprise Linux/CentOS версии 5.4 и более поздних имеют полную поддержку паравиртуализованных часов.</p>

<p>Виртуальные машины могут столкнуться с несколькими проблемами, причиной которых являются неточные часы и счётчики:</p>

<ul>
  <li>Часы могут выйти из синхронизации с точным временем, что делает сеансы работы недействительными и влияет на сети.</li>
  <li>ВМ с опаздывающими часами могут иметь проблемы при миграции.</li>
</ul>

<p>Эти проблемы существуют на других платформах виртуализации, поэтому отсчёт времени всегда необходимо подвергать проверке.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> фоновая служба NTP должна выполняться и на хосте и на виртуальных машинах. Включите службу <code>ntpd</code>:</p>

<pre class="highlight plaintext"><code># service ntpd start
</code></pre>

  <p>Добавьте службу ntpd в стандартную последовательность загрузки при запуске системы:</p>

<pre class="highlight plaintext"><code># chkconfig ntpd on
</code></pre>

  <p>Использование службы <code>ntpd</code> должно свести к минимуму негативные последствия рассинхронизации часов во всех случаях.</p>

</div>
<p>Используемые серверы NTP должны быть рабочими, хосты и виртуальные машины должны иметь к ним доступ.</p>

<p>Определение, имеет ли ЦП постоянный счётчик меток времени</p>

<p>ЦП имеет постоянный счётчик меток времени при наличии флага <code>constant_tsc</code>. Чтобы определить присутствие флага <code>constant_tsc</code>, выполните следующую команду:</p>

<pre class="highlight plaintext"><code>$ cat /proc/cpuinfo | grep constant_tsc
</code></pre>

<p>При наличии любого вывода для этой команды, ЦП имеет атрибут <code>constant_tsc</code>. В случае отсутствия вывода, следуйте Действием, указанным ниже.</p>

<p>Настройка хостов без постоянного счётчика меток времени</p>

<p>Системы без постоянного счётчика меток времени требуют дополнительной настройки. Функционал управления электропитанием мешает поддержанию точного времени, поэтому для поддержания точного времени виртуальными машинами KVM, управление питанием необходимо отключать.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> данные инструкции применимы только для процессоров AMD ревизии F.</p>

</div>
<p>Если у ЦП отсутствует атрибут <code>constant_tsc</code>, отключите все параметры управления питанием (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=513138">BZ#513138</a>). В каждой системе существует несколько счётчиков, используемых для сохранения времени. Счётчик TSC на хосте нестабилен, что иногда происходит из-за изменений <code>cpufreq</code>, спящих состояний C или миграция на хост с более быстрым TSC. Спящие состояния C могут остановить работу TSC. Чтобы запретить ядру использовать спящие состояния C, добавьте параметр "<code>processor.max_cstate=1</code>" к загрузочным параметрам в файле <code>grub.conf</code> хоста:</p>

<pre class="highlight plaintext"><code>term Red Hat Enterprise Linux Server (2.6.18-159.el5)
        root (hd0,0)
    kernel /vmlinuz-2.6.18-159.el5 ro root=/dev/VolGroup00/LogVol00 rhgb quiet processor.max_cstate=1
</code></pre>

<p>Отключите <code>cpufreq</code> (необходимо только на хостах без атрибута <code>constant_tsc</code>) в файле <code>/etc/sysconfig/cpuspeed</code>, и укажите для переменных <code>MIN_SPEED</code> и <code>MAX_SPEED</code> самые высокие доступные значения частоты. Допустимые пределы можно найти в файлах <code>/sys/devices/system/cpu/cpu*/cpufreq/scaling_available_frequencies</code>.</p>

<p>Используйте утилиту <code>engine-config</code> для получения оповещений, если хост начнёт выбиваться из синхронизации.</p>

<p>Используйте утилиту <code>engine-config</code> для настройки оповещений, если хост начнёт выбиваться из синхронизации.</p>

<p>Для определения смещения времени на хосте существуют два релевантных параметра: <code>EnableHostTimeDrift</code> и <code>HostTimeDriftInSec</code>. Параметр <code>EnableHostTimeDrift</code>, имеющий по умолчанию значение «ложно», можно включить для получения предупредительных уведомлений о смещениях времени на хосте. Параметр <code>HostTimeDriftInSec</code> используется для установки максимально допустимого смещения перед тем, как начнут посылаться предупреждения.</p>

<p>Предупреждения отправляются раз в час для каждого отдельного хоста.</p>

<p>Использование паравиртуализированных часов на виртуальных машинах под управлением Red Hat Enterprise Linux или CentOS</p>

<p>Для некоторых машин с Red Hat Enterprise Linux или CentOS требуются дополнительные параметры ядра. Послать эти параметры можно, дописав их в конец строки /kernel в файле /boot/grub/grub.conf на виртуальной машине.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> процесс настройки параметров ядра можно автоматизировать с помощью пакета <code>ktune</code>.</p>

</div>
<p>Пакет <code>ktune</code> предоставляет интерактивный сценарий для Bourne shell, <code>fix_clock_drift.sh</code>. При запуске с правами супер-пользователя, этот сценарий проверяет несколько системных параметров, чтобы определить, могут ли случаться смещения времени на данной ВМ под нагрузкой. При положительном ответе сценарий создаёт новый файл <code>grub.conf.kvm</code> в каталоге <code>/boot/grub/</code>. В файле содержится строка загрузки ядра с дополнительными параметрами, с которыми ядро может просчитывать и предотвращать значительные временные смещения на виртуальных машинах KVM. После выполнения <code>fix_clock_drift.sh</code> с правами супер-пользователя, и после создания сценарием файла <code>grub.conf.kvm</code>, системный администратор должен вручную сделать резервную копию текущего файла <code>grub.conf</code>, вручную проверить файл <code>grub.conf.kvm</code> на полную идентичность файлу <code>grub.conf</code>, за исключением дополнительных загрузочных параметров ядра, переименовать файл <code>grub.conf.kvm</code> в <code>grub.conf</code> и перезагрузить виртуальную машину.</p>

<p>В таблице ниже перечислены версии Red Hat Enterprise Linux и параметры, требующиеся виртуальным машинам в тех системах, где отсутствует постоянный счётчик меток времени.</p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p><strong>Red Hat Enterprise Linux</strong></p></th>
<th align="left"><p><strong>Дополнительные параметры ядра</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>5.4 AMD64/Intel 64 с паравиртуализированными часами</p></td>
<td align="left"><p>Дополнительные параметры не требуются</p></td>
</tr>
<tr class="even">
<td align="left"><p>5.4 AMD64/Intel 64 без паравиртуализированных часов</p></td>
<td align="left"><p>notsc lpj=n</p></td>
</tr>
<tr class="odd">
<td align="left"><p>5.4 x86 с паравиртуализированными часами</p></td>
<td align="left"><p>Дополнительные параметры не требуются</p></td>
</tr>
<tr class="even">
<td align="left"><p>5.4 x86 без паравиртуализированных часов</p></td>
<td align="left"><p>clocksource=acpi_pm lpj=n</p></td>
</tr>
<tr class="odd">
<td align="left"><p>5.3 AMD64/Intel 64</p></td>
<td align="left"><p>notsc</p></td>
</tr>
<tr class="even">
<td align="left"><p>5.3 x86</p></td>
<td align="left"><p>clocksource=acpi_pm</p></td>
</tr>
<tr class="odd">
<td align="left"><p>4.8 AMD64/Intel 64</p></td>
<td align="left"><p>notsc</p></td>
</tr>
<tr class="even">
<td align="left"><p>4.8 x86</p></td>
<td align="left"><p>clock=pmtmr</p></td>
</tr>
<tr class="odd">
<td align="left"><p>3.9 AMD64/Intel 64</p></td>
<td align="left"><p>Дополнительные параметры не требуются</p></td>
</tr>
<tr class="even">
<td align="left"><p>3.9 x86</p></td>
<td align="left"><p>Дополнительные параметры не требуются</p></td>
</tr>
</tbody>
</table>

<p>Использование часов реального времени на машинах под управлением Windows</p>

<p>В Windows используются как часы реального времени (RTC), так и счётчик временных меток (TSC). В ВМ с установленной Windows часы реального времени можно использовать вместо TSC для всех источников времени, что устраняет проблемы со временем на виртуальных машинах.</p>

<p>Чтобы включить RTC для источника времени PMTIMER (PMTIMER обычно использует TSC), добавьте следующую строку к параметрам загрузки Windows. Параметры загрузки Windows хранятся в файле boot.ini. Добавьте следующую строку в файл <code>boot.ini</code>:</p>

<pre class="highlight plaintext"><code>/use pmtimer
</code></pre>

<p>Подробности о загрузочных параметрах Windows и параметре pmtimer см. в документе <a href="https://support.microsoft.com/ru-ru/kb/833721">Параметры, используемые в файле Boot.ini в Windows XP и Windows Server 2003</a> (РУС).</p>

<h4 id="monitoring-virtual-machine-login-activity-using-the-sessions-tab">Наблюдение за активностью входов в систему виртуальной машины во вкладке сеансов</h4>

<p>Клиентским виртуальным машинам, подключённым к oVirt, требуется обслуживание и/или периодические обновления. Информация, которую можно найти во вкладке <strong>Сеансы</strong>, даёт возможность контролировать активность входов в систему ВМ, чтобы избежать выполнения задач обслуживания на активно используемых машинах.</p>

<p>Используйте ресурсную вкладку <strong>Виртуальные машины</strong>, режим дерева или поисковый функционал чтобы найти и выделить ВМ в списке результатов. Перейдите на вкладку <strong>Сеансы</strong> на панели сведений чтобы увидеть информацию об <strong>Авторизованном пользователе</strong>, <strong>Пользователе консоли</strong> и <strong>IP консольного клиента</strong>.</p>

<h2 id="templates">⁠Шаблоны</h2>

<h3 id="introduction-to-templates">Введение в шаблоны</h3>

<p>Шаблон — это копия ранее настроенной виртуальной машины, используемая для упрощения последующих повторных созданий аналогичных ВМ. В шаблонах фиксируется установленное ПО и его параметры, а также аппаратные настройки исходной ВМ.</p>

<p>При создании шаблона на базе ВМ делается копия виртуального диска машины, доступная только для чтения. Этот диск, доступный только для чтения, становится базовым образом диска нового шаблона и любой ВМ, созданной на базе этого шаблона. Поэтому шаблон не может быть удалён, пока в окружении существуют машины, созданные на его основе.</p>

<p>ВМ, созданные на основе шаблонов, используют тот же тип и драйвер NIC, что и исходная ВМ, но имеют отдельные и уникальные MAC адреса.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> перед использование машины для создания шаблона на её основе, виртуальную машину может понадобиться запечатать.</p>

</div>

<h3 id="template-tasks">Задачи работы с шаблонами</h3>

<h4 id="creating-a-template">Создание шаблона</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание шаблона из существующей ВМ для использования его в качестве чертежа для создания дополнительных ВМ.</p>

<p><strong>Инструкция&nbsp;9.1.&nbsp;Создание шаблона из существующей ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Убедитесь, что машина выключена и имеет статус <code>Отключена</code>.</li>
  <li>Нажмите <strong>Создать шаблон</strong> чтобы открыть окно <strong>Добавить шаблон</strong>.
<img alt="The New Template window" title="Окно нового шаблона" src="./OVirt Administration Guide — oVirt_files/New_template.png">
<strong>Рисунок&nbsp;9.1.&nbsp;Окно нового шаблона</strong></li>
  <li>Введите <strong>Имя</strong>, <strong>Описание</strong> и <strong>Комментарий</strong> для шаблона.</li>
  <li>В выпадающем меню <strong>Кластер</strong> выберите кластер, с которым будет связан шаблон. По умолчанию это кластер исходной ВМ.</li>
  <li>При необходимости отметьте галочкой пункт <strong>Создать как версию подшаблона</strong>, выберите <strong>Корневой шаблон</strong> и введите <strong>Имя подверсии</strong> чтобы создать новый шаблон как подшаблон уже существующего.</li>
  <li>В разделе <strong>Распределение дисков</strong> введите псевдоним диска в текстовом поле <strong>Псевдоним</strong> и в выпадающем меню <strong>Таргет</strong> выберите домен хранилища, в котором будут храниться диски. По умолчанию, эти значения совпадают со значениями исходной ВМ.</li>
  <li>Параметр <strong>Разрешить всем пользователям доступ к этому шаблону</strong> отмечен по умолчанию, что делает шаблон открытым для общего доступа.</li>
  <li>Пункт <strong>Копировать права доступа ВМ</strong> по умолчанию не отмечен. Отметьте его чтобы скопировать права доступа исходной ВМ на шаблон.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Во время создания шаблона машина имеет статус <code>Образ заблокирован</code>. Процесс создания шаблона может занять до часа времени, в зависимости от размера ВМ и аппаратных возможностей хранилища. После завершения, шаблон добавляется во вкладку <strong>Шаблоны</strong>. Теперь на основе этого шаблона можно создавать машины.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> во время создания шаблона создаётся также копия ВМ, чтобы и шаблон и существующую ВМ можно было использовать после создания шаблона.</p>

</div>

<h4 id="explanation-of-settings-and-controls-in-the-new-template-window">Объяснение параметров и элементов управления в окне создания шаблона</h4>

<p>Ниже в таблице приводятся подробности параметров окна <strong>Новый шаблон</strong>.⁠</p>

<p><strong>Таблица&nbsp;9.1.&nbsp;Параметры добавления и изменения шаблонов</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Поле</p></th>
<th align="left"><p>Описание/действие</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Имя</strong></p></td>
<td align="left"><p>Имя шаблона. Это имя, с которым шаблон указывается в списке шаблонов во вкладке <strong>Шаблоны</strong> Административного портала и с которым он доступен для REST API. Это текстовое поле с ограничением в 40 символов, которое должно содержать уникальное имя, состоящее из любого сочетания строчных и прописных букв, цифр, тире и знаков подчёркивания.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Описание шаблона. Рекомендуется, но не обязательно.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Комментарий</strong></p></td>
<td align="left"><p>Поле для простого текстового комментария к шаблону, в удобочитаемой форме.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Кластер</strong></p></td>
<td align="left"><p>Кластер, с которым связан шаблон. По умолчанию, это кластер исходной ВМ. Можно выбрать любой кластер в дата-центре.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Создать как подверсию шаблона</strong></p></td>
<td align="left"><p>Укажите, будет ли шаблон создан как новая версия существующего шаблона. Отметьте этот флажок, чтобы получить доступ к соответствующим параметрам.</p>
<ul>
<li><strong>Корневой шаблон</strong>: шаблон, под которым будет добавлен подшаблон.</li>
<li><strong>Имя подверсии</strong>: имя шаблона. Это имя, по которому осуществляется доступ к шаблону во время создания ВМ на основе шаблона.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Распределение дисков</strong></p></td>
<td align="left"><p><strong>Псевдоним</strong> — псевдоним диска ВМ, используемого шаблоном. По умолчанию, псевдоним совпадает с именем диска исходной ВМ. <strong>Виртуальный размер</strong> — текущий фактический размер виртуального диска, используемого шаблоном. Это значение нельзя изменить, оно предоставляется только для ссылок на него. <strong>Таргет</strong> — домен хранилища, где будет храниться виртуальный диск, используемый шаблоном. По умолчанию совпадает с доменом хранилища исходной ВМ. Можно выбрать любой домен хранилища в кластере.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Разрешить всем пользователям доступ к этому шаблону</strong></p></td>
<td align="left"><p>Укажите, будет ли шаблон общедоступным или с закрытым доступом. Общедоступный шаблон доступен всем пользователям, доступ к закрытому шаблону имеют только пользователи с ролями <strong>TemplateAdmin</strong> или <strong>SuperUser</strong>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Копировать права доступа ВМ</strong></p></td>
<td align="left"><p>Позволяет перенести на шаблон привилегии, явно настроенные для исходной ВМ.</p></td>
</tr>
</tbody>
</table>

<h4 id="editing-a-template">Изменение шаблона</h4>

<p><strong>Описание задачи</strong></p>

<p>После создания шаблона можно изменять его свойства. Поскольку шаблон — это копия ВМ, то параметры шаблона, доступные изменению, аналогичны параметрам, присутствующим в окне <strong>Изменить ВМ</strong>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;9.2.&nbsp;Изменение шаблона</strong></p>

<ol>
  <li>Для поиска и выбора нужного шаблона, используйте ресурсную вкладку <strong>Шаблоны</strong>, древовидный режим или поисковый функционал.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить шаблон</strong>.</li>
  <li>Внесите необходимые изменения в параметры и нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Свойства шаблона были изменены. Окно <strong>Изменить шаблон</strong> невозможно закрыть, если поле свойства недействительно.</p>

<h4 id="deleting-a-template">Удаление шаблона</h4>

<p><strong>Описание задачи</strong></p>

<p>Удалить шаблон из окружения oVirt.</p>

<p><strong>Внимание</strong></p>

<p>Если шаблон использовался для создания ВМ, убедитесь, что вы не удаляете этот шаблон, так как он необходим для продолжения работы ВМ.</p>

<p>⁠</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;9.3.&nbsp;Удаление шаблона</strong></p>

<ol>
  <li>Для поиска и выбора нужного шаблона, используйте ресурсную вкладку, древовидный режим или поисковый функционал.</li>
  <li>Нажмите <strong>Удалить</strong> чтобы открыть окно <strong>Удалить шаблон(ы)</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы удалить шаблон.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили шаблон.</p>

<h4 id="exporting-templates">Экспорт шаблонов</h4>

<h5 id="migrating-templates-to-the-export-domain">Перенос шаблонов в домен экспорта</h5>

<p><strong>Описание задачи</strong></p>

<p>Экспорт шаблонов в домен экспорта для переноса их в другой домен данных, в том же окружении oVirt, или в другом.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;9.4.&nbsp;Экспорт отдельных шаблонов в домен экспорта</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Шаблоны</strong>, древовидный режим или поисковый функционал чтобы найти и выделить шаблон в списке результатов.</li>
  <li>Нажмите <strong>Экспорт</strong> чтобы открыть окно <strong>Экспорт шаблона</strong>.
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> отметьте галочкой пункт <strong>Принудительно заменить</strong> чтобы заменить любые более ранние версии этого шаблона в домене экспорта.</p>

    </div>
  </li>
  <li>Нажмите <strong>OK</strong> чтобы начать экспорт шаблона; этот процесс может занять до часа времени, в зависимости от размера образа диска ВМ и аппаратных возможностей хранилища.</li>
  <li>Повторяйте эти шаги до тех пор, пока все шаблоны, которые необходимо перенести, не окажутся в домене экспорта до начала процесса импорта. Используйте ресурсную вкладку <strong>Хранилище</strong>, древовидный режим или поисковый функционал чтобы найти и выделить домен экспорта в списке результатов, и перейдите на вкладку <strong>Импорт шаблонов</strong> на панели сведений, чтобы увидеть все экспортированные шаблоны в домене экспорта.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Шаблоны были экспортированы в домен экспорта.</p>

<h5 id="copying-a-templates-virtual-hard-disk">Копирование виртуального жёсткого диска шаблона</h5>

<p><strong>Описание задачи</strong></p>

<p>При перемещении ВМ, созданной из шаблона с выбранным параметром тонкого резервирования хранилища, диски шаблона должны быть скопированы в тот же домен хранилища, где находится диск ВМ.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;9.5.&nbsp;Копирование виртуального жёсткого диска</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Диски</strong>.</li>
  <li>Выберите диск шаблона или диски для копирования.</li>
  <li>Нажмите на кнопку <strong>Копировать</strong> чтобы открыть окно <strong>Копировать диск</strong>.</li>
  <li>В выпадающем меню выберите <strong>Целевой</strong> домен данных.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Была создана копия виртуального жёсткого диска шаблона, в том же или в другом домене хранилища. Если диск шаблона копировался как приготовление к переносу виртуального жёсткого диска, виртуальный жёсткий диск теперь можно переносить.</p>

<h4 id="importing-templates">Импорт шаблонов</h4>

<h5 id="importing-a-template-into-a-data-center">Импорт шаблона в дата-центр</h5>

<p><strong>Описание задачи</strong></p>

<p>Импорт шаблона из недавно присоединённого домена экспорта.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;9.6.&nbsp;Импорт шаблона в дата-центр</strong></p>

<ol>
  <li>Используйте ресурсные вкладки, древовидный режим или поисковый функционал чтобы найти и выделить недавно присоединённый домен экспорта в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Импорт шаблона</strong> панели сведений чтобы увидеть шаблоны в домене экспорта.</li>
  <li>Выберите шаблон и нажмите <strong>Импорт</strong> чтобы открыть окно <strong>Импорт шаблонов</strong>.</li>
  <li>Выберите шаблоны для импорта.</li>
  <li>В выпадающем меню выберите <strong>Целевой кластер</strong> и домен <strong>Хранилища</strong>. Измените <strong>Суффикс</strong>, если применимо. Или снимите галочку с пункта <strong>Клонировать все шаблоны</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы импортировать шаблоны и открыть окно уведомления. Нажмите на кнопку <strong>Закрыть</strong> чтобы закрыть окно уведомления.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Шаблон импортируется в целевой дата-центр. Эта операция может занять до часу времени, в зависимости от аппаратных возможностей хранилища. Наблюдать за выполнением операции импорта можно во вкладке <strong>События</strong>.</p>

<p>После завершения процесса импорта шаблон появляется в ресурсной вкладке <strong>Шаблоны</strong>. Шаблоны могут создавать новые ВМ или запускать импортированные ВМ, созданные на основе этого шаблона.</p>

<h5 id="importing-a-virtual-disk-image-from-an-openstack-image-service-as-a-template">Импорт образа виртуального диска из службы OpenStack Image в качестве шаблона</h5>

<p><strong>Описание задачи</strong></p>

<p>Образы виртуальных дисков, управляемые службой OpenStack Image Service, можно импортировать в oVirt, если эта служба OpenStack Image была добавлена в oVirt в качестве внешнего поставщика.</p>

<ol>
  <li>Перейдите на ресурсную вкладку <strong>Хранилище</strong> и выберите домен OpenStack Image Service в списке результатов.</li>
  <li>Выберите образ для импорта во вкладке <strong>Образы</strong> панели сведений.</li>
  <li>
    <p>Нажмите <strong>Импорт</strong> чтобы открыть окно <strong>Импорт образов</strong>.
⁠</p>

    <p><img alt="The Import Image(s) Window" title="Окно импорта образов" src="./OVirt Administration Guide — oVirt_files/5008.png"></p>

    <p><strong>Рисунок&nbsp;9.2.&nbsp;Окно импорта образов</strong></p>
  </li>
  <li>В выпадающем меню <strong>Дата-центр</strong> выберите дата-центр, куда будет импортирован образ виртуального диска.</li>
  <li>В выпадающем меню <strong>Имя домена</strong> выберите домен хранилища, где будет храниться образ виртуального диска.</li>
  <li>По желанию, выберите квоту в выпадающем меню <strong>Квота</strong>, чтобы применить квоту к образу виртуального диска.</li>
  <li>Отметьте галочкой пункт <strong>Импортировать как шаблон</strong>.</li>
  <li>В выпадающем меню <strong>Кластер</strong> выберите кластер, в котором образ виртуального диска будет доступен как шаблон.</li>
  <li>Нажмите <strong>OK</strong> чтобы импортировать образ виртуального диска.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Образ импортирован как шаблон и появляется в списке результатов в ресурсной вкладке <strong>Шаблоны</strong>. Теперь на основе этого шаблона можно создавать виртуальные машины.</p>

<h3 id="sealing-virtual-machines-in-preparation-for-deployment-as-templates">Запечатывание ВМ для подготовки разворачивания в качестве шаблона</h3>

<h4 id="sealing-a-linux-virtual-machine-for-deployment-as-a-template">Запечатывание ВМ под управлением Linux для разворачивания в качестве шаблона</h4>

<h5 id="sealing-a-linux-virtual-machine-for-deployment-as-a-template-1">Запечатывание ВМ под управлением Linux для разворачивания в качестве шаблона</h5>

<p>Существует два основных метода запечатывания ВМ с установленной Linux в качестве подготовки использования этой ВМ для создания шаблона: вручную или с использованием команды <code>sys-unconfig</code>. Ручное запечатывание ВМ с установленной Linux требует создания файла на виртуальной машине, который играет роль флага для инициирования различных задач конфигурации при следующем запуске этой ВМ. Команда <code>sys-unconfig</code> позволяет автоматизировать этот процесс. Тем не менее, оба этих способа требуют ручного удаления файлов на виртуальной машине, имеющих отношение только к этой машине или же тех, которые потенциально могут спровоцировать конфликты между виртуальными машинами, созданными на базе шаблона, который мы создаём из этой виртуальной машины. По этой причине оба эти метода запечатывания ВМ с установленной Linux являются допустимыми и достигают идентичного результата.</p>

<h5 id="sealing-a-linux-virtual-machine-manually-for-deployment-as-a-template">Запечатывание ВМ для разворачивания в качестве шаблона вручную</h5>

<p><strong>Описание задачи</strong></p>

<p>Мы должны подготовить (запечатать) ВМ с установленной Linux перед созданием шаблона на основе этой ВМ.</p>

<p>⁠<strong>Действие&nbsp;9.7.&nbsp;Запечатывание ВМ с установленной Linux</strong></p>

<ol>
  <li>Авторизация на виртуальной машине.</li>
  <li>
    <p>Пометка системы для повторной настройки с помощью вполнения команды с правами root:
    # touch /.unconfigured</p>
  </li>
  <li>
    <p>Выполните следующую команду для удаления ключей ssh хоста:
    # rm -rf /etc/ssh/ssh_host_*</p>
  </li>
  <li>Укажите <code>HOSTNAME=localhost.localdomain</code> в <code>/etc/sysconfig/network</code></li>
  <li>
    <p>Выполните следующую команду для удаления <code>/etc/udev/rules.d/70-*</code>:
    # rm -rf /etc/udev/rules.d/70-*</p>
  </li>
  <li>Удалите строку <code>HWADDR</code> и строку <code>UUID</code> из файла <code>/etc/sysconfig/network-scripts/ifcfg-eth*</code>.</li>
  <li>По желанию удалите все фалы журналов из каталога <code>/var/log</code> и журналы сборки из каталога <code>/root</code>.</li>
  <li>Выполните следующую команду для выключения ВМ:
    # poweroff</li>
</ol>

<p><strong>Результат</strong></p>

<p>Виртуальная машина запечатана и её можно превращать в шаблон. Разворачивать ВМ под управлением Linux из этого шаблона можно, не опасаясь конфликтов файлов конфигурации.</p>

<h5 id="sealing-a-linux-virtual-machine-for-deployment-as-a-template-using-sys-unconfig">Запечатывание ВМ для разворачивания в качестве шаблона с помощью sys-unconfig</h5>

<p><strong>Описание задачи</strong></p>

<p>Мы должны подготовить (запечатать) ВМ с установленной Linux перед созданием шаблона на основе этой ВМ.</p>

<p><strong>Инструкция&nbsp;9.8.&nbsp;Запечатывание ВМ с помощью sys-unconfig</strong></p>

<ol>
  <li>Авторизуйтесь на виртуальной машине.</li>
  <li>
    <p>Выполните следующую команду для удаления ключей ssh хоста Run the following command to remove ssh host keys:
    # rm -rf /etc/ssh/ssh_host_*</p>
  </li>
  <li>Укажите <code>HOSTNAME=localhost.localdomain</code> в <code>/etc/sysconfig/network</code>.</li>
  <li>Удалите строку <code>HWADDR</code> и строку <code>UUID</code> из <code>/etc/sysconfig/network-scripts/ifcfg-eth*</code>.</li>
  <li>По желанию удалите все фалы журналов из каталога <code>/var/log</code> и журналы сборки <code>/root</code>.</li>
  <li>Выполните следующую команду:
    # sys-unconfig</li>
</ol>

<p><strong>Результат</strong></p>

<p>Виртуальная машина выключается; теперь она запечатана и её можно превращать в шаблон. Разворачивать ВМ под управлением Linux из этого шаблона можно, не опасаясь конфликтов файлов конфигурации.</p>

<h4 id="sealing-a-windows-virtual-machine-for-deployment-as-a-template">Запечатывание ВМ под управлением Windows для разворачивания в качестве шаблона</h4>

<h5 id="considerations-when-sealing-a-windows-template-with-sysprep">Рекомендации для запечатывания шаблона Windows с помощью Sysprep</h5>

<p>Шаблон, созданный для ВМ с установленной Windows, должен быть подготовлен (запечатан) перед его использованием для разворачивания виртуальных машин. Это гарантирует, что параметры, свойственные конкретно этой машине, не будут воспроизведены в шаблоне.</p>

<p>Для запечатывания шаблонов на основе Windows перед работой с ними используется утилита <strong>Sysprep</strong>.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> не перезапускайте машину во время выполнения этого действия.</p>

</div>
<p>Перед запуском процесса <code>Sysprep</code>, убедитесь, что были настроены следующие параметры:</p>

<ul>
  <li>Параметры Windows <strong>Sysprep</strong> были определены корректно. В противном случае нажмите <strong>Изменить</strong> и введите требуемую информацию в поля <strong>Операционная система</strong> и <strong>Домен</strong>.</li>
  <li>Верный ключ продукта был указан в утилите настройки <code>engine-config</code>. В противном случае запустите утилиту настройки в oVirt с правами root, и введите требуемую информацию. Ключи, которые необходимо ввести: <code>ProductKey</code> и <code>SysPrepPath</code>. Например, значения Windows 7 — это <code>ProductKeyWindow7</code> и <code>SysPrepWindows7Path</code>. Укажите эти значения с помощью данной команды:
    # engine-config –set ProductKeyWindow7=<validproductkey> --cver=general</validproductkey></li>
</ul>

<h5 id="sealing-a-windows-xp-template">Запечатывание шаблона Windows XP</h5>

<p><strong>Описание задачи</strong></p>

<p>Запечатывание шаблона Windows XP с помощью утилиты <strong>Sysprep</strong> перед использованием шаблона для разворачивания виртуальной машины.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> вышеуказанную процедуру можно также использовать и для запечатывания шаблона Windows 2003. Утилита Windows 2003 <strong>Sysprep</strong> доступна по ссылке <a href="http://www.microsoft.com/download/en/details.aspx?id=14830"></a><a href="http://www.microsoft.com/download/en/details.aspx?id=14830">http://www.microsoft.com/download/en/details.aspx?id=14830</a>.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;9.9.&nbsp;Запечатывание шаблона Windows XP</strong></p>

<ol>
  <li>Загрузите <code>sysprep</code> на виртуальную машину, которая будет использоваться как шаблон. Утилита Windows XP <strong>Sysprep</strong> доступна по ссылке <a href="http://www.microsoft.com/download/en/details.aspx?id=11282"></a><a href="http://www.microsoft.com/download/en/details.aspx?id=11282">http://www.microsoft.com/download/en/details.aspx?id=11282</a></li>
  <li>Создайте новый каталог: <code>c:\sysprep</code>.</li>
  <li>Откройте файл <code>deploy.cab</code> и добавьте содержимое в <code>c:\sysprep</code>.</li>
  <li>Выполните <code>sysprep.exe</code> из папки и нажмите кнопку <strong>OK</strong> приветственного сообщения чтобы открыть утилиту Sysprep.</li>
  <li>Отметьте следующие пункты:
    <ul>
      <li><strong>Не сбрасывать срок отсрочки активации </strong></li>
      <li><strong>Использовать минимальную установку</strong></li>
    </ul>
  </li>
  <li>Убедитесь, что режим выключения настроен на <code>Завершить работу</code> и нажмите <strong>Запечатать</strong>.</li>
  <li>Нажмите подтверждение во всплывающем окне для завершения процесса запечатывания; после завершения, виртуальная машина автоматически завершит работу.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Шаблон Windows XP запечатан и готов для разворачивания виртуальных машин.</p>

<h5 id="sealing-a-windows-7-or-windows-2008-template">Запечатывание шаблона Windows 7 или Windows 2008</h5>

<p><strong>Описание задачи</strong></p>

<p>Запечатывание шаблона Windows 7 и Windows 2008 перед использованием шаблона для разворачивания виртуальной машины.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;9.10.&nbsp;Запечатывание шаблона Windows 7 или Windows 2008</strong></p>

<ol>
  <li>В виртуальной машине, которая будет использоваться как шаблон, откройте командную строку и введите <code>regedit</code>.</li>
  <li>Откроется <strong>Редактор реестра</strong>. В левой панели разверните <strong>HKEY_LOCAL_MACHINE</strong> → <strong>SYSTEM</strong> → <strong>SETUP</strong>.</li>
  <li>В главном окне сделайте щелчок ПКМ для добавления значения с помощью пунктов <strong>Создать</strong> → <strong>Строковой параметр</strong>.</li>
  <li>Сделайте щелчок ПКМ по файлу и выберите <strong>Изменить</strong> чтобы открыть окно <strong>Изменение строкового параметра</strong>.</li>
  <li>Введите следующие данные в указанных полях:
    <ul>
      <li>Параметр: <code>UnattendFile</code></li>
      <li>Значение: <code>a:\sysprep.inf</code></li>
    </ul>
  </li>
  <li>Запустите <strong>Sysprep</strong> по пути <code>C:\Windows\System32\sysprep\sysprep.exe</code>.</li>
  <li>Введите следующие данные для утилиты <strong>Sysprep</strong>:
    <ul>
      <li>В меню <strong>Действие по очистке системы</strong> выберите пункт <strong>Переход в окно приветствия системы (OOBE)</strong>.</li>
      <li>Отметьте параметр <strong>Подготовка к использованию</strong> если необходимо сменить номер SID.</li>
      <li>В <strong>Параметрах завершения работы</strong> выберите <strong>Завершение работы</strong>.</li>
    </ul>

    <p>Нажмите <strong>OK</strong> для завершения процесса запечатывания; после завершения, виртуальная машина автоматически завершит работу.</p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Шаблон Windows 7 или Windows 2008 запечатан и готов для разворачивания виртуальной машины.</p>

<h4 id="using-cloud-init-to-automate-the-configuration-of-virtual-machines">Использование Cloud-Init для автоматизации настройки виртуальной машины</h4>

<h5 id="cloud-init-overview">Обзор Cloud-Init</h5>

<p>Cloud-Init — это утилита автоматизации начальной настройки параметров виртуальных машин, таких, как имя хоста, сетевые интерфейсы и ключи авторизации. Эту утилиту можно использовать при подготовке виртуальных машин, развёрнутых на базе шаблона для избежания конфликтов в сети.</p>

<p>Для использования этой утилиты на виртуальной машине необходимо сначала установить пакет cloud-init. После его установки, во время загрузки системы запускается служба Cloud-Init, которая производит поиск указаний, что именно нужно настроить. Далее можно использовать параметры окна <strong>Однократный запуск</strong> чтобы предоставить эти инструкции только один раз, или параметры в окнах <strong>Добавить ВМ</strong>, <strong>Изменить ВМ</strong> и <strong>Изменить</strong> чтобы эти инструкции выполнялись каждый раз при загрузке виртуальной машины.</p>

<h5 id="cloud-init-use-case-scenarios">Сценарии вариантов использования Cloud-Init</h5>

<p>Cloud-Init можно использовать для автоматизации настройки параметров виртуальных машин в различных сценариях. Вот несколько распространённых сценариев:</p>

<p>Виртуальные машины, созданные на основе шаблонов<br>
Параметры Cloud-Init в разделе <strong>Однократный запуск</strong> окна <strong>Однократный запуск</strong> можно использовать для инициализации виртуальной машины, созданной на основе шаблона. Это даёт возможность настроить виртуальную машину во время её первого запуска.</p>

<p>Шаблоны виртуальных машин<br>
Пункты <strong>Использовать Cloud-Init/Sysprep</strong> вкладки <strong>Однократный запуск</strong> окон <strong>Добавить шаблон</strong> и <strong>Изменить шаблон</strong> можно использовать для настройки параметров виртуальных машин, созданных на базе этого шаблона.</p>

<p>Пулы виртуальных машин<br>
Пункты <strong>Использовать Cloud-Init/Sysprep</strong> во вкладке <strong>Однократный запуск</strong> окна <strong>Добавить пул</strong> можно использовать для настройки параметров виртуальных машин, взятых из этого пула машин. Это даёт возможность указать набор стандартных параметров, которые будут применяться каждый раз, когда машина будет изыматься из этого пула. Параметры, указанные для шаблона, на котором основана машина, могут быть унаследованы или переопределены, или же можно указать параметры для самого пула машин.</p>

<h5 id="installing-cloud-init">Установка Cloud-Init</h5>

<p><strong>Описание задачи</strong></p>

<p>Установка Cloud-Init на виртуальной машине с установленной Red Hat или CentOS.</p>

<p><strong>Инструкция&nbsp;9.11.&nbsp;Установка Cloud-Init</strong></p>

<ol>
  <li>Авторизуйтесь на виртуальной машине.</li>
  <li>Установите пакет cloud-init и его зависимости:
    # yum install cloud-init</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы установили пакет cloud-init и его зависимости.</p>

<h5 id="using-cloud-init-to-initialize-a-virtual-machine">Использование Cloud-Init для инициализации виртуальной машины</h5>

<p><strong>Описание задачи</strong></p>

<p>Использование Cloud-Init для автоматизации начальной настройки ВМ с установленной Linux, подготовленной на базе шаблона.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;9.12.&nbsp;Использование Cloud-Init для инициализации виртуальной машины</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите <strong>Однократный запуск</strong> чтобы открыть окно <strong>Запустить ВМ</strong>.</li>
  <li>Разверните раздел <strong>Однократный запуск</strong> и отметьте галочкой параметр <strong>Cloud-Init</strong>.</li>
  <li>Введите имя хоста в текстовом поле <strong>Имя хоста ВМ</strong>.</li>
  <li>Отметьте параметр <strong>Настроить часовой пояс</strong> и выберите часовой пояс в выпадающем меню <strong>Часовой пояс</strong>.</li>
  <li>Отметьте галочкой параметр <strong>Использовать уже настроенный пароль</strong> чтобы использовать уже существующие учётные данные, или снимите галочку и введите пароль root в текстовых полях <strong>Пароль root</strong> и <strong>Подтвердить пароль root</strong> чтобы указать новый пароль root.</li>
  <li>Введите ключи SSH для добавления в файл авторизованных хостов на виртуальной машине в текстовое поле <strong>Назначенные ключи SSH</strong>.</li>
  <li>Отметьте галочкой параметр <strong>Пересоздать ключи SSH</strong> чтобы заново создать ключи SSH для виртуальной машины.</li>
  <li>Укажите любые серверы DNS в текстовом поле <strong>Серверы DNS</strong>.</li>
  <li>Укажите любые домены поиска DNS в текстовом поле <strong>Домены поиска DNS</strong>.</li>
  <li>Отметьте параметр <strong>Сеть</strong> и используйте клавиши <strong>+</strong> и <strong>-</strong> для добавления или удаления сетевых интерфейсов виртуальной машины.</li>
  <li>Введите любые настраиваемые скрипты в текстовую область <strong>Настраиваемый скрипт</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Важно:</strong> Cloud-Init поддерживается только версией совместимости кластера версии 3.3 и более поздних.</p>

</div>
<p><strong>Результат</strong></p>

<p>Виртуальная машина загружается, и применяются указанные параметры.</p>

<h5 id="using-cloud-init-to-prepare-a-template">Использование Cloud-Init для подготовки шаблона</h5>

<p><strong>Описание задачи</strong></p>

<p>Использование Cloud-Init для указания набора стандартных параметров, которые должны быть включены в шаблон.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> хотя в нижеследующей процедуре описывается использование Cloud-Init для подготовки шаблона, те же параметры также доступны в окнах <strong>Добавить ВМ</strong> и <strong>Изменить шаблон</strong>.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;9.13.&nbsp;Использование Cloud-Init для подготовки шаблона</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Виртуальные машины</strong> и выберите ВМ.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить ВМ</strong>.</li>
  <li>Перейдите на вкладку <strong>Однократный запуск</strong> и отметьте параметр <strong>Использовать Cloud-Init/Sysprep</strong>.</li>
  <li>Введите имя хоста в текстовое поле <strong>Имя хоста ВМ</strong>.</li>
  <li>Отметьте параметр <strong>Настроить часовой пояс</strong> и выберите часовой пояс в выпадающем меню <strong>Часовой пояс</strong>.</li>
  <li>Разверните раздел <strong>Авторизация</strong> и отметьте галочкой параметр <strong>Использовать уже настроенный пароль</strong> чтобы использовать уже существующие учётные данные, или снимите галочку и введите пароль root в текстовых полях <strong>Пароль root</strong> и <strong>Подтвердить пароль root</strong> чтобы указать новый пароль root.</li>
  <li>Введите ключи SSH для добавления в файл авторизованных хостов на виртуальной машине в текстовое поле <strong>Назначенные ключи SSH</strong>.</li>
  <li>Отметьте галочкой параметр <strong>Пересоздать ключи SSH</strong> чтобы заново создать ключи SSH для виртуальной машины.</li>
  <li>Укажите любые серверы DNS в текстовом поле <strong>Серверы DNS</strong>.</li>
  <li>Укажите любые домены поиска DNS в текстовом поле <strong>Домены поиска DNS</strong>.</li>
  <li>Отметьте параметр <strong>Сеть</strong> и используйте клавиши <strong>+</strong> и <strong>-</strong> для добавления или удаления сетевых интерфейсов виртуальной машины.</li>
  <li>Введите любые настраиваемые скрипты в текстовую область <strong>Настраиваемый скрипт</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Важно:</strong> Cloud-Init поддерживается только версией совместимости кластера версии 3.3 и более поздних.</p>

</div>
<p><strong>Результат</strong></p>

<p>Виртуальная машина загружается, и применяются указанные параметры.</p>

<h2 id="pools">⁠Пулы</h2>

<h3 id="introduction-to-virtual-machine-pools">Введение в пулы виртуальных машин</h3>

<p>Пул виртуальных машин — это группа виртуальных машин, являющихся клонами одного и того же шаблона, и которые могут быть использованы по запросу любым пользователем в указанной группе. Пулы ВМ дают администраторам возможность быстро настроить ряд подготовленных ВМ для пользователей.</p>

<p>Пользователи получают доступ к пулу ВМ, забирая ВМ из пула. Когда пользователь забирает ВМ из пула, ему предоставляется любая из доступных ВМ, если они есть в пуле. На этой ВМ будет та же ОС и те же настроенные параметры, что и в шаблоне, на основе которого был создан пул, но пользователи могут не получать каждый раз одну и ту же машину пула. Пользователи также могут забирать несколько ВМ из одного пула, в зависимости от параметров этого пула.</p>

<p>ВМ из пула машин выполняются без сохранения состояния, что означает, что данные на машинах не сохраняются между перезагрузками. Тем не менее, если пользователь настроит консольные параметры машины, взятой из пула, то эти параметры будут параметрами по умолчанию этого пользователя в этом пуле ВМ.</p>

<p>В основном, ВМ в пуле запускаются, когда их забирает пользователь, и выключаются, когда пользователь завершает работу. Тем не менее, пул ВМ может содержать предварительно запущенные ВМ. Предварительно запущенные машины сохраняются в работающем состоянии и остаются неактивными до тех пор, пока их не возьмёт пользователь. Это даёт возможность начать работу с ВМ немедленно, но такие машины потребляют системные ресурсы и тогда, когда с ними не работают пользователи.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> машины, взятые из пула, выполняются с сохранением состояния, если доступ к машине получен через Портал администрирования, т.к. администраторам необходима возможность записывать изменения на диск в случае необходимости.</p>

</div>

<h3 id="virtual-machine-pool-tasks">Задачи пула виртуальных машин</h3>

<h4 id="creating-a-virtual-machine-pool">Создание пула ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание пула ВМ, содержащего виртуальные машины, созданные на базе общего шаблона.</p>

<p><strong>Инструкция&nbsp;10.1.&nbsp;Создание пула ВМ</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Пулы</strong>.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong> чтобы открыть окно <strong>Добавить пул</strong>.
    <ul>
      <li>В выпадающем меню выберите <strong>Кластер</strong> или используйте выбранное значение по умолчанию.</li>
      <li>В выпадающем меню <strong>Основана на шаблоне</strong> выберите шаблон или используйте выбранное значение по умолчанию. Если был выбран шаблон, по желанию можно использовать выпадающее меню <strong>Подверсия шаблона</strong> чтобы выбрать подверсию шаблона. Шаблон предоставляет стандартные настройки для всех ВМ в пуле.</li>
      <li>В выпадающем меню <strong>Операционная система</strong> выберите <strong>Операционную систему</strong> или используйте значение по умолчанию в шаблоне.</li>
      <li>В выпадающем меню <strong>Оптимизировано для</strong> выберите параметр для использования ВМ в качестве <strong>Рабочего стола</strong> или <strong>Сервера</strong>.</li>
    </ul>
  </li>
  <li>Введите <strong>Имя</strong> и <strong>Описание</strong>, любые <strong>Комментарии</strong> и <strong>Количество ВМ</strong> в пуле.</li>
  <li>Выберите <strong>Максимальное число ВМ на пользователя</strong>, максимальное количество ВМ, разрешённое запускать одному пользователю в одном сеансе. Минимальное число — 1.</li>
  <li>По желанию, нажмите на кнопку <strong>Показать дополнительные параметры</strong> и выполните следующие шаги:
    <ol>
      <li>Перейдите на вкладку <strong>Консоль</strong>. В нижней части окна вкладки отметьте галочкой параметр <strong>Переопределить SPICE прокси</strong> чтобы активировать текстовое поле <strong>Переназначенный адрес прокси SPICE</strong> и укажите адрес прокси SPICE для переопределения глобального прокси SPICE, если он существует.</li>
      <li>Перейдите на вкладку <strong>Пул</strong> и выберите <strong>Тип пула</strong>:
        <ul>
          <li><strong>Вручную</strong> — задача явного возвращения ВМ в пул лежит на администраторе. После того, как администратор вернул машину в пул, настройки машины откатываются до настроек базового шаблона.</li>
          <li><strong>Автоматически</strong> — после выключения машины, её настройки откатываются до настроек базового шаблона, и машина возвращается в пул.</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали и настроили пул ВМ с указанным количеством идентичных машин. Просмотреть виртуальные машины можно в ресурсной вкладке <strong>Виртуальные машины</strong> или на панели сведений ресурсной вкладки <strong>Пулы</strong>; виртуальная машина из пула отличается от независимых ВМ своим значком.</p>

<h4 id="explanation-of-settings-and-controls-in-the-new-pool-window">Объяснение параметров и элементов управления окна «Добавить пул»</h4>

<h5 id="new-pool-general-settings-explained">Объяснение общих параметров добавления нового пула</h5>

<p>В таблице ниже приводятся подробности параметров пулов виртуальных машин, которые необходимо указывать во вкладке <strong>Общие</strong> окна <strong>Добавить пул</strong>. Все другие параметры идентичны параметрам в окне <strong>Добавить ВМ</strong>.</p>

<p><strong>Таблица&nbsp;10.1.&nbsp;Общие параметры</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Число ВМ</strong></p></td>
<td align="left"><p>Позволяет указать число создаваемых и доступных пользователю машин в пуле после его создания. По умолчанию, максимальное число виртуальных машин в пуле — 1000. Это значение настраивается с помощью ключа <code>MaxVmsInPool</code> команды <code>engine-config</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Максимально число ВМ на пользователя</strong></p></td>
<td align="left"><p>Позволяет указать максимальное число ВМ, которое один пользователь может взять из пула в любое время. Значение в этом поле должно быть между <code>1</code> и <code>32,767</code>.</p></td>
</tr>
</tbody>
</table>

<h5 id="new-pool-pool-settings-explained">Параметры пула во вкладке «Добавить пул»</h5>

<p>В таблице ниже приводятся подробности параметров, требуемых во вкладке <strong>Пул</strong> окна <strong>Добавить пул</strong>.</p>

<p>⁠<strong>Таблица&nbsp;10.2.&nbsp;Параметры консоли</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Тип пула</strong></p></td>
<td align="left"><p>В этом выпадающем меню можно указать тип пула ВМ. Доступны следующие параметры:</p>
<ul>
<li><strong>Автоматически</strong>: после того, как пользователь закончил работу с ВМ, взятой из пула, эта машина автоматически возвращается в пул.</li>
<li><strong>Вручную</strong>: после того, как пользователь закончил работу с ВМ, взятой из пула, вернуть эту машину в пул может только администратор вручную.</li>
</ul></td>
</tr>
</tbody>
</table>

<h5 id="new-pool-and-edit-pool-console-settings-explained">Объяснение консольных параметров добавления пула и изменения пула</h5>

<p>В таблице ниже приводятся подробности параметров пулов виртуальных машин, присутствующих во вкладке <strong>Консоль</strong> окна <strong>Добавить пул</strong> или <strong>Изменить пул</strong>. Все другие параметры аналогичны параметрам в окне <strong>Добавить ВМ</strong> и <strong>Изменить ВМ</strong>.</p>

<p><strong>Таблица&nbsp;10.3.&nbsp;Параметры консоли</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Переопределить прокси SPICE</strong></p></td>
<td align="left"><p>Отметьте галочкой этот параметр чтобы включить переопределение параметров прокси SPICE, определённых в глобальной конфигурации. Этот параметр удобен в том случае, если пользователь (подключающийся, например, через Пользовательский портал), находится вне той сети, в которой находятся гипервизоры.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Переопределённый адрес прокси SPICE</strong></p></td>
<td align="left"><p>Прокси, через который клиент SPICE подключается к виртуальным машинам. Параметры этого прокси переопределяют как глобальные настройки прокси SPICE, указанные для окружения oVirt, так и параметры прокси SPICE, указанные для кластера, к которому принадлежит пул ВМ, если этот прокси существует. Адрес должен иметь следующий формат:</p>
<pre><code>протокол://[хост]:[порт]</code></pre></td>
</tr>
</tbody>
</table>

<h4 id="editing-a-virtual-machine-pool">Изменение параметров пула виртуальных машин</h4>

<p><strong>Описание задачи</strong></p>

<p>После создания пула ВМ можно изменить его параметры. Параметры пула ВМ, доступные для изменения, идентичны параметрам, доступным при добавлении нового пула ВМ, за исключением параметра <strong>Число ВМ</strong>, который заменяется на параметр <strong>Увеличить число ВМ в пуле на</strong>.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;10.2.&nbsp;Изменение параметров пула виртуальных машин</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Пулы</strong>, древовидный режим или поисковый функционал чтобы найти и выделить пул ВМ в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить пул</strong>.</li>
  <li>Измените параметры пула ВМ.</li>
  <li>Нажмите <strong>Ok</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Свойства существующего пула ВМ были изменены.</p>

<h4 id="explanation-of-settings-and-controls-in-the-edit-pool-window">Объяснение параметров и элементов управления окна изменения параметров пула</h4>

<h5 id="edit-pool-general-settings-explained">Объяснение общих параметров окна изменения параметров пула</h5>

<p>В таблице ниже приводятся подробности параметров пулов ВМ вкладки <strong>Общие</strong> окна <strong>Изменить пул</strong>. Все другие параметры аналогичны параметрам в окне <strong>Изменить ВМ</strong>.</p>

<p><strong>Таблица&nbsp;10.4.&nbsp;Общие параметры</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Предзапущенные ВМ</strong></p></td>
<td align="left"><p>Даёт возможность указать число тех машин в пуле, работа которых будет начата до того, как их заберёт пользователь, и которые будут сохранять рабочее состояние в момент, когда их берут пользователи. Значение в этом поле должно быть между <code>0</code> и общим числом ВМ в пуле.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Увеличить число ВМ в пуле на</strong></p></td>
<td align="left"><p>Даёт возможность увеличить число ВМ в пуле на указанное количество.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Максимальное число ВМ на пользователя</strong></p></td>
<td align="left"><p>Даёт возможность указать максимальное число машин, которые может взять из пула пользователь в любое время. Значение этого поля должно быть между <code>1</code> и <code>32,767</code>.</p></td>
</tr>
</tbody>
</table>

<h4 id="prestarting-virtual-machines-in-a-pool">Предзапуск виртуальных машин в пуле</h4>

<p>По умолчанию, виртуальные машины в пуле выключены. Когда пользователь запрашивает машину из пула, машина включается и назначается пользователю. И наоборот, предзапущенная ВМ уже работает, и пользователь берёт из пула работающую машину, что уменьшает время ожидания запуска машины перед тем, как получить к ней доступ. После выключения предзапущенной ВМ она возвращается в пул, и значения всех параметров откатываются до изначальных. Максимальное число предзапущенных ВМ в пуле — это общее число всех машин в пуле.</p>

<p><strong>Описание задачи</strong></p>

<p>Предзапущенные ВМ удобны для тех окружений, где пользователям нужен немедленный доступ к машине, не предназначенной конкретно для этого пользователя. Предзапущенные ВМ могут принадлежать только автоматическим пулам.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;10.3.&nbsp;Предзапуск ВМ в пуле</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Пулы</strong>, древовидный режим или поисковый функционал чтобы найти и выделить пул ВМ в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить пул</strong>.</li>
  <li>В поле <strong>Предзапущенные ВМ</strong> введите число предзапущенных ВМ, которые должны находиться в этом пуле.</li>
  <li>Перейдите на вкладку <strong>Пул</strong>. Убедитесь, что <strong>Тип пула</strong> имеет значение <strong>Автоматически</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы указали необходимое количество предзапущенных машин в пуле. Предзапущенные машины работают и доступны для использования.</p>

<h4 id="adding-virtual-machines-to-a-virtual-machine-pool">Добавление виртуальных машин в пул ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>Добавьте больше виртуальных машин в пул, если изначального количества машин в пуле не хватает.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;10.4.&nbsp;Добавление виртуальных машин в пул ВМ</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Пулы</strong>, древовидный режим или поисковый функционал чтобы найти и выделить пул ВМ в списке результатов.</li>
  <li>Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить пул</strong>.</li>
  <li>В поле <strong>Увеличить число ВМ в пуле на</strong> ведите число дополнительных машин, которые нужно добавить в пул.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы добавили дополнительные ВМ в пул.</p>

<h4 id="detaching-virtual-machines-from-a-virtual-machine-pool">Отсоединение виртуальных машин от пула ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>ВМ можно отсоединить от пула. Отсоединение ВМ удаляет машину из пула, и она становится независимой ВМ.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;10.5.&nbsp;Отсоединение виртуальных машин от пула ВМ</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Пулы</strong>, древовидный режим или поисковый функционал чтобы найти и выделить пул ВМ в списке результатов.</li>
  <li>Убедитесь, что ВМ имеет статус <code>Выключена</code>, т.к. нельзя отсоединять рабочую машину. Перейдите на вкладку <strong>ВМ</strong> на панели сведений чтобы увидеть список машин пула.</li>
  <li>Выберите одну или более ВМ и нажмите <strong>Отсоединить</strong> чтобы открыть подтверждающее окно <strong>Отсоединить ВМ</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы отсоединить ВМ от пула.</li>
</ol>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> отсоединённая машина по-прежнему присутствует в окружении, и к ней можно получить доступ в ресурсной вкладке <strong>ВМ</strong>. Обратите внимание, что значок отсоединённой машины меняется, указывая на то, что эта машина теперь является независимой.</p>

</div>
<p><strong>Результат</strong></p>

<p>Мы отсоединили ВМ от пула машин.</p>

<h4 id="removing-a-virtual-machine-pool">Удаление пула ВМ</h4>

<p><strong>Описание задачи</strong></p>

<p>Пул ВМ можно удалить из дата-центра. Все машины пула либо отсоединяются от пула, либо удаляются. Отсоединение машин означает, что эти машины будут сохранены как независимые виртуальные машины.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;10.6.&nbsp;Удаление пула ВМ</strong></p>

<ol>
  <li>Используйте ресурсную вкладку <strong>Пулы</strong>, древовидный режим или поисковый функционал чтобы найти и выделить пул ВМ в списке результатов.</li>
  <li>Нажмите <strong>Удалить</strong> чтобы открыть подтверждающее окно <strong>Удалить пул</strong>.</li>
  <li>Нажмите <strong>OK</strong> чтобы удалить пул.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили пул из дата-центра.</p>

<h3 id="trusted-compute-pools">Пулы доверенных вычислений Trusted Compute Pools</h3>

<h4 id="creating-a-trusted-cluster">Создание доверенного кластера</h4>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> в отсутствие правильно настроенного сервера OpenAttestation эта процедура невыполнима.</p>

</div>
<p><strong>Описание задачи</strong></p>

<p>В этом разделе описывается настройка пула доверенных вычислений. Пулы доверенных вычислений дают возможность разворачивать виртуальные машины на доверенных хостах. С добавлением аттестации, администраторы могут гарантировать, что на хостах выполняется проверенное ПО. Это составляет основу защищённого корпоративного стека.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;10.7.&nbsp;Создание доверенного кластера</strong></p>

<ol>
  <li>В панели навигации выберите вкладку <strong>Кластеры</strong>.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong>.</li>
  <li>Во вкладке <strong>Общие</strong> выберите имя кластера.</li>
  <li>Во вкладке <strong>Общие</strong> отметьте галочкой пункт <strong>Включить службу Virt</strong>.</li>
  <li>Во вкладке <strong>Политика кластера</strong> отметьте параметр <strong>Включить доверенную службу</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы собрали пул доверенных вычислений.</p>

<h4 id="adding-a-trusted-host">Добавление доверенного хоста</h4>

<p><strong>Описание задачи</strong></p>

<p>В этом разделе описывается добавление доверенного хоста в окружение oVirt.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;10.8.&nbsp;</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Хосты</strong>.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong>.</li>
  <li>Во вкладке <strong>Общие</strong> укажите имя хоста.</li>
  <li>
    <p>Во вкладке <strong>Общие</strong> укажите адрес хоста.
<strong>Внимание</strong></p>

    <p>Хост, который будет указан здесь, должен иметь доверие аттестационного сервера.</p>
  </li>
  <li>Во вкладке <strong>Общие</strong>, в выпадающем меню <strong>Кластер хоста</strong> выберите доверенный кластер.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы добавили доверенный хост в окружение oVirt.</p>

<h2 id="virtual-machine-disks">⁠Диски ВМ</h2>

<h3 id="understanding-virtual-machine-storage">Основные сведения о хранилище виртуальных машин</h3>

<p>oVirt поддерживает три типа хранилищ: NFS, iSCSI и FCP.</p>

<p>В каждом типе существует хост-диспетчер пула хранилища (SPM), управляющий доступом хостов к хранилищу. Хост SPM — это единственный узел, имеющий полный доступ в пределах пула хранилища; SPM может изменять метаданные домена хранилища, а также метаданные пула. Все остальные хосты имеют доступ только к данным на образе жёсткого диска виртуальной машины.</p>

<p>По умолчанию, в NFS, локальных или POSIX-совместимых дата-центрах, хост SPM, используя формат тонкого резервирования, создаёт виртуальный диск в виде файла на файловой системе.</p>

<p>В iSCSI и других блочных дата-центрах, хост SPM создаёт группу томов поверх предоставленных номеров LUN, и логические тома используются как диски виртуальных машин. В блочном хранилище, диски ВМ по умолчанию являются предварительно выделенными.</p>

<p>В случае предварительно выделенных виртуальных дисков, создаётся логический том с указанным размером в ГБ. Для исправления ошибок или исследования процессов виртуальной машины, она может быть смонтирована на сервере Red Hat Enterprise Linux с помощью <code>kpartx</code>, <code>vgscan</code>, <code>vgchange</code> и <code>mount</code>.</p>

<p>В случае виртуального диска, созданного с использованием тонкого резервирования, создаётся логический том размером в 1 ГБ. Логический том постоянно контролируется хостом, на котором выполняется ВМ. Как только объём использования ресурсов приближается к установленному порогу, хост оповещает SPM, и SPM увеличивает размер логического тома на 1 ГБ. Хост отвечает за возобновление работы ВМ после увеличения объёма логического тома. Если работа ВМ была приостановлена, это означает, что SPM не смог вовремя увеличить объём диска. Это случается, если SPM слишком занят, или в случае недостаточных объёмов дискового пространства.</p>

<p>У виртуального диска с предварительно выделенным форматом (RAW) немного более высокая скорость записи, чем у виртуального диска в формате тонкого резервирования (Qcow2). Виртуальные диски в формате тонкого резервирования создаются гораздо быстрее. Формат тонкого резервирования рекомендуется для ВМ с умеренным уровнем операций ввода-вывода.</p>

<p>В oVirt версии 3.3 и более поздних была добавлена возможность динамического изменения размера виртуального диска.</p>

<h3 id="understanding-virtual-disks">Основные сведения о виртуальных дисках</h3>

<p>Существует два типа создания виртуальных дисков — <strong>Тонкое резервирование</strong> и <strong>Предварительное выделение</strong>. Предварительно выделенные диски имеют формат RAW, диски с тонким резервированием — формат QCOW2.</p>

<ul>
  <li>Предварительное выделение.</p> У предварительно выделенного диска есть зарезервированное хранилище, объём которого равен объёму самого диска. Запасное устройство хранения (файл/блочное устройство) представляется виртуальной машине напрямую, без промежуточного слоя, что даёт лучшую производительность, без необходимости выделения дискового пространства во время выполнения. На SAN (iSCSI, FCP) это достигается с помощью создания блочного устройства, размер которого равен размеру виртуального диска. На NFS это достигается с помощью забивания резервного образа жёсткого диска нулями. Предварительное выделенное дисковое пространство в домене хранилища NFS предполагает, что резервное хранилище не имеет формат QCOW2, и что нули не будут дублироваться в файле образа жёсткого диска. (Если эти предпосылки не выполнены, не выбирайте формат предварительного выделения для виртуальных дисков на NFS).</li>
  <li>Тонкое резервирование. </p>Для разрежённых виртуальных дисков резервное дисковое пространство не резервируется, а выделяется по мере необходимости во время работы.  Это даёт возможность для превышенного выделения дискового пространства при условии, что дисковое пространство большинства дисков не использовано полностью, и что возможности хранилища можно использовать лучшим образом. Для этого требуется, чтобы резервное хранилище контролировало запросы на запись, что может привести к некоторым проблемам производительности. На NFS запасное дисковое пространство реализуется с использованием файлов. На SAN это реализуется с помощью создания блочного устройства, размер которого меньше, чем установленный размер виртуального диска, и с помощью обмена информацией с гипервизором для контролирования необходимого выделения ресурсов. Эта схема не требует поддержки со стороны нижележащих устройств хранения.</li>
</ul>

<p>Возможные сочетания типов хранилищ и форматов описаны ниже в таблице.</p>

<p><strong>Таблица&nbsp;11.1.&nbsp;Разрешённые сочетания хранилищ</strong></p>

<table>
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Хранилище</p></th>
<th align="left"><p>Формат</p></th>
<th align="left"><p>Тип</p></th>
<th align="left"><p>Примечание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>NFS или iSCSI/FCP</p></td>
<td align="left"><p>RAW или Qcow2</p></td>
<td align="left"><p>Разрежённый или предварительно выделенный</p></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>NFS</p></td>
<td align="left"><p>RAW</p></td>
<td align="left"><p>Разрежённый</p></td>
<td align="left"><p>Файл с изначальным размером, равным объёму дискового пространства, выделенного виртуальному диску, без форматирования.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>NFS</p></td>
<td align="left"><p>RAW</p></td>
<td align="left"><p>Разрежённый</p></td>
<td align="left"><p>Файл с почти нулевым изначальным размером, без форматирования.</p></td>
</tr>
<tr class="even">
<td align="left"><p>NFS</p></td>
<td align="left"><p>Qcow2</p></td>
<td align="left"><p>Разрежённый</p></td>
<td align="left"><p>Файл с почти нулевым изначальным размером, в формате RAW. Последующие слои будут форматированы в Qcow2.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SAN</p></td>
<td align="left"><p>RAW</p></td>
<td align="left"><p>Предварительно выделенный</p></td>
<td align="left"><p>Блочное устройство с изначальным размером, равным объёму дискового пространства, выделенного виртуальному диску, без форматирования.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SAN</p></td>
<td align="left"><p>Qcow2</p></td>
<td align="left"><p>Предварительно выделенный</p></td>
<td align="left"><p>Блочное устройство с изначальным размером, равным объёму дискового пространства, выделенного виртуальному диску, в формате Qcow2.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SAN</p></td>
<td align="left"><p>Qcow2</p></td>
<td align="left"><p>Разрежённый</p></td>
<td align="left"><p>Блочное устройство с изначальным размером гораздо меньше размера, определённого для виртуального диска (на данный момент — 1ГБ), в формате Qcow2, для которого дисковое пространство выделяется по мере необходимости (на данный момент — фрагментами по 1ГБ).</p></td>
</tr>
</tbody>
</table>

<h3 id="shareable-disks-in-ovirt">Общие диски в oVirt</h3>

<p>Некоторым приложениям необходимо общее хранилище для серверов. oVirt даёт возможность пометить жёсткие диски виртуальной машины меткой <strong>может быть общим</strong> и присоединить эти диски к виртуальным машинам. Таким образом один виртуальный диск может использоваться несколькими, ориентированными на кластер гостями.</p>

<p>Общие диски не являются универсальным решением. Для таких приложений, как серверы баз данных, собранных в кластер, и других высокодоступных служб, общие диски подходят. Но присоединение общего диска к нескольким гостям, не ориентированным на кластер, с большой вероятностью приведёт к повреждению данных, т.к. операции чтения/записи гостей не скоординированы.</p>

<p>Сделать снимок общего диска невозможно. Виртуальные диски, с которых были сделаны снимки, нельзя позже отметить как потенциально общие.</p>

<p>Отметить диск как потенциально общий можно либо во время его создания, либо изменив его свойства позже.</p>

<h3 id="read-only-disks-in-ovirt">Диски, доступные только для чтения, в oVirt</h3>

<p>Некоторым приложениям требуются общие данные, доступные только для чтения. oVirt даёт возможность пометить жёсткие диски ВМ как <strong>Доступные только для чтения</strong> и присоединить эти диски к виртуальным машинам. Если диск помечен как <strong>может быть общим</strong>, его можно добавить некоторым ВМ в режиме только для чтения, а другим — как перезаписываемый. Таким образом, данные с одного диска могут читать несколько ориентированных на кластер гостей, а права на запись принадлежат администратору.</p>

<p>Плавающие диски всегда имеют доступ на запись, их нельзя пометить как только для чтения.</p>

<p>Поставить/убрать пометку «только для чтения» можно только на неактивный диск.</p>

<p>Отметку «только для чтения» можно поставить либо во время создания диска либо изменив параметры диска позже.</p>

<h3 id="virtual-disk-tasks">Задачи виртуальных дисков</h3>

<h4 id="creating-floating-virtual-disks">Создание плавающих виртуальных дисков</h4>

<p><strong>Описание задачи</strong></p>

<p>Создание виртуального диска, не принадлежащего никакой виртуальной машине. Затем этот диск можно присоединить к одной ВМ или к нескольким, если диск можно сделать общим.</p>

<p><strong>Инструкция&nbsp;11.1.&nbsp;Создание плавающих виртуальных дисков</strong></p>

<ol>
  <li>Перейдите на ресурсную вкладку <strong>Диски</strong>.</li>
  <li>Нажмите <strong>Добавить</strong> чтобы открыть окно <strong>Добавить виртуальный диск</strong>.
<img alt="Add Virtual Disk Window" title="Окно добавления виртуального диска" src="./OVirt Administration Guide — oVirt_files/Add_Virtual_Disk.png">
<strong>Рисунок&nbsp;11.1.&nbsp;Окно добавления виртуального диска</strong></li>
  <li>Отметьте соответствующий флажок, чтобы указать, будет ли виртуальный диск <strong>Внутренним</strong> или <strong>Внешним (прямой Lun)</strong> диском.</li>
  <li>Введите <strong>Размер(ГБ)</strong>, <strong>Псевдоним</strong> и <strong>Описание</strong> виртуального диска.</li>
  <li>В выпадающем меню выберите <strong>Интерфейс</strong>, <strong>Политику распределения</strong>, <strong>Дата-центр</strong> и <strong>Домен хранилища</strong> виртуального диска.</li>
  <li>Проставьте флажки для пунктов <strong>Очистить после удаления</strong>, <strong>Загрузочный</strong> и <strong>Можно сделать общим</strong>, чтобы включить каждый из этих параметров.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали виртуальный диск, который можно прикрепить к одной или более ВМ, в зависимости от его параметров.</p>

<h4 id="explanation-of-settings-in-the-new-virtual-disk-window">Объяснение параметров окна добавления виртуального диска</h4>

<p><strong>Таблица&nbsp;11.2.&nbsp;Параметры добавления виртуального диска: внутренний диск</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Размер(ГБ)</strong></p></td>
<td align="left"><p>Размер нового виртуального диска в ГБ.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Псевдоним</strong></p></td>
<td align="left"><p>Имя виртуального диска, ограничение в 40 символов.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Описание виртуального диска. Рекомендуется, но не обязательно.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Интерфейс</strong></p></td>
<td align="left"><p>Виртуальный интерфейс, представляемый диском виртуальным машинам. <strong>VirtIO</strong> работает быстрее, но требует драйверов. В ОС Red Hat Enterprise Linux версии 5 и поздних эти драйверы включены. В ОС Windows эти драйверы отсутствуют, но их можно установить с образа гостевых утилит (guest tools ISO) или с виртуальной дискеты. Устройствам IDE специальные драйверы не нужны.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Политика распределения</strong></p></td>
<td align="left"><p>Политика распределения для нового вирт.диска. <strong>Предварительное выделение</strong> сразу предоставляет весь размер диска в домене хранилища во время создания виртуального диска. <strong>Тонкое резервирование</strong> предоставляет 1ГБ дискового объёма во время создания вирт.диска и устанавливает максимальный предел, до которого может быть увеличен его размер. Предварительно выделенные диски создаются дольше, чем диски с тонким резервированием, но имеют лучшую производительность операций чтения-записи. Предварительно выделенные диски рекомендуются для серверов. Диски с тонким резервированием создаются быстрее, чем предварительно выделенные диски и позволяют превышенное выделение хранилища. Диски с тонким резервированием рекомендуются для рабочих столов.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Дата-центр</strong></p></td>
<td align="left"><p>Дата-центр, в котором будет доступен диск.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Домен хранилища</strong></p></td>
<td align="left"><p>Домен хранилища, в котором будет расположен виртуальный диск. В выпадающем меню показаны все домены хранилища, доступные в указанном кластере, а также общее и доступное на данный момент дисковое пространство в домене.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Очистить после удаления</strong></p></td>
<td align="left"><p>Позволяет включить усиленную защиту при удалении конфиденциальных данных во время удаления виртуального диска.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Загрузочный</strong></p></td>
<td align="left"><p>Позволяет отметить виртуальный диск как загрузочный.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Может быть общим</strong></p></td>
<td align="left"><p>Позволят присоединить виртуальный диск больше, чем к одной машине одновременно.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Только для чтения</strong></p></td>
<td align="left"><p>Позволяет установить доступ к диску только для чтения. Один и тот же диск можно одновременно присоединить в режиме только для чтения к одной машине, и как перезаписываемый — к другой.</p></td>
</tr>
</tbody>
</table>

<p>Параметр <strong>Внешний (Прямой Lun)</strong> может быть показан как <strong>Таргеты &gt; LUN</strong> или <strong>LUN &gt; Таргеты</strong>. <strong>Таргеты &gt; LUN</strong> сортирует доступные LUN в соответствии с хостом, на котором они обнаружены, а <strong>LUN &gt; Таргеты</strong> показывает единый список LUN.</p>

<p><strong>Таблица&nbsp;11.3.&nbsp;Параметры добавления виртуального диска: Внешний (прямой Lun)</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя поля</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Псевдоним</strong></p></td>
<td align="left"><p>Имя виртуального диска, ограничено 40 символами.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Описание</strong></p></td>
<td align="left"><p>Описание виртуального диска. Это поле рекомендуется, но не обязательно.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Интерфейс</strong></p></td>
<td align="left"><p>Виртуальный интерфейс, который диск предоставляет виртуальным машинам. <strong>VirtIO</strong> работает быстрее, но требует драйверов. В ОС Red Hat Enterprise Linux версии 5 и поздних эти драйверы включены. В ОС Windows эти драйверы отсутствуют, но их можно установить с образа гостевых утилит (guest tools ISO) или с виртуальной дискеты. Устройствам IDE специальные драйверы не нужны.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Дата-центр</strong></p></td>
<td align="left"><p>Дата-центр, в котором будет доступен виртуальный диск.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Использовать хост</strong></p></td>
<td align="left"><p>Хост, к которому будет примонтирован LUN. Можно выбрать любой хост в дата-центре.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Тип хранилища</strong></p></td>
<td align="left"><p>Тип внешнего LUN для добавления. Можно выбрать <strong>iSCSI</strong> или <strong>Оптоволоконный канал</strong>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Обнаружение таргетов</strong></p></td>
<td align="left"><p>В случае использования внешних LUN iSCSI и выбранного пункта <strong>Таргеты &gt; LUN</strong> этот раздел можно развернуть. <strong>Адрес</strong> — имя хоста или IP-адрес целевого сервера. <strong>Порт</strong> — порт, через который будет осуществляться попытка соединения с целевым сервером. Порт по умолчанию — 3260. <strong>Аутентификация пользователя</strong> — серверу iSCSI требуется аутентификацию пользователя. Поле <strong>Аутентификация пользователя</strong> становится видимым, если используются внешние LUN iSCSI. <strong>Имя пользователя CHAP</strong> — имя пользователя, которому разрешена авторизация на LUN. Это поле становится доступным, если отмечен пункт <strong>Аутентификация пользователя</strong>. <strong>Пароль CHAP</strong> — пароль пользователя с правами для авторизации на LUN. Это поле становится доступным, если отмечен пункт <strong>Аутентификация пользователя</strong>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Загрузочный</strong></p></td>
<td align="left"><p>Позволяет отметить виртуальный диск как загрузочный..</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Может быть общим</strong></p></td>
<td align="left"><p>Позволят присоединить виртуальный диск больше, чем к одной машине одновременно.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Только для чтения</strong></p></td>
<td align="left"><p>Позволяет установить доступ к диску только для чтения. Один и тот же диск можно одновременно присоединить в режиме только для чтения к одной машине, и как перезаписываемый — к другой.</p></td>
</tr>
</tbody>
</table>

<p>Заполните поля в разделе <strong>Обнаружение таргетов</strong> и нажмите <strong>Обнаружить</strong> чтобы обнаружить целевой сервер. Затем можно нажать на кнопку <strong>Авторизоваться на всех</strong> чтобы получить список всех доступных LUN на целевом сервере, и с помощью флажков рядом с каждым LUN отметить LUN для добавления.</p>

<p>Использование прямых LUN в качестве образов жёстких дисков ВМ убирает слой абстракции между машинами и их данными.</p>

<p>При использовании прямых LUN в качестве образов жёстких дисков ВМ необходимо учитывать следующие факторы:</p>

<ul>
  <li>Динамическая миграция хранилища образов жёстких дисков прямых LUN не поддерживается.</li>
  <li>Диски прямых LUN не включаются в операции экспорта виртуальных машин.</li>
  <li>Диски прямых LUN не включаются в снимки виртуальных машин.</li>
</ul>

<h4 id="moving-a-virtual-disk">Перенос виртуального диска</h4>

<p><strong>Описание задачи</strong></p>

<p>Перенос виртуального диска, присоединённого к ВМ или являющегося плавающим виртуальным диском, с одного домена хранилища на другой.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> если виртуальный диск присоединён к виртуальной машине, которая была создана на базе шаблона и с использованием тонкого резервирования, то диски для этого базового шаблона должны копироваться в тот же домен хранилища, что и виртуальный диск.</p>

</div>
<p>⁠</p>

<p><strong>Инструкция&nbsp;11.2.&nbsp;Перенос виртуального диска</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Диски</strong>.</li>
  <li>Выберите виртуальные диски, которые нужно перенести.</li>
  <li>Нажмите на кнопку <strong>Переместить</strong> чтобы открыть окно <strong>Переместить диск</strong>.</li>
  <li>В выпадающем меню <strong>Таргет</strong> выберите домен хранилища, куда будет перемещён виртуальный диск.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Виртуальные диски перемещаются в целевой домен хранилища, во время переноса диски имеют статус <code>Заблокирован</code>.</p>

<h4 id="copying-a-virtual-disk">Копирование виртуального диска</h4>

<p><strong>Описание задачи</strong></p>

<p>Виртуальный диск, присоединённый к шаблону, можно перенести из одного домена хранилища в другой.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;11.3.&nbsp;Копирование виртуального диска</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Диски</strong>.</li>
  <li>Выберите виртуальные диски, которые нужно скопировать.</li>
  <li>Нажмите на кнопку <strong>Копировать</strong> чтобы открыть окно <strong>Копировать диск</strong>.</li>
  <li>В выпадающем меню <strong>Таргет</strong> выберите домен хранилища, куда будет скопирован виртуальный диск.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Виртуальные диски копируются в целевой домен хранилища, во время копирования диски имеют статус <code>Заблокирован</code>.</p>

<h2 id="backups">⁠Резервное копирование</h2>

<h3 id="backing-up-and-restoring-ovirt">Резервное копирование и восстановление oVirt</h3>

<h4 id="backing-up-ovirt---overview">Обзор: резервное копирование oVirt</h4>

<p>Если создание полных резервных копий машины, на которой установлена oVirt, рекомендуется каждый раз, когда вносятся изменения параметров этой машины, то для резервных копий только ключевых файлов, имеющих отношение к oVirt, предоставляется специальная утилита. Эту утилиту — команду <code>engine-backup</code> — можно использовать для быстрого создания резервной копии базы данных ЦУ и файлов конфигурации в единый файл, который можно легко сохранить.</p>

<h4 id="syntax-for-the-engine-backup-command">Синтаксис команды engine-backup</h4>

<p>Команда <code>engine-backup</code> может работать в одном из двух базовых режимов:</p>

<pre class="highlight plaintext"><code># engine-backup --mode=backup

# engine-backup --mode=restore
</code></pre>

<p>Эти два режима далее можно расширить с помощью набора параметров, который дают возможность указать диапазон создания резервной копии, а также различные учётные данные для базы данных ЦУ. Ниже приводится полный список параметров и их значений:</p>

<p><strong>Базовые параметры</strong></p>

<p><em><code>--mode</code></em><br>
Указывает, будет ли команда выполнять операцию резервного копирования или операцию восстановления. Доступно два варианта — <code>backup</code> и <code>restore</code>. Это необходимый параметр.</p>

<p><em><code>--file</code></em><br>
Указывает путь и имя файла, который будет создан во время операции резервного копирования, а также путь и имя файла, из которого будет прочитаны данные для восстановления в режиме восстановления. Это необходимый параметр для обоих режимов.</p>

<p><em><code>--log</code></em><br>
Указывает путь и имя файла, в который будет записываться журнал операции резервного копирования или восстановления. Это необходимый параметр для обоих режимов.</p>

<p><em><code>--scope</code></em><br>
Указывает диапазон операции резервного копирования или восстановления. Есть два параметра: <code>all</code>, для создания резервной копии как базы данных ЦУ oVirt, так и параметров конфигурации, и <code>db</code>, для создания резервной копии только базы данных ЦУ oVirt.</p>

<p><strong>Параметры базы данных</strong></p>

<p>Следующие параметры доступны только при использовании команды <code>engine-backup</code> в режиме <code>restore</code>.</p>

<p><em><code>--change-db-credentials</code></em><br>
Даёт возможность указать альтернативные учётные данные для восстановления базы данных ЦУ, используя другие учётные данные, чем те, которые хранятся в самой базе данных. Указание этого параметра даёт возможность также добавить следующие параметры.</p>

<p><em><code>--db-host</code></em><br>
IP-адрес полного доменного имени хоста, на котором расположена база данных. Это необходимый параметр.</p>

<p><em><code>--db-port</code></em><br>
Порт, через который будет создаваться подключение к базе данных.</p>

<p><em><code>--db-user</code></em><br>
Имя пользователя, который будет производить подключение к базе данных. Это необходимый параметр.</p>

<p><em><code>--db-passfile</code></em><br>
Файл, в котором хранится пароль, с помощью которого будет производиться подключение к базе данных. Необходимо указать либо этот параметр, либо <em><code>--db-password</code></em>.</p>

<p><em><code>--db-password</code></em><br>
Простой текстовый пароль, с помощью которого будет производиться подключение к базе данных. Необходимо указать либо этот параметр, либо <em><code>--db-passfile</code></em>.</p>

<p><em><code>--db-name</code></em><br>
Имя базы данных, в которую будет восстановлена база данных. Это необходимый параметр.</p>

<p><em><code>--db-secured</code></em><br>
Указывает, что соединение к базе данных должно быть защищено.</p>

<p><em><code>--db-secured-validation</code></em><br>
Указывает, что должна быть выполнена проверка соединения до хоста.</p>

<p><strong>Справка</strong></p>

<p><em><code>--help</code></em><br>
Предоставляет обзор доступных режимов и параметров, а также примеры использования, примеры создания новой базы данных и настройки брандмауэра в сочетании с созданием резервной копии/восстановлением oVirt.</p>

<h4 id="creating-a-backup-with-the-engine-backup-command">Создание резервной копии при помощи команды engine-backup</h4>

<p><strong>Описание задачи</strong></p>

<p>Процесс создания резервной копии базы ЦУ oVirt и параметров oVirt с использованием команды <code>engine-backup</code> достаточно прост, и его можно выполнить при активной oVirt.</p>

<p><strong>Инструкция&nbsp;12.1.&nbsp;Создание резервной копии oVirt</strong></p>

<ol>
  <li>Авторизуйтесь на машине, где выполняется oVirt.</li>
  <li>
    <p>Выполните следующую команду для создания полной резервной копии:</p>
<strong>Пример&nbsp;12.1.&nbsp;Создание полной резервной копии</strong></p>
    # engine-backup –scope=all –mode=backup –log=[file name] –file=[file name]</p>

    <p>Или выполните команду для создания резервной копии только базы данных ЦУ oVirt:</p>
<strong>Пример&nbsp;12.2.&nbsp;Создание резервной копии базы данных engine</strong></p>

<pre class="highlight plaintext"><code># engine-backup --scope=db --mode=backup --log=[file name] --file=[file name]
</code></pre>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>С помощью указанного пути и имени файла создаётся файл <code>tar</code>, содержащий резервную копию базы данных ЦУ oVirt или базы данных ЦУ и параметров конфигурации oVirt.</p>

<h4 id="restoring-a-backup-with-the-engine-backup-command">Восстановление из резервной копии с помощью команды engine-backup</h4>

<p>Не смотря на то, что процесс восстановления из резервной копии с помощью команды <code>engine-backup</code> не представляет ничего сложного, он требует нескольких дополнительных шагов, по сравнению с процессом создания резервной копии, в зависимости от цели назначения, где будет храниться созданная копия. Например, команду <code>engine-backup</code> можно использовать для восстановления резервных копий в свежую установку oVirt, поверх уже существующей установки oVirt, и с использованием локальных или удалённых баз данных.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> резервные копии можно восстанавливать только в окружения с той же мажорной версией, что использовалась при создании этой резервной копии. Например, резервную копию окружения oVirt версии 3.3 можно восстановить в другое окружение oVirt версии 3.3. Чтобы узнать версию  oVirt, содержащуюся в файле резервной копии, распакуйте архив и прочитайте значение в файле <code>version</code>, расположенном в корневом каталоге распакованных файлов.</p>

</div>

<h4 id="restoring-a-backup-to-a-fresh-installation">Восстановление резервной копии в свежую установку</h4>

<p><strong>Описание задачи</strong></p>

<p>С помощью команды <code>engine-backup</code> можно восстановить резервную копию в свежую установку oVirt. Следующая процедура должна быть выполнена на машине с установленной базовой ОС и установленными необходимыми пакетами для oVirt, но команда <code>engine-setup</code> ещё ни разу не выполнялась. Данная процедура подразумевает, что с машины, на которой должна быть восстановлена резервная копия, имеется доступ к файлу резервной копии.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> команда <code>engine-backup</code> не выполняет фактического создания базы данных ЦУ oVirt или начальной настройки службы <code>postgresql</code>. Соответственно, эти задачи должны быть выполнены вручную, при восстановлении резервной копии в свежую установку, как это описано ниже.</p>

</div>
<p><strong>Инструкция&nbsp;12.2.&nbsp;Восстановление резервной копии в свежую установку</strong></p>

<ol>
  <li>Авторизуйтесь на машине, где установлена oVirt.</li>
  <li>Вручную создайте пустую базу данных, куда должна быть помещена восстановленная резервная копия базы данных, и настройте службу <code>postgresql</code>:
    <ol>
      <li>
        <p>Выполните следующие команды для инициализации базы данных <code>postgresql</code>, запустите службу <code>postgresql</code> и убедитесь, что служба стартует при загрузке:</p>
    # service postgresql initdb</p>
    # service postgresql start</p>
    # chkconfig postgresql on</p>
      </li>
      <li>
        <p>Выполните следующие команды для получения доступа к командной строке postgresql:</p>
    # su postgres</p>
    $ psql</p>
      </li>
      <li>
        <p>Выполните команду для создания нового пользователя:</p>
    postgres=# create role [имя_пользователя] with login encrypted password '[пароль]';</p>
      </li>
      <li>
        <p>Выполните следующую команду для создания новой базы данных:</p>
    postgres=# create database [имя_базы_данных] owner [имя_пользователя] template template0 encoding 'UTF8' lc_collate 'en_US.UTF-8' lc_ctype 'en_US.UTF-8';</p>
      </li>
      <li>Внесите следующие изменения в файл <code>/var/lib/pgsql/data/pg_hba.conf</code>:
        <ul>
          <li>
            <p>Для локальных баз данных, замените существующие директивы в разделе, который начинается с <code>Local</code> в конце файла, на следующие директивы:</p>
    host    [имя_базы_данных]    [имя_пользователя]    0.0.0.0/0  md5
    host    [имя_базы_данных]    [имя_пользователя]    ::0/0      md5</p>
          </li>
          <li>
            <p>Для удалённых баз данных, добавьте следующие строки непосредственно ниже строки, начинающейся с <code>Local</code> в конце файла, заменив <em>X.X.X.X</em> IP-адресом oVirt:</p>
    host    [имя_базы_данных]    [имя_пользователя]    X.X.X.X/32   md5</p>
          </li>
        </ul>
      </li>
      <li>Выполните следующую команду для перезапуска службы <code>postgresql</code>:</p>
    # service postgresql restart</li>
    </ol>
  </li>
  <li>
    <p>Восстановите резервную копию с помощью команды <code>engine-backup</code> с параметром <em><code>--change-db-credentials</code></em> для передачи учётных данных новой базы данных:</p>
    # engine-backup –mode=restore –file=[имя_файла] –log=[имя_файла] –change-db-credentials –db-host=[местоположение_базы_данных] –db-name=[имя_базы_данных] –db-user=[имя_пользователя] –db-password=[пароль]</p>

    <p>В случае правильного выполнения команды вывод будет следующим:</p>

<pre class="highlight plaintext"><code>You should now run engine-setup.
Done.
</code></pre>
  </li>
  <li>Введите следующую команду и следуйте указаниям для настройки параметров oVirt:</p>
    # engine-setup</li>
</ol>

<p><strong>Результат</strong></p>

<p>База данных ЦУ oVirt и файлы конфигурации oVirt были восстановлены до версии резервной копии.</p>

<h4 id="restoring-a-backup-to-overwrite-an-existing-installation">Восстановление резервной копии для перезаписи существующей установки</h4>

<p><strong>Описание задачи</strong></p>

<p>С помощью команды <code>engine-backup</code> можно восстановить резервную копию на машину с уже установленной и настроенной oVirt. Это удобно в случаях, когда была сделана резервная копия установки, в неё были внесены изменения, и её необходимо восстановить из резервной копии.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> при восстановлении резервной копии и перезаписи существующих файлов установки, перед использованием команды <code>engine-backup</code> необходимо выполнить команду <code>engine-cleanup</code> для очистки существующей установки. Поскольку команда <code>engine-backup</code> только очищает базу данных ЦУ oVirt, а не удаляет базу данных или пользователя-владельца, то нет необходимости создавать новую базу данных или указывать её учётные данные, т.к. пользователь и база данных уже существуют.</p>

</div>
<p><strong>Инструкция&nbsp;12.3.&nbsp;Восстановление резервной копии для перезаписи существующей установки</strong></p>

<ol>
  <li>Авторизуйтесь на машине, где установлена oVirt.</li>
  <li>
    <p>Введите следующую команду и следуйте указаниям для удаления файлов конфигурации базы данных и очистки базы данных, связанной с oVirt:</p>
    # engine-cleanup</p>
  </li>
  <li>
    <p>Восстановите резервную копию с  помощью команды <code>engine-backup</code>:</p>
    # engine-backup –mode=restore –file=[file name] –log=[file name]</p>

    <p>В случае успешного выполнения команды вывод будет следующим:</p>

<pre class="highlight plaintext"><code>You should now run engine-setup.
Done.
</code></pre>
  </li>
  <li>Введите следующую команду и следуйте указаниям для повторной настройки брандмауэра и проверки того, что служба <code>ovirt-engine</code> настроена правильно:</p>
    # engine-setup</li>
</ol>

<p><strong>Результат</strong></p>

<p>База данных ЦУ oVirt и файлы конфигурации oVirt были восстановлены до версии резервной копии.</p>

<h4 id="restoring-a-backup-with-different-credentials">Восстановление резервной копии с другими учётными данными</h4>

<p><strong>Описание задачи</strong></p>

<p>С помощью команды <code>engine-backup</code> можно восстановить резервную копию на машину с уже установленной и настроенной oVirt, но учётные данные базы данных резервной копии отличаются от учётных данных базы данных той машины, на которой предполагается восстановить резервную копию. Это удобно там, где резервная копия была сделана для одной системы, а восстановить резервную копию необходимо в другой.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong>  при восстановлении резервной копии и перезаписи существующих файлов установки, перед использованием команды <code>engine-backup</code> необходимо выполнить команду <code>engine-cleanup</code> для очистки существующей установки. Поскольку команда <code>engine-backup</code> только очищает базу данных ЦУ oVirt, а не удаляет базу данных или пользователя-владельца, то нет необходимости создавать новую базу данных или указывать её учётные данные, т.к. пользователь и база данных уже существуют. Тем не менее, если учётные данные владельца базы данных неизвестны, их необходимо сменить перед восстановлением резервной копии.</p>

</div>
<p><strong>Инструкция&nbsp;12.4.&nbsp;Восстановление резервной копии с другими учётными данными</strong></p>

<ol>
  <li>Авторизуйтесь на машине, где установлена oVirt.</li>
  <li>
    <p>Введите следующую команду и следуйте указаниям для удаления файлов конфигурации базы данных и очистки базы данных, связанной с oVirt:</p>
    # engine-cleanup</p>
  </li>
  <li>Смените пароль владельца базы данных ЦУ oVirt, если учётные данные этого пользователя неизвестны:</p>
    <ol>
      <li>
        <p>Выполните следующие команды для получения доступа к командной строке postgresql:</p>
    # su postgres
    $ psql</p>
      </li>
      <li>
        <p>Выполните следующую команду для смены пароля пользователя-владельца базы данных ЦУ oVirt:</p>
    postgres=# alter role [имя_пользователя] encrypted password '[новый_пароль]';</p>
      </li>
    </ol>
  </li>
  <li>
    <p>Восстановите резервную копию с помощью команды <code>engine-backup</code> с параметром <em><code>--change-db-credentials</code></em>:</p>
    # engine-backup –mode=restore –file=[file name] –log=[file name] –change-db-credentials –db-host=[database location] –db-name=[database name] –db-user=[user name] –db-password=[password]</p>

    <p>В случае правильного выполнения команды вывод будет следующим:</p>

<pre class="highlight plaintext"><code>You should now run engine-setup.
Done.
</code></pre>
  </li>
  <li>Введите следующую команду и следуйте указаниям для повторной настройки брандмауэра и проверки того, что служба <code>ovirt-engine</code> настроена правильно:</p>
    # engine-setup</li>
</ol>

<p><strong>Результат</strong></p>

<p>База данных ЦУ oVirt и файлы конфигурации oVirt были восстановлены до версии резервной копии с помощью предоставленных учётных данных, и oVirt была настроена на использование новой базы данных.</p>

<h3 id="manually-backing-up-and-restoring-ovirt">Создание резервной копии и восстановление резервной копии oVirt вручную</h3>

<h4 id="backing-up-the-engine-database-using-the-backupsh-script">Создание резервной копии базы данных ЦУ oVirt с помощью скрипта backup.sh</h4>

<p><strong>Описание задачи</strong></p>

<p>В oVirt существует скрипт для автоматического создания резервных копий базы данных. Используя этот скрипт на сервере oVirt, можно защититься от возможной потери данных.</p>

<p><strong>Инструкция&nbsp;12.5.&nbsp;Создание резервной копии базы данных ЦУ oVirt с помощью скрипта backup.sh</strong></p>

<ol>
  <li>Перейдите в каталог <code>/usr/share/ovirt-engine/dbscripts/</code>.</li>
  <li>
    <p>Запустите <code>backup.sh</code> с аргументом <em><code>-h</code></em> чтобы увидеть доступные параметры.</p>
    Usage: backup.sh [-h] [-s SERVERNAME] [-p PORT] [-d DATABASE] [-l DIR] -u USERNAME [-v]</p>

<pre class="highlight plaintext"><code>    -s SERVERNAME - The database servername for the database (def. localhost)
    -p PORT       - The database port for the database       (def. 5432)
    -d DATABASE   - The database name                        (def. engine)
    -u USERNAME   - The username for the database.
    -v            - Turn on verbosity (WARNING: lots of output)
    -l DIR        - Backup file directory. 
    -h            - This help text.

for more options please run pg_dump --help
</code></pre>
  </li>
  <li>Снова запустите команду <code>backup.sh</code> с параметрами, необходимыми для имеющегося окружения. Если создаётся резервная копия локальной базы данных <code>engine</code>, параметры <em><code>-s, -p,</code></em> и <em><code>-d</code></em> не нужны. Используйте параметр <em><code>-l</code></em> чтобы указать каталог резервной копии. В результате в указанном каталоге будет создан файл в формате <code>.sql</code>.</li>
  <li>Скопируйте только что созданный файл <code>.sql</code> из указанного каталога в защищённое удалённое местоположение.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы использовали скрипт backup.sh для создания резервной копии базы данных <code>engine</code>.</p>

<h4 id="backing-up-manager-configuration-files">Создание резервной копии файлов конфигурации oVirt</h4>

<p>Изменённые параметры хранятся в oVirt в виде конфигурационных файлов. В этих файлах содержатся конкретные подробности настроек указанного окружения, и для них необходимо создать резервную копию.</p>

<p><strong>Таблица&nbsp;12.1.&nbsp;Файлы и каталоги, подлежащие обязательному резервному копированию</strong></p>

<table>
<colgroup>
<col width="67%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Местоположение</p></th>
<th align="left"><p>Краткое описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>/etc/ovirt-engine/</p></td>
<td align="left"><p>Каталог, содержащий файлы конфигурации oVirt, такие, как <code>engine-config.conf</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p>/etc/yum/pluginconf.d/versionlock.list</p></td>
<td align="left"><p>Файл, содержащий информацию о версии установленных компонентов oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>/etc/pki/ovirt-engine/</p></td>
<td align="left"><p>Сертификаты безопасности, предоставляемые oVirt клиентам.</p></td>
</tr>
<tr class="even">
<td align="left"><p>/usr/share/jasperreports-server-pro/buildomatic/</p></td>
<td align="left"><p>Каталог, содержащий файлы, необходимые для создания сервера отчётов oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>/var/lib/ovirt-engine/backups/</p></td>
<td align="left"><p>Каталог, содержащий файлы резервных копий.</p></td>
</tr>
<tr class="even">
<td align="left"><p>/var/tmp/ovirt-engine/deployments/</p></td>
<td align="left"><p>Каталог, содержащий информацию о развёртываниях.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>/usr/share/ovirt-engine-reports/</p></td>
<td align="left"><p>Каталог, содержащий файлы конфигурации отчётов. В частности, здесь расположены подкаталоги, в которых в текстовом удобочитаемом формате хранятся учётные записи пользователя отчётов.</p></td>
</tr>
<tr class="even">
<td align="left"><p>/root/.rnd</p></td>
<td align="left"><p>Файл случайного начального числа, используемый для создания сертификатов безопасности.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>/var/log/ovirt-engine/setup/</p></td>
<td align="left"><p>Каталог, содержащий журналы с ответами на установочные вопросы. Эти файлы используются при восстановлении oVirt, т.к. они предоставляют информацию, которая была указана во время начальной настройки oVirt.</p></td>
</tr>
</tbody>
</table>

<p>При наличии резервных копий вышеуказанных файлов и каталогов, можно восстановить oVirt до рабочего состояния в случае непредвиденных событий.</p>

<h4 id="restoring-the-engine-database-using-the-restoresh-script">Восстановление базы данных engine с помощью скрипта restore.sh</h4>

<p><strong>Описание задачи</strong></p>

<p>В oVirt существует скрипт для автоматического восстановления базы данных. Используя этот скрипт на сервере oVirt, можно восстановить повреждённую базу данных.</p>

<p><strong>Инструкция&nbsp;12.6.&nbsp;Восстановление базы данных engine с помощью скрипта restore.sh</strong></p>

<ol>
  <li>Перейдите в каталог <code>/usr/share/ovirt-engine/dbscripts/</code>.</li>
  <li>
    <p>Запустите <code>restore.sh</code> с аргументом <em><code>-h</code></em> чтобы увидеть доступные параметры запуска.</p>
    Usage: restore.sh [-h] [-s SERVERNAME] [-p PORT] -u USERNAME -d DATABASE -f FILE [-r]</p>

<pre class="highlight plaintext"><code>    -s SERVERNAME - The database servername for the database (def. localhost)
    -p PORT       - The database port for the database       (def. 5432)
    -u USERNAME   - The username for the database.
    -d DATABASE   - The database name
    -f File       - Backup file name to restore from. 
    -r            - Remove existing database with same name
    -h            - This help text.

for more options please run pg_restore --help
</code></pre>
  </li>
  <li>Снова запустите команду <code>restore.sh</code> с параметрами, необходимыми для имеющегося окружения.  Если создаётся резервная копия локальной базы данных <code>engine</code>, параметры <em><code>-s</code></em> и <em><code>-p</code></em> не нужны. Используйте <em><code>-d</code></em> чтобы указать имя создаваемой базы данных. oVirt ожидает, что первичная база данных будет иметь имя <code>engine</code>. Используйте <em><code>-f</code></em> чтобы указать файл <code>.sql</code>, из которого производится восстановление.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы использовали скрипт restore.sh чтобы восстановить базу данных <code>engine</code>.</p>

<h4 id="restoring-ovirt-configuration-files">Восстановление файлов конфигурации oVirt</h4>

<p><strong>Описание задачи</strong></p>

<p>Восстановление резервной копии файлов конфигурации oVirt.</p>

<p><strong>Инструкция&nbsp;12.7.&nbsp;Восстановление файлов конфигурации oVirt</strong></p>

<ol>
  <li>
    <p>Остановите службу ЦУ:
    # service ovirt-engine stop</p>
  </li>
  <li>
    <p>Полностью удалите все предыдущие установки oVirt:
    # yum remove ovirt-engine</p>
  </li>
  <li>
    <p>Удалите <code>/etc/pki/ovirt-engine</code>:
    # rm -rf /etc/pki/ovirt-engine</p>
  </li>
  <li>
    <p>Удалите главный каталог <code>ovirt-engine</code>:
    # rm -rf /etc/ovirt-engine</p>
  </li>
  <li>
    <p>Установите oVirt:
    # yum install -y ovirt-engine</p>
  </li>
  <li>
    <p>Запустите <code>engine-setup</code>, и укажите те же самые ответы, которые были даны во время первой установки <code>ovirt-engine</code>:
    # engine-setup</p>

    <p>Эти ответы можно найти в журнале <code>/var/log/engine-setup-SETUP-DATE.log</code>, для которого была сделана резервная копия.</p>
  </li>
  <li>
    <p>Остановите службу ЦУ oVirt, которая была перезапущена во время выполнения предыдущей команды:
    # service ovirt-engine stop</p>
  </li>
  <li>Восстановите резервные копии файлов конфигурации в их исходные местоположения.</li>
  <li>
    <p>Убедитесь, что владелец файла <code>.truststore</code> является правильным:
    # chown ovirt:ovirt /etc/pki/ovirt-engine/.truststore</p>
  </li>
  <li>
    <p>Убедитесь, что права доступа для файла <code>ovirt-engine-notifier.conf</code> являются правильными:
    # chmod 640 /usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</p>
  </li>
  <li>Запустите службу ЦУ oVirt:
    # service ovirt-engine start</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы восстановили файлы конфигурации oVirt из резервной копии.</p>

<h2 id="users-and-roles">Пользователи и роли</h2>

<h3 id="introduction-to-users">Введение в понятие пользователей</h3>

<p>Для аутентификации и информации о пользователях в oVirt используются службы внешних каталогов. Все учётные записи пользователей должны создаваться во внешних серверах каталогов; эти пользователи называются <em>пользователи каталога</em>. Исключением является пользователь <code>администратор</code>, который располагается во <code>внутреннем</code> домене, создаваемом во время установки.</p>

<p>После присоединения сервера каталогов к oVirt, пользователей из каталога можно добавить на Портал администрирования, сделав из них <em>пользователей oVirt</em>. Пользователям oVirt можно присваивать различные роли и привилегии, согласно выполняемым пользователями задачам.</p>

<p>Существует два типа пользователей oVirt — конечные пользователи, которые используют и контролируют виртуальные ресурсы через Пользовательский портал, и администраторы, поддерживающие системную инфраструктуру через Портал администрирования. Роли <code>пользователя</code> и роли <code>администратора</code> могут быть присвоены пользователям oVirt для работы с индивидуальными ресурсами, например, с виртуальными машинами и хостами, или для работы с объектами иерархии, такими, как кластеры или дата-центры.</p>

<h3 id="directory-users">Пользователи каталога</h3>

<h4 id="directory-services-support-in-ovirt">Поддержка служб каталога в oVirt</h4>

<p>Во время установки oVirt создаёт своего собственного внутреннего пользователя-администратора, <code>admin</code>. Эта учётная запись предназначена для использования во время первоначальной настройки окружения и для устранения неполадок. Чтобы добавлять других пользователей в oVirt, необходимо присоединить к oVirt сервер каталогов с помощью утилиты управления доменами, <code>engine-manage-domains</code>.</p>

<p>После присоединения как минимум одного сервера каталогов к oVirt можно добавлять пользователей, существующих на сервере, и присваивать им роли через Портал администрирования. Пользователи идентифицируются по имени участника-пользователя (UPN) формы <code>user@domain</code>. Присоединение более одного сервера каталога к oVirt также поддерживается.</p>

<p>Следующие серверы каталогов поддерживаются в oVirt 3.4:</p>

<ul>
  <li>Active Directory</li>
  <li>Identity Management (IdM)</li>
  <li>Red Hat Directory Server 9 (RHDS 9)</li>
  <li>OpenLDAP</li>
</ul>

<p>Необходимо убедиться, что для сервера каталога существуют корректные записи DNS. В частности, убедитесь, что записи DNS для сервера каталогов включают в себя:</p>

<ul>
  <li>Допустимая запись PTR для адреса обратного просмотра сервера каталогов.</li>
  <li>Допустимая запись SRV для LDAP через TCP-порт <code>389</code>.</li>
  <li>Допустимая запись SRV для Kerberos через TCP-порт <code>88</code>.</li>
  <li>Допустимая запись SRV для Kerberos через UDP-порт <code>88</code>.</li>
</ul>

<p>Отсутствие этих записей в DNS делает невозможным добавление домена в конфигурацию oVirt с помощью <code>engine-manage-domains</code>.</p>

<p>Подробности об установке и настройке поддерживаемых серверов каталогов см. в документации поставщиков:</p>

<ul>
  <li>Active Directory - <a href="http://technet.microsoft.com/en-us/windowsserver/dd448614"></a><a href="http://technet.microsoft.com/en-us/windowsserver/dd448614">http://technet.microsoft.com/en-us/windowsserver/dd448614</a>.</li>
  <li>Identity Management (IdM) - <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Identity_Management_Guide/index.html"></a><a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Identity_Management_Guide/index.html">http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Identity_Management_Guide/index.html</a></li>
  <li>Red Hat Directory Server (RHDS) - <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Directory_Server/index.html"></a><a href="http://docs.redhat.com/docs/en-US/Red_Hat_Directory_Server/index.html">http://docs.redhat.com/docs/en-US/Red_Hat_Directory_Server/index.html</a></li>
  <li>OpenLDAP - <a href="http://www.openldap.org/doc/"></a><a href="http://www.openldap.org/doc/">http://www.openldap.org/doc/</a></li>
</ul>

<div class="alert alert-info">
  <p><strong>Важно:</strong> пользователь для администрирования oVirt должен создаваться на сервере каталогов специально. <em>Не</em> используйте администратора сервера каталогов в качестве администратора oVirt.</p>

</div>
<div class="alert alert-info">
  <p><strong>Важно:</strong> установить oVirt (rhevm) и IdM (ipa-server) на одной и той же системе невозможно. IdM несовместима с пакетом mod_ssl, который требуется для oVirt.</p>

</div>
<div class="alert alert-info">
  <p><strong>Важно:</strong> если в качестве сервера каталогов используется Active Directory, и для создания шаблонов и виртуальных машин планируется использовать <code>sysprep</code>, то пользователю-администратору oVirt должен быть передан контроль над доменом для:</p>

  <ul>
    <li><strong>Присоединения компьютера к домену</strong></li>
    <li><strong>Изменения членства в группе</strong></li>
  </ul>

  <p>Информацию о создании учётных записей пользователей в Active Directory см. по ссылке <a href="http://technet.microsoft.com/en-us/library/cc732336.aspx"></a><a href="http://technet.microsoft.com/en-us/library/cc732336.aspx">http://technet.microsoft.com/en-us/library/cc732336.aspx</a>.</p>

  <p>Информацию о передаче контроля в Active Directory см. по ссылке <a href="http://technet.microsoft.com/en-us/library/cc732524.aspx"></a><a href="http://technet.microsoft.com/en-us/library/cc732524.aspx">http://technet.microsoft.com/en-us/library/cc732524.aspx</a>.</p>

</div>
<div class="alert alert-info">
  <p><strong>Внимание:</strong> для аутентификации на сервере каталогов oVirt использует Kerberos. RHDS не имеет встроенной поддержки Kerberos. При использовании RHDS в качестве сервера каталогов необходимо убедиться, что сервер каталогов является службой в допустимом домене Kerberos. Для этого необходимо выполнить следующие шаги, обращая внимание на документацию соответствующего сервера каталогов:</p>

  <ul>
    <li>Настройте модуль <code>memberOf</code> для разрешения RHDS членства в группах. В частности, убедитесь, что атрибуту <em><code>memberofgroupattr</code></em> модуля <code>memberOf</code> присвоено значение <code>uniqueMember</code>. В <strong>OpenLDAP</strong> функционал <code>memberOf</code> называется не «модулем» ("plugin"), а «наложением» ("overlay"), и не требует настройки после установки. Подробности настройки модуля <code>memberOf</code> см. в Red Hat Directory Server&nbsp;9.0 <em>Plug-in Guide</em>.</li>
    <li>Определите сервер каталогов как службу формы <code>ldap/хост@ОБЛАСТЬ</code> в области Kerberos. Замените <em>хост</em> полным доменным именем, связанным с сервером каталогов, а <em>ОБЛАСТЬ</em> полным именем области Kerberos. Имя области Kerberos должно быть указано прописными (заглавными) буквами.</li>
    <li>Создайте файл <code>keytab</code> для сервера каталогов в области Kerberos. Файл <code>keytab</code> содержит пары принципалов Kerberos и связанные с ними зашифрованные ключи. С помощью этих ключей сервер каталогов идентифицирует себя в области Kerberos. Подробности о создании файла <code>keytab</code> см. в документации принципала Kerberos.</li>
    <li>Установите файл <code>keytab</code> на сервере каталогов. Затем настройте RHDS для опознавания файла <code>keytab</code> и примите аутентификацию Kerberos с помощью GSSAPI. Подробности настройки RHDS для использования внешнего файла <code>keytab</code> см. в <em>Руководстве по администрированию</em> Red Hat Directory Server 9.0.</li>
    <li>Проверьте конфигурацию на сервере каталогов, используя команду <code>kinit</code> для аутентификации в качестве пользователя, определённого в области Kerberos. После выполнения аутентификации запустите команду <code>ldapsearch</code> для сервера каталогов. Используйте параметры <em><code>-Y GSSAPI</code></em>, чтобы убедиться, что для аутентификации используется Kerberos.</li>
  </ul>

</div>

<h3 id="user-authorization">Авторизация пользователей</h3>

<h4 id="user-authorization-model">Модель авторизации пользователей</h4>

<p>В oVirt применяется трёхкомпонентный контроль авторизации:</p>

<ul>
  <li>Пользователь, выполняющий действие</li>
  <li>Тип выполняемого действия</li>
  <li>Объект, к которому применяется выполняемое действие</li>
</ul>

<h4 id="user-actions">Действия пользователей</h4>

<p>Для успешного выполнения действия, у <code>пользователя</code> должны быть соответствующие <code>привилегии</code> на <code>объект</code>, к которому применяется действие. Каждый тип действия соответствует <code>привилегии</code>. В системе существует много различных привилегий, для более простого понимания см. схему:</p>

<p><img alt="Actions" title="Действия" src="./OVirt Administration Guide — oVirt_files/No-actions.png"></p>

<p><strong>Рисунок&nbsp;13.1.&nbsp;Действия</strong></p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> некоторые действия применяются больше, чем к одному объекту. Например, копирование шаблона в другой домен хранилища затрагивает как сам шаблон, так и целевой домен хранилища. Пользователь, выполняющий действие, должен иметь соответствующие привилегии для всех объектов, затронутых действием.</p>

</div>

<h4 id="user-permissions">Привилегии пользователя</h4>

<p>Привилегии (права доступа) дают пользователя возможность выполнять действия над объектами, где объектами являются либо индивидуальные объекты либо объекты-контейнеры.</p>

<p><img alt="Permissions &amp; Roles" title="Привилегии &amp; роли" src="./OVirt Administration Guide — oVirt_files/Permissions_roles.png"></p>

<p><strong>Рисунок&nbsp;13.2.&nbsp;Привилегии &amp; роли</strong></p>

<p>Любые привилегии, применимые к объекту-контейнеру, также применяются ко всем составным членам этого контейнера. На диаграмме ниже показана иерархия объектов в системе.</p>

<p><img alt="oVirt Object Hierarchy" title="Иерархия объектов oVirt" src="./OVirt Administration Guide — oVirt_files/Object_heirarchy.png"></p>

<p><strong>Рисунок&nbsp;13.3.&nbsp;Иерархия объектов oVirt</strong></p>

<h3 id="ovirt-user-properties-and-roles">Свойства и роли пользователей в oVirt</h3>

<h4 id="user-properties">Свойства пользователей</h4>

<p>Роли и привилегии — это свойства пользователя. Роли — это заранее заданные наборы привилегий, дающие доступ к разным уровням физических и виртуальных ресурсов. Многоуровневое управление предоставляет тонко настроенную иерархию привилегий/прав доступа. Например, администратор дата-центра имеет права на управление всеми объектами дата-центра, в то время как администратор хоста имеет системные права только на один физический хост.  У одного пользователя могут быть права на работу с одной ВМ, но не на внесение изменений в параметры ВМ, а у другого пользователя могут быть системные привилегии на ВМ.</p>

<h4 id="user-and-administrator-roles">Роли пользователя и администратора</h4>

<p>oVirt предоставляет широкий диапазон заранее настроенных ролей, от администратора с системными привилегиями до конечного пользователя с доступом только к одной ВМ. Не имея возможности изменить или удалить роли по умолчанию, их можно клонировать и задать их параметры или же создать новые роли в соответствии с конкретными требованиями. Существует два типа ролей:</p>

<ul>
  <li>Роль администратора: даёт доступ к <em>Порталу администрирования</em> для управления физическими и виртуальными ресурсами. Роль администратора не даёт никаких привилегий на Пользовательском портале.</li>
  <li>Роль пользователя: даёт доступ к <em>Пользовательскому порталу</em> для доступа и управления виртуальными машинами и шаблонами. Роль пользователя не даёт никаких привилегий на Портале администрирования.</li>
</ul>

<p>Имея, например, роль <code>администратора</code> кластера, мы можем управлять всеми виртуальными машинами в кластере через <em>Портал администрирования</em>. Тем не мене, у нас нет доступа ни к одной из этих машин через <em>Пользовательский портал</em>; для этого нужна роль <code>пользователя</code>.</p>

<h4 id="user-roles-explained">Объяснение ролей пользователей</h4>

<p>Ниже в таблице описаны базовые роли пользователей, которые дают привилегии для доступа и изменения параметров виртуальных машин на Пользовательском портале.</p>

<p>⁠</p>

<p><strong>Таблица&nbsp;13.1.&nbsp;Базовые пользовательские роли в oVirt</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Роль</p></th>
<th align="left"><p>Привилегии</p></th>
<th align="left"><p>Примечания</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>UserRole</p></td>
<td align="left"><p>Доступ к виртуальным машинам и пулам и их использование.</p></td>
<td align="left"><p>Может авторизоваться на Пользовательском портале, работать с присвоенными ВМ и пулами, просматривать статус и сведения о ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>PowerUserRole</p></td>
<td align="left"><p>Может создавать виртуальные машины и шаблоны и управлять ими.</p></td>
<td align="left"><p>Эта роль применяется к пользователю для всего окружения в окне <strong>Параметры</strong>, или для конкретных дата-центров или кластеров. Например, если роль PowerUserRole применяется на уровне дата-центра, то PowerUser может создавать ВМ и шаблоны в дата-центре.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>UserVmManager</p></td>
<td align="left"><p>Системный администратор виртуальной машины.</p></td>
<td align="left"><p>Может управлять виртуальными машинами, создавать и использовать шаблоны, и выполнять миграцию ВМ. Пользователю, создающему ВМ на Пользовательском портале, автоматически присваивается роль UserVmManager на этой машине.</p></td>
</tr>
</tbody>
</table>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> в oVirt 3.0 роль <strong>PowerUserRole</strong> давала права только на машины, напрямую присвоенные пользователю PowerUser, или на машины, созданные пользователем PowerUser. На данный момент роль <strong>VmCreator</strong> предоставляет привилегии, ранее предоставляемые ролью <strong>PowerUserRole</strong>. Роль <strong>PowerUserRole</strong> теперь можно применять на общесистемном уровне или на конкретных дата-центрах или кластерах, и она даёт привилегии на все виртуальные машины и шаблоны в пределах системы или конкретного ресурса. Присвоение роли <strong>PowerUserRole</strong> эквивалентно присвоению роли <strong>VmCreator</strong>, <strong>DiskCreator</strong> и <strong>TemplateCreator</strong>.</p>

</div>
<p>Ниже в таблице описаны расширенные роли пользователей, позволяющие производить более тонкую настройку прав доступа к ресурсам Пользовательского портала.</p>

<p><strong>Таблица&nbsp;13.2.&nbsp;Расширенные пользовательские роли в oVirt</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Роль</p></th>
<th align="left"><p>Привилегии</p></th>
<th align="left"><p>Примечания</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>UserTemplateBasedVm</p></td>
<td align="left"><p>Ограниченные привилегии, только использование шаблонов.</p></td>
<td align="left"><p>Может использовать шаблоны для создания ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>DiskOperator</p></td>
<td align="left"><p>Пользователь виртуального диска.</p></td>
<td align="left"><p>Может использовать, просматривать и изменять виртуальные диски. Наследует привилегии на использование ВМ, к которой присоединён виртуальный диск.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VmCreator</p></td>
<td align="left"><p>Может создавать ВМ на Пользовательском портале.</p></td>
<td align="left"><p>Эта роль не применяется к конкретной ВМ; применяйте эту роль к пользователю для всего окружения в окне <strong>Параметры</strong>. Или применяйте эту роль для конкретных дата-центров или кластеров. Применяя эту роль к кластеру, также необходимо применить роль DiskCreator ко всему дата-центру или к конкретным доменам хранилищ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>TemplateCreator</p></td>
<td align="left"><p>Может создавать, изменять, удалять и управлять шаблонами ВМ в пределах присвоенных ресурсов.</p></td>
<td align="left"><p>Эта роль не применяется к конкретному шаблону; применяйте эту роль к пользователю для всего окружения в окне <strong>Параметры</strong>. Или применяйте эту роль для конкретных дата-центров или кластеров.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>DiskCreator</p></td>
<td align="left"><p>Может создавать, изменять, удалять и управлять дисками ВМ в пределах присвоенных кластеров или дата-центров.</p></td>
<td align="left"><p>Эта роль не применяется к конкретному виртуальному диску; применяйте эту роль к пользователю для всего окружения в окне <strong>Параметры</strong>. Или применяйте эту роль для конкретных дата-центров или доменов хранилищ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>TemplateOwner</p></td>
<td align="left"><p>Может изменять и удалять шаблон, присваивать и управлять привилегиями пользователя для шаблона.</p></td>
<td align="left"><p>Эта роль автоматически присваивается пользователю, создавшему шаблон. Другие пользователи, не имеющие привилегий <strong>TemplateOwner</strong> для шаблона, не могут просматривать или использовать шаблон.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>NetworkUser</p></td>
<td align="left"><p>Пользователь логической сети и сетевого интерфейса ВМ и шаблона.</p></td>
<td align="left"><p>Может присоединять или отсоединять сетевые интерфейсы конкретных логических сетей.</p></td>
</tr>
</tbody>
</table>

<h4 id="administrator-roles-explained">Объяснение ролей администратора</h4>

<p>Ниже в таблице описаны базовые роли администратора, дающие права на доступ и изменения параметров ресурсов на Портале администрирования.</p>

<p><strong>Таблица&nbsp;13.3.&nbsp;Базовые роли системного администратора в oVirt</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Роль</p></th>
<th align="left"><p>Привилегии</p></th>
<th align="left"><p>Примечания</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>SuperUser</p></td>
<td align="left"><p>Системный администратор окружения oVirt.</p></td>
<td align="left"><p>Имеет полные права доступа на все объекты всех уровней, может управлять всеми объектами на всех дата-центрах.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ClusterAdmin</p></td>
<td align="left"><p>Администратор кластера.</p></td>
<td align="left"><p>Обладает административными привилегиями на все объекты в пределах конкретного кластера.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>DataCenterAdmin</p></td>
<td align="left"><p>Администратор дата-центра.</p></td>
<td align="left"><p>Обладает административными привилегиями на все объекты в пределах конкретного дата-центра кроме хранилища.</p></td>
</tr>
</tbody>
</table>

<div class="alert alert-info">
  <p><strong>Важно:</strong> не используйте пользователя-администратора сервера каталогов в качестве пользователя-администратора oVirt. Создайте пользователя на сервере каталогов специально для использования его в качестве администратора oVirt.</p>

</div>
<p>Ниже в таблице описаны расширенные роли администратора, позволяющие производить более тонкую настройку прав доступа к ресурсам Портала администрирования.</p>

<p><strong>Таблица&nbsp;13.4.&nbsp;Расширенные административные роли в oVirt</strong></p>

<table>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Роль</p></th>
<th align="left"><p>Привилегии</p></th>
<th align="left"><p>Примечания</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>TemplateAdmin</p></td>
<td align="left"><p>Администратор шаблона ВМ.</p></td>
<td align="left"><p>Может создавать, удалять и изменять параметры доменов хранилищ и сетевые параметры шаблонов, а также перемещать шаблоны между доменами.</p></td>
</tr>
<tr class="even">
<td align="left"><p>StorageAdmin</p></td>
<td align="left"><p>Администратор хранилища.</p></td>
<td align="left"><p>Может создавать, удалять, изменять параметры и управлять присвоенным доменом хранилища.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>HostAdmin</p></td>
<td align="left"><p>Администратор хоста.</p></td>
<td align="left"><p>Может присоединять, удалять, изменять параметры и управлять конкретным хостом.</p></td>
</tr>
<tr class="even">
<td align="left"><p>NetworkAdmin</p></td>
<td align="left"><p>Сетевой администратор.</p></td>
<td align="left"><p>Может настраивать параметры и управлять сетью конкретного дата-центра или кластера. Сетевой администратор дата-центра или кластера наследует сетевые привилегии на виртуальные пулы в пределах кластера.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VmPoolAdmin</p></td>
<td align="left"><p>Системный администратор виртуального пула.</p></td>
<td align="left"><p>Может создавать, удалять и настраивать параметры виртуального пула; присваивать и удалять пользователей виртуального пула; а также выполнять базовые операции на ВМ в пуле.</p></td>
</tr>
<tr class="even">
<td align="left"><p>GlusterAdmin</p></td>
<td align="left"><p>Администратор хранилища Gluster.</p></td>
<td align="left"><p>Может создавать, удалять, изменять параметры и управлять томами хранилища Gluster.</p></td>
</tr>
</tbody>
</table>

<h3 id="ovirt-user-tasks">Задачи пользователя oVirt</h3>

<h4 id="adding-users">Добавление пользователей</h4>

<p><strong>Описание задачи</strong></p>

<p>Перед там, как присваивать пользователям роли и привилегии, их нужно добавить в oVirt из службы внешнего каталога .</p>

<p><strong>Инструкция&nbsp;13.1.&nbsp;Добавление пользователей в oVirt</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Пользователи</strong> чтобы увидеть список авторизованных пользователей.</li>
  <li>Нажмите <strong>Добавить</strong>. Откроется окно <strong>Добавление пользователей и групп</strong>.
<img alt="Add Users and Groups Window" title="Окно добавления пользователей и групп" src="./OVirt Administration Guide — oVirt_files/Add_Users.png">
<strong>Рисунок&nbsp;13.4.&nbsp;Окно добавления пользователей и групп</strong></li>
  <li>В выпадающем меню <strong>Поиск</strong> выберите соответствующий домен. Введите имя или часть имени в поле поиска и нажмите <strong>GO</strong>. Или нажмите <strong>Искать</strong> чтобы увидеть список всех пользователей и групп.</li>
  <li>Отметьте галочками нужных пользователей и группы.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Добавленный пользователь появляется во вкладке <strong>Пользователи</strong>.</p>

<h4 id="viewing-user-information">Просмотр информации о пользователе</h4>

<p><strong>Описание задачи</strong></p>

<p>Подробные сведения о каждом пользователе можно найти во вкладке <strong>Пользователи</strong>.</p>

<p><strong>Инструкция&nbsp;13.2.&nbsp;Просмотр информации о пользователе</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Пользователи</strong> чтобы увидеть список авторизованных пользователей.</li>
  <li>Выберите пользователя или выполните поиск пользователя, если пользователь отсутствует в списке результатов.</li>
  <li>Для выбранного пользователя будет показана панель сведений, обычно во вкладке <strong>Общие</strong>, где показана общая информация, такая, как доменное имя, почтовый адрес и статус пользователя.</li>
  <li>В других вкладках можно просмотреть группы, права доступа, квоты и события пользователя. Например, чтобы просмотреть группы, в которых состоит пользователь, перейдите на вкладку <strong>Группы каталога</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы просмотрели информацию о домене, привилегиях, квоте, группе и событиях пользователя.</p>

<h4 id="viewing-user-permissions-on-resources">Просмотр привилегий пользователя для ресурсов</h4>

<p><strong>Описание задачи</strong></p>

<p>Пользователям можно назначить привилегии для конкретных ресурсов или иерархии ресурсов. Для каждого ресурса можно просмотреть назначенных пользователей и их привилегии.</p>

<p><strong>Инструкция&nbsp;13.3.&nbsp;Просмотр привилегий пользователя для ресурсов</strong></p>

<ol>
  <li>Используйте ресурсные вкладки, режим дерева или поисковый функционал чтобы найти и выделить ресурс в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Права доступа</strong> панели сведений чтобы увидеть список назначенных пользователей, роль пользователя и унаследованные права для выбранного рсурса.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы просмотрели назначенных пользователей и их роли для выбранного ресурса.</p>

<h4 id="removing-users">Удаление пользователей</h4>

<p><strong>Описание задачи</strong></p>

<p>Если учётная запись пользователя больше не нужна, её можно удалить из oVirt.</p>

<p><strong>Инструкция&nbsp;13.4.&nbsp;Удаление пользователей</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Пользователи</strong> чтобы увидеть список авторизованных пользователей.</li>
  <li>Выберите пользователя для уделения. Убедитесь, что пользователь не запустил ВМ.</li>
  <li>Нажмите на кнопку <strong>Удалить</strong>. Будет показано сообщение с просьбой подтвердить удаление. Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Пользователь был удалён из oVirt, но не из внешнего каталога.</p>

<h4 id="configuring-roles">Настройка ролей</h4>

<p>Роли — это предварительно настроенный набор привилегий, которые можно настроить в oVirt. Роли предоставляют доступ и права для управления различными уровнями ресурсов в дата-центре и конкретными физическими и виртуальными ресурсами.</p>

<p>Во многоуровневом управлении любые права доступа, применяемые к объекту-контейнеру, также применяются ко всем отдельным объектам внутри этого контейнера. Например, когда роль администратора хоста присваивается пользователю на конкретном хосте, пользователь получает права на выполнение любой из доступных операций на хосте, но только на этом присвоенном хосте. Тем не менее, если роль администратора хоста присвоена пользователю в дата-центре, пользовтаель получает права на выполнение операций  на всех хостах в пределах кластера дата-центра.</p>

<h4 id="creating-a-new-role">Создание новой роли</h4>

<p><strong>Описание задачи</strong></p>

<p>Если требуемая роль тсутствует в списке стандартных ролей oVirt, можно создать новую роль и настроить её согласно наначению.</p>

<p><strong>Инструкция&nbsp;13.5.&nbsp;Создание новой роли</strong></p>

<ol>
  <li>На панели заголовка нажмите на кнопку <strong>Параметры</strong> чтобы открыть окно <strong>Параметры</strong>. В этом окне находится список станларных ролей пользоватекля и администратора, а также все задаваемые роли.</li>
  <li>Нажмите <strong>Добавить</strong>. Будет показан диалог <strong>Добавить роль</strong>.
<img alt="The New Role Dialog" title="Диалог добавления роли" src="./OVirt Administration Guide — oVirt_files/New_Role.png">
<strong>Рисунок&nbsp;13.5.&nbsp;Диалог добавления роли</strong></li>
  <li>Введите <strong>Имя</strong> и <strong>Описание</strong> новой роли.</li>
  <li>Выберите <strong>Администратор</strong> или <strong>Пользователь</strong> в качестве <strong>Типа учётной записи</strong>.</li>
  <li>Используйте кнопки <strong>Развернуть всё</strong> или <strong>Свернуть всё</strong> чтобы увидеть больше или меньше прав на указанные объекты в списке <strong>Чтобы разрешить действие, поставьте галочки</strong>. Также можно развернуть или свернуть параметры каждого объекта.</li>
  <li>Для каждого объекта выберите или снимите отметку с действий, которые нужно ращзрешить или запретить в настраиваемой роли.</li>
  <li>Нажмите <strong>OK</strong> для применения сделанных изменений. Новая роль будет показана в списке ролей.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали новую роль с правами на конкретные ресурсы. Новую роль можно присваивать пользователям.</p>

<h4 id="editing-or-copying-a-role">Изменение или копирование роли</h4>

<p><strong>Описание задачи</strong></p>

<p>Можно изменять параметры созданных ролей, но не параметры стандартных ролей. Чтобы изменять параметры стандартных ролей, клонируйте их.</p>

<p><strong>Инструкция&nbsp;13.6.&nbsp;Изменение или копирование роли</strong></p>

<ol>
  <li>На панели заголовка нажмите на кнопку <strong>Параметры</strong> чтобы открыть окно <strong>Параметры</strong>. В этом окне находится список станларных ролей пользователя и администратора, а также все задаваемые роли.</li>
  <li>Выберите роль для изменения. Нажмите <strong>Изменить</strong> чтобы открыть окно <strong>Изменить роль</strong>, или нажмите <strong>Копировать</strong> чтобы открыть окно <strong>Копировать роль</strong>.</li>
  <li>При необходимости измените <strong>Имя</strong> и <strong>Описание</strong> роли.</li>
  <li>Используйте кнопки <strong>Развернуть всё</strong> или <strong>Свернуть всё</strong> чтобы увидеть больше или меньше прав на указанные объекты в списке. Также можно развернуть или свернуть параметры каждого объекта.</li>
  <li>Для каждого объекта выберите или снимите отметку с действий, которые нужно разрешить или запретить в настраиваемой роли.</li>
  <li>Нажмите <strong>OK</strong> для применения сделанных изменений.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы изменили параметры роли или клонировали роль.</p>

<h3 id="assigning-an-administrator-or-user-role-to-a-resource">Присвоение роли администратора или пользователя ресурсу</h3>

<p><strong>Описание задачи</strong></p>

<p>Присвоение роли администратора или пользователя ресурсам для получения доступа к ресурсу или управления ресурсом.</p>

<p><strong>Инструкция&nbsp;13.7.&nbsp;Присвоение роли ресурсу</strong></p>

<ol>
  <li>Используйте ресурсные вкладки, режим дерева или поисковый функционал чтобы найти и выделить ресурс в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Права доступа</strong> панели сведений чтобы увидеть список назначенных пользователей, роль пользователя и унаследованные права для выбранного ресурса.</li>
  <li>Нажмите <strong>Добавить</strong> чтобы открыть окно <strong>Добавить привилегию пользователю</strong>.</li>
  <li>Введите имя или имя пользователя существующего пользователя в текстовое поле <strong>Поиск</strong> и нажмите <strong>Искать</strong>. Выберите пользователя из полученного списка возможных совпадений.</li>
  <li>В выпадающем списке <strong>Присвоить роль:</strong> выберите роль.</li>
  <li>Нажмите <strong>OK</strong> чтобы присвоить роль и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы присвоили роль пользователю; у пользователя теперь есть унаследованные права этой роли на данный ресурс.</p>

<h3 id="removing-an-administrator-or-user-role-from-a-resource">Удаление роли администратора или роли пользователя из ресурса</h3>

<p><strong>Описание задачи</strong></p>

<p>Удаление роли администратора или роли пользователя из ресурса; пользователь теряет унаследованные права на этот ресурс, связанные с ролью.</p>

<p><strong>Инструкция&nbsp;13.8.&nbsp;Удаление роли из ресурса</strong></p>

<ol>
  <li>Используйте ресурсные вкладки, режим дерева или поисковый функционал чтобы найти и выделить ресурс в списке результатов.</li>
  <li>Перейдите на вкладку <strong>Права доступа</strong> панели сведений чтобы увидеть список назначенных пользователей, роль пользователя и унаследованные права для выбранного ресурса.</li>
  <li>Выберите пользователя для ужадения из ресурса.</li>
  <li>Нажмите <strong>Удалить</strong>. Откроется окно <strong>Удалить права доступа</strong> для подтверждения удаления прав.</li>
  <li>Нажмите <strong>OK</strong> для удаления роли пользователя.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили роль пользователя и связанные привилегии из ресурса.</p>

<h3 id="user-role-and-authorization-examples">Роль пользователя и примеры авторизации</h3>

<p>Следующие примеры иллюстрируют применение контроля авторизации в различных сценариях, с использованием различных возможностей системы авторизации, описанных в этом разделе.</p>

<p><strong>Пример&nbsp;13.1.&nbsp;Кластерные привилегии</strong></p>

<p>Света — системный администратор бухгалтерии фирмы. Все виртуальные ресурсы её отделения организованы под управлением <code>кластера</code> oVirt  с именем <code>Accounts</code>. На кластере бухгалтерии Свете присвоена роль <code>ClusterAdmin</code>, что даёт ей возможность управлять всеми виртуальными машиами кластера, т.к. машины являются дочерними объектами кластера. Управление ВМ включает в себя изменение, добавление или удаление виртуальных ресурсов, таких, как диски, а также создание снимков. Управлять любыми ресурсами вне этого кластера Света не может. Поскольку <code>ClusterAdmin</code> — это роль администратора, то она даёт возможность ей использовать Портал адмпнистраирования для управления этими ресурсами, но не даёт никакого доступа через Пользовтаельский портал.</p>

<p><strong>Пример&nbsp;13.2.&nbsp;Привилегии PowerUser виртуальной машины</strong></p>

<p>Василий — разработчик ПО в бухгалтерии. Он использует ВМ для сборки и тестирования своих программ. Света создала для него виртуальный рабочий стол с именем <code>vasyadesktop</code>. Василию присвоена роль <code>UserVmManager</code> на виртуальной машине <code>vasyadesktop</code>. Это даёт ему возможность доступа к этой единственной ВМ через Пользовательский портал. Поскольку Василий использует привилегии <code>UserVmManager</code>, он может изменять ВМ и добавлять ей ресурсы, например, новые виртуальные диски. Поскольку <code>UserVmManager</code> — это роль пользователя, она не даёт ему возможности использовать Портал администрирования.</p>

<p>⁠<strong>Пример&nbsp;13.3.&nbsp;Привилегии роли продвинутого пользователя дата-центра</strong></p>

<p>Марина — руководитель отдела. В дополнение к её собственным обязанностям, она иногда помогает начальнику отдела кадров в задачах найма работников, таких, как составление расписания собеседований и последующая проверка рекомендаций. Согласно корпоративной политике, Марине требуется использовать частное приложение для задач подбора сотрудников.</p>

<p>Хотя у Марины есть своя собственная машина для задач управления отделом, ей необходимо создать отдельную ВМ для запуска приложения по работе с кадрами. Марине присвоены привилегии <code>PowerUserRole</code> для дата-центра, в котором будет расположена её новая ВМ, т.к. для создания новой ВМ необходимо внести изменения в некоторые компоненты в пределах дата-центра, включая создание образа диска ВМ в домене хранилища.</p>

<p>Заметьте, что это не то же самое, что присвоение привилегий <code>DataCenterAdmin</code> Марине. Имея привилегии PowerUser для дата-центра, Марина может авторизоваться на Пользовательском портале и выполнять машино-ориентированные действия на ВМ в пределах дата-центра. Но она не может выполнять операции на уровне дата-центра, такие, как присоединение хостов или хранилища к дата-центру.</p>

<p><strong>Пример&nbsp;13.4.&nbsp;Привилегии сетевого администратора</strong></p>

<p>Ольга работает сетевым администратором в отделе IT. В её повседневные задачи входит создание, удаление и управление сетями в окружении oVirt отдела. Для её роли ей требуется административные привилегии на ресурсы и сети каждого ресурса. Например, если у Ольги есть привилегии <code>NetworkAdmin</code> на дата-центра отдела IT, она может добавлять и удалять сети в дата-центр, а также присоединять и отсоединять сети для всех виртуальных машин, принадлежащих дата-центру.</p>

<p>В дополнение к задачам управления сетями виртуализованной инфраструктуры фирмы, под руководством Ольги работает младший сетевой администратор, предоставляющий ей отчёты. Младший сетевой администратор, Пётр, управляет небольшим виртуализованным окружением отделения внутрифирменной подготовки. Ольга присвоила Петру привилегии <code>NetworkUser</code> и привилегии <code>UserVmManager</code> на виртуальные машины, используемые отделением внутрифирменной подготовки. Имея эти привилегии, Пётр может выполнять простые административные задачи, например, добавление сетевых интерфейсов виртуальным машинам через Пользовательский портал. Тем не менее, у Петра нет прав изменять параметры сети хостов, на которых выполняются ВМ, или сетей дата-центра, которому принадлежат виртуальные машины.</p>

<p><strong>Примеры&nbsp;13.5.&nbsp;Настраиваемые привилегии роли</strong></p>

<p>Татьяна работает в отделе IT и ответственна за управление учётными записями пользователей в oVirt. Ей нужны права для добавления учётных записей пользователей и присвоения им необходимых ролей и привилегий. Она не использует виртуальные машины и у неё не должно быть доступа к администрированию хостов, виртуальных машин, кластеров или дата-центров. Не существует стандартной роли, которая предоставляла бы ей такой специфический набор привилегий. Для настройки набора привилегий, необходимых Татьяне, нужно создать настраиваемую роль.</p>

<p><img alt="UserManager Custom Role" title="Настраиваемая роль UserManager" src="./OVirt Administration Guide — oVirt_files/UserManager.png"></p>

<p><strong>Рисунок&nbsp;13.6.&nbsp;Настраиваемая роль UserManager</strong></p>

<p>Показанная выше настраиваемая роль <strong>UserManager</strong> даёт возожность управления пользователями, привилегиями и ролями. Эти действия организованы в <code>Систему</code> — объект самого высокого уровня в иерархии, показанный на Рисунке&nbsp;13.6. Это означает, что указанные действия применяются ко всем другим объектам в системе. Роль настроена на <strong>Тип учётной записи</strong> <strong>Администратора</strong>. Это означает, что после присвоения этой роли Татьяна может использовать только Портал администрирования, но не Пользовательский портал.</p>

<h2 id="quotas-and-service-level-agreement-policy">⁠Квоты и политика соглашения об уровне обслуживания (SLA)</h2>

<h3 id="introduction-to-quota">Что такое квота</h3>

<p>Квота — это инструмент ограничения ресурсов, предоставляемых oVirt. Квоту можно представить как слой ограничений поверх слоя ограничений, установленных правами доступа пользователей.</p>

<p>Квота — это объект дата-центра.</p>

<p>Квота даёт возможность администраторам окружений oVirt ограничить доступ пользователей к ресурсам памяти, ЦП и хранилища. Квота определяет объём ресурсов памяти и хранилища, который администратор может выделить пользователям. В связи с этим, пользователи могут рассчитывать только на выделенные им ресурсы. При превышении квоты ресурсов oVirt запрещает дальнейшие действия пользователя.</p>

<p>Существует два различных типа квоты:</p>

<p><strong>Таблица&nbsp;14.1.&nbsp;Два различных типа квоты</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Тип квоты</p></th>
<th align="left"><p>Определение</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Квота времени выполнения</p></td>
<td align="left"><p>Данный тип квоты ограничивает потребления ресурсов времени выполнения, таких, как ЦП и память.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Квота хранилища</p></td>
<td align="left"><p>Данный тип квоты ограничивает объём доступного хранилища.</p></td>
</tr>
</tbody>
</table>

<p>Квота, как и SELinux, имеет три режима:</p>

<p><strong>Таблица&nbsp;14.2.&nbsp;Режимы квоты</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Режим квоты</p></th>
<th align="left"><p>Функционал</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Принудительный</p></td>
<td align="left"><p>Этот режим активирует квоту, настроенную в режиме аудита, ограничивая ресурсы группы пользователей, подпадающих под эту квоту.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Аудит</p></td>
<td align="left"><p>В этом режиме можно изменять параметры квоты. Выберите этот режим для увеличения или уменьшения объёма квоты времени выполнения и объёма квоты хранилища, доступного подпадающим под эту квоту пользователям.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Отключён</p></td>
<td align="left"><p>Этот режим отключает ограничения времени выполнения и хранилища, определённые квотой.</p></td>
</tr>
</tbody>
</table>

<p>При попытке пользователя запустить виртуальную машину, спецификции машины сравниваются с лимитом хранилища и с лимитом времени выполнения, указанных в применяемой квоте.</p>

<p>Если при запуске виртуальной машины все объединённые ресурсы всех выполняемых виртуальных машин, охваченных квотой, превышают лимит, определённый квотой, то в этом случае oVirt откажется запускать машину.</p>

<p>При создании пользователем нового диска, запрошенный размер диска добавляется к общему объёму использования дисковых ресурсов всех других дисков, охваченных применяемой квотой. Если добавление нового диска приводит к превышению общего объёма использования дисковых ресурсов, разрешённого квотой, диск не будет создан.</p>

<p>Квота даёт возможность предоставления общего доступа к аппаратным ресурсам. Поддерживается мягкая и жёсткая квота. Администраторы могут использовать квоту для установки порога ресурсов. С точки зрения пользователя, эти пороги представляют 100% использование этого ресурса. Для предотвращения сбоев при внезапном превышении этого порога, в интерфейсе существует поддержка «льготного» превышения порога, который включается на короткое время. При превышении порога клиенту выводится предупреждение.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> квота налагает ограничения на выполняемые виртуальные машины. Игнорирование этих ограничений скорей всего приведёт к ситуациям, когда использование ВМ и виртуальных дисков будет невозможно.</p>

</div>
<p>При выполнении квоты в принудительном режиме, виртуальные машины и диски, не имеющие присвоенной квоты, не могут использоваться.</p>

<p>Чтобы иметь возможность включить ВМ, ей должна быть присвоена квота.</p>

<p>Чтобы иметь возможность создать снимок виртуальной машины, диску, связанному с машиной, должна быть присвоена квота.</p>

<p>При создании шаблона на базе ВМ выводится сообщение о выборе квоты, которую должен потребить шаблон. Это даёт возможность настроить шаблон (и будущие ВМ, созданные на базе этого шаблона) на потребление квоты, отличной от той, которую потребляет машина и диск, на базе которых создаётся шаблон.</p>

<h3 id="shared-quota-and-individually-defined-quota">Общая и индивидуальная квота</h3>

<p>Пользователи с привилегиями SuperUser могут создавать квоты для отдельных пользователей или квоты для групп.</p>

<p>Групповые квоты можно настроить для пользователей Active Directory. Если группе, состоящей из 10 участников, присвоена квота на использование 1ТБ дискового пространства, и один из десяти пользователей использует весь 1ТБ, то вся группа превысит квоту, и ни один из 10 пользователей не сможет использовать дисковое пространство, связанное с этой группой.</p>

<p>Индивидуальная пользовательская квота настраивается для одного отдельного пользователя. Как только отдельный пользователь использует всю свою квоту времени выполнения или хранилища, квота пользователя будет превышена, и этот пользователь больше не сможет использовать дисковое пространство, привязанное к его квоте.</p>

<h3 id="quota-accounting">Расчёт квоты</h3>

<p>При присвоении квоты клиенту или ресурсу, каждое действие этого клиента или действие, касающееся ресурса, включая хранилище, виртуальный ЦП или память, ведёт к потреблению или высвобождению квоты.</p>

<p>Поскольку квота действует как верхняя граница, ограничивающая доступ пользователя к ресурсам, то рассчитанная квота может отличаться от текущего потребления ресурсов пользователем. Квота рассчитывается на максимальный потенциальный рост, а не исходя из текущего использования.</p>

<p><strong>Пример&nbsp;14.1.&nbsp;Пример расчёта</strong></p>

<p>Пользователь работает на ВМ, имеющей 1 вЦП и 1024 МБ памяти. Действие потребляет 1 вЦП и 1024 МБ квоты, присвоенной этому пользователю. При остановке ВМ, 1 вЦП и 1024 МБ памяти высвобождается обратно в квоту. Потребление квоты времени выполнения рассчитывается только исходя из текущего времени выполнения потребителя.</p>

<p>Пользователь создаёт виртуальный диск с тонким резервированием в 10ГБ. Фактическое использование диска может указывать, что используется только 3ГБ. Тем не менее, потребление квоты будет равно 10ГБ, т.е. максимальный потенциал этого диска.</p>

<h3 id="enabling-and-changing-a-quota-mode-in-a-data-center">Включение и изменение режима квоты в дата-центре</h3>

<p><strong>Описание задачи</strong></p>

<p>Это действие включает или изменяет режим квоты в дата-центре. Перед настройкой квот необходимо выбрать режим квоты. Для выполнения шагов этого действия необходимо выполнить вход на Портале администрирования.</p>

<p>Используйте режим <strong>Аудита</strong> для тестирования квоты, чтобы убедиться, что она работает так, как ожидается. Для создания или изменения парметров квоты, режим <strong>Аудита</strong> не нужен.</p>

<p><strong>Инструкция&nbsp;14.1.&nbsp;Включение и изменение квоты в дата-центре</strong></p>

<ol>
  <li>Перейдите на вкладку <strong>Дата-центры</strong> на панели навигации.</li>
  <li>В списке дата-центров на панели навигации выберите дата-центр, политику квоты которого необходимо изменить.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong> в верхнем левом углу панели навигации. Откроется окно <strong>Изменить дата-центр</strong>.</li>
  <li>В выпадающем списке <strong>Режим квоты</strong> измените режим квоты на <strong>Принудительно</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы включили режим квоты на уровне дата-центра. Если во время тестирования был вклюён режим <strong>Аудит</strong>, то для того, чтобы изменения квоты вступили в силу, режим нужно поменять на <strong>Принудительно</strong>.</p>

<h3 id="creating-a-new-quota-policy">Создание новой политики квоты</h3>

<p><strong>Описание задачи</strong></p>

<p>Мы включили режим квоты, Аудит или Принудительный. Нам нужно определить политику квоты для управления потреблением ресурсов в дата-центре</p>

<p><strong>Инструкция&nbsp;14.2.&nbsp;Создание новой политики квоты</strong></p>

<ol>
  <li>В режиме дерева выберите дата-центр. Вкладка <strong>Квота</strong> расположена на панели навигации.</li>
  <li>Перейдите на вкладку <strong>Квота</strong> на панели навигации.</li>
  <li>Нажмите <strong>Добавить</strong> на панели навигации. Откроется окно <strong>Добавить квоту</strong>.</li>
  <li>В поле <strong>Имя</strong> введите значащее имя. В поле <strong>Описание</strong> введите значащее имя.</li>
  <li>В разделе <strong>Память &amp; ЦП</strong> окна <strong>Добавить квоту</strong> с помощью зелёного бегунка установите <strong>Порог кластера</strong>.</li>
  <li>В разделе <strong>Память &amp; ЦП</strong> окна <strong>Добавить квоту</strong> с помощью синего бегунка установите <strong>Льготу кластера</strong>.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong> в нижнем правом углу поля <strong>Память &amp; ЦП</strong>. Будет открыто окно <strong>Изменить квоту</strong>.</li>
  <li>В поле <strong>Память</strong> отметьте флажком пункт <strong>Без ограничений</strong> (чтобы рарешить неограниченное потребление ресурсов памяти на кластере), или отметьте пункт <strong>ограничить до</strong> чтобы указать предел объёма памяти для этой квоты. При выборе пункта <strong>ограничить до</strong> введите квоту памяти в мегабайтах (МБ) в поле <strong>МБ</strong>.</li>
  <li>В поле <strong>ЦП</strong> отметьте пункт <strong>Без ограничений</strong> или пункт <strong>ограничить до</strong> чтобы указать предел ресурсов ЦП для этой квоты. При выборе пункта <strong>ограничить до</strong>, введите число вЦП в поле <strong>вЦП</strong>.</li>
  <li>Нажмите <strong>OK</strong> в окне <strong>Изменить квоту</strong>.</li>
  <li>В разделе <strong>Хранилище</strong> окна <strong>Добавить квоту</strong> с помощью зелёного бегунка установите <strong>Порог хранилища</strong>.</li>
  <li>В разделе <strong>Хранилище</strong> окна <strong>Добавить квоту</strong> с помощью синего бегунка установите <strong>Льготу хранилища</strong>.</li>
  <li>Нажмите <strong>Изменить</strong> в поле <strong>Хранилище</strong>. Откроется окно <strong>Изменить квоту</strong>.</li>
  <li>В поле <strong>Квота хранилища</strong> отметьте либо пункт <strong>Без ограничений</strong> (чтобы рарешить неограниченное потребление дисковых ресурсов) либо <strong>ограничить до</strong> чтобы установить предел квоты хранилища для пользователей. При выборе пункта <strong>ограничить до</strong> введите размер квоты хранилища в гигабайтах (ГБ) в поле <strong>ГБ</strong>.</li>
  <li>Нажмите <strong>OK</strong> в окне <strong>Изменить квоту</strong>. Будет выполнено возвращение в окно <strong>Добавить квоту</strong>.</li>
  <li>Нажмите <strong>OK</strong> в окне <strong>Добавить квоту</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали новую политику квоты.</p>

<h3 id="explanation-of-quota-threshold-settings">Введение параметров порога квоты</h3>

<p><strong>Таблица&nbsp;14.3.&nbsp;Пороги и льготы квоты</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Параметр</p></th>
<th align="left"><p>Определение</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Порог кластера</p></td>
<td align="left"><p>Объём доступных кластерных ресурсов, на каждый дата-центр.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Льгота кластера</p></td>
<td align="left"><p>Объём кластерных ресурсов, доступных дата-центру после превышения порога кластера дата-центра.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Порог хранилища</p></td>
<td align="left"><p>Объём доступных ресурсов хрнаилища, на каждый дата-центр.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Льгота хранилища</p></td>
<td align="left"><p>Объём ресурсов хранилища, доступных дата-центру после превышения порога хранилища для кластера дата-центра.</p></td>
</tr>
</tbody>
</table>

<p>Если квота установлена на 100GB с льготой в 20%, то потребителям запрещено использовать хранилище после того, как используемый объём достигнет 120ГБ. Если та же квота имеет утановленный порог в 70%, то потребителям выводится предупреждение о том, что потребление дискового пространства превышает 70ГБ (но они по-прежнему могут потреблять ресурсы хранилища до тех пор, пока не будет достигнуто 120ГБ.) Значение как «порога», так и «льготы» указываются относительно квоты. «Порог» можно представить в виде «мягкого предела», и при его превышении выводится предупреждение. «Лимит» можно представить в виде «жёсткого предела», и после его превышения дальнейшее использование дисковых ресурсов невозможно.</p>

<h3 id="assigning-a-quota-to-an-object">Присвоение квоты объекту</h3>

<p><strong>Описание задачи</strong></p>

<p>Здесь объясняется привязка ВМ к квоте.</p>

<p><strong>Инструкция&nbsp;14.3.&nbsp;Присвоение квоты виртуальной машине</strong></p>

<ol>
  <li>На панели навигации выберите ВМ, для которой планируется добавить квоту.</li>
  <li>Нажмите <strong>Изменить</strong>. Будет показано окно <strong>Изменить ВМ</strong>.</li>
  <li>Выберите квоту, которую должна потреблять ВМ. Для этого используйте выпадающее меню <strong>Квота</strong>.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы назначили квоту для выбранной ВМ.</p>

<p><strong>Описание задачи</strong></p>

<p>Далее объясняется, как связать диск виртуальной машины с квотой.</p>

<p><strong>Инструкция&nbsp;14.4.&nbsp;Присвоение квоты виртуальному диску</strong></p>

<ol>
  <li>На панели навигации выберите ВМ, дискам которой планируется добавить квоту.</li>
  <li>На панели сведений выберите диск, который планируется связать с квотой.</li>
  <li>Нажмите <strong>Изменить</strong>. Появится окно <strong>Изменить виртуальный диск</strong>.</li>
  <li>Выберите квоту, которую должен потреблять виртуальный диск.</li>
  <li>Нажмите <strong>OK</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы назначили квоту для выбранного виртуального диска.</p>

<div class="alert alert-info">
  <p><strong>Важно:</strong> для того, чтобы виртуальная машина работала, квота должна быть выбрана для всех объектов, связанных с этой ВМ. В противном случае малина работать не будет. В таких случаях oVirt показывает общую ошибку, что затрудняет понимание, была ли ошибка выдана в связи с отсутствием назначенной квоты всем объектам ВМ. С машины, у которой отсутствует квота, невозможно сделать снимок. Создать шаблона ВМ, виртуальным дискам которой не назначена квота, невозможно.</p>

</div>

<h3 id="using-quota-to-limit-resources-by-user">Использование квоты для ограничения ресурсов пользователя</h3>

<p><strong>Описание задачи</strong></p>

<p>Далее описывается использование квот для ограничения ресурсов, к которым имеет доступ пользователь.</p>

<p><strong>Инструкция&nbsp;14.5.&nbsp;Привязка пользователя к квоте</strong></p>

<ol>
  <li>В режиме дерева выберите дата-центр с квотой, которую нужно привязать к пользователю.</li>
  <li>Перейдите на вкладку <strong>Квота</strong> на панели навигации.</li>
  <li>Выберите целевую квоту в списке на панели навигации.</li>
  <li>Перейдите на вкладку <strong>Потребители</strong> на панели сведений.</li>
  <li>Нажмите на кнопку <strong>Добавить</strong> в верхней части панели сведений.</li>
  <li>В поле <strong>Поиск</strong> введите имя пользователя, который нужно связать с квотой.</li>
  <li>Нажмите <strong>Поиск</strong>.</li>
  <li>Отметьте галочкой имя целевого пользователя с левой стороны строки.</li>
  <li>Нажмите на кнопку <strong>OK</strong> в правом нижнем углу окна <strong>Привязать пользователей/группы к квоте</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Через некоторое время пользователь появится на вкладке <strong>Потребители</strong> панели сведений.</p>

<h3 id="editing-quotas">Изменение квот</h3>

<p><strong>Описание задачи</strong></p>

<p>Далее описывается, как можно изменить существующую квоту.</p>

<p><strong>Инструкция&nbsp;14.6.&nbsp;Изменение квот</strong></p>

<ol>
  <li>В древовидном представлении нажмите на дата-центр, квоту которого нужно изменить.</li>
  <li>Перейдите на вкладку <strong>Квота</strong> на панели навигации.</li>
  <li>Нажмите на имя квоты, которую нужно изменить.</li>
  <li>Нажмите на кнопку <strong>Изменить</strong> на панели навигации.</li>
  <li>Появится окно <strong>Изменить квоту</strong>. При необходимости введите значимое имя в поле <strong>Имя</strong>.</li>
  <li>При необходимости, введите значимое описание в поле <strong>Описание</strong>.</li>
  <li>Отметьте галочкой либо параметр <strong>Все кластеры</strong> либо параметр <strong>Конкретные кластеры</strong>. Передвиньте ползунки <strong>Порог кластера</strong> и <strong>Льгота кластера</strong> на желаемые позиции на бегунке <strong>Память &amp; ЦП</strong>.</li>
  <li>Отметьте галочкой либо параметр <strong>Все домены хранилищ</strong> либо <strong>Конкретные домены хранилищ</strong>. Передвиньте ползунки <strong>Порог хранилища</strong> и <strong>Льгота хранилища</strong> на желаемые позиции на бегунке <strong>Хранилище</strong>.</li>
  <li>Нажмите <strong>OK</strong> в окне <strong>Изменить квоту</strong> для подтверждения новых значений квоты.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы изменили существующую квоту.</p>

<h3 id="removing-quotas">⁠Удаление квот</h3>

<p><strong>Описание задачи</strong></p>

<p>Далее описывается, как можно удалить квоту.</p>

<p><strong>Инструкция&nbsp;14.7.&nbsp;Удаление квот</strong></p>

<ol>
  <li>В древовидном представлении нажмите на дата-центр, квоту которого нужно изменить.</li>
  <li>Перейдите на вкладку <strong>Квота</strong> на панели навигации.</li>
  <li>Нажмите на имя квоты, которую нужно удалить.</li>
  <li>Нажмите на кнопку <strong>Удалить</strong> в верхней части панели навигации, под рядом вкладок.</li>
  <li>Нажмите <strong>OK</strong> в окне <strong>Удалить квоту</strong> для подтверждения удаления этой квоты.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы удалили квоту.</p>

<h3 id="service-level-agreement-policy-enforcement">⁠Принудительное применение политики соглашения об уровне обслуживания (SLA)</h3>

<p>oVirt версии 3.3 поддерживает функционал SLA в процессорах. Доступ к этим возможностям можно получить через Портал администрирования.</p>

<p><strong>Описание задачи</strong></p>

<p>Далее описывается настройка функционала SLA в ЦП.</p>

<ol>
  <li>Выберите <strong>Добавить ВМ</strong> на панели навигации.</li>
  <li>Выберите <strong>Показать расширенные параметры</strong>.</li>
  <li>Перейдите на вкладку <strong>Выделение ресурсов</strong>.</li>
  <li>Укажите <strong>Ресурсы ЦП</strong>. Возможные значения: <strong>Низкое</strong>, <strong>Среднее</strong>, <strong>Высокое</strong>, <strong>Настраиваемое</strong> и <strong>Отключено</strong>. ВМ, имеющие значение <strong>Высокое</strong> получают в два раза больше ресурсов, чем ВМ со значением <strong>Среднее</strong>, а ВМ, имеющие значение <strong>Среднее</strong> получают в два раза больше ресурсов, чем ВМ со значением <strong>Низкое</strong>. Значение <strong>Отключено</strong> заставляет VDSM использовать старый алгоритм для определения раздачи ресурсов; как правило, в такой ситуации число раздаваемых ресурсов равно 1020.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили политику соглашения об уровне обслуживания ЦП. Потребление ресурсов ЦП пользователями теперь управляется настроенной политикой.</p>

<p><img alt="Description" title="Описание" src="./OVirt Administration Guide — oVirt_files/SLA.png"></p>

<p><strong>Рисунок&nbsp;14.1.&nbsp;Принудительное применение политики SLA: меню распределения ресурсов ЦП</strong></p>

<h2 id="event-notifications">Уведомление о событиях</h2>

<h3 id="configuring-event-notifications">Настройка уведомлений о событиях</h3>

<p><strong>Описание задачи</strong></p>

<p>oVirt может рассылать уведомления назначенным пользователям об особых событиях в управляемом oVirt окружении. Чтобы использовать этот функционал, необходимо настроить почтовый агент на доставку уведомлений.</p>

<p><strong>Инструкция&nbsp;15.1.&nbsp;Настройка уведомления о событиях</strong></p>

<ol>
  <li>Убедитесь, что необходимые переменные настроены на почтовом клиенте.</li>
  <li>Используйте ресурсную вкладку <strong>Пользователи</strong> режим дерева или поисковый функционал чтобы найти и выделить пользователя, которому будут посылаться уведомления о событиях.</li>
  <li>Перейдите на вкладку <strong>Уведомления о событиях</strong> на панели сведений, чтобы получить список о событиях, о которых будет уведомляться пользователь. В случае, если уведомления пользователя о событиях не настроены, список будет пустым.</li>
  <li>Нажмите <strong>Управление событиями</strong> чтобы открыть окно <strong>Добавить уведомление о событиях</strong>.
<img alt="The Add Events Notification Window" title="Окно добавления уведомлений о событиях" src="./OVirt Administration Guide — oVirt_files/Add_Event_Notification.png">
<strong>Рисунок&nbsp;15.1.&nbsp;Окно добавления уведомлений о событиях</strong></li>
  <li>Используйте кнопку <strong>Развернуть всё</strong> или кнопки разворачивания отдельных элементов чтобы просмотреть события.</li>
  <li>Отметьте галочками соответствующие параметры.</li>
  <li>В поле <strong>Получатель почты</strong> введите почтовый адрес.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
  <li>Добавьте и запустите службу <strong>ovirt-engine-notifier</strong> в oVirt для включения сделанных изменений:
    # chkconfig –add ovirt-engine-notifier
    # chkconfig ovirt-engine-notifier on
    # service ovirt-engine-notifier restart</li>
</ol>

<p><strong>Результат</strong></p>

<p>Указанный пользователь теперь будет получать уведомления о событиях в окружении oVirt. Выбранные события показываются во вкладке <strong>Уведомления о событиях</strong> этого пользователя.</p>

<h3 id="parameters-for-event-notifications-in-ovirt-engine-notifierconf">Параметры уведомлений о событиях в ovirt-engine-notifier.conf</h3>

<p>Файл конфигурации уведомления о событиях можно найти по пути <code>/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</code></p>

<p><strong>Таблица&nbsp;15.1.&nbsp;переменные ovirt-engine-notifier.conf</strong></p>

<table>
<colgroup>
<col width="40%">
<col width="20%">
<col width="40%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя переменной</p></th>
<th align="left"><p>Значение по умолчанию</p></th>
<th align="left"><p>Заметки</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>SENSITIVE_KEYS</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Список, через запятую, клавиш, которые не будут загружены.</p></td>
</tr>
<tr class="even">
<td align="left"><p>JBOSS_HOME</p></td>
<td align="left"><p>/usr/share/jbossas</p></td>
<td align="left"><p>Местоположение сервера приложений JBoss, используемого oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ENGINE_ETC</p></td>
<td align="left"><p>/etc/ovirt-engine</p></td>
<td align="left"><p>Местоположение каталога <code>etc</code>, используемого oVirt.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ENGINE_LOG</p></td>
<td align="left"><p>/var/log/ovirt-engine</p></td>
<td align="left"><p>Местоположение каталога <code>logs</code> используемого oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ENGINE_USR</p></td>
<td align="left"><p>/usr/share/ovirt-engine</p></td>
<td align="left"><p>Местоположение каталога <code>usr</code> используемого oVirt.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ENGINE_JAVA_MODULEPATH</p></td>
<td align="left"><p>${ENGINE_USR}/modules</p></td>
<td align="left"><p>Путь, по которому добавляются модули JBoss.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>NOTIFIER_DEBUG_ADDRESS</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Адрес машины, которую можно использовать для выполнения удалённой отладки виртуальной машины Java, используемой для уведомления о событиях.</p></td>
</tr>
<tr class="even">
<td align="left"><p>NOTIFIER_STOP_TIME</p></td>
<td align="left"></td>
<td align="left"><p>Лимит времени ожидания службы (сек).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>NOTIFIER_STOP_INTERVAL</p></td>
<td align="left"></td>
<td align="left"><p>Время, на которое будет увеличен счётчик лимита времени (сек).</p></td>
</tr>
<tr class="even">
<td align="left"><p>INTERVAL_IN_SECONDS</p></td>
<td align="left"></td>
<td align="left"><p>Временной промежуток между событиями доставки уведомлений подписчикам (сек).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>IDLE_INTERVAL</p></td>
<td align="left"></td>
<td align="left"><p>Временные промежутки, между которыми будут выполняться задачи с низким приоритетом (сек).</p></td>
</tr>
<tr class="even">
<td align="left"><p>DAYS_TO_KEEP_HISTORY</p></td>
<td align="left"></td>
<td align="left"><p>Эта переменная устанавливает число дней, в течении которых события, о которых были отправлены уведомления, хранятся в таблице журнала. Если значение переменной отсутствует, события хранятся в таблице журнала бесконечно.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>FAILED_QUERIES_NOTIFICATION_THRESHOLD</p></td>
<td align="left"></td>
<td align="left"><p>Число неудавшихся запросов, после которых посылается почтовое уведомление. Почтовое уведомление посылается после первого сбоя получения уведомлений, а затем по одному разу на достигнутое число сбоев, указанное этой переменной. Если указать значение <code>0</code> или <code>1</code>, почтовое уведомление будет отправляться после каждого сбоя.</p></td>
</tr>
<tr class="even">
<td align="left"><p>FAILED_QUERIES_NOTIFICATION_RECIPIENTS</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Почтовые адреса получателей, которым будут посылаться почтовые уведомления. Почтовые адреса должны разделяться запятой. Эта запись устарела с появлением переменной <code>FILTER</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>DAYS_TO_SEND_ON_STARTUP</p></td>
<td align="left"></td>
<td align="left"><p>Количество дней со старыми событиями, которые будут обработаны и посланы после начала посылки уведомлений.</p></td>
</tr>
<tr class="even">
<td align="left"><p>FILTER</p></td>
<td align="left"><p>исключая:*</p></td>
<td align="left"><p>Алгоритм, используемый для определения событий, запускающих почтовые уведомления и их получателей. Значение этой переменной состоит из сочетания <code>include</code> или <code>exclude</code>, события и получателя. Например, <code>include:VDC_START(smtp:mail@example.com) ${FILTER}</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>MAIL_SERVER</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Адрес почтового сервера SMTP. Обязательный параметр.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MAIL_PORT</p></td>
<td align="left"></td>
<td align="left"><p>Порт, используемый для подключений. Возможные значение: <code>25</code> для обычного SMTP, <code>465</code> для SMTP с SSL, и <code>587</code> для SMTP с TLS.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MAIL_USER</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Эти переменные должны быть установлены, если для аутентификации пользователя используется SSL. Эта переменная также используется для обозначения адреса отправителя, в отсутствии настроенной переменной MAIL_FROM. Некоторые почтовые серверы не поддерживают этот функционал. Адрес указывается в формате RFC822.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SENSITIVE_KEYS</p></td>
<td align="left"><p>${SENSITIVE_KEYS},MAIL_PASSWORD</p></td>
<td align="left"><p>Необходим для аутентификации пользователя, если почтовый сервер требует аутентификации или если включен SSL или TLS.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MAIL_PASSWORD</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Необходим для аутентификации пользователя, если почтовый сервер требует аутентификации или если включен SSL или TLS.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MAIL_SMTP_ENCRYPTION</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Тип шифрования, используемый при подключении. Возможные значения: <code>нет</code>, <code>ssl</code>, <code>tls</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>HTML_MESSAGE_FORMAT</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>Если значение этой переменной установлено на <code>верно</code>, почтовый сервер посылает сообщения в формате HTML.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MAIL_FROM</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Эта переменная указывает адрес отправителя в формате RFC822, если этот функционал поддерживается почтовым сервером.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MAIL_REPLY_TO</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Эта переменная указывает адреса ответов на отправленную почту в формате RFC822, если этот функционал поддерживается почтовым сервером.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MAIL_SEND_INTERVAL</p></td>
<td align="left"></td>
<td align="left"><p>Число отправленных сообщений SMTP на каждый интервал IDLE_INTERVAL</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MAIL_RETRIES</p></td>
<td align="left"></td>
<td align="left"><p>Число попыток отправки сообщений перед констатацией сбоя.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SNMP_MANAGER</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>IP-адреса полных доменных имён машин, которые будут выполнять роль SNMP-администраторов. Записи разделяются пробелом и могут содержать номер порта. Например, <code>manager1.example.com manager2.example.com:164</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>SNMP_COMMUNITY</p></td>
<td align="left"><p>общедоступный</p></td>
<td align="left"><p>SNMP-сообщество по умолчанию.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SNMP_OID</p></td>
<td align="left"></td>
<td align="left"><p>Идентификаторы объектов TRAP по умолчанию, для оповещений.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ENGINE_INTERVAL_IN_SECONDS</p></td>
<td align="left"></td>
<td align="left"><p>Интервал между проверками машины с установленной oVirt (сек). Интервал отсчитывается от момента окончания проверки.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ENGINE_MONITOR_RETRIES</p></td>
<td align="left"></td>
<td align="left"><p>Число попыток уведомителя проверить статус машины, на которой установлена oVirt, за указанный интервал после сбоя.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ENGINE_TIMEOUT_IN_SECONDS</p></td>
<td align="left"></td>
<td align="left"><p>Время ожидания перед попыткой уведомителя проверить статус машины, на которой установлена oVirt, за указанный интервал после сбоя.</p></td>
</tr>
<tr class="even">
<td align="left"><p>IS_HTTPS_PROTOCOL</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>Этот параметр должен иметь значение <code>верно</code>, если JBoss выполняется в защищённом режиме.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SSL_PROTOCOL</p></td>
<td align="left"><p>TLS</p></td>
<td align="left"><p>Протокол, используемый JBoss configuration connector при включённом SSL.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SSL_IGNORE_CERTIFICATE_ERRORS</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>Этот параметр должен иметь значение <code>верно</code>, если JBoss выполняется в защищённом режиме, и ошибки SSL должны игнорироваться.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SSL_IGNORE_HOST_VERIFICATION</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>Этот параметр должен иметь значение <code>верно</code>, если JBoss выполняется в защищённом режиме, и проверки имени хоста должны игнорироваться.</p></td>
</tr>
<tr class="even">
<td align="left"><p>REPEAT_NON_RESPONSIVE_NOTIFICATION</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>Эта переменная указывает, должны ли повторные ообщения о сбоях посылаться подписчикам, если машина с устанолвенной oVirt не отвечает.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ENGINE_PID</p></td>
<td align="left"><p>/var/lib/ovirt-engine/ovirt-engine.pid</p></td>
<td align="left"><p>Путь и имя файла идентификатора процесса oVirt.</p></td>
</tr>
</tbody>
</table>

<h3 id="canceling-event-notifications">Отмена уведомлений о событиях</h3>

<p><strong>Описание задачи</strong></p>

<p>Пользователь  настроил ненужное уведомление о событиях и хочет его отменить.</p>

<p><strong>Инструкция&nbsp;15.2.&nbsp;Отмена уведомлений о событиях</strong></p>

<ol>
  <li>Во вкладке <strong>Пользователи</strong> выберите пользователя или группу пользователей.</li>
  <li>Перейдите на вкладку <strong>Уведомления о событиях</strong> на панели сведений чтобы увидеть список событий, о которых пользователю приходят уведомления.</li>
  <li>Нажмите <strong>Управление событиями</strong> чтобы открыть окно <strong>Добавить уведомление о событии</strong>.</li>
  <li>Используйте кнопку <strong>Развернуть всё</strong> или кнопки разворачивания отдельных элементов чтобы просмотреть события.</li>
  <li>Уберите галочки с нужных пунктов чтобы удалить уведомление об этом событии.</li>
  <li>Нажмите <strong>OK</strong> чтобы сохранить изменения и закрыть окно.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы отменили ненужные уведомления о событиях пользователю.</p>

<h2 id="utilities">⁠Инструментарий</h2>

<h3 id="the-ovirt-engine-rename-tool">Инструмент переименования ЦУ Ovirt</h3>

<h4 id="the-ovirt-engine-rename-tool-1">Инструмент переименования ЦУ Ovirt</h4>

<p>При запуске команды <code>engine-setup</code> в чистом окружении, команда создаёт некоторое число сертификатов и ключей, которые используют полное доменное имя oVirt, предоставленное во время настройки. Если позже возникает необходимость изменения полного доменного имени oVirt (например, во время миграции машины-хоста oVirt в другой домен), то записи полного доменного имени должны быть обновлены для отражения нового имени. Команда <code>ovirt-engine-rename</code> автоматизирует эту задачу.</p>

<p>Команда <code>ovirt-engine-rename</code> обновляет записи полного доменного имени oVirt в следующих местоположениях:</p>

<ul>
  <li>/etc/ovirt-engine/engine.conf.d/10-setup-protocols.conf</li>
  <li>/etc/ovirt-engine/imageuploader.conf.d/10-engine-setup.conf</li>
  <li>/etc/ovirt-engine/isouploader.conf.d/10-engine-setup.conf</li>
  <li>/etc/ovirt-engine/logcollector.conf.d/10-engine-setup.conf</li>
  <li>/etc/pki/ovirt-engine/cert.conf</li>
  <li>/etc/pki/ovirt-engine/cert.template</li>
  <li>/etc/pki/ovirt-engine/certs/apache.cer</li>
  <li>/etc/pki/ovirt-engine/keys/apache.key.nopass</li>
  <li>/etc/pki/ovirt-engine/keys/apache.p12</li>
</ul>

<div class="alert alert-info">
  <p><strong>Предупреждение:</strong> хотя команда <code>ovirt-engine-rename</code> создаёт новый сертификат для веб-сервера, на котором выполняется oVirt, она не влияет на сертификат ЦУ oVirt или на CA. По этой причине использование команды <code>ovirt-engine-rename</code> связано с некоторым риском, в частности в окружениях, обновлённых с oVirt версии 3.2 и более ранних. Поэтому, везде, где это возможно, изменение полного доменного имени oVirt рекомендуется производить с помощью команд <code>engine-cleanup</code> и <code>engine-setup</code>.</p>

</div>

<h4 id="syntax-for-the-ovirt-engine-rename-command">Синтаксис команды переименования ЦУ Ovirt</h4>

<p>Базовый синтаксис команды <code>ovirt-engine-rename</code>:</p>

<pre class="highlight plaintext"><code># /usr/share/ovirt-engine/setup/bin/ovirt-engine-rename
</code></pre>

<p>Команда также принимает следующие параметры:</p>

<p><em><code>--newname=[new name]</code></em><br>
Возможность указать новое полное доменное имя oVirt без участия пользователя.</p>

<p><em><code>--log=[file]</code></em><br>
Путь и имя файла, куда должен записываться журнал операции переименования.</p>

<p><em><code>--config=[file]</code></em><br>
Путь и имя файла конфигурации для загрузки во время операции переименования.</p>

<p><em><code>--config-append=[file]</code></em><br>
Путь и имя файла конфигурации, добавляемого во время операции переименования. Этот параметр можно использовать чтобы указать путь и имя файла ответов.</p>

<p><em><code>--generate-answer=[file]</code></em><br>
Путь и имя файла, в который записываются ответы и значения, изменяемые командой <code>ovirt-engine-rename</code>.</p>

<h4 id="using-the-ovirt-engine-rename-tool">Использование команды переименования ЦУ Ovirt</h4>

<p><strong>Описание задачи</strong></p>

<p>Команду <code>ovirt-engine-rename</code> можно использовать для обновления записей полного доменного имени oVirt.</p>

<p><strong>Инструкция&nbsp;16.1.&nbsp;Переименование oVirt</strong></p>

<ol>
  <li>Подготовьте все DNS и другие релевантные записи для использования нового полного доменного имени.</li>
  <li>Обновите параметры DHCP-сервера, если используется DHCP.</li>
  <li>Обновите имя хоста в oVirt.</li>
  <li>
    <p>Введите следующую команду:
    # /usr/share/ovirt-engine/setup/bin/ovirt-engine-rename</p>
  </li>
  <li>
    <p>По запросу нажмите <strong>Enter</strong> для остановки службы ЦУ:
    During execution engine service will be stopped (OK, Cancel) [OK]:</p>
  </li>
  <li>По запросу введите новое полное доменное имя oVirt:
    New fully qualified server name:[новое_имя]</li>
</ol>

<p><strong>Результат</strong></p>

<p>Команда <code>ovirt-engine-rename</code> обновляет записи полного доменного имени oVirt.</p>

<h3 id="the-domain-management-tool">Инструмент управления доменом</h3>

<h4 id="the-domain-management-tool-1">Инструмент управления доменом</h4>

<p>oVirt аутентифицирует пользователей с помощью служб каталогов. Для добавления пользователей в oVirt сначала нужно, чтобы внутренний <code>администратор</code> добавил службу каталогов, в которой необходима аутентификация пользователей. Домены служб каталогов добавляются и удаляются с помощью встроенной утилиты управления доменами, <code>engine-manage-domains</code>.</p>

<p>Команда <code>engine-manage-domains</code> доступна только на машине, где установлена oVirt. Команда <code>engine-manage-domains</code> должна запускаться с правами пользователя <code>root</code>.</p>

<h4 id="syntax-for-the-domain-management-tool">Синтаксис управления доменами</h4>

<p>Используется следующий синтаксис:</p>

<pre class="highlight plaintext"><code>engine-manage-domains -action=ДЕЙСТВИЕ [параметры]
</code></pre>

<p>Доступные действия:</p>

<p><em><code>add</code></em><br>
Добавление домена в конфигурацию служб каталогов oVirt.</p>

<p><em><code>edit</code></em><br>
Изменить домен в конфигурации служб каталогов oVirt.</p>

<p><em><code>delete</code></em><br>
Удалить домен из конфигурации служб каталогов oVirt.</p>

<p><em><code>validate</code></em><br>
Проверка конфигурации служб каталогов oVirt. Данная команда выполняет попытку аутентификации каждого домена в конфигурации с помощью настроенного пользователя и пароля.</p>

<p><em><code>list</code></em><br>
Список текущей конфигурации служб каталогов oVirt.</p>

<p>Эти параметры можно сочетать с действиями в командной строке:</p>

<p><em><code>--add-permissions</code></em><br>
Указывает, что пользователю домена в oVirt будет присвоена роль <strong>SuperUser</strong>. По умолчанию, если параметр <em><code>--add-permissions</code></em> не указан, то роль <strong>SuperUser</strong> пользователю домена не присваивается. Параметр <em><code>--add-permissions</code></em> указывается по желанию. Он действителен только при использовании в сочетании с действиями <em><code>add</code></em> и <em><code>edit</code></em>.</p>

<p><em><code>--change-password-msg=[MSG]</code></em><br>
Указывает сообщение, которое будет возвращено пользователю при попытке входа в систему с просроченным паролем. Это сообщение даёт возможность направить пользователей по конкретному адресу URL (начинающемуся с http или https), где можно сменить пароль. Параметр <em><code>--change-password-msg</code></em> является опциональным и действует только при использовании в сочетании с действиями <em><code>add</code></em> и <em><code>edit</code></em>.</p>

<p><em><code>--config-file=[FILE]</code></em><br>
Указывает альтернативный файл конфигурации. Параметр <em><code>--config-file</code></em> всегда опционален.</p>

<p><em><code>--domain=[DOMAIN]</code></em><br>
Домен, в котором будет выполняться действие. Параметр <em><code>--domain</code></em> является обязательным для действий <em><code>add</code></em>, <em><code>edit</code></em> и <em><code>delete</code></em>.</p>

<p><em><code>--force</code></em><br>
Принудительный пропуск подтверждений при операциях удаления.</p>

<p><em><code>--ldap-servers=[servers]</code></em><br>
Список серверов LDAP.</p>

<p><em><code>--provider=</code></em>[PROVIDER]<br>
Тип поставщика LDAP сервера каталогов для домена. Действительные значения:</p>

<ul>
  <li><em><code>ad</code></em> - Microsoft Active Directory.</li>
  <li><em><code>ipa</code></em> - Identity Management (IdM).</li>
  <li><em><code>rhds</code></em> - Red Hat Directory Server. В составе Red Hat Directory Server отсутствует Kerberos. oVirt требует аутентификацию Kerberos. Для предоставления служб каталога oVirt, Red Hat Directory Server должен выполняться в качестве службы внутри домена Kerberos.
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> чтобы использовать Red Hat Directory Server в качестве сервера каталогов, в Red Hat Directory Server должен быть установлен модуль <code>memberof</code>. Чтобы использовать модуль <code>memberof</code>, пользователи должны быть <code>inetuser</code>.</p>

    </div>
  </li>
  <li><code>itds</code> - IBM Tivoli Directory Server.</li>
  <li><code>oldap</code> - OpenLDAP.</li>
</ul>

<p><em><code>--report</code></em><br>
При использовании в сочетании с действием <em><code>validate</code></em>, эта команда выводит сообщение о всех возникших ошибках проверки.</p>

<p><em><code>--user=[USER]</code></em><br>
Указывает, какого пользователя домена использовать. Параметр <em><code>--user</code></em> обязателен для действия <em><code>add</code></em>, и опционален для действия <em><code>edit</code></em>.</p>

<p><em><code>--password-file=[FILE]</code></em><br>
Указывает, что пароль пользователя домена находится в первой строке предоставленного файла. Этот параметр, или параметр <em><code>--interactive</code></em> необходим для предоставления пароля при использовании с действием <em><code>add</code></em>.</p>

<p>Дополнительные подробности использования см. в выводе <code>engine-manage-domains</code> с параметром help:</p>

<pre class="highlight plaintext"><code># engine-manage-domains --help
</code></pre>

<h3 id="the-configuration-tool">Инструмент конфигурации</h3>

<h4 id="the-configuration-tool-1">Инструмент конфигурации</h4>

<p>Во время установки oVirt изменяется только набор параметров конфигурации по умолчанию. Дальнейшие изменения делаются с помощью инструмента конфигурации: <code>engine-config</code>.</p>

<p>Для запуска и обновления конфигурации, инструменту конфигурации не требуется платформа приложений Red Hat JBoss Enterprise Application Platform или oVirt. Ключевые значения конфигурации хранятся в базе данных; изменения будут сохраняться только если база данных является рабочей. Изменения применяются во время перезапуска Red Hat JBoss Enterprise Application Platform.</p>

<p>oVirt хранит параметры конфигурации в виде последовательностей парных отображений ключ-значение. Инструмент конфигурации даёт возможность:</p>

<ul>
  <li>Получить список всех доступных ключей конфигурации.</li>
  <li>Получить список всех доступных значений конфигурации.</li>
  <li>Получать значение конкретного ключа конфигурации.</li>
  <li>Установить значение конкретного ключа конфигурации.</li>
</ul>

<p>Также имеется возможность поддерживать более одной версии конфигурации oVirt. Используйте параметр <em><code>--cver</code></em> для указания версии конфигурации, используемой для получения или установки значения ключа. Версия конфигурации по умолчанию: <code>general</code>.</p>

<h4 id="syntax-for-engine-config-command">Синтаксис команды engine-config</h4>

<p>Этот инструмент конфигурации доступен на клиентской машине с установленной oVirt. Полную информацию об использовании см. в выводе команды <code>engine-config</code> с параметром help:</p>

<pre class="highlight plaintext"><code># engine-config --help
</code></pre>

<p><strong>Типовые задачи</strong></p>

<p>Вывести список доступных ключей конфигурации<br>
Используйте параметр <em><code>--list</code></em> для получения списка доступных ключей.</p>

<!-- -->

<pre class="highlight plaintext"><code># engine-config --list
</code></pre>

<p>Для каждого доступного ключа конфигурации приводится имя и описание.</p>

<p>Вывести список доступных значений конфигурации<br>
Используйте параметр <em><code>--all</code></em> для получения списка доступных значений.</p>

<!-- -->

<pre class="highlight plaintext"><code># engine-config --all
</code></pre>

<p>Для каждого доступного ключа конфигурации приводится имя, текущее значение ключа и версия конфигурации.</p>

<p>Получение значения ключа конфигурации<br>
Используйте параметр <em><code>--get</code></em> для получения значения конкретного ключа.</p>

<!-- -->

<pre class="highlight plaintext"><code># engine-config --get KEY_NAME
</code></pre>

<p>Замените <em>KEY_NAME</em> именем конкретного ключа для получения имени ключа, его значения и версии конфигурации. Используйте параметр <em><code>--cver</code></em> для указания версии конфигурации при получении значения.</p>

<p>Установка значения ключа конфигурации<br>
Используйте параметр <em><code>--set</code></em> для указания значения конкретного ключа. Также необходимо установить версию конфигурации, к которой применяются изменения, с помощью параметра <em><code>--cver</code></em>.</p>

<!-- -->

<pre class="highlight plaintext"><code># engine-config --set KEY_NAME=KEY_VALUE --cver=VERSION
</code></pre>

<p>Замените <em>KEY_NAME</em> именем конкретного ключа, который нужно установить; замените <em>KEY_VALUE</em> необходимым значением. Окружения более чем с одной версией требуют указания <em>VERSION</em>.</p>

<h4 id="the-admininternal-user">Пользователь admin@internal</h4>

<p>Учётная запись пользователя <code>admin@internal</code> автоматически создаётся во время установки oVirt. Эта учётная запись хранится локально в базе данных oVirt PostgreSQL, отдельно от внешних служб каталогов, таких, как IdM или Active Directory. В отличие от внешних доменов каталогов, пользователей нельзя удалить или добавить из <code>внешнего</code> домена. Пользователь <code>admin@internal</code> — это SuperUser с административными привилегиями в окружении oVirt через Портал администрирования.</p>

<p>Пароль пользователя <code>admin@internal</code> настраивается во время установки oVirt. Для смены пароля используйте утилиту <strong>engine-config</strong>.</p>

<h4 id="changing-the-password-for-admininternal">Смена пароля пользователя admin@internal</h4>

<ol>
  <li>Авторизуйтесь на сервере oVirt как пользователь <code>root</code>.</li>
  <li>
    <ul>
      <li>
        <p>Для oVirt версии 3.6 или более поздней (подробности см. <a href="http://www.ovirt.org/develop/release-management/features/infra/aaa-jdbc/#Password_management">по ссылке</a>):</p>
    # ovirt-aaa-jdbc-tool user password-reset admin</p>
      </li>
      <li>
        <p>Для oVirt версии 3.5 или более ранней:
Чтобы установить новый пароль пользователя <code>admin@internal</code> используйте утилиту <code>engine-config</code> .</p>
    # engine-config -s AdminPassword=interactive</p>

        <p>Используйте экранирование, если в пароле используются специальные символы.</p>
      </li>
    </ul>
  </li>
  <li>Для применения изменений перезапустите службу ovirt-engine.</li>
</ol>

<!-- -->

<pre class="highlight plaintext"><code># service ovirt-engine restart
</code></pre>

<h4 id="ovirt-configuration-options">Параметры конфигурации oVirt</h4>

<p><strong>Таблица&nbsp;16.1.&nbsp;Параметры конфигурации oVirt</strong></p>

<table>
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Имя</p></th>
<th align="left"><p>Описание</p></th>
<th align="left"><p>Тип</p></th>
<th align="left"><p>Значение по умолчанию</p></th>
<th align="left"><p>Комментарии</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>AbortMigrationOnError</p></td>
<td align="left"><p>Прерывание текущей миграции при возникновении ошибки</p></td>
<td align="left"><p>Логический</p></td>
<td align="left"><p>v3.0: ложно v3.1: ложно v3.2: ложно v3.3: ложно</p></td>
<td align="left"><p>Указывает, можно ли по желанию прервать текущую миграцию при возникновении ошибки.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AsyncTaskPollingRate</p></td>
<td align="left"><p>Частота опроса асинхронных задач (в сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Насколько часто (в секундах) oVirt опрашивает статус выполняемых асинхронных задач.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AsyncTaskZombieTaskLifeInMinutes</p></td>
<td align="left"><p>Время жизни задач-зомби (в минутах)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Разрешённое время выполнения задачи перед тем, как она считается зомби и должна быть убита. Это значение особенно влияет на действия с большими хранилищами. При использовании медленных хранилищ и больших виртуальных образов, или же если известно, что для выполнения задачи требуется более 3000 минут (50 часов), то это значение должно быть увеличено.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AttestationPort</p></td>
<td align="left"><p>Определение порта службы для службы аттестации</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Какой порт прослушивает сервер аттестации</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AttestationServer</p></td>
<td align="left"><p>Определение полного доменного имени сервера аттестации</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Полное доменное имя или IP-адрес сервера аттестации.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AttestationTruststore</p></td>
<td align="left"><p>Хранилище доверия для защиты соединений со службой аттестации</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>TrustStore.jks</p></td>
<td align="left"><p>Скопируйте файл хранилища ключей TrustStore.jks keystore из каталога <code>/var/lib/oat-appraiser/Certificate/</code> на сервере аттестации в каталог <code>/usr/share</code> на сервере oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AttestationTruststorePass</p></td>
<td align="left"><p>Пароль для доступа к хранилищу доверия</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>password</p></td>
<td align="left"><p>Пароль по умолчанию: password.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AttestationFirstStageSize</p></td>
<td align="left"><p>Размер аттестации для первого этапа</p></td>
<td align="left"><p>Целое</p></td>
<td align="left"></td>
<td align="left"><p>Используется для быстрой инициализации. Не изменяйте, если не знаете, зачем.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AuditLogAgingThreshold</p></td>
<td align="left"><p>Порог устаревания журнала аудита (дни)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Сколько хранится журнал аудита перед его ротацией.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AuditLogCleanupTime</p></td>
<td align="left"><p>Время проверки для чистки журнала аудита</p></td>
<td align="left"><p>Время</p></td>
<td align="left"><p>В какое время производится проверка журнала аудита на устаревание и его чистка.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AuthenticationMethod</p></td>
<td align="left"><p>Метод аутентификации, используемый в oVirt</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>LDAP</p></td>
<td align="left"><p>API, используемый для опроса пользователей. На данный момент поддерживается только LDAP.</p></td>
</tr>
<tr class="even">
<td align="left"><p>BlockMigrationOnSwapUsagePercentage</p></td>
<td align="left"><p>Процентный порог файла подкачки хоста (для расписаний)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальный процентный размер файла подкачки хоста, который может потребить ВМ во время работы или миграции. Если занимаемый хостом процент файла подкачки выходит за этот размер, перенос машины или запуск машины для работы не будет выполнен.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>BootstrapMinimalVdsmVersion</p></td>
<td align="left"><p>Минимальная версия VDSM</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Минимальная версия VDSM, поддерживаемая при добавлении хостов в oVirt. Новые версии имеют больше возможностей.</p></td>
</tr>
<tr class="even">
<td align="left"><p>CABaseDirectory</p></td>
<td align="left"><p>Базовый каталог CA</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>/etc/pki/ovirt-engine</p></td>
<td align="left"><p>Расположение центра сертификации oVirt на хосте oVirt host.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>CertificateFileName</p></td>
<td align="left"><p>Имя файла сертификата</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>/etc/pki/ovirt-engine/certs/engine.cer</p></td>
<td align="left"><p>Указывает на файл сертификата, используемый oVirt для SSL/TLS-подключений к VDSM.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ClientModeSpiceDefault</p></td>
<td align="left"><p>Стандартный консольный режим протокола SPICE</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>Автоматически</p></td>
<td align="left"><p>Режим по умолчанию для подключений к ВМ с помощью консольного протокола SPICE.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ClientModeVncDefault</p></td>
<td align="left"><p>Стандартный консольный режим протокола VNC</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>Встроенный</p></td>
<td align="left"><p>Режим по умолчанию для подключений к ВМ с помощью консольного протокола VNC.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ClientModeRdpDefault</p></td>
<td align="left"><p>Стандартный консольный режим протокола RDP</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>Автоматически</p></td>
<td align="left"><p>Режим по умолчанию для подключений к ВМ с помощью консольного протокола RDP.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ClusterEmulatedMachines</p></td>
<td align="left"><p>Поддерживаемые типы машин</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>v3.0: rhel6.2.0 v3.1: rhel6.3.0 v3.2: rhel6.4.0 v3.3: rhel6.5.0 v3.4: rhel6.5.0</p></td>
<td align="left"><p>Типы машин, поддерживаемые кластерами.</p></td>
</tr>
<tr class="even">
<td align="left"><p>CpuOverCommitDurationMinutes</p></td>
<td align="left"><p>Продолжительность (в минутах) потребления ресурсов ЦП для активации алгоритма выбора</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>При активированной политике равномерного распределения на кластере, ждать в течение указанного количества минут после обнаруженного превышенного выделения ресурсов ЦП перед запуском миграции ВМ для ребалансировки загрузки хоста. Это значение параметра применяется только для стандарта.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>CustomDeviceProperties</p></td>
<td align="left"><p>Настраиваемые свойства устройства</p></td>
<td align="left"><p>DeviceCustomProperties</p></td>
<td align="left"><p>Только v3.4: {type=interface;prop={SecurityGroups=^(?:(?:[0-9a-fA-F]{8}-(?:[0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}, *)*[0-9a-fA-F]{8}-(?:[0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}|)$}}</p></td>
<td align="left"><p>Определение настраиваемых свойств для каждого типа устройств.</p></td>
</tr>
<tr class="even">
<td align="left"><p>DefaultWindowsTimeZone</p></td>
<td align="left"><p>Часовой пояс по умолчанию для ВМ с Windows</p></td>
<td align="left"><p>WindowsTimeZone</p></td>
<td align="left"><p>GMT — время по Гринвичу </p></td>
<td align="left"><p>Часовой пояс по умолчанию при создании новых ВМ с Windows.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>DefaultGeneralTimeZone</p></td>
<td align="left"><p>Часовой пояс по умолчанию для ВМ с ОС, отличной от Windows</p></td>
<td align="left"><p>GeneralTimeZone</p></td>
<td align="left"><p>Etc/GMT</p></td>
<td align="left"><p>Часовой пояс по умолчанию при создании новых ВМ с ОС, отличными от Windows.</p></td>
</tr>
<tr class="even">
<td align="left"><p>DelayResetForSpmInSeconds</p></td>
<td align="left"><p>Задержка перед сбросом диспетчера пула хранилища</p></td>
<td align="left"><p>Двойной</p></td>
<td align="left"></td>
<td align="left"><p>Дополнительная задержка (сек.) перед перезагрузкой из-за проблем со связью в случае, если хост является диспетчером пула хранилища.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>DelayResetPerVmInSeconds</p></td>
<td align="left"><p>Задержка перед перезагрузкой ВМ</p></td>
<td align="left"><p>Двойной</p></td>
<td align="left"></td>
<td align="left"><p>Дополнительная задержка (сек.) перед перезагрузкой из-за проблем со связью для каждой ВМ, выполняемой на хосте.</p></td>
</tr>
<tr class="even">
<td align="left"><p>DisableFenceAtStartupInSec</p></td>
<td align="left"><p>Отсрочить операции блокады при запуске oVirt на кол-во секунд</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Разрешить задержку на указанное кол-во секунд после запуска oVirt для определения хостов, перед принятием решения о том, что хосты не отвечают, и переходу к выполнению операции блокады. Это значение необходимо увеличить, если oVirt находится на машине с долгой сетевой загрузкой (гость VMware, например).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>DwhHeartBeatInterval</p></td>
<td align="left"><p>Интервал (сек), через который хранилище данных информируется о том, что oVirt работает</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>WANDisableEffects</p></td>
<td align="left"><p>Значение отключенных эффектов WAN, посылаемое в консоль SPICE</p></td>
<td align="left"><p>StringMultiple</p></td>
<td align="left"><p>анимация</p></td>
<td align="left"><p>Список эффектов, отключенных в SPICE. Возможные значения: <code>анимация</code>, <code>фоновое изображение</code>, <code>сглаживание шрифтов</code> и <code>все</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>WANColorDepth</p></td>
<td align="left"><p>Значение глубины цвета WAN, посылаемое в консоль SPICE</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"><p>Глубина цвета, используемая SPICE. Возможные значения: <code>16</code> и <code>32</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p>EnableMACAntiSpoofingFilterRules</p></td>
<td align="left"><p>Включение правил фильтрации антиспуфинга для MAC-адресов</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>Включена ли сетевая фильтрация.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>EnableSpiceRootCertificateValidation</p></td>
<td align="left"><p>Включение проверки корневых сертификатов  Enable Spice Root Certification Validation</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>Если <code>верно</code>, то, при попытке подключения к ВМ через SPICE, сертификат хоста, на котором выполняется ВМ, и установочный сертификат ЦС oVirt посылаются клиенту SPICE, в качестве дополнительной меры безопасности.</p></td>
</tr>
<tr class="even">
<td align="left"><p>EnableUSBAsDefault</p></td>
<td align="left"><p>Подключение устройств USB к ВМ по умолчанию</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>верно</p></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>EnableVdsLoadBalancing</p></td>
<td align="left"><p>Включает систему балансировки загрузки на хосте</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>Это значение позволяет пользователю включать и отключать («верно» и «ложно», соответственно) балансировку ВМ согласно настроенной политике кластера.</p></td>
</tr>
<tr class="even">
<td align="left"><p>EncryptHostCommunication</p></td>
<td align="left"><p>Шифрование при обмене информацией между хостами</p></td>
<td align="left"><p>Логический</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>Будет ли шифроваться обмен информацией между хостами и oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ExternalSchedulerServiceURL</p></td>
<td align="left"><p>Местоположение внешнего планировщика</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p><a href="http://localhost:18781/" class="uri">http://localhost:18781</a></p></td>
<td align="left"><p>Местоположение внешнего планировщика.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ExternalSchedulerConnectionTimeout</p></td>
<td align="left"><p>Время до истечения времени ожидания, в течение которого будут производиться попытки подключения к внешнему планировщику</p></td>
<td align="left"><p>Integer</p></td>
<td align="left"></td>
<td align="left"><p>Для отключения этого функционала установите значение <code>0</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ExternalSchedulerEnabled</p></td>
<td align="left"><p>Будет ли внешний планировщик учитывать внешние фильтры и балансировщики нагрузки</p></td>
<td align="left"><p>Логическое</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>ExternalSchedulerResponseTimeout</p></td>
<td align="left"><p>Время до истечения времени ожидания, в течение которого будет ожидаться ответ от внешнего планировщика</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>FreeSpaceCriticalLowInGB</p></td>
<td align="left"><p>Критический порог для предупреждения о нехватке места на диске (в ГБ)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Выводит предупреждение, если в домене хранилища остался указанный объём дискового пространства. Этот параметр также используется  в различных предварительных тестах на готовность к работе при попытках пользователей использовать домены хранилища, для предотвращения достижения данного критического объёма. Добавление и импорт дисков не будет выполнено, если доступный объём дискового пространства меньше указанного здесь значения.</p></td>
</tr>
<tr class="even">
<td align="left"><p>FreeSpaceLow</p></td>
<td align="left"><p>Процентный лимит свободного дискового пространства, ниже которого констатируется его нехватка</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Если свободное дисковое пространство в домене хранилища достигает указанного процента, то констатируется нехватка места на диске.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>GlusterRefreshRateHooks</p></td>
<td align="left"><p>Частота обновления ловушек Gluster</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Частота обновления (сек.) для ловушек Gluster из серверов Gluster.</p></td>
</tr>
<tr class="even">
<td align="left"><p>HighUtilizationForEvenlyDistribute</p></td>
<td align="left"><p>Лимит высокого коэффициента использования для алгоритма выбора равномерного распределения</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное число виртуальных машин на хост в алгоритме выбора равномерного распределения.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>HighUtilizationForPowerSave</p></td>
<td align="left"><p>Лимит высокого коэффициента использования для алгоритма выбора режима экономии энергии</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Стандарт для только что созданных кластеров, используемый с алгоритмом балансировки нагрузки при экономии энергии, отмечает самый высокий лимит использования хоста при начальной загрузке данных на хосты.</p></td>
</tr>
<tr class="even">
<td align="left"><p>HostPreparingForMaintenanceIdleTime</p></td>
<td align="left"><p>Время ожидания (сек.) для определения, простаивает ли хост со статусом <code>PreparingForMaintenance</code></p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>По истечении интервала делается ещё одна попытка перевести хост в режим обслуживания.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>KeystoneAuthUrl</p></td>
<td align="left"><p>Местоположение сервера Keystone</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Местоположение сервера OpenStack Keystone для аутентификации поставщиков OpenStack.</p></td>
</tr>
<tr class="even">
<td align="left"><p>LDAPQueryTimeout</p></td>
<td align="left"><p>Истечение времени чтения (сек.) для запросов LDAP</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Промежуток времени, в течение которого запрос LDAP будет производить чтение, до того, как запрос будет остановлен.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>LDAPOperationTimeout</p></td>
<td align="left"><p>Истечение времени поиска на стороне сервера LDAP</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Промежуток времени, в течение которого будет работать поиск LDAP, перед его остановкой.</p></td>
</tr>
<tr class="even">
<td align="left"><p>LDAPConnectTimeout</p></td>
<td align="left"><p>Истечение времени подключения (сек.) для запросов LDAP</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Промежуток времени, в течение которого будет подключен запрос LDAP, перед его остановкой.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>LocalAdminPassword</p></td>
<td align="left"><p>Пароль локального администратора</p></td>
<td align="left"><p>Password</p></td>
<td align="left"><p>Заполняется во время первоначальной настройки</p></td>
<td align="left"><p>Пароль для пользователя по умолчанию <code>admin@local</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p>LogMaxPhysicalMemoryUsedThresholdInPercentage</p></td>
<td align="left"><p>Порог использования ресурсов памяти перед запуском события журнала</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальный порог использования физической памяти хоста, в процентах, при превышении которого будет запущено событие журнала аудита.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>LogMaxCpuUsedThresholdInPercentage</p></td>
<td align="left"><p>Порог использования ресурсов ЦП для запуска события журнала</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальный порог использования ресурсов ЦП хоста, в процентах, при превышении которого будет запущено событие журнала аудита.</p></td>
</tr>
<tr class="even">
<td align="left"><p>LogMaxNetworkUsedThresholdInPercentage</p></td>
<td align="left"><p>Порог использования сетевых ресурсов для запуска события журнала</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальный порог использования сетевых ресурсов хоста, в процентах, при превышении которого будет запущено событие журнала аудита.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>LogMinFreeSwapThresholdInMB</p></td>
<td align="left"><p>Порог свободных ресурсов подкачки для запуска события журнала</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Минимальный порог свободных ресурсов подкачки на хосте (МБ), при превышении которого будет запущено событие журнала аудита.</p></td>
</tr>
<tr class="even">
<td align="left"><p>LogMaxSwapUsedThresholdInPercentage</p></td>
<td align="left"><p>Порог использования ресурсов подкачки для запуска события журнала</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальный порог использования подкачки на хосте, в процентах, при превышении которого будет запущено событие журнала аудита.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>LogPhysicalMemoryThresholdInMB</p></td>
<td align="left"><p>Порог для журнальной записи о низких ресурсах памяти хоста, в МБ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Минимальный объём оставшихся ресурсов ОЗУ перед тем, как на хосте констатируется нехватка памяти. Если объём ОЗУ хоста ниже этого значения, это записывается в журнал аудита. Никакого действия не предпринимается.</p></td>
</tr>
<tr class="even">
<td align="left"><p>LowUtilizationForEvenlyDistribute</p></td>
<td align="left"><p>Предел низкого коэффициента использования для алгоритма выбора равномерного распределения </p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Минимальное число ВМ на хост в алгоритме равномерного распределения.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>LowUtilizationForPowerSave</p></td>
<td align="left"><p>Предел низкого коэффициента использования для алгоритма выбора сбережения энергии</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Стандарт для только что созданных кластеров, используемый с алгоритмом балансировки нагрузки при экономии энергии, отмечает самый низкий лимит использования хоста при начальной загрузке данных на хосты.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MacPoolRanges</p></td>
<td align="left"><p>Диапазоны пула MAC-адресов</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Диапазон пула MAC-адресов, для автоматического присвоения виртуальным машинам.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxAverageNetworkQoSValue</p></td>
<td align="left"><p>Максимальное значение качества обслуживания в сетях средней нагрузки (Мбит/с)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>MaxPeakNetworkQoSValue</p></td>
<td align="left"><p>Максимальное значение качества обслуживания в сетях пиковой нагрузки (Мбит/с)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxBurstNetworkQoSValue</p></td>
<td align="left"><p>Максимальное значение качества обслуживания в сетях с пиковым всплеском нагрузки (МБ)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>MaxMacsCountInPool</p></td>
<td align="left"><p>Максимальное число MAC-адресов в пуле</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное разрешённое число MAC-адресов в пуле.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxNumberOfHostsInStoragePool</p></td>
<td align="left"><p>Максимальное число хостов в пуле хранилищ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Ограничивает максимальное количество хостов, выделенных кластерам одного дата-центра. В случае необходимости это число может быть увеличено после тестирования дополнительных хостов.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxNumOfCpuPerSocket</p></td>
<td align="left"><p>Максимальное число ЦП на сокет</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное число ядер виртуальных ЦП, которое можно присвоить одному сокету вЦП.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxNumOfVmCpus</p></td>
<td align="left"><p>Общее количество ЦП виртуальных машин</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"><p>3.1: 160 3.2: 160 3.3: 160 3.4: 160</p></td>
<td align="left"><p>Максимальное общее число ядер ЦП, присвоенных ВМ (определяется числом ядер, умноженным на число сокетов).</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxNumofVmSockets</p></td>
<td align="left"><p>Максимальное число сокетов на ВМ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное число сокетов вЦП, присвоенных виртуальной машине.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxRerunVmOnVdsCount</p></td>
<td align="left"><p>Максимальное число попыток перезапуска ВМ на хосте</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное число попыток запустить ВМ на хосте перед выводом сообщения об ошибке («невозможно запустить ВМ»).</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxSchedulerWeight</p></td>
<td align="left"><p>Максимальный весовой коэффициент расписания</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальная оценка модуля весового коэффициента весового модуля одного планировщика.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxStorageVdsDelayCheckSec</p></td>
<td align="left"><p>Максимальная задержка проверки домена в секундах</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное количество секунд ожидания возвращения статуса домена хранилища перед выводом сообщения об ошибке.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxStorageVdsTimeoutCheckSec</p></td>
<td align="left"><p>Максимальное время ожидания последней проверки домена, в секундах</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Во время наблюдения за хранилищем, vdsmd на хостах сообщает значение "lastCheck" для каждого домена. Этот параметр используется для определения, насколько давно была проведена последняя проверка, и в домене констатируется ошибка.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxVdsMemOverCommit</p></td>
<td align="left"><p>Максимальное превышение выделения памяти хоста (%) при загрузке виртуальных рабочих столов</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Процент разрешённого превышенного выделения памяти при использовании загрузки виртуального рабочего стола.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxVdsMemOverCommitForServers</p></td>
<td align="left"><p>Максимальное превышение выделения памяти хоста (%) при загрузке виртуальных серверов</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Процент разрешённого превышенного выделения памяти при использовании загрузок виртуального сервера.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxVdsNameLength</p></td>
<td align="left"><p>Максимальная длина имени VDS</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальная длина имени хоста с гипервизором.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxVmNameLengthNonWindows</p></td>
<td align="left"><p>Максимальная длина имени для не-Windows ОС</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальная длина имени для не-Windows ВМ.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxVmNameLengthWindows</p></td>
<td align="left"><p>Максимальная длина имени в Windows</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальная длина имени для ВМ с Windows (ограничения, налагаемые именами хостов в Windows).</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxVmsInPool</p></td>
<td align="left"><p>Максимальное число ВМ в пуле</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное число ВМ в одном дата-центре.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VmPoolMaxSubsequentFailures</p></td>
<td align="left"><p>Максимальное число сбоев при создании ВМ перед отказом от операции</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное число последовательных сбоев при создании ВМ, допускаемое в пуле ВМ перед остановкой операции.</p></td>
</tr>
<tr class="even">
<td align="left"><p>NumberofFailedRunsOnVds</p></td>
<td align="left"><p>Число неудавшихся запусков на хосте</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Число попыток запуска ВМ на хосте перед тем как хосту будет присвоен статус «Ошибка».</p></td>
</tr>
<tr class="odd">
<td align="left"><p>NumberOfVmsForTopSizeVms</p></td>
<td align="left"><p>Число показываемых ВМ с наибольшим размером диска</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Число ВМ для показа во вкладке виртуальных машин домена хранилища. Будет показано указанное число ВМ, отфильтрованных по наибольшему объёму диска на каждую используемую ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>NumberVmRefreshesBeforeSave</p></td>
<td align="left"><p>Число обновлений информации о ВМ перед сохранением в базе данных</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Число итераций мониторинга хоста между обновлением ВМ из VDSM (определяет, должны ли обновляться ВМ один раз на каждую итерацию)</p></td>
</tr>
<tr class="odd">
<td align="left"><p>OnlyRequiredNetworksMandatoryForVdsSelection</p></td>
<td align="left"><p>Указывает, будут ли учитываться только требуемые сети при определении, может ли ВМ выполняться на хосте</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>При значении <code>верно</code>, только сети, помеченные как <code>Требуется</code>, будут учитываться при определении, может ли ВМ выполняться на указанном хосте. В противном случае, для того, чтобы на хосте могла выполняться ВМ, должны быть настроены все сети, используемые этой ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>OverUtilizationForHaReservation</p></td>
<td align="left"><p>Процент, представляющий порог чрезмерного использования, по сравнению со сценарием оптимального использования</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Пример: если оптимальное количество высокодоступных ВМ для указанного хоста равно двум, а данный ключ установлен на <code>200</code>, то высокодоступная ВМ не будет переноситься с использованием метода балансировки до тех пор, пока на указанном хосте не будут находиться как минимум пять высокодоступных ВМ.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ScaleDownForHaReservation</p></td>
<td align="left"><p>Число на которое делится весовой коэффициент резервирования высокой доступности, для получения окончательного весового коэффициента</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Пример: если весовой коэффициент хоста равен 90, а данный ключ равен <code>2</code>, то окончательный коэффициент для этого хоста будет равен 45. Это даёт возможность снизить влияние весовой функции резервирования высокой доступности на итоговый коэффициент хоста.</p></td>
</tr>
<tr class="even">
<td align="left"><p>oVirtISOsRepositoryPath</p></td>
<td align="left"><p>Пути установочных файлов oVirt Node</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>/usr/share/ovirt-hypervisor</p></td>
<td align="left"><p>Местоположение ISO-образов oVirt Node, используемых для обновления хостов гипервизора.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>EnableVdsHaReservation</p></td>
<td align="left"><p>Включено ли на кластере резервирования ВМ высокой доступности</p></td>
<td align="left"><p>Логическое</p></td>
<td align="left"><p>верно</p></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>VdsHaReservationIntervalInMinutes</p></td>
<td align="left"><p>Временной промежуток, в минутах, после которого кластер будет проверен на резервирование высокой доступности</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>DefaultMaximumMigrationDowntime</p></td>
<td align="left"><p>Максимальное время, в течении которого ВМ может быть нерабочей во время динамической миграции</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Если данное значение равно <code>0</code>, то будет использовано значение по умолчанию для VDSM.</p></td>
</tr>
<tr class="even">
<td align="left"><p>PollUri</p></td>
<td align="left"><p>Адрес URI, используемый для доступа к службе аттестации</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>AttestationService/resources/PollHosts</p></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>ProductKey2003</p></td>
<td align="left"><p>Ключ продукта (для Windows 2003)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ProductKey2003x64</p></td>
<td align="left"><p>Ключ продукта (для Windows 2003 x64)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ProductKey2008</p></td>
<td align="left"><p>Ключ продукта (для Windows 2008)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ProductKey2008R2</p></td>
<td align="left"><p>Ключ продукта (для Windows 2008 R2)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ProductKey2008x64</p></td>
<td align="left"><p>Ключ продукта (для Windows 2008 x64)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ProductKey</p></td>
<td align="left"><p>Ключ продукта (для Windows XP)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ProductKeyWindow7</p></td>
<td align="left"><p>Ключ продукта (для Windows 7)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="even">
<td align="left"><p>ProductKeyWindow7x64</p></td>
<td align="left"><p>Ключ продукта (для Windows 7 x64)</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Серийный номер Windows, используемый для ВМ, созданных из шаблона и настроенных с помощью Sysprep.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ProductRPMVersion</p></td>
<td align="left"><p>Версия RPM в oVirt</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>Заполняется автоматически</p></td>
<td align="left"><p>Версия RPM используемого пакета rhevm.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SANWipeAfterDelete</p></td>
<td align="left"><p>Инициализация образа диска более надёжна, но может занять много времени и иметь большой объём операций ввода-вывода, в зависимости от размера образа</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>Определяет значение по умолчанию (отмечено/не отмечено) флажка <strong>Очистить после удаления</strong> окна <strong>Добавить виртуальный диск</strong>. Для дисков, созданных в доменах хранилищ на базе SAN (FC/iSCSI).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SASL_QOP</p></td>
<td align="left"><p>Качество защиты SASL</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>auth-conf</p></td>
<td align="left"><p>Определяет качество защиты аутентификации и запросов LDAP (auth, auth-int, auth-conf).</p></td>
</tr>
<tr class="even">
<td align="left"><p>SearchResultsLimit</p></td>
<td align="left"><p>Максимальное количество результатов поиска</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Число возвращаемых результатов поиска, в отсутствии значения, указанного на Портале администрирования или в REST.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SecureConnectionWithOATServers</p></td>
<td align="left"><p>Используется ли защищённое соединение для доступа к службе аттестации</p></td>
<td align="left"><p>Логическое</p></td>
<td align="left"><p>верно</p></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>ServerRebootTimeout</p></td>
<td align="left"><p>Время ожидания перезапуска хоста (сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Ждать указанное кол-во секунд во время перезагрузки или проведения операции блокады хоста, перед констатацией, что хост <code>Не отвечает</code>. Для хостов с долгой перезагрузкой значение можно увеличить.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SpiceProxyDefault</p></td>
<td align="left"><p>Адрес SPICE-прокси.</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>нет</p></td>
<td align="left"><p>Если для данного ключа значение указано, SPICE-прокси активируется (включается). Если для данного ключа значение не указано, SPICE-прокси не активируется (выключается).</p></td>
</tr>
<tr class="even">
<td align="left"><p>SpiceReleaseCursorKeys</p></td>
<td align="left"><p>Сочетание клавиш для высвобождения курсора мышки при его захвате в SPICE</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>Shift+F12</p></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>SpiceSecureChannels</p></td>
<td align="left"><p>Защищённые каналы SPICE</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>smain, sinputs, scursor, splayback, srecord, sdisplay, susbredir, ssmartcard</p></td>
<td align="left"><p>Какие каналы SPICE должны быть защищены с помощью SSL.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SpiceToggleFullScreenKeys</p></td>
<td align="left"><p>Сочетание клавиш для включения/отключения полноэкранного режима окна клиента SPICE</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>Shift+F11</p></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>SpiceUsbAutoShare</p></td>
<td align="left"><p>Включение общего доступа к устройствам USB по умолчанию в SPICE</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>Представляет значение по умолчанию (отмечено/не отмечено) флажка <strong>Включить автоматический общий доступ к USB</strong> диалога <strong>Параметры консоли</strong> на Портале пользователей.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SpmCommandFailOverRetries</p></td>
<td align="left"><p>Число повторных попыток отработки отказа диспетчера пула хранилища (SPM) при сбое команд</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Число повторных попыток отработки отказа с выбором SPM. В случае сбоя команды SPM выполняется отработка отказа — выбирается новый SPM и команда выполняется снова.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SPMFailOverAttempts</p></td>
<td align="left"><p>Число попыток подключения к диспетчеру пула хранилища (SPM) перед отработкой отказа</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Во время наблюдения за пулом хранилища, в случае сбоя текущего SPM, отработка отказа не происходит сразу же (см. описание SpmCommandFailOverRetries). Этот параметр определяет число повторных попыток перед констатацией отключения текущего SPM и необходимости отработки отказа.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SpmVCpuConsumption</p></td>
<td align="left"><p>Потребление ресурсов ЦП диспетчером пула хранилища (SPM), представленное в виде кол-ва вЦП на хосте</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Если хост является SPM, считается, что он потребляет указанное кол-во дополнительных вЦП, для компенсации дополнительных затрат, создаваемых операциями SPM.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SSHInactivityTimoutSeconds</p></td>
<td align="left"><p>Время ожидания неактивности SSH (сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальное кол-во времени, в течение которого разрешён сеанс SSH на удалённые хосты. После этого времени ожидания сеанс убивается.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SSHInactivityHardTimoutSeconds</p></td>
<td align="left"><p>Жёсткий тайм-аут периода бездействия SSH (сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>NumberOfUSBSlots</p></td>
<td align="left"><p>Число слотов USB на виртуальных машинах со встроенной поддержкой USB</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>SchedulerAllowOverBooking</p></td>
<td align="left"><p>Будет ли пропущена синхронизация ресурсов планировщика</p></td>
<td align="left"><p>Логическое</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>Пропуск синхронизации ресурсов планировщика может привести к тому, что в расписание может быть внесено больше запросов, чем может быть выполнено.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SchedulerOverBookingThreshold</p></td>
<td align="left"><p>Определяет порог запросов, ожидающих внесения в расписание, перед тем, как будет пропущена синхронизация ресурсов планировщика</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Этот параметр используется, когда значение параметра <code>SchedulerAllowOverBooking</code> установлено на <code>верно</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SSLEnabled</p></td>
<td align="left"><p>SPICE SSL включено</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>Будут ли защищённые каналы SPICE зашифрованы с использованием SSL.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>StorageDomainFailureTimeoutInMinutes</p></td>
<td align="left"><p>Время ожидания сбоя домена хранилища</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Определяет количество времени ожидания перед тем, как будет принято решение о проблемах в домене, начиная с первого сбоя, о котором сообщит VDSM (мин.).</p></td>
</tr>
<tr class="even">
<td align="left"><p>StoragePoolRefreshTimeInSeconds</p></td>
<td align="left"><p>Частота опросов менеджера пула хранилища (сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Частота опросов пула хранилища.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SysPrep2K3Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 2003</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SysPrep2K8Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 2008</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SysPrep2K8R2Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 2008 R2</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SysPrep2K8x64Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 2008</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SysPrepWindows7Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 7</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SysPrepWindows7x64Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 7 x64</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SysPrepWindows8Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 8</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SysPrepWindows8x64Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 8 x64</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SysPrepWindows2012x64Path</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows 2012 x64</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SysPrepXPPath</p></td>
<td align="left"><p>Путь до файла sysprep машины с Windows XP</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Путь до шаблона файла sysprep конкретной ОС.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>TimeoutToResetVdsInSeconds</p></td>
<td align="left"><p>Время ожидания соединения перед попыткой перезагрузки (сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Промежуток времени, в течение которого хост не отвечает, перед тем, как будет запущена операция блокады. Используется в сочетании с <em><code>VDSAttemptsToResetCount</code></em>.</p></td>
</tr>
<tr class="even">
<td align="left"><p>TimeToReduceFailedRunOnVdsInMinutes</p></td>
<td align="left"><p>Время сокращения неудачного выполнения на хосте (мин.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Время, в течение которого хост будет иметь статус «ошибка» после неудачных попыток запуска ВМ.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>UserDefinedVMProperties</p></td>
<td align="left"><p>Свойства ВМ, определённые пользователем</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Обычно используется с ловушками VDSM.</p></td>
</tr>
<tr class="even">
<td align="left"><p>UseFqdnForRdpIfAvailable</p></td>
<td align="left"><p>Будет ли полное доменное имя использоваться в соединениях, использующих консольный протокол RDP</p></td>
<td align="left"><p>Логическое</p></td>
<td align="left"><p>верно</p></td>
<td align="left"><p>Если этот параметр отмечен, консоль RDP будет использовать полное доменное имя машины, если оно доступно, по данным гостевого агента. Это полное доменное имя затем используется для установки соединения.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>UserRefreshRate</p></td>
<td align="left"><p>Частота обновления данных пользователей из Active Directory (сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Как часто опрашивается сервер каталогов на предмет обновления учётных записей пользователей.</p></td>
</tr>
<tr class="even">
<td align="left"><p>UtilizationThresholdInPercent</p></td>
<td align="left"><p>Порог использования (в процентах)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>В балансировке нагрузки это значение по умолчанию, используемое для расчёта максимального предела использования ресурсов ЦП, для определения чрезмерного использования хоста. В процентах от значения, установленного пользователем для высокой загрузке на кластере.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>ValidNumOfMonitors</p></td>
<td align="left"><p>Допустимое число экранов</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Количество экранов, доступных для ВМ, использующих SPICE.</p></td>
</tr>
<tr class="even">
<td align="left"><p>VdcVersion</p></td>
<td align="left"><p>Версия oVirt</td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Автоматически устанавливается в соответствии с текущей версией oVirt</p></td>
</tr>
<tr class="odd">
</tr>
<tr class="even">
<td align="left"><p>VDSAttemptsToResetCount</p></td>
<td align="left"><p>Число попыток установить связь с хостом до перезапуска</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Число повторных попыток установить связь с хостом перед запуском перед тем, как будет запущена операция блокады. Используется в сочетании с <em><code>TimeoutToResetVdsInSeconds</code></em>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VdsLoadBalancingeIntervalInMinutes</p></td>
<td align="left"><p>Интервал балансировки нагрузки хоста (мин.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Интервал перед запуском балансировщика нагрузки виртуальных машин, в минутах (также определяет первый запуск балансировщика нагрузки).</p></td>
</tr>
<tr class="even">
<td align="left"><p>VdsRecoveryTimeoutInMintues</p></td>
<td align="left"><p>Время ожидания хоста во время восстановления (мин.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Во время сбоев/перезапусков VDSM может иногда находиться в режиме восстановления (VDSM сообщает "идёт инициализация" или "восстановление").</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VdsRefreshRate</p></td>
<td align="left"><p>Временной интервал (сек.) для опроса статуса хоста</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Насколько часто проверятся статус хоста гипервизора.</p></td>
</tr>
<tr class="even">
<td align="left"><p>vdsTimeout</p></td>
<td align="left"><p>Время ожидания контрольной связи с хостом (сек.)</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Время ожидания вызова VDSM — время, в течение которого oVirt ожидает вызова синхронизации VDSM.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>vdsConnectionTimeout</p></td>
<td align="left"><p>Значение времени ожидания соединения с VDS</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Время ожидания (сек.) для установки соединения с хостом.</p></td>
</tr>
<tr class="even">
<td align="left"><p>vdsRetries</p></td>
<td align="left"><p>Число попыток повтора операций хоста, связанных с VDS</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Количество попыток повторить операцию хоста в случае ошибок связи.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VM32BitMaxMemorySizeInMB</p></td>
<td align="left"><p>Максимальный объём памяти для 32-битных ВМ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Максимальный объём памяти, в МБ, для 32-битных ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>VM64BitMaxMemorySizeInMB</p></td>
<td align="left"><p>Максимальный объём памяти для 64-битных ВМ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"><p>v3.0: 524288 v3.1: 2097152 v3.2: 2097152 v3.3: 2097152 v3.4: 2097152</p></td>
<td align="left"><p>&nbsp;</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VmGracefulShutdownMessage</p></td>
<td align="left"><p>Сообщение, показываемое в виртуальной машине, когда машина выключается через oVirt</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Системный администратор инициировал выключение этой виртуальной машины. Виртуальная машина выключается.</p></td>
</tr>
<tr class="even">
</tr>
<tr class="odd">
<td align="left"><p>VMMinMemorySizeInMB</p></td>
<td align="left"><p>Минимальный объём памяти ВМ в МБ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>VncKeyboardLayout</p></td>
<td align="left"><p>Параметры раскладки клавиатуры для VNC</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>en-us</p></td>
<td align="left"><p>Возможные значения: ar, da, de-ch, en-us, et, fo, fr-be, fr-ch, hu, it, li, mk, nl, no, pt, ru, sv, tr, de en-gb, es, fi, fr, fr-ca, hr, is, ja, lv, nl-be, pl, pt-br, sl, th.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>WaitForVdsInitInSec</p></td>
<td align="left"><p>Ждать, пока хост завершит init в выборе SPM</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Это время ожидания инициализации хоста, аналогично параметру в <em><code>VdsRecoveryTimeoutInMinutes</code></em>, но это время ожидания длится меньше и используется во время алгоритма выбора SPM. Если выбранный хост инициализируется, ждите его восстановления.</p></td>
</tr>
<tr class="even">
<td align="left"><p>FenceQuietTimeBetweenOperationsInSec</p></td>
<td align="left"><p>Время молчания между операциями управления питанием, в сек.</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Минимальное время (сек.) между двумя операциями управления питанием, активированных вручную пользователем.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>FenceProxyDefaultPreferences</p></td>
<td align="left"><p>Параметры по умолчанию для прокси операций блокады</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>cluster,dc</p></td>
<td align="left"><p>Параметры по умолчанию для прокси операций блокады, используемые для метода поиска хоста прокси при проведении операции блокады.</p></td>
</tr>
<tr class="even">
<td align="left"><p>MaxAuditLogMessageLength</p></td>
<td align="left"><p>Максимальная длина сообщения журнала аудита</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>SysPrepDefaultUser</p></td>
<td align="left"><p>Имя по умолчанию пользователя sysprep</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Этот пользователь используется, если домен sysprep неизвестен или не указан.</p></td>
</tr>
<tr class="even">
<td align="left"><p>SysPrepDefaultPassword</p></td>
<td align="left"><p>Пароль по умолчанию пользователя sysprep</p></td>
<td align="left"><p>Пароль</p></td>
<td align="left"><p>Пусто</p></td>
<td align="left"><p>Этот пароль используется, если домен sysprep неизвестен или не указан.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>QoSInboundAverageDefaultValue</p></td>
<td align="left"><p>Среднее резервирование канала для входящего сетевого трафика</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Среднее резервирование канала для входящего сетевого трафика, в Мбит/с.</p></td>
</tr>
<tr class="even">
<td align="left"><p>QoSInboundPeakDefaultValue</p></td>
<td align="left"><p>Резервирование канала для входящего сетевого трафика в периоды высокой нагрузки</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Резервирование канала для входящего сетевого трафика в периоды высокой нагрузки, в Мбит/с.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>QoSInboundBurstDefaultValue</p></td>
<td align="left"><p>Резервирование канала для входящего сетевого трафика в пиковом всплеске</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Резервирование канала для входящего сетевого трафика в пиковом всплеске, в Мбит/с.</p></td>
</tr>
<tr class="even">
<td align="left"><p>QoSOutboundAverageDefaultValue</p></td>
<td align="left"><p>Среднее резервирование канала для исходящего сетевого трафика</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Среднее резервирование канала для исходящего сетевого трафика, в Мбит/с.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>QoSOutboundPeakDefaultValue</p></td>
<td align="left"><p>Резервирование канала для исходящего сетевого трафика в периоды пиковой нагрузки</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Резервирование канала для исходящего сетевого трафика в периоды пиковой нагрузки, в Мбит/с.</p></td>
</tr>
<tr class="even">
<td align="left"><p>QoSOutboundBurstDefaultValue</p></td>
<td align="left"><p>Резервирование канала для исходящего сетевого трафика в пиковом всплеске</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Резервирование канала для исходящего сетевого трафика в пиковом всплеске, в Мбит/с.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>UserSessionTimeOutInterval</p></td>
<td align="left"><p>Интервал времени ожидания сеанса, в минутах</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Время ожидания сеанса пользователя. Глобально для всех типов доступа: Пользовательский портал/Портал администрирования/Веб-администрирование/API.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AdminPassword</p></td>
<td align="left"><p>Пароль администратора</p></td>
<td align="left"><p>Пароль</p></td>
<td align="left"></td>
<td align="left"><p>Пароль пользователя-администратора (в случае, если для аутентификации не используется directory service).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>IPTablesConfig</p></td>
<td align="left"><p>Параметры Iptables, используемые для автоматической настройки oVirt</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Полный набор правил iptables, используемый при выборе автоматической настройки брандмауэра во время выполнения команды <code>engine-setup</code></p></td>
</tr>
<tr class="even">
<td align="left"><p>OvirtIsoPrefix</p></td>
<td align="left"><p>Префикс ISO-файлов oVirt</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>ovirt-node-iso, rhevh</p></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>OvirtInitialSupportedIsoVersion</p></td>
<td align="left"><p>Начальная поддерживаемая версия ISO oVirt node</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>VdsLocalDisksLowFreeSpace</p></td>
<td align="left"><p>Объём свободного дискового пространства в локальном домене хранилища хоста, который должен считаться низким, в МБ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Значение ниже стандартных 1000 МБ снижает время, доступное для добавления дополнительного дискового пространства доменам данных перед тем, как начнёт ухудшаться производительность виртуальной машины. При наличии множества машин, создающих или получающих данные, более высокое значение этого параметра может оказаться полезным.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>VdsLocalDisksCriticallyLowFreeSpace</p></td>
<td align="left"><p>Объём дискового пространства в локальном домене хранилища хоста, который должен считаться критически низким, в МБ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Значение ниже стандартных 500 МБ уменьшает промежуток времени между моментом, когда начинают выводиться сообщения о критической нехватке места и моментом, когда начинает ухудшаться производительность ВМ. При наличии множества машин, быстро создающих или получающих данные, значение по умолчанию может оказаться слишком маленьким и не предоставить достаточно времени для добавления дополнительного дискового пространства.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AllowDuplicateMacAddresses</p></td>
<td align="left"><p>Включение дублирующего MAC-адреса для сетевого интерфейса ВМ</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>При включенном параметре один и тот же MAC-адрес может быть явно установлен на нескольких виртуальных NIC. В противном случае, установка уже использующегося MAC-адреса на другую виртуальную NIC запрещена.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>JobCleanupRateInMinutes</p></td>
<td align="left"><p>Частота процесса очистки задач</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>SucceededJobCleanupTimeInMinutes</p></td>
<td align="left"><p>Время для сохранения успешно завершённых заданий</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>FailedJobCleanupTimeInMinutes</p></td>
<td align="left"><p>Время для сохранения задач, завершившихся сбоем</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>VmPoolMonitorIntervalInMinutes</p></td>
<td align="left"><p>Интервал (мин.) для контролирования числа предзапущенных ВМ в пулах ВМ</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>UserMessageOfTheDay</p></td>
<td align="left"><p>Сообщение, показываемое на странице авторизации Пользовательского портала</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>VmPoolMonitorBatchSize</p></td>
<td align="left"><p>Максимальное число ВМ, которое попробует предварительно запустить монитор пула машин за один цикл</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>NetworkConnectivityCheckTimeoutInSeconds</p></td>
<td align="left"><p>Время ожидания (сек.) перед откатом изменений сетевых параметров в случае, если oVirt теряет связь с хостом</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>AllowClusterWithVirtGlusterEnabled</p></td>
<td align="left"><p>Возможность создать кластер с одновременно включенными службами Virt и Gluster</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>При включенном параметре пользователь может создавать кластер как с поддержкой обеих служб Virt и Gluster, так и с поддержкой только одной из них, в противном случае кластер с поддержкой двух служб создать нельзя.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>EnableMACAntiSpoofingFilterRules</p></td>
<td align="left"><p>Должна ли быть включена сетевая фильтрация</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>v3.0: ложно v3.1: ложно v3.2: верно</p></td>
<td align="left"><p>При включенном параметре на каждой карте сетевого интерфейса установлены правила MAC-антиспуфинга, что гарантирует, что Ethernet-кадры, посылаемые этой картой, имеют исходный MAC, присвоенный карте в oVirt.</p></td>
</tr>
<tr class="even">
<td align="left"><p>EnableHostTimeDrift</p></td>
<td align="left"><p>Указывает, включена ли проверка дрейфа времени хоста</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>ложно</p></td>
<td align="left"><p>При включенной проверке дрейфа времени, oVirt потребует, чтобы системное время хоста находилось в границах указанного изменения системного времени oVirt. Разрешённая разница устанавливается при помощи HostTimeDriftInSec</p></td>
</tr>
<tr class="odd">
<td align="left"><p>EngineMode</p></td>
<td align="left"><p>Рабочий режим oVirt</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"><p>Активно</p></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><p>HostTimeDriftInSec</p></td>
<td align="left"><p>Разрешённый дрейф времени между любым хостом и oVirt</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><p>WebSocketProxy</p></td>
<td align="left"><p>Местоположение websocket-прокси</p></td>
<td align="left"><p>Строка</p></td>
<td align="left"></td>
<td align="left"><p>Местоположение websocket-прокси. Возможные значения: <code>Off</code>, <code>Host:[порт]</code>, <code>Engine:[порт]</code>, <em>[имя_хоста]</em> или <em>[ip-адрес]</em>:<em>[порт]</em></p></td>
</tr>
<tr class="even">
<td align="left"><p>WebSocketProxyTicketValiditySeconds</p></td>
<td align="left"><p>Время, в течении которого действуют тикеты websocket-прокси</p></td>
<td align="left"><p>Целое число</p></td>
<td align="left"></td>
<td align="left"><p>Время действия тикетов, выданных для websocket-прокси (сек.).</p></td>
</tr>
</tbody>
</table>

<h3 id="the-image-uploader-tool">Инструмент загрузки образов</h3>

<h4 id="the-image-uploader-tool-1">Инструмент загрузки образов</h4>

<p>Команда <code>engine-image-uploader</code> даёт возможность получить список доменов экспорта хранилищ и загружать в домен образы виртуальной машины в формате OVF, которые автоматически распознаются в oVirt.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> загрузчик образов поддерживает только файлы в формате OVF, созданные oVirt и сжатые при помощи gzip.</p>

</div>
<p>Архив содержит образы и главные каталоги в следующем формате:</p>

<pre class="highlight plaintext"><code>|-- images
|   |-- [Image Group UUID]
|        |--- [Image UUID (this is the disk image)]
|        |--- [Image UUID (this is the disk image)].meta
|-- master
|   |---vms
|       |--- [UUID]
|             |--- [UUID].ovf
</code></pre>

<h4 id="syntax-for-the-engine-image-uploader-command">Синтаксис команды engine-image-uploader</h4>

<p>Базовый синтаксис команды для загрузки образов:</p>

<pre class="highlight plaintext"><code>engine-image-uploader [options] list
engine-image-uploader [options] upload [file].[file]...[file]
</code></pre>

<p>Команды загрузки образов поддерживает два действия: <em><code>list</code></em> и <em><code>upload</code></em>.</p>

<ul>
  <li>Действие <em><code>list</code></em> выводит список доменов экспорта, на которые можно загрузить образы.</li>
  <li>Действие <em><code>upload</code></em> загружает образы на указанный домен экспорта.</li>
</ul>

<p>При использовании команды загрузки образов необходимо указать одно из вышеуказанных действий. Кроме того, необходимо указать как минимум один локальный файл для использования действия <em><code>upload</code></em>.</p>

<p>Существует несколько параметров для тонкой настройки команды <code>engine-image-uploader</code>. Значения по умолчанию для любого из этих параметров можно указать в файле <code>/etc/ovirt-engine/imageuploader.conf</code>.</p>

<p><strong>Общие параметры</strong></p>

<p><em><code>-h</code></em>, <em><code>--help</code></em><br>
Информация по использованию команды для загрузки образов.</p>

<p><em><code>--conf-file=[PATH]</code></em><br>
Устанавливает <em>[ПУТЬ]</em> в качестве файла конфигурации, используемого командой. Путь по умолчанию: <code>etc/ovirt-engine/imageuploader.conf</code>.</p>

<p><em><code>--log-file=[PATH]</code></em><br>
Устанавливает <em>[ПУТЬ]</em> в качестве имени файла, в который будет записываться вывод журнала. Путь по умолчанию: <code>/var/log/ovirt-engine/ovirt-image-uploader/ovirt-image-uploader-[дата].log</code>.</p>

<p><em><code>--cert-file=[PATH]</code></em><br>
Устанавливает <em>[ПУТЬ]</em> в качестве сертификата для валидации oVirt. Путь по умолчанию: <code>/etc/pki/ovirt-engine/ca.pem</code>.</p>

<p><em><code>--insecure</code></em><br>
Указывает, что валидация oVirt проводиться не будет.</p>

<p><em><code>--quiet</code></em><br>
Режим без сообщений; консольный вывод сведён к минимуму.</p>

<p><em><code>-v</code></em>, <em><code>--verbose</code></em><br>
Режим подробной информации, подробный консольный вывод.</p>

<p><em><code>-f</code></em>, <em><code>--force</code></em><br>
Принудительный режим необходим в том случае, когда имя загружаемого исходного файла совпадает с именем уже существующего файла в целевом домене экспорта. С этим параметром существующий файл будет заменён.</p>

<p><strong>Параметры oVirt</strong></p>

<p><em><code>-u [USER]</code></em>, <em><code>--user=[USER]</code></em><br>
Определяет пользователя, чьи учётные данные будут использованы при выполнении команды. <em>[ПОЛЬЗОВАТЕЛЬ]</em> указывается в формате <em>[имя_пользователя]</em>@<em>[домен]</em>. Пользователь должен существовать в указанном домене и быть известным для oVirt.</p>

<p><em><code>-r [FQDN]</code></em>, <em><code>--engine=[FQDN]</code></em><br>
Указывает IP-ажрес или полное доменное имя oVirt, откуда будут загружаться образы. Предполагается, что загрузчик образов запускается на той же машине, на которой установлена oVirt. Значение по умолчанию: <code>localhost:443</code>.</p>

<p><strong>Параметры домена экспорта</strong></p>

<p>Следующие параметры указывают домен экспорта, в который будут загружены образы. Эти параметры нельзя использовать одновременно; указывается либо параметр <em><code>-e</code></em> либо параметр <em><code>-n</code></em>.</p>

<p><em><code>-e</code></em> <em>[ДОМЕН_ЭКСПОРТА]</em>, <em><code>--export-domain=[ДОМЕН_ЭКСПОРТА]</code></em><br>
Указывается целевой домен хранилища <em>ДОМЕН_ЭКСПОРТА</em> для загрузки.</p>

<p><em><code>-n</code></em> <em>[NFSSERVER]</em>, <em><code>--nfs-server=[NFSSERVER]</code></em><br>
Sets the NFS path <em>[NFSSERVER]</em> as the destination for uploads.</p>

<p><strong>Параметры импорта</strong></p>

<p>Следующие параметры дают возможность настроить, какие именно атрибуты загружаемых образов будут включены при загрузке образа в домен экспорта.</p>

<p><em><code>-i</code></em>, <em><code>--ovf-id</code></em><br>
Указывает, что UUID образа не будет загружен. По умолчанию, команды создаёт новый UUID для загружаемых образов. Это устраняет возможный конфликт между идентификатором загружаемого образа и образов, уже существующих в окружении.</p>

<p><em><code>-d</code></em>, <em><code>--disk-instance-id</code></em><br>
Указывает, что идентификатор экземпляра для каждого диска в образе не будет переименован. По умолчанию, команда создаёт новые UUID для дисков в загружаемых образах. Это устраняет возможные конфликты между дисками в загружаемом образе и дисками, уже существующими в окружении.</p>

<p><em><code>-m</code></em>, <em><code>--mac-address</code></em><br>
Указывает, что сетевые компоненты в образе не будут из него удалены. По умолчанию, команда удаляет данные карт сетевых интерфейсов из загружаемых образов, для предотвращения конфликтов с сетевыми картами других ВМ, уже находящихся в окружении. Если этот параметр не используется, с помощью Портала администрирования можно добавить карты сетевых интерфейсов к недавно загруженным образам, и oVirt устранит возможные конфликты MAC-адресов.</p>

<p><em><code>-N [NEW_IMAGE_NAME]</code></em>, <em><code>--name=[NEW_IMAGE_NAME]</code></em><br>
Указывает новое имя загружаемого образа.</p>

<h4 id="creating-an-ovf-archive-that-is-compatible-with-the-image-uploader">Создание архива OVF, совместимого с загрузчиком образов</h4>

<p><strong>Описание задачи</strong></p>

<p>Создать файлы, которые будут загружены с помощью утилиты <code>engine-image-uploader</code>.</p>

<p><strong>Инструкция&nbsp;16.2.&nbsp;Создание архива OVF, совместимого с загрузчиком образов</strong></p>

<ol>
  <li>С помощью oVirt создайте пустой домен экспорта. Пустой домен экспорта облегчает поиск каталога, содержащего нужную ВМ.</li>
  <li>Экспортируйте ВМ в только что созданный пустой домен экспорта.</li>
  <li>Авторизуйтесь на сервере хранилища, который служит доменом экспорта, найдите корень общего ресурса NFS и перейдите в подкаталог в этой точке монтирования. Мы начали с нового домена экспорта, поэтому в экспортируемом каталоге существует только один подкаталог, в котором находятся каталоги <code>images/</code> и <code>master/</code>.</li>
  <li>Выполните команду <code>tar -zcvf my.ovf images/ master/</code> для создания архива tar/gzip в формате ovf.</li>
  <li>Любой, кому будет передан итоговый файл ovf (в этом примере названный <code>my.ovf</code>) может импортировать его в oVirt с помощью команды <code>engine-image-uploader</code>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы создали сжатый образ OVF, который можно распространять. Любой, кому будет передан файл, может использовать команду <code>engine-image-uploader</code> для загрузки образа в своё окружение oVirt.</p>

<h4 id="basic-engine-image-uploader-usage-examples">Базовые примеры использования engine-image-uploader</h4>

<p>Далее показан пример использования команды engine uploader для показа списка доменов экспорта:</p>

<p><strong>Пример&nbsp;16.1.&nbsp;Вывод списка доменов экспорта с использованием загрузчика образов</strong></p>

<pre class="highlight plaintext"><code># engine-image-uploader list
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):
Export Storage Domain Name | Datacenter  | Export Domain Status
myexportdom               | Myowndc 　  | active
</code></pre>

<p>Далее показан пример загрузки файла в формате Open Virtualization Format (ovf):</p>

<p><strong>Пример&nbsp;16.2.&nbsp;Загрузка файла с помощью загрузчика образов</strong></p>

<pre class="highlight plaintext"><code># engine-image-uploader -e myexportdom upload myrhel6.ovf
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):
</code></pre>

<h3 id="the-log-collector-tool">Инструмент сборщик данных журнала</h3>

<h4 id="log-collector">Сборщик данных журнала</h4>

<p>Инструмент сборки данных журнала включен в oVirt. Это даёт возможность легко собрать нужные файлы журналов со всего окружения oVirt в случае необходимости помощи.</p>

<p>Команда сборщика: <code>engine-log-collector</code>. Для запуска требуется выполнить авторизацию как пользователь <code>root</code> и предоставить учётные данные администратора окружения oVirt. Команда <code>engine-log-collector -h</code> показывает информацию об использовании, включая список всех допустимых параметров команды <code>engine-log-collector</code>.</p>

<h4 id="syntax-for-engine-log-collector-command">Синтаксис команды engine-log-collector</h4>

<p>Базовый синтаксис команды сборщика данных журнала:</p>

<pre class="highlight plaintext"><code>engine-log-collector [параметры] list [all, clusters, datacenters]
engine-log-collector [параметры] collect
</code></pre>

<p>Поддерживаются два режима выполнения: <em><code>list</code></em> и <em><code>collect</code></em>.</p>

<ul>
  <li>Параметр <em><code>list</code></em> выводит список хостов, кластеров или дата-центров, присоединённых к oVirt. Также есть возможность производить фильтрацию собранных журналов на основе объектов в списке.</li>
  <li>Параметр <em><code>collect</code></em> выполняет сборку файлов журналов по oVirt. Собранные журналы помещаются в файл архива в каталог <code>/tmp/logcollector</code>. Команда <code>engine-log-collector</code> присваивает каждому файлу журнала специальное имя файла.</li>
</ul>

<p>Если не указано других параметров, действие по умолчанию — вывод списка доступных хостов, а также дата-центра и кластера, которому они принадлежат. Для получения некоторых файлов журнала будет предложено ввести имена пользователей и пароли.</p>

<p>Для более тонкой настройки команды <code>engine-log-collector</code> существуют дополнительные параметры.</p>

<p><strong>Общие параметры</strong></p>

<p><em><code>--version</code></em><br>
Выводит номер версии используемой команды и возвращает приглашение командной строки.</p>

<p><em><code>-h</code></em>, <em><code>--help</code></em><br>
Выводит информацию об использовании и возвращает приглашение командной строки.</p>

<p><em><code>--conf-file=ПУТЬ</code></em><br>
Указывает <em>ПУТЬ</em> в качестве используемого файла конфигурации.</p>

<p><em><code>--local-tmp=ПУТЬ</code></em><br>
Указывает <em>ПУТЬ</em> в качестве каталога, в который сохраняются файлы журнала. Каталог по умолчанию <code>/tmp/logcollector</code>.</p>

<p><em><code>--ticket-number=БИЛЕТ</code></em><br>
Указывает <em>БИЛЕТ</em> в качестве билета, или номера заявки, привязанного к SOS report.</p>

<p><em><code>--upload=FTP_СЕРВЕР</code></em><br>
Указывает <em>FTP_СЕРВЕР</em> в качестве целевого сервера пересылки собранных журналов с помощью FTP. Не используйте этот параметр, если только это не было посоветовано представителем техподдержки Red Hat.</p>

<p><em><code>--log-file=ПУТЬ</code></em><br>
Указывает <em>ПУТЬ</em> в качестве имени файла, используемого командой для вывода журнала.</p>

<p><em><code>--quiet</code></em><br>
Устанавливает режим без сообщений, консольный вывод сведён к минимуму. Режим без сообщений по умолчанию выключен.</p>

<p><em><code>-v</code></em>, <em><code>--verbose</code></em><br>
Устанавливает режим подробной информации, подробный консольный вывод. Режим подробной информации по умолчанию выключен.</p>

<p><strong>Параметры oVirt</strong></p>

<p>Эти параметры отфильтровывают собранные журналы и конкретизируют подробности аутентификации для oVirt.</p>

<p>Для конкретных команд эти параметры можно использовать вместе. Например, <code>engine-log-collector --user=admin@internal --cluster ClusterA,ClusterB --hosts "SalesHost"*</code> указывает пользователя в качестве <code>admin@internal</code> и ограничивает сборку журналов хостами <code>SalesHost</code> в кластерах <code>A</code> и <code>B</code>.</p>

<p><em><code>--no-hypervisors</code></em><br>
При сборке логов исключаются хосты виртуализации.</p>

<p><em><code>-u ПОЛЬЗОВАТЕЛЬ</code></em>, <em><code>--user=ПОЛЬЗОВАТЕЛЬ</code></em><br>
Указывает имя пользователя для авторизации. <em>ПОЛЬЗОВАТЕЛЬ</em> указывается в формате <em>пользователь</em>@<em>домен</em>, где <em>пользователь</em> — имя пользователя, а <em>домен</em> — используемый домен служб каталогов. Пользователь должен существовать в службах каталогов и быть известен в oVirt.</p>

<p><em><code>-r FQDN</code></em>, <em><code>--rhevm=FQDN</code></em><br>
Указывает полное доменное имя сервера oVirt, с которого необходимо собрать файлы журналов, где <em>FQDN</em> заменяется полным доменным именем oVirt. Предполагается, что сборщик логов запускается на том же локальном хосте, что и oVirt; значение по умолчанию: <code>localhost</code>.</p>

<p><em><code>-c КЛАСТЕР</code></em>, <em><code>--cluster=КЛАСТЕР</code></em><br>
Собирает файлы журналов с хостов виртуализации в указанном <em>КЛАСТЕРЕ</em>, в дополнению к журналам oVirt. Включённые кластеры должны указываться в списке имён кластеров, разделённом запятыми, или шаблонов соответствия.</p>

<p><em><code>-d ДАТА-ЦЕНТР</code></em>, <em><code>--data-center=ДАТА-ЦЕНТР</code></em><br>
Собирает файлы журналов с хостов виртуализации в указанном <em>ДАТА-ЦЕНТРЕ</em>, в дополнению к журналам oVirt. Включённые дата-центры должны указываться в списке имён дата-центров, разделённом запятыми, или шаблонов соответствия.</p>

<p><em><code>-H СПИСОК_ХОСТОВ</code></em>, <em><code>--hosts=СПИСОК_ХОСТОВ</code></em><br>
Собирает файлы журналов с хостов виртуализации в указанном <em>СПИСКЕ_ХОСТОВ</em>, в дополнению к журналам oVirt. Включённые хосты должны указываться в списке имён хостов, полных доменных имён или IP-адресов. Шаблоны соответствия также действительны.</p>

<p><strong>Параметры отчётов SOS</strong></p>

<p>Сборщик файлов журналов использует модуль JBoss SOS. Для сбора данных через консоль JMX используйте следующие параметры.</p>

<p><em><code>--jboss-home=JBOSS_HOME</code></em><br>
Путь до каталога с установкой JBoss. Значение по умолчанию: <code>/var/lib/jbossas</code>.</p>

<p><em><code>--java-home=JAVA_HOME</code></em><br>
Путь до каталога с установкой Java. Значение по умолчанию: <code>/usr/lib/jvm/java</code>.</p>

<p><em><code>--jboss-profile=ПРОФИЛЬ_JBOSS</code></em><br>
Выводит список серверных профилей, взятых в кавычки и разделённых запятыми; ограничивает сбор журналов указанными профилями. Значение по умолчанию: <em><code>'rhevm-slimmed'</code></em>.</p>

<p><em><code>--enable-jmx</code></em><br>
Включает сбор метрик времени выполнения из интерфейса oVirt JBoss JMX.</p>

<p><em><code>--jboss-user=ПОЛЬЗОВАТЕЛЬ_JBOSS</code></em><br>
Пользователь с правами запуска JBoss JMX. Значение по умолчанию: <em><code>admin</code></em>.</p>

<p><em><code>--jboss-logsize=РАЗМЕР_ЖУРНАЛА</code></em><br>
Максимальный размер (МБ) собранных файлов журналов.</p>

<p><em><code>--jboss-stdjar=СТАТУС</code></em><br>
Сбор статистики JAR для стандарных JAR-файлов JBoss. Замените <em>СТАТУС</em> на <code>on</code> или <code>off</code>. Значение по умолчанию: <code>on</code>.</p>

<p><em><code>--jboss-servjar=СТАТУС</code></em><br>
Сбор статистики JAR из любых каталогов с параметрами сервера. Замените <em>СТАТУС</em> на <code>on</code> или <code>off</code>. Значение по умолчанию: <code>on</code>.</p>

<p><em><code>--jboss-twiddle=СТАТУС</code></em><br>
Включает/выключает сбор данных twiddle. Twiddle — это инструмент JBoss для сбора данных из вызывающего объекта JMX. Замените <em>СТАТУС</em> на <code>on</code> или <code>off</code>. Значение по умолчанию: <code>on</code>.</p>

<p><em><code>--jboss-appxml=СПИСОК_XML</code></em><br>
Выводит список взятых в кавычки и разделённых запятыми необходимых для получения приложений с описаниями XML. Значение по умолчанию: <code>all</code>.</p>

<p><strong>Параметры SSH</strong></p>

<p><em><code>--ssh-port=ПОРТ</code></em><br>
Указывает <em>ПОРТ</em> в качестве порта, используемого для подключений SSH к портам виртуализации.</p>

<p><em><code>-k ФАЙЛ_КЛЮЧА</code></em>, <em><code>--key-file=ФАЙЛ_КЛЮЧА</code></em><br>
Указывает <em>ФАЙЛ_КЛЮЧА</em> в качестве открытого ключа SSH, используемого для доступа к хостам виртуализации.</p>

<p><em><code>--max-connections=MAX_ПОДКЛЮЧЕНИЙ</code></em><br>
Указывает <em>MAX_ПОДКЛЮЧЕНИЙ</em> в качестве максимально допустимого числа SSH-подключений для сбора файлов журналов с хостов виртуализации. Значение по умолчанию: <code>10</code>.</p>

<p><strong>Параметры базы данных PostgreSQL</strong></p>

<p>С помощью параметров <em><code>pg-user</code></em> и <em><code>dbname</code></em> необходимо указать имя пользователя базы данных и имя базы данных, если их значения по умолчанию были изменены.</p>

<p>Используйте параметр <em><code>pg-dbhost</code></em>, если база данных расположена не в локальном хосте. Используйте опциональный параметр  <em><code>pg-host-key</code></em> для сбора удалённых файлов журналов. Для успешного сбора удалённых журналов на сервер базы данных необходимо установить модуль PostgreSQL SOS.</p>

<p><em><code>--no-postgresql</code></em><br>
Отключает сбор журналов файлов базы данных. Сборщик логов подключится к базе данных oVirt PostgreSQL и включит данные в отчёт, если только не будет указан параметр <em><code>--no-postgresql</code></em>.</p>

<p><em><code>--pg-user=ПОЛЬЗОВАТЕЛЬ</code></em><br>
Указывает <em>ПОЛЬЗОВАТЕЛЯ</em> в качестве имени пользователя, используемого для подключений к серверу базы данных. Значение по умолчанию: <code>postgres</code>.</p>

<p><em><code>--pg-dbname=DBNAME</code></em><br>
Указывает <em>DBNAME</em> в качестве имени базы данных, используемой для подключений к серверу базы данных. Значение по умолчанию: <code>rhevm</code>.</p>

<p><em><code>--pg-dbhost=DBHOST</code></em><br>
Указывает <em>DBHOST</em> в качестве имени хоста для сервера базы данных. Значение по умолчанию: <code>localhost</code>.</p>

<p><em><code>--pg-host-key=ФАЙЛ_КЛЮЧА</code></em><br>
Указывает <em>KEYFILE</em> в качестве открытого идентификационного файла (закрытый ключ) для сервера базы данных. Значения по умолчанию для этого параметра нет; оно требуется только если на локальном хосте база данных отсутствует.</p>

<h4 id="basic-log-collector-usage">Базовое использование сборщика файлов журналов</h4>

<p>При запуске команды <code>engine-log-collector</code> без дополнительных параметров, она по умолчанию собирает все файлы журналов oVirt и присоединённых к oVirt хостов. Также будут собираться журналы базы данных, если только не был указан параметр <em><code>--no-postgresql</code></em>. В следующем примере сборщик запускается для сбора всех файлов журналов oVirt и трёх присоединённых хостов.</p>

<p><strong>Пример&nbsp;16.3.&nbsp;Использование сборщика журналов</strong></p>

<pre class="highlight plaintext"><code># engine-log-collector
INFO: Gathering oVirt Engine information...
INFO: Gathering PostgreSQL the oVirt Engine database and log files from localhost...
Please provide REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):
About to collect information from 3 hypervisors. Continue? (Y/n):
INFO: Gathering information from selected hypervisors...
INFO: collecting information from 192.168.122.250
INFO: collecting information from 192.168.122.251
INFO: collecting information from 192.168.122.252
INFO: finished collecting information from 192.168.122.250
INFO: finished collecting information from 192.168.122.251
INFO: finished collecting information from 192.168.122.252
Creating compressed archive...
INFO Log files have been collected and placed in /tmp/logcollector/sosreport-rhn-account-20110804121320-ce2a.tar.xz.
The MD5 for this file is 6d741b78925998caff29020df2b2ce2a and its size is 26.7M
</code></pre>

<h3 id="the-iso-uploader-tool">Инструмент загрузки ISO</h3>

<h4 id="the-iso-uploader-tool-1">Инструмент загрузки ISO — ISO uploader</h4>

<p>Инструмент загрузки ISO — это инструмент для загрузки образов ISO в домен хранилища ISO. Он устанавливается в составе oVirt.</p>

<p>Команда загрузки ISO: <code>engine-iso-uploader</code>. Для использования этой команды требуется авторизация с правами пользователя <code>root</code> и предоставить учётные данные администратора окружения oVirt. Команда <code>engine-iso-uploader -h</code> показывает информацию об использовании, включая список всех допустимых параметров команды <code>engine-iso-uploader</code>.</p>

<h4 id="syntax-for-the-engine-iso-uploader-command">Синтаксис команды engine-iso-uploader</h4>

<p>Команда ISO uploader имеет следующий базовый синтаксис:</p>

<pre class="highlight plaintext"><code>engine-iso-uploader [options] list
engine-iso-uploader [options] upload [file].[file]...[file]
</code></pre>

<p>Команда загрузки ISO поддерживает два действия — <em><code>list</code></em> и <em><code>upload</code></em>.</p>

<ul>
  <li>Действие <em><code>list</code></em> выводит список доменов хранилища ISO, в которые можно загрузить файлы ISO. oVirt создаёт этот список на той машине, где была установлена oVirt, во время процесса установки.</li>
  <li>Действие <em><code>upload</code></em> загружает единичный файл ISO или несколько файлов ISO, разделённых пробелами, на указанный домен хранилища ISO. По умолчанию используется NFS, также доступен SSH.</li>
</ul>

<p>При использовании команды загрузки ISO, необходимо указать одно из вышеуказанных действий. Кроме того, при использовании действия <em><code>upload</code></em> необходимо указать как минимум один локальный файл.</p>

<p>Для дальнейшей тонкой настройки команды <code>engine-iso-uploader</code> есть несколько дополнительных параметров.</p>

<p><strong>Общие параметры</strong></p>

<p><em><code>--version</code></em><br>
Выводит версию команды ISO uploader.</p>

<p><em><code>-h</code></em>, <em><code>--help</code></em><br>
Выводит информацию об использовании команды ISO uploader.</p>

<p><em><code>--conf-file=[ПУТЬ]</code></em><br>
Указывает <em>[ПУТЬ]</em> в качестве файла конфигурации, используемого командой. Значение по умолчанию: <code>/etc/ovirt-engine/isouploader.conf</code>.</p>

<p><em><code>--log-file=[ПУТЬ]</code></em><br>
Указывает <em>[ПУТЬ]</em> в качестве конкретного имени файла, используемого командой для записи вывода журнала. Значение по умолчанию: <code>/var/log/ovirt-engine/ovirt-iso-uploader/ovirt-iso-uploader[date].log</code>.</p>

<p><em><code>--cert-file=[PATH]</code></em><br>
Устанавливает <em>[ПУТЬ]</em> в качестве сертификата для валидации oVirt. Путь по умолчанию: <code>/etc/pki/ovirt-engine/ca.pem</code>.</p>

<p><em><code>--insecure</code></em><br>
Указывает, что валидация oVirt проводиться не будет.</p>

<p><em><code>--nossl</code></em><br>
Указывает, что SSL не будет использоваться для подключения к oVirt.</p>

<p><em><code>--quiet</code></em><br>
Устанавливает режим без сообщений, консольный вывод сведён к минимуму.</p>

<p><em><code>-v</code></em>, <em><code>--verbose</code></em><br>
Устанавливает режим подробной информации, подробный консольный вывод.</p>

<p><em><code>-f</code></em>, <em><code>--force</code></em><br>
Принудительный режим необходим в том случае, когда имя загружаемого исходного файла совпадает с именем уже существующего файла в целевом домене ISO. С этим параметром существующий файл будет заменён.</p>

<p><strong>Параметры oVirt</strong></p>

<p><em><code>-u [ПОЛЬЗОВАТЕЛЬ]</code></em>, <em><code>--user=[ПОЛЬЗОВАТЕЛЬ]</code></em><br>
Определяет пользователя, чьи учётные данные будут использованы при выполнении команды. <em>[ПОЛЬЗОВАТЕЛЬ]</em> указывается в формате <em>[имя_пользователя]</em>@<em>[домен]</em>. Пользователь должен существовать в указанном домене и быть известным для oVirt.</p>

<p><em><code>-r [FQDN]</code></em>, <em><code>--engine=[FQDN]</code></em><br>
Указывает IP-адрес или полное доменное имя oVirt, откуда будут загружаться образы. Предполагается, что загрузчик образов запускается на той же машине, на которой установлена oVirt. Значение по умолчанию: <code>localhost:443</code>.</p>

<p><strong>Параметры домена ISO</strong></p>

<p>Следующие параметры указывают домен ISO, в который будут загружены образы. Эти параметры нельзя использовать одновременно; указывается либо параметр <em><code>-i</code></em> либо параметр <em><code>-n</code></em>.</p>

<p><em><code>-i</code></em>, <em><code>--iso-domain=[ISODOMAIN]</code></em><br>
Указывает целевой домен хранилища <em>[ISODOMAIN]</em> в качестве целевого домена для загрузок.</p>

<p><em><code>-n</code></em>, <em><code>--nfs-server=[NFSSERVER]</code></em><br>
Указывает путь NFS <em>[NFSSERVER]</em> в качестве целевого пути для загрузок.</p>

<p><strong>Параметры подключения</strong></p>

<p>Инструмент загрузки ISO для загрузки файлов по умолчанию использует NFS. Эти параметры для загрузки файлов указывают протокол SSH.</p>

<p><em><code>--ssh-user=[ПОЛЬЗОВАТЕЛЬ]</code></em><br>
Указывает <em>[ПОЛЬЗОВАТЕЛЯ]</em> в качестве имени пользователя SSH, используемого для загрузки. Пользователь по умолчанию: <code>root</code>.</p>

<p><em><code>--ssh-port=[ПОРТ]</code></em><br>
Указывает <em>[ПОРТ]</em> в качестве порта, используемого для SSH-подключений.</p>

<p><em><code>-k [ФАЙЛ_КЛЮЧА]</code></em>, <em><code>--key-file=[ФАЙЛ_КЛЮЧА]</code></em><br>
Указывает <em>[ФАЙЛ_КЛЮЧА]</em> в качестве открытого ключа для SSH-аутентификации. В случае, если ключ ранее не был настроен, будет предложено ввести пароль пользователя, указанного параметром <em><code>--ssh-user=[ПОЛЬЗОВАТЕЛЬ]</code></em>.</p>

<h2 id="log-files">Файлы журналов</h2>

<h3 id="ovirt-installation-log-files">Файлы журналов установки oVirt</h3>

<p>⁠</p>

<p><strong>Таблица&nbsp;17.1.&nbsp;Установка</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Файл журнала</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>/var/log/ovirt-engine/engine-cleanup_гггг_мм_дд_чч_мм_сс.log</code></p></td>
<td align="left"><p>Журнал команды <code>engine-cleanup</code>. Это команда используется для отката установки oVirt. Журнал создаётся каждый раз при выполнении команды. Дата и время выполнения используется в имени файла, для возможности создания нескольких файлов.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>/var/log/ovirt-engine/engine-db-install-гггг_мм_дд_чч_мм_сс.log</code></p></td>
<td align="left"><p>Журнал команды <code>engine-setup</code>, содержащий подробности создания и настройки базы данных <code>rhevm</code>.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>/var/log/ovirt-engine/rhevm-dwh-setup-гггг_мм_дд_чч_мм_сс.log</code></p></td>
<td align="left"><p>Журнал команды <code>rhevm-dwh-setup</code>. Это команда, используемая для создания базы данных <code>ovirt_engine_history</code> для отчётов. Журнал создаётся каждый раз при выполнении команды. Дата и время выполнения используется в имени файла, для возможности создания нескольких файлов.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>/var/log/ovirt-engine/ovirt-engine-reports-setup-гггг_мм_дд_чч_мм_сс.log</code></p></td>
<td align="left"><p>Журнал команды <code>rhevm-reports-setup</code>. Эта команда используется для установки модулей oVirt Reports. Журнал создаётся каждый раз при выполнении команды. Дата и время выполнения используется в имени файла, для возможности создания несколько файлов.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>/var/log/ovirt-engine/setup/ovirt-engine-setup-гггг_ммддччммсс.log</code></p></td>
<td align="left"><p>Журнал команды <code>engine-setup</code>. Журнал создаётся каждый раз при выполнении команды. Дата и время выполнения используется в имени файла, для возможности создания несколько файлов.</p></td>
</tr>
</tbody>
</table>

<h3 id="ovirt-log-files">Файлы журналов oVirt</h3>

<p><strong>Таблица&nbsp;17.2.&nbsp;Действия службы</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Файл журнала</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>/var/log/ovirt-engine/engine.log</code></p></td>
<td align="left"><p>Отражает все аварийные завершения графического интерфейса oVirt, поиски в Active Directory, проблемы базы данных и другие события.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>/var/log/ovirt-engine/host-deploy</code></p></td>
<td align="left"><p>Файлы журналов хостов, развёрнутых из oVirt.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>/var/lib/ovirt-engine/setup-history.txt</code></p></td>
<td align="left"><p>Отслеживает установку и обновление пакетов, связанных с oVirt.</p></td>
</tr>
</tbody>
</table>

<h3 id="ovirt-host-log-files">Файлы журналов хоста oVirt</h3>

<p><strong>Таблица&nbsp;17.3.&nbsp; Файлы журналов хоста</strong></p>

<table>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Файл журнала</p></th>
<th align="left"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>/var/log/vdsm/libvirt.log</code></p></td>
<td align="left"><p>Файл журнала <code>libvirt</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>/var/log/vdsm/spm-lock.log</code></p></td>
<td align="left"><p>Файл журнала со сведениями о возможности получения хостом аренды роли диспетчера пула хранилища (SPM). Журнал даёт сведения о том, когда хост получил, закончил, обновил или получил сбой при обновлении аренды.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><code>/var/log/vdsm/vdsm.log</code></p></td>
<td align="left"><p>Файл журнала VDSM, агент oVirt на хостах виртуализации.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>/tmp/ovirt-host-deploy-@DATE@.log</code></p></td>
<td align="left"><p>Журнал разворачивания хоста, копируемый в oVirt как /var/log/ovirt-engine/host-deploy/ovirt-<em>@ДАТА@-@ХОСТ@-@ИДЕНТИФИКАТОР_КОРРЕЛЯЦИИ@</em>.log после успешного разворачивания хоста.</p></td>
</tr>
</tbody>
</table>

<h3 id="remotely-logging-host-activities">Действия удалённой авторизации хоста</h3>

<h4 id="setting-up-a-virtualization-host-logging-server">Настройка сервера авторизации хоста виртуализации</h4>

<p><strong>Описание задачи</strong></p>

<p>Хост oVirt создаёт и обновляет файлы журналов, куда записываются действия и проблемы oVirt. Централизованный сбор этих файлов журналов облегчает отладку.</p>

<p>Эта процедура должны быть выполнена на централизованном сервере журналирования. Можно использовать отдельный сервер журналирования или выполнить данную процедуру для включения журналирования хостов в oVirt.</p>

<p><strong>Инструкция&nbsp;17.1.&nbsp;Настройка сервера авторизации хоста виртуализации</strong></p>

<ol>
  <li>
    <p>Настройка SELinux на разрешение трафика <strong>rsyslog</strong>.</p>
    # semanage port -a -t syslogd_port_t -p udp 514</p>
  </li>
  <li>
    <p>Измените <code>/etc/rsyslog.conf</code> и добавьте следующие строки:</p>
    $template TmplAuth, "/var/log/%fromhost%/secure" 
    $template TmplMsg, "/var/log/%fromhost%/messages"</p>

<pre class="highlight plaintext"><code>$RuleSet remote
authpriv.*   ?TmplAuth
*.info,mail.none;authpriv.none,cron.none   ?TmplMsg
$RuleSet RSYSLOG_DefaultRuleset
$InputUDPServerBindRuleset remote
</code></pre>

    <p>Раскомментируйте следующие строки:</p>

<pre class="highlight plaintext"><code>#$ModLoad imudp
#$UDPServerRun 514
</code></pre>
  </li>
  <li>
    <p>Перезапустите службу rsyslog:</p>
    # service rsyslog restart</p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Централизованный сервер журналирования настроен для получения и хранения журналов <code>сообщений</code> и <code>безопасности</code> хостов виртуализации.</p>

<h4 id="configuring-ovirt-node-hosts-to-use-a-logging-server">Настройка хостов oVirt Node для использования сервера журналирования</h4>

<p><strong>Описание задачи</strong></p>

<p>Хосты oVirt создают и обновляют файлы журналов, куда записываются действия и проблемы хостов. Централизованный сбор файлов журналов облегчает отладку.</p>

<p>Выполните данную процедуру на хосте oVirt Node чтобы начать отсылку файлов журналов на централизованный сервер журналирования.</p>

<p>⁠</p>

<p><strong>Инструкция&nbsp;17.2.&nbsp;Настройка хостов oVirt Node для использования сервера журналирования</strong></p>

<ol>
  <li>Авторизуйтесь на хосте oVirt Node с правами <code>администратора</code> чтобы получить доступ к экрану настройки текстового пользовательского интерфейса (TUI) гипервизора.</li>
  <li>В списке параметров в левой части экрана выберите пункт <strong>Журналирование</strong>.</li>
  <li>Нажмите клавишу <strong>Tab</strong> чтобы получить доступ к полям ввода текста. Введите IP-адрес FQDN централизованного сервера журналирования и используемый им порт.</li>
  <li>Нажмите клавишу <strong>Tab</strong> чтобы получить доступ к пункту <strong>Применить</strong>, и нажмите клавишу <strong>Enter</strong>.</li>
</ol>

<p><strong>Результат</strong></p>

<p>Хост oVirt Node был настроен для отсылки файлов журналов на централизованный сервер журналирования.</p>

<h2 id="proxies">⁠Прокси</h2>

<h3 id="spice-proxy">SPICE-прокси</h3>

<h4 id="spice-proxy-overview">Обзор SPICE Proxy</h4>

<p>SPICE Proxy — это инструмент для подключения клиентов SPICE к гостевым системам в случаях, когда клиенты SPICE находятся вне сетей, соединяющих гипервизоры.</p>

<p>Настройка SPICE Proxy состоит из установки <strong>Squid</strong> на машине и настройки <strong>iptables</strong> для разрешения прохода трафика прокси через брандмауэр.</p>

<p>Для включения SPICE Proxy в oVirt выполняется <strong>engine-config</strong> для настройки <code>SpiceProxyDefault</code> на значение, состоящего из имени и порта прокси.</p>

<p>Для выключения SPICE Proxy в oVirt выполняется <strong>engine-config</strong> для удаления настроенного ранее значения <code>SpiceProxyDefault</code>.</p>

<h4 id="spice-proxy-machine-setup">Настройка машины в качестве SPICE Proxy</h4>

<p><strong>Описание задачи</strong></p>

<p>Далее описывается настройка машины в качестве SPICE Proxy. SPICE Proxy делает возможным подключения к сети oVirt извне сети. <strong>Squid</strong> используется в данной процедуре для предоставления сервисов прокси.</p>

<p><strong>Инструкция&nbsp;18.1.&nbsp;Установка Squid на машине с RHEL</strong></p>

<ol>
  <li>
    <p>Установка <strong>Squid</strong> на машине с Proxy:</p>
    # yum install squid</p>
  </li>
  <li>
    <p>Откройте <code>/etc/squid/squid.conf</code>. Измените</p>
    http_access deny CONNECT !SSL_ports</p>

    <p>на</p>

<pre class="highlight plaintext"><code>http_access deny CONNECT !Safe_ports
</code></pre>
  </li>
  <li>
    <p>Перезапустите прокси:
    # service squid restart</p>
  </li>
  <li>
    <p>Откройте порт squid по умолчанию:</p>
    # iptables -A INPUT -p tcp –dport 3128 -j ACCEPT</p>
  </li>
  <li>
    <p>Сделайте это правило iptables постоянным:</p>
    # iptables-save</p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы настроили машину для работы в качестве прокси SPICE. Перед подключением к сети oVirt извне сети, активируйте SPICE-прокси.</p>

<h4 id="turning-on-spice-proxy">Включение SPICE Proxy</h4>

<p><strong>Описание задачи</strong></p>

<p>Далее объясняется как активировать (или включить) SPICE-прокси.</p>

<p><strong>Инструкция&nbsp;18.2.&nbsp;Активация SPICE Proxy</strong></p>

<ol>
  <li>
    <p>Запустите в oVirt инструмент engine-config для настройки прокси:</p>
    # engine-config -s SpiceProxyDefault=someProxy</p>
  </li>
  <li>
    <p>Перезапустите службу <strong>ovirt-engine</strong>:</p>
    # service ovirt-engine restart</p>

    <p>Прокси имеет следующий формат:</p>

<pre class="highlight plaintext"><code>протокол://[хост]:[порт]
</code></pre>

    <div class="alert alert-info">
      <p><strong>Внимание:</strong> клиенты SPICE поддерживают только протокол http. При указанном https, клиент будет игнорировать параметы прокси и попытается установить прямое подключение к гипервизору</p>

    </div>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>SPICE Proxy был активирован (включен). Теперь имеется возможность подключения к сети oVirt через SPICE-прокси.</p>

<h4 id="turning-off-a-spice-proxy">Выключение SPICE Proxy</h4>

<p><strong>Описание задачи</strong></p>

<p>Далее объясняется, как выключить (деактивировать) SPICE-прокси.</p>

<p><strong>Инструкция&nbsp;18.3.&nbsp;Выключение SPICE Proxy</strong></p>

<ol>
  <li>
    <p>Авторизуйтесь в oVirt:</p>
    $ ssh root@[IP oVirt]</p>
  </li>
  <li>
    <p>Выполните следующую команду для очистки SPICE-прокси:</p>
    # engine-config -s SpiceProxyDefault=""</p>
  </li>
  <li>
    <p>Перезапустите oVirt:
    # service ovirt-engine restart</p>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>SPICE-прокси теперь деактивирован (выключен). Подключиться к сети oVirt через SPICE-прокси больше невозможно.</p>

<h3 id="squid-proxy">Squid-прокси</h3>

<h4 id="installing-and-configuring-a-squid-proxy">Установки и настройка Squid Proxy</h4>

<p><strong>Описание задачи</strong></p>

<p>В данном разделе объясняется, как установить и настроить Squid Proxy до Пользовательского портала.</p>

<p><strong>Инструкция&nbsp;18.4.&nbsp;Настройка Squid Proxy</strong></p>

<ol>
  <li><strong>Получение пары ключей</strong>
Получение пары ключей и сертификата для порта HTTPS прокси-сервера Squid.
Эту пару ключей можно получить точно так же, как и для любой другой службы SSL/TLS. Пара ключей состоит из двух файлов формата PEM, содержащих закрытый ключ и подписанный сертификат. В нашем документе мы предполагаем, что файлы имеют имена <code>proxy.key</code> и <code>proxy.cer</code>.
Пару ключей и сертификат такж можно создать с помощью центра сертификации ЦУ oVirt. В случае, если закрытый ключ и сертификат прокси уже имеются, и вы не хотите создавать их с помощью центра сертификации ЦУ oVirt, переходите к следующему шагу.</li>
  <li>
    <p><strong>Создание пары ключей</strong>
Выберите имя хоста прокси. В нашем примере прокси называется <code>proxy.example.com</code>.
Выберите оставшуюся часть отличительного имени сертификата прокси. Здесь важно обратить внимание на «обычное имя», которое содержит имя хоста прокси. Браузеры пользователей используют обычное имя для проверки подключения. Рекомендуется использовать ту же страну и то же имя организации, что используется в ЦУ oVirt. Найдите эту информацию, авторизовавшись на машине с ЦУ oVirt и выполнив следующую команду:</p>
    [root@engine ~]# openssl x509 -in /etc/pki/ovirt-engine/ca.pem -noout -subject</p>

    <p>Вывод этой команды будет примерно следующим:</p>

<pre class="highlight plaintext"><code>subject= /C=US/O=Example Inc./CN=engine.example.com.81108
</code></pre>

    <p>Нужная нам информация: <code>/C=us/O=Example Inc.</code>. Используйте её для создания полного отличительного имени сертификата прокси:</p>

<pre class="highlight plaintext"><code>/C=US/O=Example Inc./CN=proxy.example.com
</code></pre>

    <p>Авторизуйтесь на машине прокси и создайте запрос подписи сертификата:</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# openssl req -newkey rsa:2048 -subj '/C=US/O=Example Inc./CN=proxy.example.com' -nodes -keyout proxy.key -out proxy.req
</code></pre>

    <div class="alert alert-info">
      <p><strong>Внимание:</strong> кавычки, в которые взято отличительное имя сертификата, очень важны. Не опускайте их.</p>

    </div>
    <p>Эта команда создаст пару ключей. Очень важно, чтобы закрытый ключ не был зашифрован (за это отвечает параметр -nodes), потому что в противном случае для запуска прокси-сервера понадобится вводить пароль.
Вывод команды выглядит следующим образом:</p>

<pre class="highlight plaintext"><code>Generating a 2048 bit RSA private key
......................................................+++
.................................................................................+++
writing new private key to 'proxy.key'
-----
</code></pre>

    <p>Команда создаст два файла: <code>proxy.key</code> и <code>proxy.req</code>. Файл <code>proxy.key</code> является закрытым ключём. Берегите его. Файл <code>proxy.req</code> — это запрос подписи сертификата. Файлу <code>proxy.req</code> особая защита не нужна. Для создания пописанного сертификата скопируйте файл <code>private.csr</code> на машину с ЦУ oVirt, используя команду <strong>scp</strong>:</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# scp proxy.req engine.example.com:/etc/pki/ovirt-engine/requests/.
</code></pre>

    <p>Авторизуйтесь на машине с ЦУ oVirt и запустите следующую команду чтобы подписать сертификат:</p>

<pre class="highlight plaintext"><code>[root@engine ~]# /usr/share/ovirt-engine/bin/pki-enroll-request.sh --name=proxy --days=3650 --subject='/C=US/O=Example Inc./CN=proxy.example.com'
</code></pre>

    <p>Сертификат будет подписан и будет действителен в течении 10 лет (3650 дней). Если необходимо, установите меньший срок годности сертификата.
Вывод команды выглядит следующим образом:</p>

<pre class="highlight plaintext"><code>Using configuration from openssl.conf
Check that the request matches the signature
Signature ok
The Subject's Distinguished Name is as follows
countryName           :PRINTABLE:'US'
organizationName      :PRINTABLE:'Example Inc.'
commonName            :PRINTABLE:'proxy.example.com'
Certificate is to be certified until Jul 10 10:05:24 2023 GMT (3650
days)

Write out database with 1 new entries
Data Base Updated
</code></pre>

    <p>Созданный файл сертификата доступен в каталоге <code>/etc/pki/ovirt-engine/certs</code> и должен иметь имя <code>proxy.cer</code>. Скопируйте этот файл на машину прокси:</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# scp engine.example.com:/etc/pki/ovirt-engine/certs/proxy.cer .
</code></pre>

    <p>Убедитесь, что оба файла, и <code>proxy.key</code> и <code>proxy.cer</code>, присутствуют на машине прокси:</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# ls -l proxy.key proxy.cer
</code></pre>

    <p>Вывод команды будет выглядеть следующим образом:</p>

<pre class="highlight plaintext"><code>-rw-r--r--. 1 root root 4902 Jul 12 12:11 proxy.cer
-rw-r--r--. 1 root root 1834 Jul 12 11:58 proxy.key
</code></pre>

    <p>Мы готовы к установке и настройке прокси-сервера.</p>
  </li>
  <li>
    <p><strong>Установка пакета прокси-сервера Squid</strong></p>
Установите систему следующим образом:</p>
    [root@proxy ~]# yum -y install squid</p>
  </li>
  <li>
    <p><strong>Настройка проки-сервера Squid</strong></p>
Переместите закрытый ключ и подписанный сертификат в то местоположение, где у прокси будет доступ к этим файлам, например, в каталог <code>/etc/squid</code>:</p>
    [root@proxy ~]# cp proxy.key proxy.cer /etc/squid/.</p>

    <p>Разрешите пользователю "squid" доступ на чтение этих файлов:</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# chgrp squid /etc/squid/proxy.*
[root@proxy ~]# chmod 640 /etc/squid/proxy.*
</code></pre>

    <p>Squid-прокси подключится к веб-серверу ЦУ oVirt, используя протокол SSL, и должен будет проверить сертификат, используемый oVirt. Скопируйте сертификат того центра сертификации, который подписал сертификат веб-сервера ЦУ oVirt, в местоположение, где у прокси будет к нему доступ, например <code>/etc/squid</code>. Стандартный сертификат центра сертификации расположен в файле <code>/etc/pki/ovirt-engine/ca.pem</code> на машине ЦУ oVirt. Скопируйте его при помощи следующей команды:</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# scp engine.example.com:/etc/pki/ovirt-engine/ca.pem /etc/squid/.
</code></pre>

    <p>Убедитесь, что пользователь <code>squid</code> может читать этот файл:</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# chgrp squid /etc/squid/ca.pem
[root@proxy ~]# chmod 640 /etc/squid/ca.pem
</code></pre>

    <p>Для принудительного режима SELinux измените контекст порта 443 с помощью утилиты <strong>semanage</strong>, разрешив Squid использовать порт 443.</p>

<pre class="highlight plaintext"><code>[root@proxy ~]# yum install -y policycoreutils-python
[root@proxy ~]# semanage port -m -p tcp -t http_cache_port_t 443
</code></pre>

    <p>Замените существующий файл конфигурации squid следующим образом:</p>

<pre class="highlight plaintext"><code>https_port 443 key=/etc/squid/proxy.key cert=/etc/squid/proxy.cer ssl-bump defaultsite=engine.example.com
cache_peer engine.example.com parent 443 0 no-query originserver ssl sslcafile=/etc/squid/ca.pem name=engine
cache_peer_access engine allow all
ssl_bump allow all
http_access allow all
</code></pre>
  </li>
  <li>
    <p><strong>Перезапуск прокси-сервер Squid</strong></p>
Выполните следующую команду на машине прокси:</p>
    [root@proxy ~]# service squid restart</p>
  </li>
  <li><strong>Настройка websockets proxy</strong>
    <div class="alert alert-info">
      <p><strong>Внимание:</strong> этот шаг является необязательным. Он необходим только в случае использования консоли noVNC или консоли SPICE HTML 5.</p>

    </div>
    <p>В случае использования консолей noVNC или SPICE HTML 5, для подключения к консолям виртуальных машин, на машине, где установлен ЦУ oVirt, необходимо настроить прокси-сервер websocket. Если ранее, при установке или обновлении ЦУoVirt, во время выполнения команды <code>engine-setup</code> была выбрана настройка прокси-сервера websocket, то он уже настроен. В противном случае, прокси-сервер websocket можно настроить позже, запустив команду <code>engine-setup</code> со следующим параметром:</p>

<pre class="highlight plaintext"><code>engine-setup --otopi-environment="OVESETUP_CONFIG/websocketProxyConfig=bool:True"
</code></pre>

    <p>Также необходимо убедиться, что служба <strong>ovirt-websocket-proxy</strong> запущена, и настроена на автоматический запуск во время загрузки:</p>

<pre class="highlight plaintext"><code>[root@engine ~]# service ovirt-websocket-proxy status
[root@engine ~]# chkconfig ovirt-websocket-proxy on
</code></pre>

    <p>Для подключения к ВМ, консоли noVNC и SPICE HTML 5 используют протокол websocket, но прокси-сервер squid не поддерживает протокол websocket, поэтому использование Squid невозможно. Система должна подключаться напрямую к прокси websockets, выполняемому на машине с установленным ЦУ oVirt. Для этого обновите параметр конфигурации <code>WebSocketProxy</code> с помощью утилиты "engine-config":</p>

<pre class="highlight plaintext"><code>[root@engine ~]# engine-config \
-s WebSocketProxy=engine.example.com:6100
[root@engine ~]# service ovirt-engine restart
</code></pre>

    <div class="alert alert-info">
      <p><strong>Важно:</strong> если этот шаг будет пропущен, клиенты будут предполагать, что websockets-прокси работает на прокси-машине, соответственно подключение выполнить будет невозможно.</p>

    </div>
  </li>
  <li>
    <p><strong>Подключение к Пользовательскому порталу с помощью полного URL</strong></p>
Подключитесь к Пользовательскому порталу с ипользованием полного адреса URL, например:</p>
    https://proxy.example.com/UserPortal/org.ovirt.engine.ui.userportal.UserPortal/UserPortal.html</p>

    <div class="alert alert-info">
      <p><strong>Внимание:</strong> сокращённые URL, такие, как <code>https://proxy.example.com/UserPortal</code>, дадут сбой. Подобные короткие адреса URL перенаправляются на длинные сервером приложений, с использованием кода ответа 302 и заголовка местоположения. Версия <strong>Squid</strong> в Red Hat Enterprise Linux и Fedora (<strong>Squid</strong> версии 3.1) не поддерживает перезапись этих заголовков.</p>

    </div>
  </li>
</ol>

<p><strong>Результат</strong></p>

<p>Мы установили и настроили Squid-прокси на Пользовательском портале.</p>

<h2 id="firewalls">Брандмауэры</h2>

<h3 id="ovirt-firewall-requirements">Требования к брандмауэру ⁠oVirt</h3>

<p>Для разрешения пропуска сетевого трафика сквозь системный брандмауэр, несколько портов oVirt должны быть открыты. Сценарий <code>engine-setup</code> может настроить брандмауэр автоматичеcки, но перезаписывает его предыдущую конфигурацию.</p>

<p>Там, где брандмаэур уже настроен, необходимо вручную вставить правила, необходимые oVirt. Команда <code>engine-setup</code> сохраняет список правил <code>iptables</code>, необходимых для файла <code>/usr/share/ovirt-engine/conf/iptables.example</code>.</p>

<p>Указанная здесь настойка брандмауэра подразумевает стандартные значения параметров. Там, где при установке были выбраны нестандартные порты HTTP и HTTPS, настройте правила так, чтобы разрешить сетевой трафик на выбранных портах, а не на портах по умолчанию, указанных в наших примерах (<code>80</code> и <code>443</code>).</p>

<p><strong>Таблица&nbsp;A.1.&nbsp;Требования брандмауэра oVirt</strong></p>

<table>
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Порт(ы)</p></th>
<th align="left"><p>Протокол</p></th>
<th align="left"><p>Источник</p></th>
<th align="left"><p>Назначение</p></th>
<th align="left"><p>Цель</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>-</p></td>
<td align="left"><p>ICMP</p></td>
<td align="left"><ul>
<li>oVirt Node<br></li>
<li>Хост(ы) Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><p>Во время регистрации в oVirt, хосты виртуализации посылают в oVirt запрос команды проверки связи ICMP для подтверждения его присутствия в сети.</p></td>
</tr>
<tr class="even">
<td align="left"><p>22</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>Системы, используемые для обслуживания oVirt, включая фоновую настройку и обновление ПО.</li>
</ul></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><p>SSH (по желанию)</p></td>
</tr>
<tr class="odd">
<td align="left"><p>80, 443</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>Клиенты Портала администрирования<br></li>
<li>Клиенты Пользовательского портала<br></li>
<li>oVirt Node<br></li>
<li>Хост(ы) Red Hat Enterprise Linux<br></li>
<li>Клиенты REST API<br></li>
</ul></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><p>Предоставляет доступ к oVirt по протоколам HTTP и HTTPS.</p></td>
</tr>
</tbody>
</table>

<div class="alert alert-info">
  <p><strong>Важно:</strong> в тех окружениях, где от oVirt также требуется экспорт хранилища NFS, например, домена хранилища ISO, дополнительным портам требуется разрешение проведения трафика через брандмауэр. Примените исключения брандмауэра для портов, соответственно используемой версии NFS:</p>

  <p><strong>NFSv4</strong><br>
Порт TCP <code>2049</code> для NFS.</p>

  <p><strong>NFSv3</strong><br>
Порты TCP и UDP <code>2049</code> для NFS.</p>

  <p>Порты TCP и UDP <code>111</code> (<code>rpcbind</code>/<code>sunrpc</code>).</p>

  <p>Порты TCP и UDP, указанные параметром <code>MOUNTD_PORT="порт"</code></p>

  <p>Порты TCP и UDP, указанные параметром <code>STATD_PORT="порт"</code></p>

  <p>Порт TCP, указанный параметром <code>LOCKD_TCPPORT="порт"</code></p>

  <p>Порт UDP, указанный параметром <code>LOCKD_UDPPORT="порт"</code></p>

</div>

<p>Порты <code>MOUNTD_PORT</code>, <code>STATD_PORT</code>, <code>LOCKD_TCPPORT</code> и <code>LOCKD_UDPPORT</code> настроены в файле <code>/etc/sysconfig/nfs</code>.</p>

<h3 id="virtualization-host-firewall-requirements">⁠Требования брандмауэра хоста виртуализации</h3>

<p>Хосты Red Hat Enterprise Linux и узлы oVirt Node требуют открытия нескольких портов для разрешения передачи трафика через системный брандмауэр. В случае oVirt Node эти правила настраиваются автоматически, но для хостов Red Hat Enterprise Linux необходима ручная настройка.</p>

<p><strong>Таблица&nbsp;A.2.&nbsp;Требования брандмауэра хоста виртуализации</strong></p>

<table>
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Порт(ы)</p></th>
<th align="left"><p>Протокол</p></th>
<th align="left"><p>Источник</p></th>
<th align="left"><p>Назначение</p></th>
<th align="left"><p>Цель</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>22</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><ul>
<li>oVirt Node</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><p>Доступ Secure Shell (SSH).</p></td>
</tr>
<tr class="even">
<td align="left"><p>161</p></td>
<td align="left"><p>UDP</p></td>
<td align="left"><ul>
<li>Гипервизоры Red Hat Enterprise Linux</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><p>Протокол Simple network management (SNMP).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>5900-6923</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>Клиенты Портала администрирования</li>
<li>Клиенты Пользовательского портала</li>
</ul></td>
<td align="left"><ul>
<li>oVirt Node</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><p>Удалённый гостевой консольный доступ через VNC и SPICE. Эти порты должны быть открыты для облегчения клиентского доступа к ВМ.</p></td>
</tr>
<tr class="even">
<td align="left"><p>5989</p></td>
<td align="left"><p>TCP, UDP</p></td>
<td align="left"><ul>
<li>Диспетчер объектов CIM (CIMOM)</li>
</ul></td>
<td align="left"><ul>
<li>oVirt Nodes</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><p>Используется диспетчерами объектов CIM для наблюдения за ВМ, выполняемыми на хосте виртуализации. Использование CIMOM для наблюдения за виртуальными машинами в виртуализованныом окружении требует открытия этого порта.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>16514</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>oVirt Node</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><ul>
<li>oVirt Node</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><p>Миграция ВМ с использованием <code>libvirt</code>.</p></td>
</tr>
<tr class="even">
<td align="left"><p>49152-49216</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>Гипервизоры Red Hat Enterprise Linux</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><ul>
<li>Гипервизоры Red Hat Enterprise Linux</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><p>Миграция и проведение операции блокады ВМ с использованием VDSM. Эти порты должны быть открыты для облегчения как автоматического, так и ручного запуска миграции виртуальных машин.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>54321</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>oVirt</li>
<li>oVirt Node</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><ul>
<li>oVirt Node</li>
<li>Хосты Red Hat Enterprise Linux</li>
</ul></td>
<td align="left"><p>Связь VDSM с oVirt и другими хостами виртуализации.</p></td>
</tr>
</tbody>
</table>

<p><strong>Пример&nbsp;A.1.&nbsp;Имя параметра: IPTablesConfig</strong></p>

<p>Рекомендуемые (стандартные) значения: созданные автоматически сценарием vdsm bootstrap</p>

<pre class="highlight plaintext"><code>*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
# vdsm
-A INPUT -p tcp --dport 54321 -j ACCEPT
# libvirt tls
-A INPUT -p tcp --dport 16514 -j ACCEPT
# SSH
-A INPUT -p tcp --dport 22 -j ACCEPT
# guest consoles
-A INPUT -p tcp -m multiport --dports 5900:6923 -j ACCEPT
# migration
-A INPUT -p tcp -m multiport --dports 49152:49216 -j ACCEPT
# snmp
-A INPUT -p udp --dport 161 -j ACCEPT
# Reject any other input traffic
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -m physdev ! --physdev-is-bridged -j REJECT --reject-with icmp-host-prohibited
COMMIT
</code></pre>

<h3 id="directory-server-firewall-requirements">⁠Требования брандмауэра для сервера каталогов</h3>

<p>Для авторизации пользователей oVirt использует сервер каталогов. Для поддержки авторизации GSS-API, используемой в oVirt, в брандмауэре сервера каталогов необходимо открыть несколько портов.</p>

<p><strong>Таблица&nbsp;A.3.&nbsp;Требования брандмауэра хоста</strong></p>

<table>
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Порт(ы)</p></th>
<th align="left"><p>Протокол</p></th>
<th align="left"><p>Источник</p></th>
<th align="left"><p>Назначение</p></th>
<th align="left"><p>Цель</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>88, 464</p></td>
<td align="left"><p>TCP, UDP</p></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><ul>
<li>Сервер каталогов</li>
</ul></td>
<td align="left"><p>Аутентификация Kerberos.</p></td>
</tr>
<tr class="even">
<td align="left"><p>389, 636</p></td>
<td align="left"><p>TCP</p></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><ul>
<li>Сервер каталогов</li>
</ul></td>
<td align="left"><p>Lightweight Directory Access Protocol (LDAP) и LDAP через SSL.</p></td>
</tr>
</tbody>
</table>

<h3 id="database-server-firewall-requirements">Требования брандмауэра для сервера базы данных</h3>

<p>oVirt поддерживает использование удалённого сервера баз данных. Если oVirt планируется использовать с удалённым сервером баз данных, то необходимо убедиться, что на сервере разрешены подключения из oVirt.</p>

<p><strong>Таблица&nbsp;A.4.&nbsp;Требования брандмауэра хоста</strong></p>

<table>
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Порт(ы)</p></th>
<th align="left"><p>Протокол</p></th>
<th align="left"><p>Источник</p></th>
<th align="left"><p>Назначение</p></th>
<th align="left"><p>Цель</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>5432</p></td>
<td align="left"><p>TCP, UDP</p></td>
<td align="left"><ul>
<li>oVirt</li>
</ul></td>
<td align="left"><ul>
<li>Сервер базы данных PostgreSQL</li>
</ul></td>
<td align="left"><p>Порт по умолчанию для подключений базы данных PostgreSQL.</p></td>
</tr>
</tbody>
</table>

<p>Если планируется использование локального сервера баз данных непосредственно в oVirt, что является значением по умолчанию во время установки, то дополнительные правила брандмауэра не требуются.</p>

<h2 id="ovirt-and-ssl">oVirt и SSL</h2>

<h3 id="replacing-ovirt-ssl-certificate">⁠Замена сертификата oVirt SSL</h3>

<p><strong>Описание задачи</strong></p>

<p>Использование коммерчески подписанного сертификата вашей организации для идентификации oVirt пользователями, подключающимися по протоколу https.</p>

<div class="alert alert-info">
  <p><strong>Внимание:</strong> использование коммерчески выданного сертификата для подключений по протоколу https не влияет на сертификат, используемый для аутентификации между oVirt и хостами, для этого будет по-прежнему использоваться самоподписанный сертификат, созданный oVirt.</p>

</div>
<p>Предварительные требования</p>

<p>Для данной процедуры потребуется сертификат в формате <em>PEM</em>, выданный коммерческим центром сертификации, файлы <em>.nokey</em> и <em>.cer</em>. Файлы <em>.nokey</em> и <em>.cer</em> иногда распространяются в виде пакета «сертификат-ключ», имеющего формат <em>P12</em>.</p>

<p>Далее подразумевается, что у нас имеется пакет «сертификат-ключ» в формате <em>P12</em>.</p>

<p><strong>Инструкция&nbsp;B.1.&nbsp;Замена сертификата oVirt Apache SSL</strong></p>

<ol>
  <li>
    <p>Параметры oVirt были настроены на использование <code>/etc/pki/ovirt-engine/apache-ca.pem</code>, являющегося символьной ссылкой на <code>/etc/pki/ovirt-engine/ca.pem</code>. Удалите символьную ссылку.</p>
    # rm /etc/pki/ovirt-engine/apache-ca.pem</p>
  </li>
  <li>
    <p>Сохраните коммерчески выданный сертификат в виде <code>/etc/pki/ovirt-engine/apache-ca.pem</code>.</p>
    mv YOUR-3RD-PARTY-CERT.pem /etc/pki/ovirt-engine/apache-ca.pem</p>
  </li>
  <li>Переместите пакет <em>P12</em> в <code>/etc/pki/ovirt-engine/keys/apache.p12</code>.</li>
  <li>
    <p>Извлеките ключ из пакета.</p>
    # openssl pkcs12 -in  /etc/pki/ovirt-engine/keys/apache.p12 -nocerts -nodes &gt; /etc/pki/ovirt-engine/keys/apache.key.nopass</p>
  </li>
  <li>
    <p>Извлеките сертификат из пакета.</p>
    # openssl pkcs12 -in /etc/pki/ovirt-engine/keys/apache.p12 -nokeys &gt; /etc/pki/ovirt-engine/certs/apache.cer</p>
  </li>
  <li>Перезапустите сервер Apache.</p>
    # service httpd restart</li>
</ol>

<p><strong>Результат</strong></p>

<p>При подключении пользователей к порталам больше не выводится предупреждение о подлинности сертификата, используемого для шифрования трафика https.</p>

<h2 id="authors-and-revision-history">Авторы и история редакций</h2>

<p><strong>Jodi Biddle</strong></p>

<p>Red Hat Engineering Content Services</p>

<pre class="highlight plaintext"><code>  jbiddle@redhat.com
</code></pre>

<p><strong>Andrew Burden</strong></p>

<p>Red Hat Engineering Content Services</p>

<pre class="highlight plaintext"><code>  aburden@redhat.com
</code></pre>

<p><strong>Lucy Bopf</strong></p>

<p>Red Hat Engineering Content Services</p>

<pre class="highlight plaintext"><code>  lbopf@redhat.com
</code></pre>

<p><strong>Andrew Dahms</strong></p>

<p>Red Hat Engineering Content Services</p>

<pre class="highlight plaintext"><code>  adahms@redhat.com
</code></pre>

<p><strong>Zac Dover</strong></p>

<p>Red Hat Engineering Content Services</p>

<pre class="highlight plaintext"><code>  zdover@redhat.com
</code></pre>

<p>Revision 1.0-1</p>

<p>Wed 25 Jun 2014</p>

<p><strong>Lucy Bopf</strong></p>

<table>
  <tbody>
    <tr>
      <td>Initial creation for oVirt Engine test build for Brian Proffitt.</td>
    </tr>
  </tbody>
</table>

<h2>Перевод на русский язык</h2>
<p><strong>Юлия Дронова</strong></p>
<p>18.05.2016</p>
<pre class="highlight plaintext"><code>  juliette.tux@gmail.com
</code></pre>
<p><strong>Алексей Бутырин</strong></p>
<p>18.05.2016</p>
<pre class="highlight plaintext"><code>  a.butyrin@ntcit-rosa.ru
</code></pre>


<h2 id="legal-notice">Правовая информация</h2>

<p>© 2014 Red Hat, Inc.</p>

<p>Этот документ предоставляется компанией Red Hat по лицензии <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>. В случае распространения этого документа или его изменённой версии, необходимо указание авторства Red Hat, Inc. и предоставление ссылки на оригинал. В случае изменения документа, все товарные знаки Red Hat должны быть удалены.</p>

<p>Как лицензиар данного документа, компания Red Hat будет отменять или не утверждать раздел 4d лицензии CC-BY-SA во всех установленных законом случаях.</p>

<p>Red Hat, Red Hat Enterprise Linux, логотип Shadowman, JBoss, MetaMatrix, Fedora, логотип Infinity и RHCE являются товарными знаками Red Hat, Inc., зарегистрированными в США и других странах.</p>

<p>Linux® является зарегистрированным товарным знаком Линуса Торвальдса (Linus Torvalds) в США и других странах.</p>

<p>Java® является зарегистрированным товарным знаком Oracle и/или зависимых обществ.</p>

<p>XFS® является зарегистрированным товарным знаком Silicon Graphics International Corp. или её дочерних компаний в США и/или в других странах.</p>

<p>MySQL® является зарегистрированным товарным знаком MySQL AB в США, Европейском Союзе и в других странах.</p>

<p>Node.js® является официальным товарным знаком Joyent. Red Hat Software Collections не являются формально санкционированными или связанными с официальным коммерческим или открытым проектом Joyent Node.js.</p>

<p>Текстовый символ OpenStack® и логотип OpenStack являются либо зарегистрированными товарными знаками/знаками обслуживания либо товарными знаками/знаками обслуживания OpenStack Foundation в США и других странах, и используются с разрешения OpenStack Foundation. Мы не связаны, не санкционированы и не финансируемся ни фондом OpenStack Foundation ни сообществом OpenStack.</p>

<p>Все другие товарные знаки являются собственностью их соответствующих владельцев.</p>

</section>
</section>
</section>
<footer class="text-center" id="footer">
<hr class="visible-print">
<ul class="footer-nav-list">
<li><a target="_blank" href="http://www.ovirt.org/privacy/">Политика конфиденциальности</a></li>
<li><a target="_blank" href="http://www.ovirt.org/about/">О программе</a></li>
<li><a target="_blank" href="http://www.ovirt.org/disclaimers/">Отказ от ответственности</a></li>
</ul>

© 2013–2016 oVirt
<div class="edit-this-page">
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/documentation/admin-guide/administration-guide.html.md"><i class="icon fa fa-pencil"></i>Edit this page on GitHub</a>
</div>
<div class="last-modified">
Page last modified
Fri 18 Mar 2016 10:39 UTC
</div>
</footer>


<script src="./OVirt Administration Guide — oVirt_files/application.js" type="text/javascript"></script>

<!-- eloqua -->
<script src="http://www.redhat.com/j/elqNow/elqCfg.js" type="text/javascript"></script>
<script src="http://www.redhat.com/j/elqNow/elqImg.js" type="text/javascript"></script>



<script async="" src="http://dl.metabar.ru/static/js/sovetnik.min.js?mbr=true&settings=%7B%22affId%22%3A1020%2C%22clid%22%3A2210496%2C%22applicationName%22%3A%22SaveFrom%22%2C%22aviaEnabled%22%3Atrue%2C%22offerEnabled%22%3Atrue%7D" charset="UTF-8"></script></body></html>
